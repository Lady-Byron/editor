(()=>{var t={709(t){"use strict";var e,n=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,s={};function a(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}((t,e)=>{for(var r in e)n(t,r,{get:e[r],enumerable:!0})})(s,{Hooks:()=>mt,Lexer:()=>dt,Marked:()=>vt,Parser:()=>pt,Renderer:()=>ft,TextRenderer:()=>ht,Tokenizer:()=>ut,defaults:()=>c,getDefaults:()=>a,lexer:()=>Tt,marked:()=>yt,options:()=>kt,parse:()=>Ct,parseInline:()=>St,parser:()=>Mt,setOptions:()=>bt,use:()=>wt,walkTokens:()=>xt}),t.exports=(e=s,((t,e,s,a)=>{if(e&&"object"==typeof e||"function"==typeof e)for(let s of o(e))i.call(t,s)||void 0===s||n(t,s,{get:()=>e[s],enumerable:!(a=r(e,s))||a.enumerable});return t})(n({},"__esModule",{value:!0}),e));var c={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};function l(t){c=t}var u={exec:()=>null};function d(t,e=""){let n="string"==typeof t?t:t.source;const r={replace:(t,e)=>{let o="string"==typeof e?e:e.source;return o=o.replace(f.caret,"$1"),n=n.replace(t,o),r},getRegex:()=>new RegExp(n,e)};return r}var f={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[\t ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ \t][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},h=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,p=/(?:[*+-]|\d{1,9}[.)])/,m=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,v=d(m).replace(/bull/g,p).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),g=d(m).replace(/bull/g,p).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),y=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,k=/(?!\s*\])(?:\\.|[^\[\]\\])+/,b=d(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",k).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),w=d(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,p).getRegex(),x="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",S=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,C=d("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ \t]*)+\\n|$))","i").replace("comment",S).replace("tag",x).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),M=d(y).replace("hr",h).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",x).getRegex(),T={blockquote:d(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",M).getRegex(),code:/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,def:b,fences:/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,heading:/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,hr:h,html:C,lheading:v,list:w,newline:/^(?:[ \t]*(?:\n|$))+/,paragraph:M,table:u,text:/^[^\n]+/},A=d("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",h).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}\t)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",x).getRegex(),O={...T,lheading:g,table:A,paragraph:d(y).replace("hr",h).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",A).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",x).getRegex()},E={...T,html:d("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",S).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:u,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:d(y).replace("hr",h).replace("heading"," *#{1,6} *[^\n]").replace("lheading",v).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},N=/^( {2,}|\\)\n(?!\s*$)/,R=/[\p{P}\p{S}]/u,D=/[\s\p{P}\p{S}]/u,I=/[^\s\p{P}\p{S}]/u,L=d(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,D).getRegex(),P=/(?!~)[\p{P}\p{S}]/u,z=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,B=d(z,"u").replace(/punct/g,R).getRegex(),$=d(z,"u").replace(/punct/g,P).getRegex(),H="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",_=d(H,"gu").replace(/notPunctSpace/g,I).replace(/punctSpace/g,D).replace(/punct/g,R).getRegex(),j=d(H,"gu").replace(/notPunctSpace/g,/(?:[^\s\p{P}\p{S}]|~)/u).replace(/punctSpace/g,/(?!~)[\s\p{P}\p{S}]/u).replace(/punct/g,P).getRegex(),F=d("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,I).replace(/punctSpace/g,D).replace(/punct/g,R).getRegex(),V=d(/\\(punct)/,"gu").replace(/punct/g,R).getRegex(),W=d(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),q=d(S).replace("(?:--\x3e|$)","--\x3e").getRegex(),K=d("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",q).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),U=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,J=d(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",U).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),G=d(/^!?\[(label)\]\[(ref)\]/).replace("label",U).replace("ref",k).getRegex(),Z=d(/^!?\[(ref)\](?:\[\])?/).replace("ref",k).getRegex(),Q={_backpedal:u,anyPunctuation:V,autolink:W,blockSkip:/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<[^<>]*?>/g,br:N,code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,del:u,emStrongLDelim:B,emStrongRDelimAst:_,emStrongRDelimUnd:F,escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,link:J,nolink:Z,punctuation:L,reflink:G,reflinkSearch:d("reflink|nolink(?!\\()","g").replace("reflink",G).replace("nolink",Z).getRegex(),tag:K,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,url:u},X={...Q,link:d(/^!?\[(label)\]\((.*?)\)/).replace("label",U).getRegex(),reflink:d(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",U).getRegex()},Y={...Q,emStrongRDelimAst:j,emStrongLDelim:$,url:d(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},tt={...Y,br:d(N).replace("{2,}","*").getRegex(),text:d(Y.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},et={normal:T,gfm:O,pedantic:E},nt={normal:Q,gfm:Y,breaks:tt,pedantic:X},rt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ot=t=>rt[t];function it(t,e){if(e){if(f.escapeTest.test(t))return t.replace(f.escapeReplace,ot)}else if(f.escapeTestNoEncode.test(t))return t.replace(f.escapeReplaceNoEncode,ot);return t}function st(t){try{t=encodeURI(t).replace(f.percentDecode,"%")}catch{return null}return t}function at(t,e){const n=t.replace(f.findPipe,(t,e,n)=>{let r=!1,o=e;for(;--o>=0&&"\\"===n[o];)r=!r;return r?"|":" |"}).split(f.splitPipe);let r=0;if(n[0].trim()||n.shift(),n.length>0&&!n.at(-1)?.trim()&&n.pop(),e)if(n.length>e)n.splice(e);else for(;n.length<e;)n.push("");for(;r<n.length;r++)n[r]=n[r].trim().replace(f.slashPipe,"|");return n}function ct(t,e,n){const r=t.length;if(0===r)return"";let o=0;for(;o<r;){const i=t.charAt(r-o-1);if(i!==e||n){if(i===e||!n)break;o++}else o++}return t.slice(0,r-o)}function lt(t,e,n,r,o){const i=e.href,s=e.title||null,a=t[1].replace(o.other.outputLinkReplace,"$1");r.state.inLink=!0;const c={type:"!"===t[0].charAt(0)?"image":"link",raw:n,href:i,title:s,text:a,tokens:r.inlineTokens(a)};return r.state.inLink=!1,c}var ut=class{options;rules;lexer;constructor(t){this.options=t||c}space(t){const e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){const e=this.rules.block.code.exec(t);if(e){const t=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?t:ct(t,"\n")}}}fences(t){const e=this.rules.block.fences.exec(t);if(e){const t=e[0],n=function(t,e,n){const r=t.match(n.other.indentCodeCompensation);if(null===r)return e;const o=r[1];return e.split("\n").map(t=>{const e=t.match(n.other.beginningSpace);if(null===e)return t;const[r]=e;return r.length>=o.length?t.slice(o.length):t}).join("\n")}(t,e[3]||"",this.rules);return{type:"code",raw:t,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:n}}}heading(t){const e=this.rules.block.heading.exec(t);if(e){let t=e[2].trim();if(this.rules.other.endingHash.test(t)){const e=ct(t,"#");this.options.pedantic?t=e.trim():e&&!this.rules.other.endingSpaceChar.test(e)||(t=e.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:t,tokens:this.lexer.inline(t)}}}hr(t){const e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:ct(e[0],"\n")}}blockquote(t){const e=this.rules.block.blockquote.exec(t);if(e){let t=ct(e[0],"\n").split("\n"),n="",r="";const o=[];for(;t.length>0;){let e=!1;const i=[];let s;for(s=0;s<t.length;s++)if(this.rules.other.blockquoteStart.test(t[s]))i.push(t[s]),e=!0;else{if(e)break;i.push(t[s])}t=t.slice(s);const a=i.join("\n"),c=a.replace(this.rules.other.blockquoteSetextReplace,"\n    $1").replace(this.rules.other.blockquoteSetextReplace2,"");n=n?`${n}\n${a}`:a,r=r?`${r}\n${c}`:c;const l=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(c,o,!0),this.lexer.state.top=l,0===t.length)break;const u=o.at(-1);if("code"===u?.type)break;if("blockquote"===u?.type){const e=u,i=e.raw+"\n"+t.join("\n"),s=this.blockquote(i);o[o.length-1]=s,n=n.substring(0,n.length-e.raw.length)+s.raw,r=r.substring(0,r.length-e.text.length)+s.text;break}if("list"===u?.type){const e=u,i=e.raw+"\n"+t.join("\n"),s=this.list(i);o[o.length-1]=s,n=n.substring(0,n.length-u.raw.length)+s.raw,r=r.substring(0,r.length-e.raw.length)+s.raw,t=i.substring(o.at(-1).raw.length).split("\n");continue}}return{type:"blockquote",raw:n,tokens:o,text:r}}}list(t){let e=this.rules.block.list.exec(t);if(e){let n=e[1].trim();const r=n.length>1,o={type:"list",raw:"",ordered:r,start:r?+n.slice(0,-1):"",loose:!1,items:[]};n=r?`\\d{1,9}\\${n.slice(-1)}`:`\\${n}`,this.options.pedantic&&(n=r?n:"[*+-]");const i=this.rules.other.listItemRegex(n);let s=!1;for(;t;){let n=!1,r="",a="";if(!(e=i.exec(t)))break;if(this.rules.block.hr.test(t))break;r=e[0],t=t.substring(r.length);let c=e[2].split("\n",1)[0].replace(this.rules.other.listReplaceTabs,t=>" ".repeat(3*t.length)),l=t.split("\n",1)[0],u=!c.trim(),d=0;if(this.options.pedantic?(d=2,a=c.trimStart()):u?d=e[1].length+1:(d=e[2].search(this.rules.other.nonSpaceChar),d=d>4?1:d,a=c.slice(d),d+=e[1].length),u&&this.rules.other.blankLine.test(l)&&(r+=l+"\n",t=t.substring(l.length+1),n=!0),!n){const e=this.rules.other.nextBulletRegex(d),n=this.rules.other.hrRegex(d),o=this.rules.other.fencesBeginRegex(d),i=this.rules.other.headingBeginRegex(d),s=this.rules.other.htmlBeginRegex(d);for(;t;){const f=t.split("\n",1)[0];let h;if(l=f,this.options.pedantic?(l=l.replace(this.rules.other.listReplaceNesting,"  "),h=l):h=l.replace(this.rules.other.tabCharGlobal,"    "),o.test(l))break;if(i.test(l))break;if(s.test(l))break;if(e.test(l))break;if(n.test(l))break;if(h.search(this.rules.other.nonSpaceChar)>=d||!l.trim())a+="\n"+h.slice(d);else{if(u)break;if(c.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4)break;if(o.test(c))break;if(i.test(c))break;if(n.test(c))break;a+="\n"+l}u||l.trim()||(u=!0),r+=f+"\n",t=t.substring(f.length+1),c=h.slice(d)}}o.loose||(s?o.loose=!0:this.rules.other.doubleBlankLine.test(r)&&(s=!0));let f,h=null;this.options.gfm&&(h=this.rules.other.listIsTask.exec(a),h&&(f="[ ] "!==h[0],a=a.replace(this.rules.other.listReplaceTask,""))),o.items.push({type:"list_item",raw:r,task:!!h,checked:f,loose:!1,text:a,tokens:[]}),o.raw+=r}const a=o.items.at(-1);if(!a)return;a.raw=a.raw.trimEnd(),a.text=a.text.trimEnd(),o.raw=o.raw.trimEnd();for(let t=0;t<o.items.length;t++)if(this.lexer.state.top=!1,o.items[t].tokens=this.lexer.blockTokens(o.items[t].text,[]),!o.loose){const e=o.items[t].tokens.filter(t=>"space"===t.type),n=e.length>0&&e.some(t=>this.rules.other.anyLine.test(t.raw));o.loose=n}if(o.loose)for(let t=0;t<o.items.length;t++)o.items[t].loose=!0;return o}}html(t){const e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:"pre"===e[1]||"script"===e[1]||"style"===e[1],text:e[0]}}def(t){const e=this.rules.block.def.exec(t);if(e){const t=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),n=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:t,raw:e[0],href:n,title:r}}}table(t){const e=this.rules.block.table.exec(t);if(!e)return;if(!this.rules.other.tableDelimiter.test(e[2]))return;const n=at(e[1]),r=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),o=e[3]?.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split("\n"):[],i={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===r.length){for(const t of r)this.rules.other.tableAlignRight.test(t)?i.align.push("right"):this.rules.other.tableAlignCenter.test(t)?i.align.push("center"):this.rules.other.tableAlignLeft.test(t)?i.align.push("left"):i.align.push(null);for(let t=0;t<n.length;t++)i.header.push({text:n[t],tokens:this.lexer.inline(n[t]),header:!0,align:i.align[t]});for(const t of o)i.rows.push(at(t,i.header.length).map((t,e)=>({text:t,tokens:this.lexer.inline(t),header:!1,align:i.align[e]})));return i}}lheading(t){const e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:"="===e[2].charAt(0)?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){const e=this.rules.block.paragraph.exec(t);if(e){const t="\n"===e[1].charAt(e[1].length-1)?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:t,tokens:this.lexer.inline(t)}}}text(t){const e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){const e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){const e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){const e=this.rules.inline.link.exec(t);if(e){const t=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(t)){if(!this.rules.other.endAngleBracket.test(t))return;const e=ct(t.slice(0,-1),"\\");if((t.length-e.length)%2==0)return}else{const t=function(t,e){if(-1===t.indexOf(e[1]))return-1;let n=0;for(let r=0;r<t.length;r++)if("\\"===t[r])r++;else if(t[r]===e[0])n++;else if(t[r]===e[1]&&(n--,n<0))return r;return n>0?-2:-1}(e[2],"()");if(-2===t)return;if(t>-1){const n=(0===e[0].indexOf("!")?5:4)+e[1].length+t;e[2]=e[2].substring(0,t),e[0]=e[0].substring(0,n).trim(),e[3]=""}}let n=e[2],r="";if(this.options.pedantic){const t=this.rules.other.pedanticHrefTitle.exec(n);t&&(n=t[1],r=t[3])}else r=e[3]?e[3].slice(1,-1):"";return n=n.trim(),this.rules.other.startAngleBracket.test(n)&&(n=this.options.pedantic&&!this.rules.other.endAngleBracket.test(t)?n.slice(1):n.slice(1,-1)),lt(e,{href:n?n.replace(this.rules.inline.anyPunctuation,"$1"):n,title:r?r.replace(this.rules.inline.anyPunctuation,"$1"):r},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){const t=e[(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," ").toLowerCase()];if(!t){const t=n[0].charAt(0);return{type:"text",raw:t,text:t}}return lt(n,t,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let r=this.rules.inline.emStrongLDelim.exec(t);if(r&&(!r[3]||!n.match(this.rules.other.unicodeAlphaNumeric))&&(!r[1]&&!r[2]||!n||this.rules.inline.punctuation.exec(n))){const n=[...r[0]].length-1;let o,i,s=n,a=0;const c="*"===r[0][0]?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(c.lastIndex=0,e=e.slice(-1*t.length+n);null!=(r=c.exec(e));){if(o=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!o)continue;if(i=[...o].length,r[3]||r[4]){s+=i;continue}if((r[5]||r[6])&&n%3&&!((n+i)%3)){a+=i;continue}if(s-=i,s>0)continue;i=Math.min(i,i+s+a);const e=[...r[0]][0].length,c=t.slice(0,n+r.index+e+i);if(Math.min(n,i)%2){const t=c.slice(1,-1);return{type:"em",raw:c,text:t,tokens:this.lexer.inlineTokens(t)}}const l=c.slice(2,-2);return{type:"strong",raw:c,text:l,tokens:this.lexer.inlineTokens(l)}}}}codespan(t){const e=this.rules.inline.code.exec(t);if(e){let t=e[2].replace(this.rules.other.newLineCharGlobal," ");const n=this.rules.other.nonSpaceChar.test(t),r=this.rules.other.startingSpaceChar.test(t)&&this.rules.other.endingSpaceChar.test(t);return n&&r&&(t=t.substring(1,t.length-1)),{type:"codespan",raw:e[0],text:t}}}br(t){const e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){const e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){const e=this.rules.inline.autolink.exec(t);if(e){let t,n;return"@"===e[2]?(t=e[1],n="mailto:"+t):(t=e[1],n=t),{type:"link",raw:e[0],text:t,href:n,tokens:[{type:"text",raw:t,text:t}]}}}url(t){let e;if(e=this.rules.inline.url.exec(t)){let t,n;if("@"===e[2])t=e[0],n="mailto:"+t;else{let r;do{r=e[0],e[0]=this.rules.inline._backpedal.exec(e[0])?.[0]??""}while(r!==e[0]);t=e[0],n="www."===e[1]?"http://"+e[0]:e[0]}return{type:"link",raw:e[0],text:t,href:n,tokens:[{type:"text",raw:t,text:t}]}}}inlineText(t){const e=this.rules.inline.text.exec(t);if(e){const t=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:t}}}},dt=class t{tokens;options;state;tokenizer;inlineQueue;constructor(t){this.tokens=[],this.tokens.links=Object.create(null),this.options=t||c,this.options.tokenizer=this.options.tokenizer||new ut,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};const e={other:f,block:et.normal,inline:nt.normal};this.options.pedantic?(e.block=et.pedantic,e.inline=nt.pedantic):this.options.gfm&&(e.block=et.gfm,this.options.breaks?e.inline=nt.breaks:e.inline=nt.gfm),this.tokenizer.rules=e}static get rules(){return{block:et,inline:nt}}static lex(e,n){return new t(n).lex(e)}static lexInline(e,n){return new t(n).inlineTokens(e)}lex(t){t=t.replace(f.carriageReturn,"\n"),this.blockTokens(t,this.tokens);for(let t=0;t<this.inlineQueue.length;t++){const e=this.inlineQueue[t];this.inlineTokens(e.src,e.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,e=[],n=!1){for(this.options.pedantic&&(t=t.replace(f.tabCharGlobal,"    ").replace(f.spaceLine,""));t;){let r;if(this.options.extensions?.block?.some(n=>!!(r=n.call({lexer:this},t,e))&&(t=t.substring(r.raw.length),e.push(r),!0)))continue;if(r=this.tokenizer.space(t)){t=t.substring(r.raw.length);const n=e.at(-1);1===r.raw.length&&void 0!==n?n.raw+="\n":e.push(r);continue}if(r=this.tokenizer.code(t)){t=t.substring(r.raw.length);const n=e.at(-1);"paragraph"===n?.type||"text"===n?.type?(n.raw+="\n"+r.raw,n.text+="\n"+r.text,this.inlineQueue.at(-1).src=n.text):e.push(r);continue}if(r=this.tokenizer.fences(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.heading(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.hr(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.blockquote(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.list(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.html(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.def(t)){t=t.substring(r.raw.length);const n=e.at(-1);"paragraph"===n?.type||"text"===n?.type?(n.raw+="\n"+r.raw,n.text+="\n"+r.raw,this.inlineQueue.at(-1).src=n.text):this.tokens.links[r.tag]||(this.tokens.links[r.tag]={href:r.href,title:r.title});continue}if(r=this.tokenizer.table(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.lheading(t)){t=t.substring(r.raw.length),e.push(r);continue}let o=t;if(this.options.extensions?.startBlock){let e=1/0;const n=t.slice(1);let r;this.options.extensions.startBlock.forEach(t=>{r=t.call({lexer:this},n),"number"==typeof r&&r>=0&&(e=Math.min(e,r))}),e<1/0&&e>=0&&(o=t.substring(0,e+1))}if(this.state.top&&(r=this.tokenizer.paragraph(o))){const i=e.at(-1);n&&"paragraph"===i?.type?(i.raw+="\n"+r.raw,i.text+="\n"+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=i.text):e.push(r),n=o.length!==t.length,t=t.substring(r.raw.length);continue}if(r=this.tokenizer.text(t)){t=t.substring(r.raw.length);const n=e.at(-1);"text"===n?.type?(n.raw+="\n"+r.raw,n.text+="\n"+r.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=n.text):e.push(r);continue}if(t){const e="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(e);break}throw new Error(e)}}return this.state.top=!0,e}inline(t,e=[]){return this.inlineQueue.push({src:t,tokens:e}),e}inlineTokens(t,e=[]){let n=t,r=null;if(this.tokens.links){const t=Object.keys(this.tokens.links);if(t.length>0)for(;null!=(r=this.tokenizer.rules.inline.reflinkSearch.exec(n));)t.includes(r[0].slice(r[0].lastIndexOf("[")+1,-1))&&(n=n.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(r=this.tokenizer.rules.inline.anyPunctuation.exec(n));)n=n.slice(0,r.index)+"++"+n.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;null!=(r=this.tokenizer.rules.inline.blockSkip.exec(n));)n=n.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+n.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let o=!1,i="";for(;t;){let r;if(o||(i=""),o=!1,this.options.extensions?.inline?.some(n=>!!(r=n.call({lexer:this},t,e))&&(t=t.substring(r.raw.length),e.push(r),!0)))continue;if(r=this.tokenizer.escape(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.tag(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.link(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(r.raw.length);const n=e.at(-1);"text"===r.type&&"text"===n?.type?(n.raw+=r.raw,n.text+=r.text):e.push(r);continue}if(r=this.tokenizer.emStrong(t,n,i)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.codespan(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.br(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.del(t)){t=t.substring(r.raw.length),e.push(r);continue}if(r=this.tokenizer.autolink(t)){t=t.substring(r.raw.length),e.push(r);continue}if(!this.state.inLink&&(r=this.tokenizer.url(t))){t=t.substring(r.raw.length),e.push(r);continue}let s=t;if(this.options.extensions?.startInline){let e=1/0;const n=t.slice(1);let r;this.options.extensions.startInline.forEach(t=>{r=t.call({lexer:this},n),"number"==typeof r&&r>=0&&(e=Math.min(e,r))}),e<1/0&&e>=0&&(s=t.substring(0,e+1))}if(r=this.tokenizer.inlineText(s)){t=t.substring(r.raw.length),"_"!==r.raw.slice(-1)&&(i=r.raw.slice(-1)),o=!0;const n=e.at(-1);"text"===n?.type?(n.raw+=r.raw,n.text+=r.text):e.push(r);continue}if(t){const e="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(e);break}throw new Error(e)}}return e}},ft=class{options;parser;constructor(t){this.options=t||c}space(t){return""}code({text:t,lang:e,escaped:n}){const r=(e||"").match(f.notSpaceStart)?.[0],o=t.replace(f.endingNewline,"")+"\n";return r?'<pre><code class="language-'+it(r)+'">'+(n?o:it(o,!0))+"</code></pre>\n":"<pre><code>"+(n?o:it(o,!0))+"</code></pre>\n"}blockquote({tokens:t}){return`<blockquote>\n${this.parser.parse(t)}</blockquote>\n`}html({text:t}){return t}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>\n`}hr(t){return"<hr>\n"}list(t){const e=t.ordered,n=t.start;let r="";for(let e=0;e<t.items.length;e++){const n=t.items[e];r+=this.listitem(n)}const o=e?"ol":"ul";return"<"+o+(e&&1!==n?' start="'+n+'"':"")+">\n"+r+"</"+o+">\n"}listitem(t){let e="";if(t.task){const n=this.checkbox({checked:!!t.checked});t.loose?"paragraph"===t.tokens[0]?.type?(t.tokens[0].text=n+" "+t.tokens[0].text,t.tokens[0].tokens&&t.tokens[0].tokens.length>0&&"text"===t.tokens[0].tokens[0].type&&(t.tokens[0].tokens[0].text=n+" "+it(t.tokens[0].tokens[0].text),t.tokens[0].tokens[0].escaped=!0)):t.tokens.unshift({type:"text",raw:n+" ",text:n+" ",escaped:!0}):e+=n+" "}return e+=this.parser.parse(t.tokens,!!t.loose),`<li>${e}</li>\n`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>\n`}table(t){let e="",n="";for(let e=0;e<t.header.length;e++)n+=this.tablecell(t.header[e]);e+=this.tablerow({text:n});let r="";for(let e=0;e<t.rows.length;e++){const o=t.rows[e];n="";for(let t=0;t<o.length;t++)n+=this.tablecell(o[t]);r+=this.tablerow({text:n})}return r&&(r=`<tbody>${r}</tbody>`),"<table>\n<thead>\n"+e+"</thead>\n"+r+"</table>\n"}tablerow({text:t}){return`<tr>\n${t}</tr>\n`}tablecell(t){const e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>\n`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${it(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){const r=this.parser.parseInline(n),o=st(t);if(null===o)return r;let i='<a href="'+(t=o)+'"';return e&&(i+=' title="'+it(e)+'"'),i+=">"+r+"</a>",i}image({href:t,title:e,text:n,tokens:r}){r&&(n=this.parser.parseInline(r,this.parser.textRenderer));const o=st(t);if(null===o)return it(n);let i=`<img src="${t=o}" alt="${n}"`;return e&&(i+=` title="${it(e)}"`),i+=">",i}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:it(t.text)}},ht=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}},pt=class t{options;renderer;textRenderer;constructor(t){this.options=t||c,this.options.renderer=this.options.renderer||new ft,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new ht}static parse(e,n){return new t(n).parse(e)}static parseInline(e,n){return new t(n).parseInline(e)}parse(t,e=!0){let n="";for(let r=0;r<t.length;r++){const o=t[r];if(this.options.extensions?.renderers?.[o.type]){const t=o,e=this.options.extensions.renderers[t.type].call({parser:this},t);if(!1!==e||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(t.type)){n+=e||"";continue}}const i=o;switch(i.type){case"space":n+=this.renderer.space(i);continue;case"hr":n+=this.renderer.hr(i);continue;case"heading":n+=this.renderer.heading(i);continue;case"code":n+=this.renderer.code(i);continue;case"table":n+=this.renderer.table(i);continue;case"blockquote":n+=this.renderer.blockquote(i);continue;case"list":n+=this.renderer.list(i);continue;case"html":n+=this.renderer.html(i);continue;case"paragraph":n+=this.renderer.paragraph(i);continue;case"text":{let o=i,s=this.renderer.text(o);for(;r+1<t.length&&"text"===t[r+1].type;)o=t[++r],s+="\n"+this.renderer.text(o);n+=e?this.renderer.paragraph({type:"paragraph",raw:s,text:s,tokens:[{type:"text",raw:s,text:s,escaped:!0}]}):s;continue}default:{const t='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(t),"";throw new Error(t)}}}return n}parseInline(t,e=this.renderer){let n="";for(let r=0;r<t.length;r++){const o=t[r];if(this.options.extensions?.renderers?.[o.type]){const t=this.options.extensions.renderers[o.type].call({parser:this},o);if(!1!==t||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(o.type)){n+=t||"";continue}}const i=o;switch(i.type){case"escape":case"text":n+=e.text(i);break;case"html":n+=e.html(i);break;case"link":n+=e.link(i);break;case"image":n+=e.image(i);break;case"strong":n+=e.strong(i);break;case"em":n+=e.em(i);break;case"codespan":n+=e.codespan(i);break;case"br":n+=e.br(i);break;case"del":n+=e.del(i);break;default:{const t='Token with "'+i.type+'" type was not found.';if(this.options.silent)return console.error(t),"";throw new Error(t)}}}return n}},mt=class{options;block;constructor(t){this.options=t||c}static passThroughHooks=new Set(["preprocess","postprocess","processAllTokens"]);preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}provideLexer(){return this.block?dt.lex:dt.lexInline}provideParser(){return this.block?pt.parse:pt.parseInline}},vt=class{defaults={async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null};options=this.setOptions;parse=this.parseMarkdown(!0);parseInline=this.parseMarkdown(!1);Parser=pt;Renderer=ft;TextRenderer=ht;Lexer=dt;Tokenizer=ut;Hooks=mt;constructor(...t){this.use(...t)}walkTokens(t,e){let n=[];for(const r of t)switch(n=n.concat(e.call(this,r)),r.type){case"table":{const t=r;for(const r of t.header)n=n.concat(this.walkTokens(r.tokens,e));for(const r of t.rows)for(const t of r)n=n.concat(this.walkTokens(t.tokens,e));break}case"list":{const t=r;n=n.concat(this.walkTokens(t.items,e));break}default:{const t=r;this.defaults.extensions?.childTokens?.[t.type]?this.defaults.extensions.childTokens[t.type].forEach(r=>{const o=t[r].flat(1/0);n=n.concat(this.walkTokens(o,e))}):t.tokens&&(n=n.concat(this.walkTokens(t.tokens,e)))}}return n}use(...t){const e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(t=>{const n={...t};if(n.async=this.defaults.async||n.async||!1,t.extensions&&(t.extensions.forEach(t=>{if(!t.name)throw new Error("extension name required");if("renderer"in t){const n=e.renderers[t.name];e.renderers[t.name]=n?function(...e){let r=t.renderer.apply(this,e);return!1===r&&(r=n.apply(this,e)),r}:t.renderer}if("tokenizer"in t){if(!t.level||"block"!==t.level&&"inline"!==t.level)throw new Error("extension level must be 'block' or 'inline'");const n=e[t.level];n?n.unshift(t.tokenizer):e[t.level]=[t.tokenizer],t.start&&("block"===t.level?e.startBlock?e.startBlock.push(t.start):e.startBlock=[t.start]:"inline"===t.level&&(e.startInline?e.startInline.push(t.start):e.startInline=[t.start]))}"childTokens"in t&&t.childTokens&&(e.childTokens[t.name]=t.childTokens)}),n.extensions=e),t.renderer){const e=this.defaults.renderer||new ft(this.defaults);for(const n in t.renderer){if(!(n in e))throw new Error(`renderer '${n}' does not exist`);if(["options","parser"].includes(n))continue;const r=n,o=t.renderer[r],i=e[r];e[r]=(...t)=>{let n=o.apply(e,t);return!1===n&&(n=i.apply(e,t)),n||""}}n.renderer=e}if(t.tokenizer){const e=this.defaults.tokenizer||new ut(this.defaults);for(const n in t.tokenizer){if(!(n in e))throw new Error(`tokenizer '${n}' does not exist`);if(["options","rules","lexer"].includes(n))continue;const r=n,o=t.tokenizer[r],i=e[r];e[r]=(...t)=>{let n=o.apply(e,t);return!1===n&&(n=i.apply(e,t)),n}}n.tokenizer=e}if(t.hooks){const e=this.defaults.hooks||new mt;for(const n in t.hooks){if(!(n in e))throw new Error(`hook '${n}' does not exist`);if(["options","block"].includes(n))continue;const r=n,o=t.hooks[r],i=e[r];mt.passThroughHooks.has(n)?e[r]=t=>{if(this.defaults.async)return Promise.resolve(o.call(e,t)).then(t=>i.call(e,t));const n=o.call(e,t);return i.call(e,n)}:e[r]=(...t)=>{let n=o.apply(e,t);return!1===n&&(n=i.apply(e,t)),n}}n.hooks=e}if(t.walkTokens){const e=this.defaults.walkTokens,r=t.walkTokens;n.walkTokens=function(t){let n=[];return n.push(r.call(this,t)),e&&(n=n.concat(e.call(this,t))),n}}this.defaults={...this.defaults,...n}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return dt.lex(t,e??this.defaults)}parser(t,e){return pt.parse(t,e??this.defaults)}parseMarkdown(t){return(e,n)=>{const r={...n},o={...this.defaults,...r},i=this.onError(!!o.silent,!!o.async);if(!0===this.defaults.async&&!1===r.async)return i(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(null==e)return i(new Error("marked(): input parameter is undefined or null"));if("string"!=typeof e)return i(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=t);const s=o.hooks?o.hooks.provideLexer():t?dt.lex:dt.lexInline,a=o.hooks?o.hooks.provideParser():t?pt.parse:pt.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(e):e).then(t=>s(t,o)).then(t=>o.hooks?o.hooks.processAllTokens(t):t).then(t=>o.walkTokens?Promise.all(this.walkTokens(t,o.walkTokens)).then(()=>t):t).then(t=>a(t,o)).then(t=>o.hooks?o.hooks.postprocess(t):t).catch(i);try{o.hooks&&(e=o.hooks.preprocess(e));let t=s(e,o);o.hooks&&(t=o.hooks.processAllTokens(t)),o.walkTokens&&this.walkTokens(t,o.walkTokens);let n=a(t,o);return o.hooks&&(n=o.hooks.postprocess(n)),n}catch(t){return i(t)}}}onError(t,e){return n=>{if(n.message+="\nPlease report this to https://github.com/markedjs/marked.",t){const t="<p>An error occurred:</p><pre>"+it(n.message+"",!0)+"</pre>";return e?Promise.resolve(t):t}if(e)return Promise.reject(n);throw n}}},gt=new vt;function yt(t,e){return gt.parse(t,e)}yt.options=yt.setOptions=function(t){return gt.setOptions(t),yt.defaults=gt.defaults,l(yt.defaults),yt},yt.getDefaults=a,yt.defaults=c,yt.use=function(...t){return gt.use(...t),yt.defaults=gt.defaults,l(yt.defaults),yt},yt.walkTokens=function(t,e){return gt.walkTokens(t,e)},yt.parseInline=gt.parseInline,yt.Parser=pt,yt.parser=pt.parse,yt.Renderer=ft,yt.TextRenderer=ht,yt.Lexer=dt,yt.lexer=dt.lex,yt.Tokenizer=ut,yt.Hooks=mt,yt.parse=yt;var kt=yt.options,bt=yt.setOptions,wt=yt.use,xt=yt.walkTokens,St=yt.parseInline,Ct=yt,Mt=pt.parse,Tt=dt.lex}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};(()=>{"use strict";n.r(r),n.d(r,{MenuState:()=>Ap,TiptapEditorDriver:()=>ap,TiptapToolbar:()=>Tp});const t=flarum.core.compat["forum/app"];var e=n.n(t);const o=flarum.core.compat["common/extend"],i=flarum.core.compat["common/components/TextEditor"];var s=n.n(i);const a=flarum.core.compat["common/helpers/icon"];var c=n.n(a);const l=flarum.core.compat["common/utils/extractText"];var u=n.n(l);function d(t,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},d(t,e)}function f(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,d(t,e)}function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function p(t){var e=function(t){if("object"!=h(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==h(e)?e:e+""}function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,p(r.key),r)}}function g(t,e,n){return e&&v(t.prototype,e),n&&v(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function y(){return y=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},y.apply(null,arguments)}function k(t){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},k(t)}function b(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(b=function(){return!!t})()}function w(t){var e="function"==typeof Map?new Map:void 0;return w=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(b())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var o=new(t.bind.apply(t,r));return n&&d(o,n.prototype),o}(t,arguments,k(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),d(n,t)},w(t)}function x(t){this.content=t}x.prototype={constructor:x,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return-1==e?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,o=r.find(t),i=r.content.slice();return-1==o?i.push(n||t,e):(i[o+1]=e,n&&(i[o]=n)),new x(i)},remove:function(t){var e=this.find(t);if(-1==e)return this;var n=this.content.slice();return n.splice(e,2),new x(n)},addToStart:function(t,e){return new x([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new x(n)},addBefore:function(t,e,n){var r=this.remove(e),o=r.content.slice(),i=r.find(t);return o.splice(-1==i?o.length:i,0,e,n),new x(o)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return(t=x.from(t)).size?new x(t.content.concat(this.subtract(t).content)):this},append:function(t){return(t=x.from(t)).size?new x(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=x.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}},x.from=function(t){if(t instanceof x)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new x(e)};const S=x;function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function M(t,e,n){for(var r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;var o=t.child(r),i=e.child(r);if(o!=i){if(!o.sameMarkup(i))return n;if(o.isText&&o.text!=i.text){for(var s=0;o.text[s]==i.text[s];s++)n++;return n}if(o.content.size||i.content.size){var a=M(o.content,i.content,n+1);if(null!=a)return a}n+=o.nodeSize}else n+=o.nodeSize}}function T(t,e,n,r){for(var o=t.childCount,i=e.childCount;;){if(0==o||0==i)return o==i?null:{a:n,b:r};var s=t.child(--o),a=e.child(--i),c=s.nodeSize;if(s!=a){if(!s.sameMarkup(a))return{a:n,b:r};if(s.isText&&s.text!=a.text){for(var l=0,u=Math.min(s.text.length,a.text.length);l<u&&s.text[s.text.length-l-1]==a.text[a.text.length-l-1];)l++,n--,r--;return{a:n,b:r}}if(s.content.size||a.content.size){var d=T(s.content,a.content,n-1,r-1);if(d)return d}n-=c,r-=c}else n-=c,r-=c}}var A=function(){function t(t,e){if(this.content=t,this.size=e||0,null==e)for(var n=0;n<t.length;n++)this.size+=t[n].nodeSize}var e=t.prototype;return e.nodesBetween=function(t,e,n,r,o){void 0===r&&(r=0);for(var i=0,s=0;s<e;i++){var a=this.content[i],c=s+a.nodeSize;if(c>t&&!1!==n(a,r+s,o||null,i)&&a.content.size){var l=s+1;a.nodesBetween(Math.max(0,t-l),Math.min(a.content.size,e-l),n,r+l)}s=c}},e.descendants=function(t){this.nodesBetween(0,this.size,t)},e.textBetween=function(t,e,n,r){var o="",i=!0;return this.nodesBetween(t,e,function(s,a){var c=s.isText?s.text.slice(Math.max(t,a)-a,e-a):s.isLeaf?r?"function"==typeof r?r(s):r:s.type.spec.leafText?s.type.spec.leafText(s):"":"";s.isBlock&&(s.isLeaf&&c||s.isTextblock)&&n&&(i?i=!1:o+=n),o+=c},0),o},e.append=function(e){if(!e.size)return this;if(!this.size)return e;var n=this.lastChild,r=e.firstChild,o=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(o[o.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)o.push(e.content[i]);return new t(o,this.size+e.size)},e.cut=function(e,n){if(void 0===n&&(n=this.size),0==e&&n==this.size)return this;var r=[],o=0;if(n>e)for(var i=0,s=0;s<n;i++){var a=this.content[i],c=s+a.nodeSize;c>e&&((s<e||c>n)&&(a=a.isText?a.cut(Math.max(0,e-s),Math.min(a.text.length,n-s)):a.cut(Math.max(0,e-s-1),Math.min(a.content.size,n-s-1))),r.push(a),o+=a.nodeSize),s=c}return new t(r,o)},e.cutByIndex=function(e,n){return e==n?t.empty:0==e&&n==this.content.length?this:new t(this.content.slice(e,n))},e.replaceChild=function(e,n){var r=this.content[e];if(r==n)return this;var o=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return o[e]=n,new t(o,i)},e.addToStart=function(e){return new t([e].concat(this.content),this.size+e.nodeSize)},e.addToEnd=function(e){return new t(this.content.concat(e),this.size+e.nodeSize)},e.eq=function(t){if(this.content.length!=t.content.length)return!1;for(var e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0},e.child=function(t){var e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e},e.maybeChild=function(t){return this.content[t]||null},e.forEach=function(t){for(var e=0,n=0;e<this.content.length;e++){var r=this.content[e];t(r,n,e),n+=r.nodeSize}},e.findDiffStart=function(t,e){return void 0===e&&(e=0),M(this,t,e)},e.findDiffEnd=function(t,e,n){return void 0===e&&(e=this.size),void 0===n&&(n=t.size),T(this,t,e,n)},e.findIndex=function(t){if(0==t)return E(0,t);if(t==this.size)return E(this.content.length,t);if(t>this.size||t<0)throw new RangeError("Position "+t+" outside of fragment ("+this+")");for(var e=0,n=0;;e++){var r=n+this.child(e).nodeSize;if(r>=t)return r==t?E(e+1,r):E(e,n);n=r}},e.toString=function(){return"<"+this.toStringInner()+">"},e.toStringInner=function(){return this.content.join(", ")},e.toJSON=function(){return this.content.length?this.content.map(function(t){return t.toJSON()}):null},t.fromJSON=function(e,n){if(!n)return t.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new t(n.map(e.nodeFromJSON))},t.fromArray=function(e){if(!e.length)return t.empty;for(var n,r=0,o=0;o<e.length;o++){var i=e[o];r+=i.nodeSize,o&&i.isText&&e[o-1].sameMarkup(i)?(n||(n=e.slice(0,o)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new t(n||e,r)},t.from=function(e){if(!e)return t.empty;if(e instanceof t)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new t([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))},g(t,[{key:"firstChild",get:function(){return this.content.length?this.content[0]:null}},{key:"lastChild",get:function(){return this.content.length?this.content[this.content.length-1]:null}},{key:"childCount",get:function(){return this.content.length}}])}();A.empty=new A([],0);var O={index:0,offset:0};function E(t,e){return O.index=t,O.offset=e,O}function N(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;var n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(var r=0;r<t.length;r++)if(!N(t[r],e[r]))return!1}else{for(var o in t)if(!(o in e)||!N(t[o],e[o]))return!1;for(var i in e)if(!(i in t))return!1}return!0}var R=function(){function t(t,e){this.type=t,this.attrs=e}var e=t.prototype;return e.addToSet=function(t){for(var e,n=!1,r=0;r<t.length;r++){var o=t[r];if(this.eq(o))return t;if(this.type.excludes(o.type))e||(e=t.slice(0,r));else{if(o.type.excludes(this.type))return t;!n&&o.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(o)}}return e||(e=t.slice()),n||e.push(this),e},e.removeFromSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t},e.isInSet=function(t){for(var e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1},e.eq=function(t){return this==t||this.type==t.type&&N(this.attrs,t.attrs)},e.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return t},t.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");var n=t.marks[e.type];if(!n)throw new RangeError("There is no mark type "+e.type+" in this schema");var r=n.create(e.attrs);return n.checkAttrs(r.attrs),r},t.sameSet=function(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0},t.setFrom=function(e){if(!e||Array.isArray(e)&&0==e.length)return t.none;if(e instanceof t)return[e];var n=e.slice();return n.sort(function(t,e){return t.type.rank-e.type.rank}),n},t}();R.none=[];var D=function(t){function e(){return t.apply(this,arguments)||this}return f(e,t),e}(w(Error)),I=function(){function t(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}var e=t.prototype;return e.insertAt=function(e,n){var r=P(this.content,e+this.openStart,n);return r&&new t(r,this.openStart,this.openEnd)},e.removeBetween=function(e,n){return new t(L(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)},e.eq=function(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd},e.toString=function(){return this.content+"("+this.openStart+","+this.openEnd+")"},e.toJSON=function(){if(!this.content.size)return null;var t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t},t.fromJSON=function(e,n){if(!n)return t.empty;var r=n.openStart||0,o=n.openEnd||0;if("number"!=typeof r||"number"!=typeof o)throw new RangeError("Invalid input for Slice.fromJSON");return new t(A.fromJSON(e,n.content),r,o)},t.maxOpen=function(e,n){void 0===n&&(n=!0);for(var r=0,o=0,i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(var s=e.lastChild;s&&!s.isLeaf&&(n||!s.type.spec.isolating);s=s.lastChild)o++;return new t(e,r,o)},g(t,[{key:"size",get:function(){return this.content.size-this.openStart-this.openEnd}}])}();function L(t,e,n){var r=t.findIndex(e),o=r.index,i=r.offset,s=t.maybeChild(o),a=t.findIndex(n),c=a.index,l=a.offset;if(i==e||s.isText){if(l!=n&&!t.child(c).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(o!=c)throw new RangeError("Removing non-flat range");return t.replaceChild(o,s.copy(L(s.content,e-i-1,n-i-1)))}function P(t,e,n,r){var o=t.findIndex(e),i=o.index,s=o.offset,a=t.maybeChild(i);if(s==e||a.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));var c=P(a.content,e-s-1,n,a);return c&&t.replaceChild(i,a.copy(c))}function z(t,e,n){if(n.openStart>t.depth)throw new D("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new D("Inconsistent open depths");return B(t,e,n,0)}function B(t,e,n,r){var o=t.index(r),i=t.node(r);if(o==e.index(r)&&r<t.depth-n.openStart){var s=B(t,e,n,r+1);return i.copy(i.content.replaceChild(o,s))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){var a=function(t,e){for(var n=e.depth-t.openStart,r=e.node(n).copy(t.content),o=n-1;o>=0;o--)r=e.node(o).copy(A.from(r));return{start:r.resolveNoCache(t.openStart+n),end:r.resolveNoCache(r.content.size-t.openEnd-n)}}(n,t);return F(i,V(t,a.start,a.end,e,r))}var c=t.parent,l=c.content;return F(c,l.cut(0,t.parentOffset).append(n.content).append(l.cut(e.parentOffset)))}return F(i,W(t,e,r))}function $(t,e){if(!e.type.compatibleContent(t.type))throw new D("Cannot join "+e.type.name+" onto "+t.type.name)}function H(t,e,n){var r=t.node(n);return $(r,e.node(n)),r}function _(t,e){var n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function j(t,e,n,r){var o=(e||t).node(n),i=0,s=e?e.index(n):o.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(_(t.nodeAfter,r),i++));for(var a=i;a<s;a++)_(o.child(a),r);e&&e.depth==n&&e.textOffset&&_(e.nodeBefore,r)}function F(t,e){return t.type.checkContent(e),t.copy(e)}function V(t,e,n,r,o){var i=t.depth>o&&H(t,e,o+1),s=r.depth>o&&H(n,r,o+1),a=[];return j(null,t,o,a),i&&s&&e.index(o)==n.index(o)?($(i,s),_(F(i,V(t,e,n,r,o+1)),a)):(i&&_(F(i,W(t,e,o+1)),a),j(e,n,o,a),s&&_(F(s,W(n,r,o+1)),a)),j(r,null,o,a),new A(a)}function W(t,e,n){var r=[];return j(null,t,n,r),t.depth>n&&_(F(H(t,e,n+1),W(t,e,n+1)),r),j(e,null,n,r),new A(r)}I.empty=new I(A.empty,0,0);var q=function(){function t(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}var e=t.prototype;return e.resolveDepth=function(t){return null==t?this.depth:t<0?this.depth+t:t},e.node=function(t){return this.path[3*this.resolveDepth(t)]},e.index=function(t){return this.path[3*this.resolveDepth(t)+1]},e.indexAfter=function(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)},e.start=function(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1},e.end=function(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size},e.before=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]},e.after=function(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize},e.posAtIndex=function(t,e){e=this.resolveDepth(e);for(var n=this.path[3*e],r=0==e?0:this.path[3*e-1]+1,o=0;o<t;o++)r+=n.child(o).nodeSize;return r},e.marks=function(){var t=this.parent,e=this.index();if(0==t.content.size)return R.none;if(this.textOffset)return t.child(e).marks;var n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){var o=n;n=r,r=o}for(var i=n.marks,s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i},e.marksAcross=function(t){var e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;for(var n=e.marks,r=t.parent.maybeChild(t.index()),o=0;o<n.length;o++)!1!==n[o].type.spec.inclusive||r&&n[o].isInSet(r.marks)||(n=n[o--].removeFromSet(n));return n},e.sharedDepth=function(t){for(var e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0},e.blockRange=function(t,e){if(void 0===t&&(t=this),t.pos<this.pos)return t.blockRange(this);for(var n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new G(this,t,n);return null},e.sameParent=function(t){return this.pos-this.parentOffset==t.pos-t.parentOffset},e.max=function(t){return t.pos>this.pos?t:this},e.min=function(t){return t.pos<this.pos?t:this},e.toString=function(){for(var t="",e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset},t.resolve=function(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");for(var r=[],o=0,i=n,s=e;;){var a=s.content.findIndex(i),c=a.index,l=a.offset,u=i-l;if(r.push(s,c,o+l),!u)break;if((s=s.child(c)).isText)break;i=u-1,o+=l+1}return new t(n,r,i)},t.resolveCached=function(e,n){var r=J.get(e);if(r)for(var o=0;o<r.elts.length;o++){var i=r.elts[o];if(i.pos==n)return i}else J.set(e,r=new K);var s=r.elts[r.i]=t.resolve(e,n);return r.i=(r.i+1)%U,s},g(t,[{key:"parent",get:function(){return this.node(this.depth)}},{key:"doc",get:function(){return this.node(0)}},{key:"textOffset",get:function(){return this.pos-this.path[this.path.length-1]}},{key:"nodeAfter",get:function(){var t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;var n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r}},{key:"nodeBefore",get:function(){var t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)}}])}(),K=function(){this.elts=[],this.i=0},U=12,J=new WeakMap,G=function(){return g(function(t,e,n){this.$from=t,this.$to=e,this.depth=n},[{key:"start",get:function(){return this.$from.before(this.depth+1)}},{key:"end",get:function(){return this.$to.after(this.depth+1)}},{key:"parent",get:function(){return this.$from.node(this.depth)}},{key:"startIndex",get:function(){return this.$from.index(this.depth)}},{key:"endIndex",get:function(){return this.$to.indexAfter(this.depth)}}])}(),Z=Object.create(null),Q=function(){function t(t,e,n,r){void 0===r&&(r=R.none),this.type=t,this.attrs=e,this.marks=r,this.content=n||A.empty}var e=t.prototype;return e.child=function(t){return this.content.child(t)},e.maybeChild=function(t){return this.content.maybeChild(t)},e.forEach=function(t){this.content.forEach(t)},e.nodesBetween=function(t,e,n,r){void 0===r&&(r=0),this.content.nodesBetween(t,e,n,r,this)},e.descendants=function(t){this.nodesBetween(0,this.content.size,t)},e.textBetween=function(t,e,n,r){return this.content.textBetween(t,e,n,r)},e.eq=function(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)},e.sameMarkup=function(t){return this.hasMarkup(t.type,t.attrs,t.marks)},e.hasMarkup=function(t,e,n){return this.type==t&&N(this.attrs,e||t.defaultAttrs||Z)&&R.sameSet(this.marks,n||R.none)},e.copy=function(e){return void 0===e&&(e=null),e==this.content?this:new t(this.type,this.attrs,e,this.marks)},e.mark=function(e){return e==this.marks?this:new t(this.type,this.attrs,this.content,e)},e.cut=function(t,e){return void 0===e&&(e=this.content.size),0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))},e.slice=function(t,e,n){if(void 0===e&&(e=this.content.size),void 0===n&&(n=!1),t==e)return I.empty;var r=this.resolve(t),o=this.resolve(e),i=n?0:r.sharedDepth(e),s=r.start(i),a=r.node(i).content.cut(r.pos-s,o.pos-s);return new I(a,r.depth-i,o.depth-i)},e.replace=function(t,e,n){return z(this.resolve(t),this.resolve(e),n)},e.nodeAt=function(t){for(var e=this;;){var n=e.content.findIndex(t),r=n.index,o=n.offset;if(!(e=e.maybeChild(r)))return null;if(o==t||e.isText)return e;t-=o+1}},e.childAfter=function(t){var e=this.content.findIndex(t),n=e.index,r=e.offset;return{node:this.content.maybeChild(n),index:n,offset:r}},e.childBefore=function(t){if(0==t)return{node:null,index:0,offset:0};var e=this.content.findIndex(t),n=e.index,r=e.offset;if(r<t)return{node:this.content.child(n),index:n,offset:r};var o=this.content.child(n-1);return{node:o,index:n-1,offset:r-o.nodeSize}},e.resolve=function(t){return q.resolveCached(this,t)},e.resolveNoCache=function(t){return q.resolve(this,t)},e.rangeHasMark=function(t,e,n){var r=!1;return e>t&&this.nodesBetween(t,e,function(t){return n.isInSet(t.marks)&&(r=!0),!r}),r},e.toString=function(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);var t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),Y(this.marks,t)},e.contentMatchAt=function(t){var e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e},e.canReplace=function(t,e,n,r,o){void 0===n&&(n=A.empty),void 0===r&&(r=0),void 0===o&&(o=n.childCount);var i=this.contentMatchAt(t).matchFragment(n,r,o),s=i&&i.matchFragment(this.content,e);if(!s||!s.validEnd)return!1;for(var a=r;a<o;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0},e.canReplaceWith=function(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;var o=this.contentMatchAt(t).matchType(n),i=o&&o.matchFragment(this.content,e);return!!i&&i.validEnd},e.canAppend=function(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)},e.check=function(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);for(var t=R.none,e=0;e<this.marks.length;e++){var n=this.marks[e];n.type.checkAttrs(n.attrs),t=n.addToSet(t)}if(!R.sameSet(t,this.marks))throw new RangeError("Invalid collection of marks for node "+this.type.name+": "+this.marks.map(function(t){return t.type.name}));this.content.forEach(function(t){return t.check()})},e.toJSON=function(){var t={type:this.type.name};for(var e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map(function(t){return t.toJSON()})),t},t.fromJSON=function(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");var n=void 0;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}var r=A.fromJSON(t,e.content),o=t.nodeType(e.type).create(e.attrs,r,n);return o.type.checkAttrs(o.attrs),o},g(t,[{key:"children",get:function(){return this.content.content}},{key:"nodeSize",get:function(){return this.isLeaf?1:2+this.content.size}},{key:"childCount",get:function(){return this.content.childCount}},{key:"textContent",get:function(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}},{key:"firstChild",get:function(){return this.content.firstChild}},{key:"lastChild",get:function(){return this.content.lastChild}},{key:"isBlock",get:function(){return this.type.isBlock}},{key:"isTextblock",get:function(){return this.type.isTextblock}},{key:"inlineContent",get:function(){return this.type.inlineContent}},{key:"isInline",get:function(){return this.type.isInline}},{key:"isText",get:function(){return this.type.isText}},{key:"isLeaf",get:function(){return this.type.isLeaf}},{key:"isAtom",get:function(){return this.type.isAtom}}])}();Q.prototype.text=void 0;var X=function(t){function e(e,n,r,o){var i;if(i=t.call(this,e,n,null,o)||this,!r)throw new RangeError("Empty text nodes are not allowed");return i.text=r,i}f(e,t);var n=e.prototype;return n.toString=function(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Y(this.marks,JSON.stringify(this.text))},n.textBetween=function(t,e){return this.text.slice(t,e)},n.mark=function(t){return t==this.marks?this:new e(this.type,this.attrs,this.text,t)},n.withText=function(t){return t==this.text?this:new e(this.type,this.attrs,t,this.marks)},n.cut=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.text.length),0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))},n.eq=function(t){return this.sameMarkup(t)&&this.text==t.text},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return e.text=this.text,e},g(e,[{key:"textContent",get:function(){return this.text}},{key:"nodeSize",get:function(){return this.text.length}}])}(Q);function Y(t,e){for(var n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var tt=function(){function t(t){this.validEnd=t,this.next=[],this.wrapCache=[]}t.parse=function(e,n){var r=new et(e,n);if(null==r.next)return t.empty;var o=nt(r);r.next&&r.err("Unexpected trailing text");var i=lt(function(t){var e=[[]];return o(function t(e,i){if("choice"==e.type)return e.exprs.reduce(function(e,n){return e.concat(t(n,i))},[]);if("seq"!=e.type){if("star"==e.type){var s=n();return r(i,s),o(t(e.expr,s),s),[r(s)]}if("plus"==e.type){var a=n();return o(t(e.expr,i),a),o(t(e.expr,a),a),[r(a)]}if("opt"==e.type)return[r(i)].concat(t(e.expr,i));if("range"==e.type){for(var c=i,l=0;l<e.min;l++){var u=n();o(t(e.expr,c),u),c=u}if(-1==e.max)o(t(e.expr,c),c);else for(var d=e.min;d<e.max;d++){var f=n();r(c,f),o(t(e.expr,c),f),c=f}return[r(c)]}if("name"==e.type)return[r(i,void 0,e.value)];throw new Error("Unknown expr type")}for(var h=0;;h++){var p=t(e.exprs[h],i);if(h==e.exprs.length-1)return p;o(p,i=n())}}(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){var o={term:r,to:n};return e[t].push(o),o}function o(t,e){t.forEach(function(t){return t.to=e})}}(o));return function(t,e){for(var n=0,r=[t];n<r.length;n++){for(var o=r[n],i=!o.validEnd,s=[],a=0;a<o.next.length;a++){var c=o.next[a],l=c.type,u=c.next;s.push(l.name),!i||l.isText||l.hasRequiredAttrs()||(i=!1),-1==r.indexOf(u)&&r.push(u)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(i,r),i};var e=t.prototype;return e.matchType=function(t){for(var e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null},e.matchFragment=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=t.childCount);for(var r=this,o=e;r&&o<n;o++)r=r.matchType(t.child(o).type);return r},e.compatible=function(t){for(var e=0;e<this.next.length;e++)for(var n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1},e.fillBefore=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=0);var r=[this];return function o(i,s){var a=i.matchFragment(t,n);if(a&&(!e||a.validEnd))return A.from(s.map(function(t){return t.createAndFill()}));for(var c=0;c<i.next.length;c++){var l=i.next[c],u=l.type,d=l.next;if(!u.isText&&!u.hasRequiredAttrs()&&-1==r.indexOf(d)){r.push(d);var f=o(d,s.concat(u));if(f)return f}}return null}(this,[])},e.findWrapping=function(t){for(var e=0;e<this.wrapCache.length;e+=2)if(this.wrapCache[e]==t)return this.wrapCache[e+1];var n=this.computeWrapping(t);return this.wrapCache.push(t,n),n},e.computeWrapping=function(t){for(var e=Object.create(null),n=[{match:this,type:null,via:null}];n.length;){var r=n.shift(),o=r.match;if(o.matchType(t)){for(var i=[],s=r;s.type;s=s.via)i.push(s.type);return i.reverse()}for(var a=0;a<o.next.length;a++){var c=o.next[a],l=c.type,u=c.next;l.isLeaf||l.hasRequiredAttrs()||l.name in e||r.type&&!u.validEnd||(n.push({match:l.contentMatch,type:l,via:r}),e[l.name]=!0)}}return null},e.edge=function(t){if(t>=this.next.length)throw new RangeError("There's no "+t+"th edge in this content match");return this.next[t]},e.toString=function(){var t=[];return function e(n){t.push(n);for(var r=0;r<n.next.length;r++)-1==t.indexOf(n.next[r].next)&&e(n.next[r].next)}(this),t.map(function(e,n){for(var r=n+(e.validEnd?"*":" ")+" ",o=0;o<e.next.length;o++)r+=(o?", ":"")+e.next[o].type.name+"->"+t.indexOf(e.next[o].next);return r}).join("\n")},g(t,[{key:"inlineContent",get:function(){return 0!=this.next.length&&this.next[0].type.isInline}},{key:"defaultType",get:function(){for(var t=0;t<this.next.length;t++){var e=this.next[t].type;if(!e.isText&&!e.hasRequiredAttrs())return e}return null}},{key:"edgeCount",get:function(){return this.next.length}}])}();tt.empty=new tt(!0);var et=function(){function t(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}var e=t.prototype;return e.eat=function(t){return this.next==t&&(this.pos++||!0)},e.err=function(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")},g(t,[{key:"next",get:function(){return this.tokens[this.pos]}}])}();function nt(t){var e=[];do{e.push(rt(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function rt(t){var e=[];do{e.push(ot(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function ot(t){for(var e=function(t){if(t.eat("(")){var e=nt(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){var n=function(t,e){var n=t.nodeTypes,r=n[e];if(r)return[r];var o=[];for(var i in n){var s=n[i];s.isInGroup(e)&&o.push(s)}return 0==o.length&&t.err("No node type or group '"+e+"' found"),o}(t,t.next).map(function(e){return null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e}});return t.pos++,1==n.length?n[0]:{type:"choice",exprs:n}}t.err("Unexpected token '"+t.next+"'")}(t);;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=st(t,e)}return e}function it(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");var e=Number(t.next);return t.pos++,e}function st(t,e){var n=it(t),r=n;return t.eat(",")&&(r="}"!=t.next?it(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function at(t,e){return e-t}function ct(t,e){var n=[];return function e(r){var o=t[r];if(1==o.length&&!o[0].term)return e(o[0].to);n.push(r);for(var i=0;i<o.length;i++){var s=o[i],a=s.term,c=s.to;a||-1!=n.indexOf(c)||e(c)}}(e),n.sort(at)}function lt(t){var e=Object.create(null);return function n(r){var o=[];r.forEach(function(e){t[e].forEach(function(e){var n=e.term,r=e.to;if(n){for(var i,s=0;s<o.length;s++)o[s][0]==n&&(i=o[s][1]);ct(t,r).forEach(function(t){i||o.push([n,i=[]]),-1==i.indexOf(t)&&i.push(t)})}})});for(var i=e[r.join(",")]=new tt(r.indexOf(t.length-1)>-1),s=0;s<o.length;s++){var a=o[s][1].sort(at);i.next.push({type:o[s][0],next:e[a.join(",")]||n(a)})}return i}(ct(t,0))}function ut(t){var e=Object.create(null);for(var n in t){var r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function dt(t,e){var n=Object.create(null);for(var r in t){var o=e&&e[r];if(void 0===o){var i=t[r];if(!i.hasDefault)throw new RangeError("No value supplied for attribute "+r);o=i.default}n[r]=o}return n}function ft(t,e,n,r){for(var o in e)if(!(o in t))throw new RangeError("Unsupported attribute "+o+" for "+n+" of type "+o);for(var i in t){var s=t[i];s.validate&&s.validate(e[i])}}function ht(t,e){var n=Object.create(null);if(e)for(var r in e)n[r]=new mt(t,r,e[r]);return n}var pt=function(){function t(t,e,n){this.name=t,this.schema=e,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=ht(t,n.attrs),this.defaultAttrs=ut(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t}var e=t.prototype;return e.isInGroup=function(t){return this.groups.indexOf(t)>-1},e.hasRequiredAttrs=function(){for(var t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1},e.compatibleContent=function(t){return this==t||this.contentMatch.compatible(t.contentMatch)},e.computeAttrs=function(t){return!t&&this.defaultAttrs?this.defaultAttrs:dt(this.attrs,t)},e.create=function(t,e,n){if(void 0===t&&(t=null),this.isText)throw new Error("NodeType.create can't construct text nodes");return new Q(this,this.computeAttrs(t),A.from(e),R.setFrom(n))},e.createChecked=function(t,e,n){return void 0===t&&(t=null),e=A.from(e),this.checkContent(e),new Q(this,this.computeAttrs(t),e,R.setFrom(n))},e.createAndFill=function(t,e,n){if(void 0===t&&(t=null),t=this.computeAttrs(t),(e=A.from(e)).size){var r=this.contentMatch.fillBefore(e);if(!r)return null;e=r.append(e)}var o=this.contentMatch.matchFragment(e),i=o&&o.fillBefore(A.empty,!0);return i?new Q(this,t,e.append(i),R.setFrom(n)):null},e.validContent=function(t){var e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(var n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0},e.checkContent=function(t){if(!this.validContent(t))throw new RangeError("Invalid content for node "+this.name+": "+t.toString().slice(0,50))},e.checkAttrs=function(t){ft(this.attrs,t,"node",this.name)},e.allowsMarkType=function(t){return null==this.markSet||this.markSet.indexOf(t)>-1},e.allowsMarks=function(t){if(null==this.markSet)return!0;for(var e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0},e.allowedMarks=function(t){if(null==this.markSet)return t;for(var e,n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:R.none:t},t.compile=function(e,n){var r=Object.create(null);e.forEach(function(e,o){return r[e]=new t(e,n,o)});var o=n.spec.topNode||"doc";if(!r[o])throw new RangeError("Schema is missing its top node type ('"+o+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(var i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r},g(t,[{key:"isInline",get:function(){return!this.isBlock}},{key:"isTextblock",get:function(){return this.isBlock&&this.inlineContent}},{key:"isLeaf",get:function(){return this.contentMatch==tt.empty}},{key:"isAtom",get:function(){return this.isLeaf||!!this.spec.atom}},{key:"whitespace",get:function(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}}])}(),mt=function(){return g(function(t,e,n){this.hasDefault=Object.prototype.hasOwnProperty.call(n,"default"),this.default=n.default,this.validate="string"==typeof n.validate?function(t,e,n){var r=n.split("|");return function(n){var o=null===n?"null":typeof n;if(r.indexOf(o)<0)throw new RangeError("Expected value of type "+r+" for attribute "+e+" on type "+t+", got "+o)}}(t,e,n.validate):n.validate},[{key:"isRequired",get:function(){return!this.hasDefault}}])}(),vt=function(){function t(t,e,n,r){this.name=t,this.rank=e,this.schema=n,this.spec=r,this.attrs=ht(t,r.attrs),this.excluded=null;var o=ut(this.attrs);this.instance=o?new R(this,o):null}var e=t.prototype;return e.create=function(t){return void 0===t&&(t=null),!t&&this.instance?this.instance:new R(this,dt(this.attrs,t))},t.compile=function(e,n){var r=Object.create(null),o=0;return e.forEach(function(e,i){return r[e]=new t(e,o++,n,i)}),r},e.removeFromSet=function(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t},e.isInSet=function(t){for(var e=0;e<t.length;e++)if(t[e].type==this)return t[e]},e.checkAttrs=function(t){ft(this.attrs,t,"mark",this.name)},e.excludes=function(t){return this.excluded.indexOf(t)>-1},t}(),gt=function(){function t(t){var e=this;this.linebreakReplacement=null,this.cached=Object.create(null);var n=this.spec={};for(var r in t)n[r]=t[r];n.nodes=S.from(t.nodes),n.marks=S.from(t.marks||{}),this.nodes=pt.compile(this.spec.nodes,this),this.marks=vt.compile(this.spec.marks,this);var o=Object.create(null);for(var i in this.nodes){if(i in this.marks)throw new RangeError(i+" can not be both a node and a mark");var s=this.nodes[i],a=s.spec.content||"",c=s.spec.marks;if(s.contentMatch=o[a]||(o[a]=tt.parse(a,this.nodes)),s.inlineContent=s.contentMatch.inlineContent,s.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!s.isInline||!s.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=s}s.markSet="_"==c?null:c?yt(this,c.split(" ")):""!=c&&s.inlineContent?null:[]}for(var l in this.marks){var u=this.marks[l],d=u.spec.excludes;u.excluded=null==d?[u]:""==d?[]:yt(this,d.split(" "))}this.nodeFromJSON=function(t){return Q.fromJSON(e,t)},this.markFromJSON=function(t){return R.fromJSON(e,t)},this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}var e=t.prototype;return e.node=function(t,e,n,r){if(void 0===e&&(e=null),"string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof pt))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)},e.text=function(t,e){var n=this.nodes.text;return new X(n,n.defaultAttrs,t,R.setFrom(e))},e.mark=function(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)},e.nodeType=function(t){var e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e},t}();function yt(t,e){for(var n=[],r=0;r<e.length;r++){var o=e[r],i=t.marks[o],s=i;if(i)n.push(i);else for(var a in t.marks){var c=t.marks[a];("_"==o||c.spec.group&&c.spec.group.split(" ").indexOf(o)>-1)&&n.push(s=c)}if(!s)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}var kt=function(){function t(t,e){var n=this;this.schema=t,this.rules=e,this.tags=[],this.styles=[];var r=this.matchedStyles=[];e.forEach(function(t){if(function(t){return null!=t.tag}(t))n.tags.push(t);else if(function(t){return null!=t.style}(t)){var e=/[^=]*/.exec(t.style)[0];r.indexOf(e)<0&&r.push(e),n.styles.push(t)}}),this.normalizeLists=!this.tags.some(function(e){if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;var n=t.nodes[e.node];return n.contentMatch.matchType(n)})}var e=t.prototype;return e.parse=function(t,e){void 0===e&&(e={});var n=new Mt(this,e,!1);return n.addAll(t,R.none,e.from,e.to),n.finish()},e.parseSlice=function(t,e){void 0===e&&(e={});var n=new Mt(this,e,!0);return n.addAll(t,R.none,e.from,e.to),I.maxOpen(n.finish())},e.matchTag=function(t,e,n){for(var r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){var o=this.tags[r];if(Tt(t,o.tag)&&(void 0===o.namespace||t.namespaceURI==o.namespace)&&(!o.context||e.matchesContext(o.context))){if(o.getAttrs){var i=o.getAttrs(t);if(!1===i)continue;o.attrs=i||void 0}return o}}},e.matchStyle=function(t,e,n,r){for(var o=r?this.styles.indexOf(r)+1:0;o<this.styles.length;o++){var i=this.styles[o],s=i.style;if(!(0!=s.indexOf(t)||i.context&&!n.matchesContext(i.context)||s.length>t.length&&(61!=s.charCodeAt(t.length)||s.slice(t.length+1)!=e))){if(i.getAttrs){var a=i.getAttrs(e);if(!1===a)continue;i.attrs=a||void 0}return i}}},t.schemaRules=function(t){var e=[];function n(t){for(var n=null==t.priority?50:t.priority,r=0;r<e.length;r++){var o=e[r];if((null==o.priority?50:o.priority)<n)break}e.splice(r,0,t)}var r=function(e){var r=t.marks[e].spec.parseDOM;r&&r.forEach(function(t){n(t=At(t)),t.mark||t.ignore||t.clearMark||(t.mark=e)})};for(var o in t.marks)r(o);var i=function(e){var r=t.nodes[e].spec.parseDOM;r&&r.forEach(function(t){n(t=At(t)),t.node||t.ignore||t.mark||(t.node=e)})};for(var s in t.nodes)i(s);return e},t.fromSchema=function(e){return e.cached.domParser||(e.cached.domParser=new t(e,t.schemaRules(e)))},t}(),bt={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},wt={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},xt={ol:!0,ul:!0};function St(t,e,n){return null!=e?(e?1:0)|("full"===e?2:0):t&&"pre"==t.whitespace?3:-5&n}var Ct=function(){function t(t,e,n,r,o,i){this.type=t,this.attrs=e,this.marks=n,this.solid=r,this.options=i,this.content=[],this.activeMarks=R.none,this.match=o||(4&i?null:t.contentMatch)}var e=t.prototype;return e.findWrapping=function(t){if(!this.match){if(!this.type)return[];var e=this.type.contentMatch.fillBefore(A.from(t));if(!e){var n,r=this.type.contentMatch;return(n=r.findWrapping(t.type))?(this.match=r,n):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)},e.finish=function(t){if(!(1&this.options)){var e,n=this.content[this.content.length-1];if(n&&n.isText&&(e=/[ \t\r\n\u000c]+$/.exec(n.text))){var r=n;n.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-e[0].length))}}var o=A.from(this.content);return!t&&this.match&&(o=o.append(this.match.fillBefore(A.empty,!0))),this.type?this.type.create(this.attrs,o,this.marks):o},e.inlineContext=function(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!bt.hasOwnProperty(t.parentNode.nodeName.toLowerCase())},t}(),Mt=function(){function t(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0,this.localPreserveWS=!1;var r,o=e.topNode,i=St(null,e.preserveWhitespace,0)|(n?4:0);r=o?new Ct(o.type,o.attrs,R.none,!0,e.topMatch||o.type.contentMatch,i):new Ct(n?null:t.schema.topNodeType,null,R.none,!0,null,i),this.nodes=[r],this.find=e.findPositions,this.needsBlock=!1}var e=t.prototype;return e.addDOM=function(t,e){3==t.nodeType?this.addTextNode(t,e):1==t.nodeType&&this.addElement(t,e)},e.addTextNode=function(t,e){var n=t.nodeValue,r=this.top,o=2&r.options?"full":this.localPreserveWS||(1&r.options)>0,i=this.parser.schema;if("full"===o||r.inlineContext(t)||/[^ \t\r\n\u000c]/.test(n)){if(o)if("full"===o)n=n.replace(/\r\n?/g,"\n");else if(i.linebreakReplacement&&/[\r\n]/.test(n)&&this.top.findWrapping(i.linebreakReplacement.create())){for(var s=n.split(/\r?\n|\r/),a=0;a<s.length;a++)a&&this.insertNode(i.linebreakReplacement.create(),e,!0),s[a]&&this.insertNode(i.text(s[a]),e,!/\S/.test(s[a]));n=""}else n=n.replace(/\r?\n|\r/g," ");else if(n=n.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(n)&&this.open==this.nodes.length-1){var c=r.content[r.content.length-1],l=t.previousSibling;(!c||l&&"BR"==l.nodeName||c.isText&&/[ \t\r\n\u000c]$/.test(c.text))&&(n=n.slice(1))}n&&this.insertNode(i.text(n),e,!/\S/.test(n)),this.findInText(t)}else this.findInside(t)},e.addElement=function(t,e,n){var r=this.localPreserveWS,o=this.top;("PRE"==t.tagName||/pre/.test(t.style&&t.style.whiteSpace))&&(this.localPreserveWS=!0);var i,s=t.nodeName.toLowerCase();xt.hasOwnProperty(s)&&this.parser.normalizeLists&&function(t){for(var e=t.firstChild,n=null;e;e=e.nextSibling){var r=1==e.nodeType?e.nodeName.toLowerCase():null;r&&xt.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):"li"==r?n=e:r&&(n=null)}}(t);var a=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(i=this.parser.matchTag(t,this,n));t:if(a?a.ignore:wt.hasOwnProperty(s))this.findInside(t),this.ignoreFallback(t,e);else if(!a||a.skip||a.closeParent){a&&a.closeParent?this.open=Math.max(0,this.open-1):a&&a.skip.nodeType&&(t=a.skip);var c,l=this.needsBlock;if(bt.hasOwnProperty(s))o.content.length&&o.content[0].isInline&&this.open&&(this.open--,o=this.top),c=!0,o.type||(this.needsBlock=!0);else if(!t.firstChild){this.leafFallback(t,e);break t}var u=a&&a.skip?e:this.readStyles(t,e);u&&this.addAll(t,u),c&&this.sync(o),this.needsBlock=l}else{var d=this.readStyles(t,e);d&&this.addElementByRule(t,a,d,!1===a.consuming?i:void 0)}this.localPreserveWS=r},e.leafFallback=function(t,e){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"),e)},e.ignoreFallback=function(t,e){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"),e,!0)},e.readStyles=function(t,e){var n=this,r=t.style;if(r&&r.length)for(var o=0;o<this.parser.matchedStyles.length;o++){var i=this.parser.matchedStyles[o],s=r.getPropertyValue(i);if(s)for(var a,c=function(t){var r=n.parser.matchStyle(i,s,n,t);return r?r.ignore?{v:null}:(e=r.clearMark?e.filter(function(t){return!r.clearMark(t)}):e.concat(n.parser.schema.marks[r.mark].create(r.attrs)),!1!==r.consuming?(l=t,0):void(l=t=r)):(l=t,0)},l=void 0;0!==(a=c(l));)if(a)return a.v}return e},e.addElementByRule=function(t,e,n,r){var o,i,s=this;if(e.node)if((i=this.parser.schema.nodes[e.node]).isLeaf)this.insertNode(i.create(e.attrs),n,"BR"==t.nodeName)||this.leafFallback(t,n);else{var a=this.enter(i,e.attrs||null,n,e.preserveWhitespace);a&&(o=!0,n=a)}else{var c=this.parser.schema.marks[e.mark];n=n.concat(c.create(e.attrs))}var l=this.top;if(i&&i.isLeaf)this.findInside(t);else if(r)this.addElement(t,n,r);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach(function(t){return s.insertNode(t,n,!1)});else{var u=t;"string"==typeof e.contentElement?u=t.querySelector(e.contentElement):"function"==typeof e.contentElement?u=e.contentElement(t):e.contentElement&&(u=e.contentElement),this.findAround(t,u,!0),this.addAll(u,n),this.findAround(t,u,!1)}o&&this.sync(l)&&this.open--},e.addAll=function(t,e,n,r){for(var o=n||0,i=n?t.childNodes[n]:t.firstChild,s=null==r?null:t.childNodes[r];i!=s;i=i.nextSibling,++o)this.findAtPoint(t,o),this.addDOM(i,e);this.findAtPoint(t,o)},e.findPlace=function(t,e,n){for(var r,o,i=this.open,s=0;i>=0;i--){var a=this.nodes[i],c=a.findWrapping(t);if(c&&(!r||r.length>c.length+s)&&(r=c,o=a,!c.length))break;if(a.solid){if(n)break;s+=2}}if(!r)return null;this.sync(o);for(var l=0;l<r.length;l++)e=this.enterInner(r[l],null,e,!1);return e},e.insertNode=function(t,e,n){if(t.isInline&&this.needsBlock&&!this.top.type){var r=this.textblockFromContext();r&&(e=this.enterInner(r,null,e))}var o=this.findPlace(t,e,n);if(o){this.closeExtra();var i=this.top;i.match&&(i.match=i.match.matchType(t.type));for(var s,a=R.none,c=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return C(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(o.concat(t.marks));!(s=c()).done;){var l=s.value;(i.type?i.type.allowsMarkType(l.type):Ot(l.type,t.type))&&(a=l.addToSet(a))}return i.content.push(t.mark(a)),!0}return!1},e.enter=function(t,e,n,r){var o=this.findPlace(t.create(e),n,!1);return o&&(o=this.enterInner(t,e,n,!0,r)),o},e.enterInner=function(t,e,n,r,o){void 0===r&&(r=!1),this.closeExtra();var i=this.top;i.match=i.match&&i.match.matchType(t);var s=St(t,o,i.options);4&i.options&&0==i.content.length&&(s|=4);var a=R.none;return n=n.filter(function(e){return!(i.type?i.type.allowsMarkType(e.type):Ot(e.type,t))||(a=e.addToSet(a),!1)}),this.nodes.push(new Ct(t,e,a,r,null,s)),this.open++,n},e.closeExtra=function(t){void 0===t&&(t=!1);var e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}},e.finish=function(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!(!this.isOpen&&!this.options.topOpen))},e.sync=function(t){for(var e=this.open;e>=0;e--){if(this.nodes[e]==t)return this.open=e,!0;this.localPreserveWS&&(this.nodes[e].options|=1)}return!1},e.findAtPoint=function(t,e){if(this.find)for(var n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)},e.findInside=function(t){if(this.find)for(var e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)},e.findAround=function(t,e,n){if(t!=e&&this.find)for(var r=0;r<this.find.length;r++)null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)&&e.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)},e.findInText=function(t){if(this.find)for(var e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))},e.matchesContext=function(t){var e=this;if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);var n=t.split("/"),r=this.options.context,o=!(this.isOpen||r&&r.parent.type!=this.nodes[0].type),i=-(r?r.depth+1:0)+(o?0:1),s=function(t,a){for(;t>=0;t--){var c=n[t];if(""==c){if(t==n.length-1||0==t)continue;for(;a>=i;a--)if(s(t-1,a))return!0;return!1}var l=a>0||0==a&&o?e.nodes[a].type:r&&a>=i?r.node(a-i).type:null;if(!l||l.name!=c&&!l.isInGroup(c))return!1;a--}return!0};return s(n.length-1,this.open)},e.textblockFromContext=function(){var t=this.options.context;if(t)for(var e=t.depth;e>=0;e--){var n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(var r in this.parser.schema.nodes){var o=this.parser.schema.nodes[r];if(o.isTextblock&&o.defaultAttrs)return o}},g(t,[{key:"top",get:function(){return this.nodes[this.open]}},{key:"currentPos",get:function(){this.closeExtra();for(var t=0,e=this.open;e>=0;e--){for(var n=this.nodes[e].content,r=n.length-1;r>=0;r--)t+=n[r].nodeSize;e&&t++}return t}}])}();function Tt(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function At(t){var e={};for(var n in t)e[n]=t[n];return e}function Ot(t,e){var n,r=e.schema.nodes,o=function(){var n=r[i];if(!n.allowsMarkType(t))return 0;var o=[],s=function(t){o.push(t);for(var n=0;n<t.edgeCount;n++){var r=t.edge(n),i=r.type,a=r.next;if(i==e)return!0;if(o.indexOf(a)<0&&s(a))return!0}};return s(n.contentMatch)?{v:!0}:void 0};for(var i in r)if(0!==(n=o())&&n)return n.v}var Et=function(){function t(t,e){this.nodes=t,this.marks=e}var e=t.prototype;return e.serializeFragment=function(t,e,n){var r=this;void 0===e&&(e={}),n||(n=Rt(e).createDocumentFragment());var o=n,i=[];return t.forEach(function(t){if(i.length||t.marks.length){for(var n=0,s=0;n<i.length&&s<t.marks.length;){var a=t.marks[s];if(r.marks[a.type.name]){if(!a.eq(i[n][0])||!1===a.type.spec.spanning)break;n++,s++}else s++}for(;n<i.length;)o=i.pop()[1];for(;s<t.marks.length;){var c=t.marks[s++],l=r.serializeMark(c,t.isInline,e);l&&(i.push([c,o]),o.appendChild(l.dom),o=l.contentDOM||l.dom)}}o.appendChild(r.serializeNodeInner(t,e))}),n},e.serializeNodeInner=function(t,e){var n=It(Rt(e),this.nodes[t.type.name](t),null,t.attrs),r=n.dom,o=n.contentDOM;if(o){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,o)}return r},e.serializeNode=function(t,e){void 0===e&&(e={});for(var n=this.serializeNodeInner(t,e),r=t.marks.length-1;r>=0;r--){var o=this.serializeMark(t.marks[r],t.isInline,e);o&&((o.contentDOM||o.dom).appendChild(n),n=o.dom)}return n},e.serializeMark=function(t,e,n){void 0===n&&(n={});var r=this.marks[t.type.name];return r&&It(Rt(n),r(t,e),null,t.attrs)},t.renderSpec=function(t,e,n,r){return void 0===n&&(n=null),It(t,e,n,r)},t.fromSchema=function(e){return e.cached.domSerializer||(e.cached.domSerializer=new t(this.nodesFromSchema(e),this.marksFromSchema(e)))},t.nodesFromSchema=function(t){var e=Nt(t.nodes);return e.text||(e.text=function(t){return t.text}),e},t.marksFromSchema=function(t){return Nt(t.marks)},t}();function Nt(t){var e={};for(var n in t){var r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Rt(t){return t.document||window.document}var Dt=new WeakMap;function It(t,e,n,r){if("string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;var o,i=e[0];if("string"!=typeof i)throw new RangeError("Invalid array passed to renderSpec");if(r&&(o=function(t){var e=Dt.get(t);return void 0===e&&Dt.set(t,e=function(t){var e=null;return function t(n){if(n&&"object"==typeof n)if(Array.isArray(n))if("string"==typeof n[0])e||(e=[]),e.push(n);else for(var r=0;r<n.length;r++)t(n[r]);else for(var o in n)t(n[o])}(t),e}(t)),e}(r))&&o.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");var s,a=i.indexOf(" ");a>0&&(n=i.slice(0,a),i=i.slice(a+1));var c=n?t.createElementNS(n,i):t.createElement(i),l=e[1],u=1;if(l&&"object"==typeof l&&null==l.nodeType&&!Array.isArray(l))for(var d in u=2,l)if(null!=l[d]){var f=d.indexOf(" ");f>0?c.setAttributeNS(d.slice(0,f),d.slice(f+1),l[d]):"style"==d&&c.style?c.style.cssText=l[d]:c.setAttribute(d,l[d])}for(var h=u;h<e.length;h++){var p=e[h];if(0===p){if(h<e.length-1||h>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:c,contentDOM:c}}var m=It(t,p,n,r),v=m.dom,g=m.contentDOM;if(c.appendChild(v),g){if(s)throw new RangeError("Multiple content holes");s=g}}return{dom:c,contentDOM:s}}var Lt=Math.pow(2,16);function Pt(t,e){return t+e*Lt}function zt(t){return 65535&t}var Bt=function(){return g(function(t,e,n){this.pos=t,this.delInfo=e,this.recover=n},[{key:"deleted",get:function(){return(8&this.delInfo)>0}},{key:"deletedBefore",get:function(){return(5&this.delInfo)>0}},{key:"deletedAfter",get:function(){return(6&this.delInfo)>0}},{key:"deletedAcross",get:function(){return(4&this.delInfo)>0}}])}(),$t=function(){function t(e,n){if(void 0===n&&(n=!1),this.ranges=e,this.inverted=n,!e.length&&t.empty)return t.empty}var e=t.prototype;return e.recover=function(t){var e=0,n=zt(t);if(!this.inverted)for(var r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+function(t){return(t-(65535&t))/Lt}(t)},e.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},e.map=function(t,e){return void 0===e&&(e=1),this._map(t,e,!0)},e._map=function(t,e,n){for(var r=0,o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?r:0);if(a>t)break;var c=this.ranges[s+o],l=this.ranges[s+i],u=a+c;if(t<=u){var d=a+r+((c?t==a?-1:t==u?1:e:e)<0?0:l);if(n)return d;var f=t==(e<0?a:u)?null:Pt(s/3,t-a),h=t==a?2:t==u?1:4;return(e<0?t!=a:t!=u)&&(h|=8),new Bt(d,h,f)}r+=l-c}return n?t+r:new Bt(t+r,0,null)},e.touches=function(t,e){for(var n=0,r=zt(e),o=this.inverted?2:1,i=this.inverted?1:2,s=0;s<this.ranges.length;s+=3){var a=this.ranges[s]-(this.inverted?n:0);if(a>t)break;var c=this.ranges[s+o];if(t<=a+c&&s==3*r)return!0;n+=this.ranges[s+i]-c}return!1},e.forEach=function(t){for(var e=this.inverted?2:1,n=this.inverted?1:2,r=0,o=0;r<this.ranges.length;r+=3){var i=this.ranges[r],s=i-(this.inverted?o:0),a=i+(this.inverted?0:o),c=this.ranges[r+e],l=this.ranges[r+n];t(s,s+c,a,a+l),o+=l-c}},e.invert=function(){return new t(this.ranges,!this.inverted)},e.toString=function(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)},t.offset=function(e){return 0==e?t.empty:new t(e<0?[0,-e,0]:[0,0,e])},t}();$t.empty=new $t([]);var Ht=function(){function t(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=t?t.length:0),this.mirror=e,this.from=n,this.to=r,this._maps=t||[],this.ownData=!(t||e)}var e=t.prototype;return e.slice=function(e,n){return void 0===e&&(e=0),void 0===n&&(n=this.maps.length),new t(this._maps,this.mirror,e,n)},e.appendMap=function(t,e){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(t),null!=e&&this.setMirror(this._maps.length-1,e)},e.appendMapping=function(t){for(var e=0,n=this._maps.length;e<t._maps.length;e++){var r=t.getMirror(e);this.appendMap(t._maps[e],null!=r&&r<e?n+r:void 0)}},e.getMirror=function(t){if(this.mirror)for(var e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]},e.setMirror=function(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)},e.appendMappingInverted=function(t){for(var e=t.maps.length-1,n=this._maps.length+t._maps.length;e>=0;e--){var r=t.getMirror(e);this.appendMap(t._maps[e].invert(),null!=r&&r>e?n-r-1:void 0)}},e.invert=function(){var e=new t;return e.appendMappingInverted(this),e},e.map=function(t,e){if(void 0===e&&(e=1),this.mirror)return this._map(t,e,!0);for(var n=this.from;n<this.to;n++)t=this._maps[n].map(t,e);return t},e.mapResult=function(t,e){return void 0===e&&(e=1),this._map(t,e,!1)},e._map=function(t,e,n){for(var r=0,o=this.from;o<this.to;o++){var i=this._maps[o].mapResult(t,e);if(null!=i.recover){var s=this.getMirror(o);if(null!=s&&s>o&&s<this.to){o=s,t=this._maps[s].recover(i.recover);continue}}r|=i.delInfo,t=i.pos}return n?t:new Bt(t,r,null)},g(t,[{key:"maps",get:function(){return this._maps}}])}(),_t=Object.create(null),jt=function(){function t(){}var e=t.prototype;return e.getMap=function(){return $t.empty},e.merge=function(t){return null},t.fromJSON=function(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");var n=_t[e.stepType];if(!n)throw new RangeError("No step type "+e.stepType+" defined");return n.fromJSON(t,e)},t.jsonID=function(t,e){if(t in _t)throw new RangeError("Duplicate use of step JSON ID "+t);return _t[t]=e,e.prototype.jsonID=t,e},t}(),Ft=function(){function t(t,e){this.doc=t,this.failed=e}return t.ok=function(e){return new t(e,null)},t.fail=function(e){return new t(null,e)},t.fromReplace=function(e,n,r,o){try{return t.ok(e.replace(n,r,o))}catch(e){if(e instanceof D)return t.fail(e.message);throw e}},t}();function Vt(t,e,n){for(var r=[],o=0;o<t.childCount;o++){var i=t.child(o);i.content.size&&(i=i.copy(Vt(i.content,e,i))),i.isInline&&(i=e(i,n,o)),r.push(i)}return A.fromArray(r)}var Wt=function(t){function e(e,n,r){var o;return(o=t.call(this)||this).from=e,o.to=n,o.mark=r,o}f(e,t);var n=e.prototype;return n.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=t.resolve(this.from),o=r.node(r.sharedDepth(this.to)),i=new I(Vt(n.content,function(t,n){return t.isAtom&&n.type.allowsMarkType(e.mark.type)?t.mark(e.mark.addToSet(t.marks)):t},o),n.openStart,n.openEnd);return Ft.fromReplace(t,this.from,this.to,i)},n.invert=function(){return new qt(this.from,this.to,this.mark)},n.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},n.merge=function(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null},n.toJSON=function(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(jt);jt.jsonID("addMark",Wt);var qt=function(t){function e(e,n,r){var o;return(o=t.call(this)||this).from=e,o.to=n,o.mark=r,o}f(e,t);var n=e.prototype;return n.apply=function(t){var e=this,n=t.slice(this.from,this.to),r=new I(Vt(n.content,function(t){return t.mark(e.mark.removeFromSet(t.marks))},t),n.openStart,n.openEnd);return Ft.fromReplace(t,this.from,this.to,r)},n.invert=function(){return new Wt(this.from,this.to,this.mark)},n.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new e(n.pos,r.pos,this.mark)},n.merge=function(t){return t instanceof e&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new e(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null},n.toJSON=function(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new e(n.from,n.to,t.markFromJSON(n.mark))},e}(jt);jt.jsonID("removeMark",qt);var Kt=function(t){function e(e,n){var r;return(r=t.call(this)||this).pos=e,r.mark=n,r}f(e,t);var n=e.prototype;return n.apply=function(t){var e=t.nodeAt(this.pos);if(!e)return Ft.fail("No node at mark step's position");var n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return Ft.fromReplace(t,this.pos,this.pos+1,new I(A.from(n),0,e.isLeaf?0:1))},n.invert=function(t){var n=t.nodeAt(this.pos);if(n){var r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(var o=0;o<n.marks.length;o++)if(!n.marks[o].isInSet(r))return new e(this.pos,n.marks[o]);return new e(this.pos,this.mark)}}return new Ut(this.pos,this.mark)},n.map=function(t){var n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)},n.toJSON=function(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}},e.fromJSON=function(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new e(n.pos,t.markFromJSON(n.mark))},e}(jt);jt.jsonID("addNodeMark",Kt);var Ut=function(t){function e(e,n){var r;return(r=t.call(this)||this).pos=e,r.mark=n,r}f(e,t);var n=e.prototype;return n.apply=function(t){var e=t.nodeAt(this.pos);if(!e)return Ft.fail("No node at mark step's position");var n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return Ft.fromReplace(t,this.pos,this.pos+1,new I(A.from(n),0,e.isLeaf?0:1))},n.invert=function(t){var e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new Kt(this.pos,this.mark):this},n.map=function(t){var n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.mark)},n.toJSON=function(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}},e.fromJSON=function(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new e(n.pos,t.markFromJSON(n.mark))},e}(jt);jt.jsonID("removeNodeMark",Ut);var Jt=function(t){function e(e,n,r,o){var i;return void 0===o&&(o=!1),(i=t.call(this)||this).from=e,i.to=n,i.slice=r,i.structure=o,i}f(e,t);var n=e.prototype;return n.apply=function(t){return this.structure&&Zt(t,this.from,this.to)?Ft.fail("Structure replace would overwrite content"):Ft.fromReplace(t,this.from,this.to,this.slice)},n.getMap=function(){return new $t([this.from,this.to-this.from,this.slice.size])},n.invert=function(t){return new e(this.from,this.from+this.slice.size,t.slice(this.from,this.to))},n.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new e(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)},n.merge=function(t){if(!(t instanceof e)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;var n=this.slice.size+t.slice.size==0?I.empty:new I(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new e(t.from,this.to,n,this.structure)}var r=this.slice.size+t.slice.size==0?I.empty:new I(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new e(this.from,this.to+(t.to-t.from),r,this.structure)},n.toJSON=function(){var t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new e(n.from,n.to,I.fromJSON(t,n.slice),!!n.structure)},e}(jt);jt.jsonID("replace",Jt);var Gt=function(t){function e(e,n,r,o,i,s,a){var c;return void 0===a&&(a=!1),(c=t.call(this)||this).from=e,c.to=n,c.gapFrom=r,c.gapTo=o,c.slice=i,c.insert=s,c.structure=a,c}f(e,t);var n=e.prototype;return n.apply=function(t){if(this.structure&&(Zt(t,this.from,this.gapFrom)||Zt(t,this.gapTo,this.to)))return Ft.fail("Structure gap-replace would overwrite content");var e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return Ft.fail("Gap is not a flat range");var n=this.slice.insertAt(this.insert,e.content);return n?Ft.fromReplace(t,this.from,this.to,n):Ft.fail("Content does not fit in gap")},n.getMap=function(){return new $t([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])},n.invert=function(t){var n=this.gapTo-this.gapFrom;return new e(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)},n.map=function(t){var n=t.mapResult(this.from,1),r=t.mapResult(this.to,-1),o=this.from==this.gapFrom?n.pos:t.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:t.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||o<n.pos||i>r.pos?null:new e(n.pos,r.pos,o,i,this.slice,this.insert,this.structure)},n.toJSON=function(){var t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t},e.fromJSON=function(t,n){if("number"!=typeof n.from||"number"!=typeof n.to||"number"!=typeof n.gapFrom||"number"!=typeof n.gapTo||"number"!=typeof n.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new e(n.from,n.to,n.gapFrom,n.gapTo,I.fromJSON(t,n.slice),n.insert,!!n.structure)},e}(jt);function Zt(t,e,n){for(var r=t.resolve(e),o=n-e,i=r.depth;o>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,o--;if(o>0)for(var s=r.node(i).maybeChild(r.indexAfter(i));o>0;){if(!s||s.isLeaf)return!0;s=s.firstChild,o--}return!1}function Qt(t,e,n,r,o){void 0===r&&(r=n.contentMatch),void 0===o&&(o=!0);for(var i=t.doc.nodeAt(e),s=[],a=e+1,c=0;c<i.childCount;c++){var l=i.child(c),u=a+l.nodeSize,d=r.matchType(l.type);if(d){r=d;for(var f=0;f<l.marks.length;f++)n.allowsMarkType(l.marks[f].type)||t.step(new qt(a,u,l.marks[f]));if(o&&l.isText&&"pre"!=n.whitespace)for(var h=void 0,p=/\r?\n|\r/g,m=void 0;h=p.exec(l.text);)m||(m=new I(A.from(n.schema.text(" ",n.allowedMarks(l.marks))),0,0)),s.push(new Jt(a+h.index,a+h.index+h[0].length,m))}else s.push(new Jt(a,u,I.empty));a=u}if(!r.validEnd){var v=r.fillBefore(A.empty,!0);t.replace(a,a,new I(v,0,0))}for(var g=s.length-1;g>=0;g--)t.step(s[g])}function Xt(t,e,n){return(0==e||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Yt(t){for(var e=t.parent.content.cutByIndex(t.startIndex,t.endIndex),n=t.depth,r=0,o=0;;--n){var i=t.$from.node(n),s=t.$from.index(n)+r,a=t.$to.indexAfter(n)-o;if(n<t.depth&&i.canReplace(s,a,e))return n;if(0==n||i.type.spec.isolating||!Xt(i,s,a))break;s&&(r=1),a<i.childCount&&(o=1)}return null}function te(t,e,n,r){void 0===n&&(n=null),void 0===r&&(r=t);var o=function(t,e){var n=t.parent,r=t.startIndex,o=t.endIndex,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;var s=i.length?i[0]:e;return n.canReplaceWith(r,o,s)?i:null}(t,e),i=o&&function(t,e){var n=t.parent,r=t.startIndex,o=t.endIndex,i=n.child(r),s=e.contentMatch.findWrapping(i.type);if(!s)return null;for(var a=(s.length?s[s.length-1]:e).contentMatch,c=r;a&&c<o;c++)a=a.matchType(n.child(c).type);return a&&a.validEnd?s:null}(r,e);return i?o.map(ee).concat({type:e,attrs:n}).concat(i.map(ee)):null}function ee(t){return{type:t,attrs:null}}function ne(t,e,n,r){e.forEach(function(o,i){if(o.isText)for(var s,a=/\r?\n|\r/g;s=a.exec(o.text);){var c=t.mapping.slice(r).map(n+1+i+s.index);t.replaceWith(c,c+1,e.type.schema.linebreakReplacement.create())}})}function re(t,e,n,r){e.forEach(function(o,i){if(o.type==o.type.schema.linebreakReplacement){var s=t.mapping.slice(r).map(n+1+i);t.replaceWith(s,s+1,e.type.schema.text("\n"))}})}function oe(t,e,n,r){void 0===n&&(n=1);var o=t.resolve(e),i=o.depth-n,s=r&&r[r.length-1]||o.parent;if(i<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!s.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(var a=o.depth-1,c=n-2;a>i;a--,c--){var l=o.node(a),u=o.index(a);if(l.type.spec.isolating)return!1;var d=l.content.cutByIndex(u,l.childCount),f=r&&r[c+1];f&&(d=d.replaceChild(0,f.type.create(f.attrs)));var h=r&&r[c]||l;if(!l.canReplace(u+1,l.childCount)||!h.type.validContent(d))return!1}var p=o.indexAfter(i),m=r&&r[0];return o.node(i).canReplaceWith(p,p,m?m.type:o.node(i+1).type)}function ie(t,e){var n=t.resolve(e),r=n.index();return se(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function se(t,e){return!(!t||!e||t.isLeaf||!function(t,e){e.content.size||t.type.compatibleContent(e.type);for(var n=t.contentMatchAt(t.childCount),r=t.type.schema.linebreakReplacement,o=0;o<e.childCount;o++){var i=e.child(o),s=i.type==r?t.type.schema.nodes.text:i.type;if(!(n=n.matchType(s)))return!1;if(!t.type.allowsMarks(i.marks))return!1}return n.validEnd}(t,e))}function ae(t,e,n){void 0===n&&(n=-1);for(var r=t.resolve(e),o=r.depth;;o--){var i=void 0,s=void 0,a=r.index(o);if(o==r.depth?(i=r.nodeBefore,s=r.nodeAfter):n>0?(i=r.node(o+1),a++,s=r.node(o).maybeChild(a)):(i=r.node(o).maybeChild(a-1),s=r.node(o+1)),i&&!i.isTextblock&&se(i,s)&&r.node(o).canReplace(a,a+1))return e;if(0==o)break;e=n<0?r.before(o):r.after(o)}}function ce(t,e,n){var r=t.resolve(e);if(!n.content.size)return e;for(var o=n.content,i=0;i<n.openStart;i++)o=o.firstChild.content;for(var s=1;s<=(0==n.openStart&&n.size?2:1);s++)for(var a=r.depth;a>=0;a--){var c=a==r.depth?0:r.pos<=(r.start(a+1)+r.end(a+1))/2?-1:1,l=r.index(a)+(c>0?1:0),u=r.node(a),d=!1;if(1==s)d=u.canReplace(l,l,o);else{var f=u.contentMatchAt(l).findWrapping(o.firstChild.type);d=f&&u.canReplaceWith(l,l,f[0])}if(d)return 0==c?r.pos:c<0?r.before(a+1):r.after(a+1)}return null}function le(t,e,n,r){if(void 0===n&&(n=e),void 0===r&&(r=I.empty),e==n&&!r.size)return null;var o=t.resolve(e),i=t.resolve(n);return ue(o,i,r)?new Jt(e,n,r):new de(o,i,r).fit()}function ue(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}jt.jsonID("replaceAround",Gt);var de=function(){function t(t,e,n){this.$from=t,this.$to=e,this.unplaced=n,this.frontier=[],this.placed=A.empty;for(var r=0;r<=t.depth;r++){var o=t.node(r);this.frontier.push({type:o.type,match:o.contentMatchAt(t.indexAfter(r))})}for(var i=t.depth;i>0;i--)this.placed=A.from(t.node(i).copy(this.placed))}var e=t.prototype;return e.fit=function(){for(;this.unplaced.size;){var t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}var e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,o=this.close(e<0?this.$to:r.doc.resolve(e));if(!o)return null;for(var i=this.placed,s=r.depth,a=o.depth;s&&a&&1==i.childCount;)i=i.firstChild.content,s--,a--;var c=new I(i,s,a);return e>-1?new Gt(r.pos,e,this.$to.pos,this.$to.end(),c,n):c.size||r.pos!=this.$to.pos?new Jt(r.pos,o.pos,c):null},e.findFittable=function(){for(var t=this.unplaced.openStart,e=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<t;n++){var o=e.firstChild;if(e.childCount>1&&(r=0),o.type.spec.isolating&&r<=n){t=n;break}e=o.content}for(var i=1;i<=2;i++)for(var s=1==i?t:this.unplaced.openStart;s>=0;s--)for(var a=null,c=(s?(a=pe(this.unplaced.content,s-1).firstChild).content:this.unplaced.content).firstChild,l=this.depth;l>=0;l--){var u=this.frontier[l],d=u.type,f=u.match,h=void 0,p=null;if(1==i&&(c?f.matchType(c.type)||(p=f.fillBefore(A.from(c),!1)):a&&d.compatibleContent(a.type)))return{sliceDepth:s,frontierDepth:l,parent:a,inject:p};if(2==i&&c&&(h=f.findWrapping(c.type)))return{sliceDepth:s,frontierDepth:l,parent:a,wrap:h};if(a&&f.matchType(a.type))break}},e.openMore=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=pe(e,n);return!(!o.childCount||o.firstChild.isLeaf||(this.unplaced=new I(e,n+1,Math.max(r,o.size+n>=e.size-r?n+1:0)),0))},e.dropNode=function(){var t=this.unplaced,e=t.content,n=t.openStart,r=t.openEnd,o=pe(e,n);if(o.childCount<=1&&n>0){var i=e.size-n<=n+o.size;this.unplaced=new I(fe(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new I(fe(e,n,1),n,r)},e.placeNodes=function(t){for(var e=t.sliceDepth,n=t.frontierDepth,r=t.parent,o=t.inject,i=t.wrap;this.depth>n;)this.closeFrontierNode();if(i)for(var s=0;s<i.length;s++)this.openFrontierNode(i[s]);var a=this.unplaced,c=r?r.content:a.content,l=a.openStart-e,u=0,d=[],f=this.frontier[n],h=f.match,p=f.type;if(o){for(var m=0;m<o.childCount;m++)d.push(o.child(m));h=h.matchFragment(o)}for(var v=c.size+e-(a.content.size-a.openEnd);u<c.childCount;){var g=c.child(u),y=h.matchType(g.type);if(!y)break;(++u>1||0==l||g.content.size)&&(h=y,d.push(me(g.mark(p.allowedMarks(g.marks)),1==u?l:0,u==c.childCount?v:-1)))}var k=u==c.childCount;k||(v=-1),this.placed=he(this.placed,n,A.from(d)),this.frontier[n].match=h,k&&v<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(var b=0,w=c;b<v;b++){var x=w.lastChild;this.frontier.push({type:x.type,match:x.contentMatchAt(x.childCount)}),w=x.content}this.unplaced=k?0==e?I.empty:new I(fe(a.content,e-1,1),e-1,v<0?a.openEnd:e-1):new I(fe(a.content,e,u),a.openStart,a.openEnd)},e.mustMoveInline=function(){if(!this.$to.parent.isTextblock)return-1;var t,e=this.frontier[this.depth];if(!e.type.isTextblock||!ve(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;for(var n=this.$to.depth,r=this.$to.after(n);n>1&&r==this.$to.end(--n);)++r;return r},e.findCloseLevel=function(t){t:for(var e=Math.min(this.depth,t.depth);e>=0;e--){var n=this.frontier[e],r=n.match,o=n.type,i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=ve(t,e,o,r,i);if(s){for(var a=e-1;a>=0;a--){var c=this.frontier[a],l=c.match,u=ve(t,a,c.type,l,!0);if(!u||u.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}},e.close=function(t){var e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=he(this.placed,e.depth,e.fit)),t=e.move;for(var n=e.depth+1;n<=t.depth;n++){var r=t.node(n),o=r.type.contentMatch.fillBefore(r.content,!0,t.index(n));this.openFrontierNode(r.type,r.attrs,o)}return t},e.openFrontierNode=function(t,e,n){void 0===e&&(e=null);var r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=he(this.placed,this.depth,A.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})},e.closeFrontierNode=function(){var t=this.frontier.pop().match.fillBefore(A.empty,!0);t.childCount&&(this.placed=he(this.placed,this.frontier.length,t))},g(t,[{key:"depth",get:function(){return this.frontier.length-1}}])}();function fe(t,e,n){return 0==e?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(fe(t.firstChild.content,e-1,n)))}function he(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(he(t.lastChild.content,e-1,n)))}function pe(t,e){for(var n=0;n<e;n++)t=t.firstChild.content;return t}function me(t,e,n){if(e<=0)return t;var r=t.content;return e>1&&(r=r.replaceChild(0,me(r.firstChild,e-1,1==r.childCount?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(A.empty,!0)))),t.copy(r)}function ve(t,e,n,r,o){var i=t.node(e),s=o?t.indexAfter(e):t.index(e);if(s==i.childCount&&!n.compatibleContent(i.type))return null;var a=r.fillBefore(i.content,!0,s);return a&&!function(t,e,n){for(var r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}(n,i.content,s)?a:null}function ge(t){return t.spec.defining||t.spec.definingForContent}function ye(t,e,n,r,o){if(e<n){var i=t.firstChild;t=t.replaceChild(0,i.copy(ye(i.content,e+1,n,r,i)))}if(e>r){var s=o.contentMatchAt(0),a=s.fillBefore(t).append(t);t=a.append(s.matchFragment(a).fillBefore(A.empty,!0))}return t}function ke(t,e){for(var n=[],r=Math.min(t.depth,e.depth);r>=0;r--){var o=t.start(r);if(o<t.pos-(t.depth-r)||e.end(r)>e.pos+(e.depth-r)||t.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;(o==e.start(r)||r==t.depth&&r==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&r&&e.start(r-1)==o-1)&&n.push(r)}return n}var be=function(t){function e(e,n,r){var o;return(o=t.call(this)||this).pos=e,o.attr=n,o.value=r,o}f(e,t);var n=e.prototype;return n.apply=function(t){var e=t.nodeAt(this.pos);if(!e)return Ft.fail("No node at attribute step's position");var n=Object.create(null);for(var r in e.attrs)n[r]=e.attrs[r];n[this.attr]=this.value;var o=e.type.create(n,null,e.marks);return Ft.fromReplace(t,this.pos,this.pos+1,new I(A.from(o),0,e.isLeaf?0:1))},n.getMap=function(){return $t.empty},n.invert=function(t){return new e(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])},n.map=function(t){var n=t.mapResult(this.pos,1);return n.deletedAfter?null:new e(n.pos,this.attr,this.value)},n.toJSON=function(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}},e.fromJSON=function(t,n){if("number"!=typeof n.pos||"string"!=typeof n.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new e(n.pos,n.attr,n.value)},e}(jt);jt.jsonID("attr",be);var we=function(t){function e(e,n){var r;return(r=t.call(this)||this).attr=e,r.value=n,r}f(e,t);var n=e.prototype;return n.apply=function(t){var e=Object.create(null);for(var n in t.attrs)e[n]=t.attrs[n];e[this.attr]=this.value;var r=t.type.create(e,t.content,t.marks);return Ft.ok(r)},n.getMap=function(){return $t.empty},n.invert=function(t){return new e(this.attr,t.attrs[this.attr])},n.map=function(t){return this},n.toJSON=function(){return{stepType:"docAttr",attr:this.attr,value:this.value}},e.fromJSON=function(t,n){if("string"!=typeof n.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new e(n.attr,n.value)},e}(jt);jt.jsonID("docAttr",we);var xe=Error;((xe=function t(e){var n=Error.call(this,e);return n.__proto__=t.prototype,n}).prototype=Object.create(Error.prototype)).constructor=xe,xe.prototype.name="TransformError";var Se=function(){function t(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new Ht}var e=t.prototype;return e.step=function(t){var e=this.maybeStep(t);if(e.failed)throw new xe(e.failed);return this},e.maybeStep=function(t){var e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e},e.addStep=function(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e},e.replace=function(t,e,n){void 0===e&&(e=t),void 0===n&&(n=I.empty);var r=le(this.doc,t,e,n);return r&&this.step(r),this},e.replaceWith=function(t,e,n){return this.replace(t,e,new I(A.from(n),0,0))},e.delete=function(t,e){return this.replace(t,e,I.empty)},e.insert=function(t,e){return this.replaceWith(t,t,e)},e.replaceRange=function(t,e,n){return function(t,e,n,r){if(!r.size)return t.deleteRange(e,n);var o=t.doc.resolve(e),i=t.doc.resolve(n);if(ue(o,i,r))return t.step(new Jt(e,n,r));var s=ke(o,i);0==s[s.length-1]&&s.pop();var a=-(o.depth+1);s.unshift(a);for(var c=o.depth,l=o.pos-1;c>0;c--,l--){var u=o.node(c).type.spec;if(u.defining||u.definingAsContext||u.isolating)break;s.indexOf(c)>-1?a=c:o.before(c)==l&&s.splice(1,0,-c)}for(var d=s.indexOf(a),f=[],h=r.openStart,p=r.content,m=0;;m++){var v=p.firstChild;if(f.push(v),m==r.openStart)break;p=v.content}for(var g=h-1;g>=0;g--){var y=f[g],k=ge(y.type);if(k&&!y.sameMarkup(o.node(Math.abs(a)-1)))h=g;else if(k||!y.type.isTextblock)break}for(var b=r.openStart;b>=0;b--){var w=(b+h+1)%(r.openStart+1),x=f[w];if(x)for(var S=0;S<s.length;S++){var C=s[(S+d)%s.length],M=!0;C<0&&(M=!1,C=-C);var T=o.node(C-1),A=o.index(C-1);if(T.canReplaceWith(A,A,x.type,x.marks))return t.replace(o.before(C),M?i.after(C):n,new I(ye(r.content,0,r.openStart,w),w,r.openEnd))}}for(var O=t.steps.length,E=s.length-1;E>=0&&(t.replace(e,n,r),!(t.steps.length>O));E--){var N=s[E];N<0||(e=o.before(N),n=i.after(N))}}(this,t,e,n),this},e.replaceRangeWith=function(t,e,n){return function(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){var o=function(t,e,n){var r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(var o=r.depth-1;o>=0;o--){var i=r.index(o);if(r.node(o).canReplaceWith(i,i,n))return r.before(o+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(var s=r.depth-1;s>=0;s--){var a=r.indexAfter(s);if(r.node(s).canReplaceWith(a,a,n))return r.after(s+1);if(a<r.node(s).childCount)return null}return null}(t.doc,e,r.type);null!=o&&(e=n=o)}t.replaceRange(e,n,new I(A.from(r),0,0))}(this,t,e,n),this},e.deleteRange=function(t,e){return function(t,e,n){for(var r=t.doc.resolve(e),o=t.doc.resolve(n),i=ke(r,o),s=0;s<i.length;s++){var a=i[s],c=s==i.length-1;if(c&&0==a||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),o.end(a));if(a>0&&(c||r.node(a-1).canReplace(r.index(a-1),o.indexAfter(a-1))))return t.delete(r.before(a),o.after(a))}for(var l=1;l<=r.depth&&l<=o.depth;l++)if(e-r.start(l)==r.depth-l&&n>r.end(l)&&o.end(l)-n!=o.depth-l&&r.start(l-1)==o.start(l-1)&&r.node(l-1).canReplace(r.index(l-1),o.index(l-1)))return t.delete(r.before(l),n);t.delete(e,n)}(this,t,e),this},e.lift=function(t,e){return function(t,e,n){for(var r=e.$from,o=e.$to,i=e.depth,s=r.before(i+1),a=o.after(i+1),c=s,l=a,u=A.empty,d=0,f=i,h=!1;f>n;f--)h||r.index(f)>0?(h=!0,u=A.from(r.node(f).copy(u)),d++):c--;for(var p=A.empty,m=0,v=i,g=!1;v>n;v--)g||o.after(v+1)<o.end(v)?(g=!0,p=A.from(o.node(v).copy(p)),m++):l++;t.step(new Gt(c,l,s,a,new I(u.append(p),d,m),u.size-d,!0))}(this,t,e),this},e.join=function(t,e){return void 0===e&&(e=1),function(t,e,n){var r=null,o=t.doc.type.schema.linebreakReplacement,i=t.doc.resolve(e-n),s=i.node().type;if(o&&s.inlineContent){var a="pre"==s.whitespace,c=!!s.contentMatch.matchType(o);a&&!c?r=!1:!a&&c&&(r=!0)}var l=t.steps.length;if(!1===r){var u=t.doc.resolve(e+n);re(t,u.node(),u.before(),l)}s.inlineContent&&Qt(t,e+n-1,s,i.node().contentMatchAt(i.index()),null==r);var d=t.mapping.slice(l),f=d.map(e-n);if(t.step(new Jt(f,d.map(e+n,-1),I.empty,!0)),!0===r){var h=t.doc.resolve(f);ne(t,h.node(),h.before(),t.steps.length)}}(this,t,e),this},e.wrap=function(t,e){return function(t,e,n){for(var r=A.empty,o=n.length-1;o>=0;o--){if(r.size){var i=n[o].type.contentMatch.matchFragment(r);if(!i||!i.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=A.from(n[o].type.create(n[o].attrs,r))}var s=e.start,a=e.end;t.step(new Gt(s,a,s,a,new I(r,0,0),n.length,!0))}(this,t,e),this},e.setBlockType=function(t,e,n,r){return void 0===e&&(e=t),void 0===r&&(r=null),function(t,e,n,r,o){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");var i=t.steps.length;t.doc.nodesBetween(e,n,function(e,n){var s="function"==typeof o?o(e):o;if(e.isTextblock&&!e.hasMarkup(r,s)&&function(t,e,n){var r=t.resolve(e),o=r.index();return r.parent.canReplaceWith(o,o+1,n)}(t.doc,t.mapping.slice(i).map(n),r)){var a=null;if(r.schema.linebreakReplacement){var c="pre"==r.whitespace,l=!!r.contentMatch.matchType(r.schema.linebreakReplacement);c&&!l?a=!1:!c&&l&&(a=!0)}!1===a&&re(t,e,n,i),Qt(t,t.mapping.slice(i).map(n,1),r,void 0,null===a);var u=t.mapping.slice(i),d=u.map(n,1),f=u.map(n+e.nodeSize,1);return t.step(new Gt(d,f,d+1,f-1,new I(A.from(r.create(s,null,e.marks)),0,0),1,!0)),!0===a&&ne(t,e,n,i),!1}})}(this,t,e,n,r),this},e.setNodeMarkup=function(t,e,n,r){return void 0===n&&(n=null),function(t,e,n,r,o){var i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);var s=n.create(r,null,o||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,s);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Gt(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new I(A.from(s),0,0),1,!0))}(this,t,e,n,r),this},e.setNodeAttribute=function(t,e,n){return this.step(new be(t,e,n)),this},e.setDocAttribute=function(t,e){return this.step(new we(t,e)),this},e.addNodeMark=function(t,e){return this.step(new Kt(t,e)),this},e.removeNodeMark=function(t,e){var n=this.doc.nodeAt(t);if(!n)throw new RangeError("No node at position "+t);if(e instanceof R)e.isInSet(n.marks)&&this.step(new Ut(t,e));else{for(var r,o=n.marks,i=[];r=e.isInSet(o);)i.push(new Ut(t,r)),o=r.removeFromSet(o);for(var s=i.length-1;s>=0;s--)this.step(i[s])}return this},e.split=function(t,e,n){return void 0===e&&(e=1),function(t,e,n,r){void 0===n&&(n=1);for(var o=t.doc.resolve(e),i=A.empty,s=A.empty,a=o.depth,c=o.depth-n,l=n-1;a>c;a--,l--){i=A.from(o.node(a).copy(i));var u=r&&r[l];s=A.from(u?u.type.create(u.attrs,s):o.node(a).copy(s))}t.step(new Jt(e,e,new I(i.append(s),n,n),!0))}(this,t,e,n),this},e.addMark=function(t,e,n){return function(t,e,n,r){var o,i,s=[],a=[];t.doc.nodesBetween(e,n,function(t,c,l){if(t.isInline){var u=t.marks;if(!r.isInSet(u)&&l.type.allowsMarkType(r.type)){for(var d=Math.max(c,e),f=Math.min(c+t.nodeSize,n),h=r.addToSet(u),p=0;p<u.length;p++)u[p].isInSet(h)||(o&&o.to==d&&o.mark.eq(u[p])?o.to=f:s.push(o=new qt(d,f,u[p])));i&&i.to==d?i.to=f:a.push(i=new Wt(d,f,r))}}}),s.forEach(function(e){return t.step(e)}),a.forEach(function(e){return t.step(e)})}(this,t,e,n),this},e.removeMark=function(t,e,n){return function(t,e,n,r){var o=[],i=0;t.doc.nodesBetween(e,n,function(t,s){if(t.isInline){i++;var a=null;if(r instanceof vt)for(var c,l=t.marks;c=r.isInSet(l);)(a||(a=[])).push(c),l=c.removeFromSet(l);else r?r.isInSet(t.marks)&&(a=[r]):a=t.marks;if(a&&a.length)for(var u=Math.min(s+t.nodeSize,n),d=0;d<a.length;d++){for(var f=a[d],h=void 0,p=0;p<o.length;p++){var m=o[p];m.step==i-1&&f.eq(o[p].style)&&(h=m)}h?(h.to=u,h.step=i):o.push({style:f,from:Math.max(s,e),to:u,step:i})}}}),o.forEach(function(e){return t.step(new qt(e.from,e.to,e.style))})}(this,t,e,n),this},e.clearIncompatible=function(t,e,n){return Qt(this,t,e,n),this},g(t,[{key:"before",get:function(){return this.docs.length?this.docs[0]:this.doc}},{key:"docChanged",get:function(){return this.steps.length>0}}])}(),Ce=Object.create(null),Me=function(){function t(t,e,n){this.$anchor=t,this.$head=e,this.ranges=n||[new Te(t.min(e),t.max(e))]}var e=t.prototype;return e.content=function(){return this.$from.doc.slice(this.from,this.to,!0)},e.replace=function(t,e){void 0===e&&(e=I.empty);for(var n=e.content.lastChild,r=null,o=0;o<e.openEnd;o++)r=n,n=n.lastChild;for(var i=t.steps.length,s=this.ranges,a=0;a<s.length;a++){var c=s[a],l=c.$from,u=c.$to,d=t.mapping.slice(i);t.replaceRange(d.map(l.pos),d.map(u.pos),a?I.empty:e),0==a&&ze(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}},e.replaceWith=function(t,e){for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],s=i.$from,a=i.$to,c=t.mapping.slice(n),l=c.map(s.pos),u=c.map(a.pos);o?t.deleteRange(l,u):(t.replaceRangeWith(l,u,e),ze(t,n,e.isInline?-1:1))}},t.findFrom=function(t,e,n){void 0===n&&(n=!1);var r=t.parent.inlineContent?new Ee(t):Pe(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(var o=t.depth-1;o>=0;o--){var i=e<0?Pe(t.node(0),t.node(o),t.before(o+1),t.index(o),e,n):Pe(t.node(0),t.node(o),t.after(o+1),t.index(o)+1,e,n);if(i)return i}return null},t.near=function(t,e){return void 0===e&&(e=1),this.findFrom(t,e)||this.findFrom(t,-e)||new Ie(t.node(0))},t.atStart=function(t){return Pe(t,t,0,0,1)||new Ie(t)},t.atEnd=function(t){return Pe(t,t,t.content.size,t.childCount,-1)||new Ie(t)},t.fromJSON=function(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");var n=Ce[e.type];if(!n)throw new RangeError("No selection type "+e.type+" defined");return n.fromJSON(t,e)},t.jsonID=function(t,e){if(t in Ce)throw new RangeError("Duplicate use of selection JSON ID "+t);return Ce[t]=e,e.prototype.jsonID=t,e},e.getBookmark=function(){return Ee.between(this.$anchor,this.$head).getBookmark()},g(t,[{key:"anchor",get:function(){return this.$anchor.pos}},{key:"head",get:function(){return this.$head.pos}},{key:"from",get:function(){return this.$from.pos}},{key:"to",get:function(){return this.$to.pos}},{key:"$from",get:function(){return this.ranges[0].$from}},{key:"$to",get:function(){return this.ranges[0].$to}},{key:"empty",get:function(){for(var t=this.ranges,e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}}])}();Me.prototype.visible=!0;var Te=function(t,e){this.$from=t,this.$to=e},Ae=!1;function Oe(t){Ae||t.parent.inlineContent||(Ae=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}var Ee=function(t){function e(e,n){return void 0===n&&(n=e),Oe(e),Oe(n),t.call(this,e,n)||this}f(e,t);var n=e.prototype;return n.map=function(t,n){var r=t.resolve(n.map(this.head));if(!r.parent.inlineContent)return Me.near(r);var o=t.resolve(n.map(this.anchor));return new e(o.parent.inlineContent?o:r,r)},n.replace=function(e,n){if(void 0===n&&(n=I.empty),t.prototype.replace.call(this,e,n),n==I.empty){var r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}},n.eq=function(t){return t instanceof e&&t.anchor==this.anchor&&t.head==this.head},n.getBookmark=function(){return new Ne(this.anchor,this.head)},n.toJSON=function(){return{type:"text",anchor:this.anchor,head:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.anchor||"number"!=typeof n.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,e,n){void 0===n&&(n=e);var r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))},e.between=function(t,n,r){var o=t.pos-n.pos;if(r&&!o||(r=o>=0?1:-1),!n.parent.inlineContent){var i=Me.findFrom(n,r,!0)||Me.findFrom(n,-r,!0);if(!i)return Me.near(n,r);n=i.$head}return t.parent.inlineContent||(0==o||(t=(Me.findFrom(t,-r,!0)||Me.findFrom(t,r,!0)).$anchor).pos<n.pos!=o<0)&&(t=n),new e(t,n)},g(e,[{key:"$cursor",get:function(){return this.$anchor.pos==this.$head.pos?this.$head:null}}])}(Me);Me.jsonID("text",Ee);var Ne=function(){function t(t,e){this.anchor=t,this.head=e}var e=t.prototype;return e.map=function(e){return new t(e.map(this.anchor),e.map(this.head))},e.resolve=function(t){return Ee.between(t.resolve(this.anchor),t.resolve(this.head))},t}(),Re=function(t){function e(e){var n,r=e.nodeAfter,o=e.node(0).resolve(e.pos+r.nodeSize);return(n=t.call(this,e,o)||this).node=r,n}f(e,t);var n=e.prototype;return n.map=function(t,n){var r=n.mapResult(this.anchor),o=r.deleted,i=r.pos,s=t.resolve(i);return o?Me.near(s):new e(s)},n.content=function(){return new I(A.from(this.node),0,0)},n.eq=function(t){return t instanceof e&&t.anchor==this.anchor},n.toJSON=function(){return{type:"node",anchor:this.anchor}},n.getBookmark=function(){return new De(this.anchor)},e.fromJSON=function(t,n){if("number"!=typeof n.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new e(t.resolve(n.anchor))},e.create=function(t,n){return new e(t.resolve(n))},e.isSelectable=function(t){return!t.isText&&!1!==t.type.spec.selectable},e}(Me);Re.prototype.visible=!1,Me.jsonID("node",Re);var De=function(){function t(t){this.anchor=t}var e=t.prototype;return e.map=function(e){var n=e.mapResult(this.anchor),r=n.deleted,o=n.pos;return r?new Ne(o,o):new t(o)},e.resolve=function(t){var e=t.resolve(this.anchor),n=e.nodeAfter;return n&&Re.isSelectable(n)?new Re(e):Me.near(e)},t}(),Ie=function(t){function e(e){return t.call(this,e.resolve(0),e.resolve(e.content.size))||this}f(e,t);var n=e.prototype;return n.replace=function(e,n){if(void 0===n&&(n=I.empty),n==I.empty){e.delete(0,e.doc.content.size);var r=Me.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else t.prototype.replace.call(this,e,n)},n.toJSON=function(){return{type:"all"}},e.fromJSON=function(t){return new e(t)},n.map=function(t){return new e(t)},n.eq=function(t){return t instanceof e},n.getBookmark=function(){return Le},e}(Me);Me.jsonID("all",Ie);var Le={map:function(){return this},resolve:function(t){return new Ie(t)}};function Pe(t,e,n,r,o,i){if(void 0===i&&(i=!1),e.inlineContent)return Ee.create(t,n);for(var s=r-(o>0?0:1);o>0?s<e.childCount:s>=0;s+=o){var a=e.child(s);if(a.isAtom){if(!i&&Re.isSelectable(a))return Re.create(t,n-(o<0?a.nodeSize:0))}else{var c=Pe(t,a,n+o,o<0?a.childCount:0,o,i);if(c)return c}n+=a.nodeSize*o}return null}function ze(t,e,n){var r=t.steps.length-1;if(!(r<e)){var o,i=t.steps[r];(i instanceof Jt||i instanceof Gt)&&(t.mapping.maps[r].forEach(function(t,e,n,r){null==o&&(o=r)}),t.setSelection(Me.near(t.doc.resolve(o),n)))}}var Be=function(t){function e(e){var n;return(n=t.call(this,e.doc)||this).curSelectionFor=0,n.updated=0,n.meta=Object.create(null),n.time=Date.now(),n.curSelection=e.selection,n.storedMarks=e.storedMarks,n}f(e,t);var n=e.prototype;return n.setSelection=function(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=-3&this.updated|1,this.storedMarks=null,this},n.setStoredMarks=function(t){return this.storedMarks=t,this.updated|=2,this},n.ensureMarks=function(t){return R.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this},n.addStoredMark=function(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))},n.removeStoredMark=function(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))},n.addStep=function(e,n){t.prototype.addStep.call(this,e,n),this.updated=-3&this.updated,this.storedMarks=null},n.setTime=function(t){return this.time=t,this},n.replaceSelection=function(t){return this.selection.replace(this,t),this},n.replaceSelectionWith=function(t,e){void 0===e&&(e=!0);var n=this.selection;return e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||R.none))),n.replaceWith(this,t),this},n.deleteSelection=function(){return this.selection.replace(this),this},n.insertText=function(t,e,n){var r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();if(null==n&&(n=e),!t)return this.deleteRange(e,n);var o=this.storedMarks;if(!o){var i=this.doc.resolve(e);o=n==e?i.marks():i.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,o)),this.selection.empty||this.selection.to!=e+t.length||this.setSelection(Me.near(this.selection.$to)),this},n.setMeta=function(t,e){return this.meta["string"==typeof t?t:t.key]=e,this},n.getMeta=function(t){return this.meta["string"==typeof t?t:t.key]},n.scrollIntoView=function(){return this.updated|=4,this},g(e,[{key:"selection",get:function(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}},{key:"selectionSet",get:function(){return(1&this.updated)>0}},{key:"storedMarksSet",get:function(){return(2&this.updated)>0}},{key:"isGeneric",get:function(){for(var t in this.meta)return!1;return!0}},{key:"scrolledIntoView",get:function(){return(4&this.updated)>0}}])}(Se);function $e(t,e){return e&&t?t.bind(e):t}var He=function(t,e,n){this.name=t,this.init=$e(e.init,n),this.apply=$e(e.apply,n)},_e=[new He("doc",{init:function(t){return t.doc||t.schema.topNodeType.createAndFill()},apply:function(t){return t.doc}}),new He("selection",{init:function(t,e){return t.selection||Me.atStart(e.doc)},apply:function(t){return t.selection}}),new He("storedMarks",{init:function(t){return t.storedMarks||null},apply:function(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new He("scrollToSelection",{init:function(){return 0},apply:function(t,e){return t.scrolledIntoView?e+1:e}})],je=function(t,e){var n=this;this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=_e.slice(),e&&e.forEach(function(t){if(n.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");n.plugins.push(t),n.pluginsByKey[t.key]=t,t.spec.state&&n.fields.push(new He(t.key,t.spec.state,t))})},Fe=function(){function t(t){this.config=t}var e=t.prototype;return e.apply=function(t){return this.applyTransaction(t).state},e.filterTransaction=function(t,e){void 0===e&&(e=-1);for(var n=0;n<this.config.plugins.length;n++)if(n!=e){var r=this.config.plugins[n];if(r.spec.filterTransaction&&!r.spec.filterTransaction.call(r,t,this))return!1}return!0},e.applyTransaction=function(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};for(var e=[t],n=this.applyInner(t),r=null;;){for(var o=!1,i=0;i<this.config.plugins.length;i++){var s=this.config.plugins[i];if(s.spec.appendTransaction){var a=r?r[i].n:0,c=r?r[i].state:this,l=a<e.length&&s.spec.appendTransaction.call(s,a?e.slice(a):e,c,n);if(l&&n.filterTransaction(l,i)){if(l.setMeta("appendedTransaction",t),!r){r=[];for(var u=0;u<this.config.plugins.length;u++)r.push(u<i?{state:n,n:e.length}:{state:this,n:0})}e.push(l),n=n.applyInner(l),o=!0}r&&(r[i]={state:n,n:e.length})}}if(!o)return{state:n,transactions:e}}},e.applyInner=function(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");for(var n=new t(this.config),r=this.config.fields,o=0;o<r.length;o++){var i=r[o];n[i.name]=i.apply(e,this[i.name],this,n)}return n},t.create=function(e){for(var n=new je(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new t(n),o=0;o<n.fields.length;o++)r[n.fields[o].name]=n.fields[o].init(e,r);return r},e.reconfigure=function(e){for(var n=new je(this.schema,e.plugins),r=n.fields,o=new t(n),i=0;i<r.length;i++){var s=r[i].name;o[s]=this.hasOwnProperty(s)?this[s]:r[i].init(e,o)}return o},e.toJSON=function(t){var e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map(function(t){return t.toJSON()})),t&&"object"==typeof t)for(var n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");var r=t[n],o=r.spec.state;o&&o.toJSON&&(e[n]=o.toJSON.call(r,this[r.key]))}return e},t.fromJSON=function(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");var o=new je(e.schema,e.plugins),i=new t(o);return o.fields.forEach(function(t){if("doc"==t.name)i.doc=Q.fromJSON(e.schema,n.doc);else if("selection"==t.name)i.selection=Me.fromJSON(i.doc,n.selection);else if("storedMarks"==t.name)n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(var o in r){var s=r[o],a=s.spec.state;if(s.key==t.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(n,o))return void(i[t.name]=a.fromJSON.call(s,e,n[o],i))}i[t.name]=t.init(e,i)}}),i},g(t,[{key:"schema",get:function(){return this.config.schema}},{key:"plugins",get:function(){return this.config.plugins}},{key:"tr",get:function(){return new Be(this)}}])}();function Ve(t,e,n){for(var r in t){var o=t[r];o instanceof Function?o=o.bind(e):"handleDOMEvents"==r&&(o=Ve(o,e,{})),n[r]=o}return n}var We=function(){function t(t){this.spec=t,this.props={},t.props&&Ve(t.props,this,this.props),this.key=t.key?t.key.key:Ke("plugin")}return t.prototype.getState=function(t){return t[this.key]},t}(),qe=Object.create(null);function Ke(t){return t in qe?t+"$"+ ++qe[t]:(qe[t]=0,t+"$")}var Ue=function(){function t(t){void 0===t&&(t="key"),this.key=Ke(t)}var e=t.prototype;return e.get=function(t){return t.config.pluginsByKey[this.key]},e.getState=function(t){return t[this.key]},t}(),Je=function(t,e){return!t.selection.empty&&(e&&e(t.tr.deleteSelection().scrollIntoView()),!0)};function Ge(t,e){var n=t.selection.$cursor;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}var Ze=function(t,e,n){var r=Ge(t,n);if(!r)return!1;var o=tn(r);if(!o){var i=r.blockRange(),s=i&&Yt(i);return null!=s&&(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)}var a=o.nodeBefore;if(dn(t,o,e,-1))return!0;if(0==r.parent.content.size&&(Xe(a,"end")||Re.isSelectable(a)))for(var c=r.depth;;c--){var l=le(t.doc,r.before(c),r.after(c),I.empty);if(l&&l.slice.size<l.to-l.from){if(e){var u=t.tr.step(l);u.setSelection(Xe(a,"end")?Me.findFrom(u.doc.resolve(u.mapping.map(o.pos,-1)),-1):Re.create(u.doc,o.pos-a.nodeSize)),e(u.scrollIntoView())}return!0}if(1==c||r.node(c-1).childCount>1)break}return!(!a.isAtom||o.depth!=r.depth-1||(e&&e(t.tr.delete(o.pos-a.nodeSize,o.pos).scrollIntoView()),0))};function Qe(t,e,n){for(var r=e.nodeBefore,o=e.pos-1;!r.isTextblock;o--){if(r.type.spec.isolating)return!1;var i=r.lastChild;if(!i)return!1;r=i}for(var s=e.nodeAfter,a=e.pos+1;!s.isTextblock;a++){if(s.type.spec.isolating)return!1;var c=s.firstChild;if(!c)return!1;s=c}var l=le(t.doc,o,a,I.empty);if(!l||l.from!=o||l instanceof Jt&&l.slice.size>=a-o)return!1;if(n){var u=t.tr.step(l);u.setSelection(Ee.create(u.doc,o)),n(u.scrollIntoView())}return!0}function Xe(t,e,n){void 0===n&&(n=!1);for(var r=t;r;r="start"==e?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&1!=r.childCount)return!1}return!1}var Ye=function(t,e,n){var r=t.selection,o=r.$head,i=o;if(!r.empty)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):o.parentOffset>0)return!1;i=tn(o)}var s=i&&i.nodeBefore;return!(!s||!Re.isSelectable(s)||(e&&e(t.tr.setSelection(Re.create(t.doc,i.pos-s.nodeSize)).scrollIntoView()),0))};function tn(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function en(t,e){var n=t.selection.$cursor;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}var nn=function(t,e,n){var r=en(t,n);if(!r)return!1;var o=on(r);if(!o)return!1;var i=o.nodeAfter;if(dn(t,o,e,1))return!0;if(0==r.parent.content.size&&(Xe(i,"start")||Re.isSelectable(i))){var s=le(t.doc,r.before(),r.after(),I.empty);if(s&&s.slice.size<s.to-s.from){if(e){var a=t.tr.step(s);a.setSelection(Xe(i,"start")?Me.findFrom(a.doc.resolve(a.mapping.map(o.pos)),1):Re.create(a.doc,a.mapping.map(o.pos))),e(a.scrollIntoView())}return!0}}return!(!i.isAtom||o.depth!=r.depth-1||(e&&e(t.tr.delete(o.pos,o.pos+i.nodeSize).scrollIntoView()),0))},rn=function(t,e,n){var r=t.selection,o=r.$head,i=o;if(!r.empty)return!1;if(o.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):o.parentOffset<o.parent.content.size)return!1;i=on(o)}var s=i&&i.nodeAfter;return!(!s||!Re.isSelectable(s)||(e&&e(t.tr.setSelection(Re.create(t.doc,i.pos)).scrollIntoView()),0))};function on(t){if(!t.parent.type.spec.isolating)for(var e=t.depth-1;e>=0;e--){var n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}var sn=function(t,e){var n=t.selection,r=n.$head,o=n.$anchor;return!(!r.parent.type.spec.code||!r.sameParent(o)||(e&&e(t.tr.insertText("\n").scrollIntoView()),0))};function an(t){for(var e=0;e<t.edgeCount;e++){var n=t.edge(e).type;if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}var cn=function(t,e){var n=t.selection,r=n.$head,o=n.$anchor;if(!r.parent.type.spec.code||!r.sameParent(o))return!1;var i=r.node(-1),s=r.indexAfter(-1),a=an(i.contentMatchAt(s));if(!a||!i.canReplaceWith(s,s,a))return!1;if(e){var c=r.after(),l=t.tr.replaceWith(c,c,a.createAndFill());l.setSelection(Me.near(l.doc.resolve(c),1)),e(l.scrollIntoView())}return!0},ln=function(t,e){var n=t.selection,r=n.$from,o=n.$to;if(n instanceof Ie||r.parent.inlineContent||o.parent.inlineContent)return!1;var i=an(o.parent.contentMatchAt(o.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){var s=(!r.parentOffset&&o.index()<o.parent.childCount?r:o).pos,a=t.tr.insert(s,i.createAndFill());a.setSelection(Ee.create(a.doc,s+1)),e(a.scrollIntoView())}return!0},un=function(t,e){var n=t.selection.$cursor;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){var r=n.before();if(oe(t.doc,r))return e&&e(t.tr.split(r).scrollIntoView()),!0}var o=n.blockRange(),i=o&&Yt(o);return null!=i&&(e&&e(t.tr.lift(o,i).scrollIntoView()),!0)};function dn(t,e,n,r){var o,i,s=e.nodeBefore,a=e.nodeAfter,c=s.type.spec.isolating||a.type.spec.isolating;if(!c&&function(t,e,n){var r=e.nodeBefore,o=e.nodeAfter,i=e.index();return!(!(r&&o&&r.type.compatibleContent(o.type))||(!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),0):!e.parent.canReplace(i,i+1)||!o.isTextblock&&!ie(t.doc,e.pos)||(n&&n(t.tr.join(e.pos).scrollIntoView()),0)))}(t,e,n))return!0;var l=!c&&e.parent.canReplace(e.index(),e.index()+1);if(l&&(o=(i=s.contentMatchAt(s.childCount)).findWrapping(a.type))&&i.matchType(o[0]||a.type).validEnd){if(n){for(var u=e.pos+a.nodeSize,d=A.empty,f=o.length-1;f>=0;f--)d=A.from(o[f].create(null,d));d=A.from(s.copy(d));var h=t.tr.step(new Gt(e.pos-1,u,e.pos,u,new I(d,1,0),o.length,!0)),p=h.doc.resolve(u+2*o.length);p.nodeAfter&&p.nodeAfter.type==s.type&&ie(h.doc,p.pos)&&h.join(p.pos),n(h.scrollIntoView())}return!0}var m=a.type.spec.isolating||r>0&&c?null:Me.findFrom(e,1),v=m&&m.$from.blockRange(m.$to),g=v&&Yt(v);if(null!=g&&g>=e.depth)return n&&n(t.tr.lift(v,g).scrollIntoView()),!0;if(l&&Xe(a,"start",!0)&&Xe(s,"end")){for(var y=s,k=[];k.push(y),!y.isTextblock;)y=y.lastChild;for(var b=a,w=1;!b.isTextblock;b=b.firstChild)w++;if(y.canReplace(y.childCount,y.childCount,b.content)){if(n){for(var x=A.empty,S=k.length-1;S>=0;S--)x=A.from(k[S].copy(x));n(t.tr.step(new Gt(e.pos-k.length,e.pos+a.nodeSize,e.pos+w,e.pos+a.nodeSize-w,new I(x,k.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function fn(t){return function(e,n){for(var r=e.selection,o=t<0?r.$from:r.$to,i=o.depth;o.node(i).isInline;){if(!i)return!1;i--}return!!o.node(i).isTextblock&&(n&&n(e.tr.setSelection(Ee.create(e.doc,t<0?o.start(i):o.end(i)))),!0)}}var hn=fn(-1),pn=fn(1);function mn(t,e){return void 0===e&&(e=null),function(n,r){for(var o=!1,i=0;i<n.selection.ranges.length&&!o;i++){var s=n.selection.ranges[i],a=s.$from.pos,c=s.$to.pos;n.doc.nodesBetween(a,c,function(r,i){if(o)return!1;if(r.isTextblock&&!r.hasMarkup(t,e))if(r.type==t)o=!0;else{var s=n.doc.resolve(i),a=s.index();o=s.parent.canReplaceWith(a,a+1,t)}})}if(!o)return!1;if(r){for(var l=n.tr,u=0;u<n.selection.ranges.length;u++){var d=n.selection.ranges[u],f=d.$from.pos,h=d.$to.pos;l.setBlockType(f,h,t,e)}r(l.scrollIntoView())}return!0}}function vn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t,n,r){for(var o=0;o<e.length;o++)if(e[o](t,n,r))return!0;return!1}}var gn=vn(Je,Ze,Ye),yn=vn(Je,nn,rn),kn={Enter:vn(sn,ln,un,function(t,e){var n=t.selection,r=n.$from;n.$to;if(t.selection instanceof Re&&t.selection.node.isBlock)return!(!r.parentOffset||!oe(t.doc,r.pos)||(e&&e(t.tr.split(r.pos).scrollIntoView()),0));if(!r.depth)return!1;for(var o,i,s=[],a=!1,c=!1,l=r.depth;;l--){if(r.node(l).isBlock){a=r.end(l)==r.pos+(r.depth-l),c=r.start(l)==r.pos-(r.depth-l),i=an(r.node(l-1).contentMatchAt(r.indexAfter(l-1)));s.unshift(a&&i?{type:i}:null),o=l;break}if(1==l)return!1;s.unshift(null)}var u=t.tr;(t.selection instanceof Ee||t.selection instanceof Ie)&&u.deleteSelection();var d=u.mapping.map(r.pos),f=oe(u.doc,d,s.length,s);if(f||(s[0]=i?{type:i}:null,f=oe(u.doc,d,s.length,s)),!f)return!1;if(u.split(d,s.length,s),!a&&c&&r.node(o).type!=i){var h=u.mapping.map(r.before(o)),p=u.doc.resolve(h);i&&r.node(o-1).canReplaceWith(p.index(),p.index()+1,i)&&u.setNodeMarkup(u.mapping.map(r.before(o)),i)}return e&&e(u.scrollIntoView()),!0}),"Mod-Enter":cn,Backspace:gn,"Mod-Backspace":gn,"Shift-Backspace":gn,Delete:yn,"Mod-Delete":yn,"Mod-a":function(t,e){return e&&e(t.tr.setSelection(new Ie(t.doc))),!0}},bn={"Ctrl-h":kn.Backspace,"Alt-Backspace":kn["Mod-Backspace"],"Ctrl-d":kn.Delete,"Ctrl-Alt-Backspace":kn["Mod-Delete"],"Alt-Delete":kn["Mod-Delete"],"Alt-d":kn["Mod-Delete"],"Ctrl-a":hn,"Ctrl-e":pn};for(var wn in kn)bn[wn]=kn[wn];function xn(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Sn(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Sn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Sn(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):"undefined"!=typeof os&&os.platform&&os.platform();var Cn=function(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e},Mn=function(t){var e=t.assignedSlot||t.parentNode;return e&&11==e.nodeType?e.host:e},Tn=null,An=function(t,e,n){var r=Tn||(Tn=document.createRange());return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,e||0),r},On=function(t,e,n,r){return n&&(Nn(t,e,n,r,-1)||Nn(t,e,n,r,1))},En=/^(img|br|input|textarea|hr)$/i;function Nn(t,e,n,r,o){for(var i;;){if(t==n&&e==r)return!0;if(e==(o<0?0:Rn(t))){var s=t.parentNode;if(!s||1!=s.nodeType||Dn(t)||En.test(t.nodeName)||"false"==t.contentEditable)return!1;e=Cn(t)+(o<0?0:1),t=s}else{if(1!=t.nodeType)return!1;var a=t.childNodes[e+(o<0?-1:0)];if(1==a.nodeType&&"false"==a.contentEditable){if(!(null===(i=a.pmViewDesc)||void 0===i?void 0:i.ignoreForSelection))return!1;e+=o}else t=a,e=o<0?Rn(t):0}}}function Rn(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function Dn(t){for(var e,n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}var In=function(t){return t.focusNode&&On(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Ln(t,e){var n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}var Pn="undefined"!=typeof navigator?navigator:null,zn="undefined"!=typeof document?document:null,Bn=Pn&&Pn.userAgent||"",$n=/Edge\/(\d+)/.exec(Bn),Hn=/MSIE \d/.exec(Bn),_n=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Bn),jn=!!(Hn||_n||$n),Fn=Hn?document.documentMode:_n?+_n[1]:$n?+$n[1]:0,Vn=!jn&&/gecko\/(\d+)/i.test(Bn);Vn&&(/Firefox\/(\d+)/.exec(Bn)||[0,0])[1];var Wn=!jn&&/Chrome\/(\d+)/.exec(Bn),qn=!!Wn,Kn=Wn?+Wn[1]:0,Un=!jn&&!!Pn&&/Apple Computer/.test(Pn.vendor),Jn=Un&&(/Mobile\/\w+/.test(Bn)||!!Pn&&Pn.maxTouchPoints>2),Gn=Jn||!!Pn&&/Mac/.test(Pn.platform),Zn=!!Pn&&/Win/.test(Pn.platform),Qn=/Android \d/.test(Bn),Xn=!!zn&&"webkitFontSmoothing"in zn.documentElement.style,Yn=Xn?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function tr(t){var e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function er(t,e){return"number"==typeof t?t:t[e]}function nr(t){var e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function rr(t,e,n){for(var r=t.someProp("scrollThreshold")||0,o=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument,s=n||t.dom;s;)if(1==s.nodeType){var a=s,c=a==i.body,l=c?tr(i):nr(a),u=0,d=0;if(e.top<l.top+er(r,"top")?d=-(l.top-e.top+er(o,"top")):e.bottom>l.bottom-er(r,"bottom")&&(d=e.bottom-e.top>l.bottom-l.top?e.top+er(o,"top")-l.top:e.bottom-l.bottom+er(o,"bottom")),e.left<l.left+er(r,"left")?u=-(l.left-e.left+er(o,"left")):e.right>l.right-er(r,"right")&&(u=e.right-l.right+er(o,"right")),u||d)if(c)i.defaultView.scrollBy(u,d);else{var f=a.scrollLeft,h=a.scrollTop;d&&(a.scrollTop+=d),u&&(a.scrollLeft+=u);var p=a.scrollLeft-f,m=a.scrollTop-h;e={left:e.left-p,top:e.top-m,right:e.right-p,bottom:e.bottom-m}}var v=c?"fixed":getComputedStyle(s).position;if(/^(fixed|sticky)$/.test(v))break;s="absolute"==v?s.offsetParent:Mn(s)}else s=Mn(s)}function or(t){for(var e=[],n=t.ownerDocument,r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=Mn(r));return e}function ir(t,e){for(var n=0;n<t.length;n++){var r=t[n],o=r.dom,i=r.top,s=r.left;o.scrollTop!=i+e&&(o.scrollTop=i+e),o.scrollLeft!=s&&(o.scrollLeft=s)}}var sr=null;function ar(t,e){for(var n,r,o,i,s=2e8,a=0,c=e.top,l=e.top,u=t.firstChild,d=0;u;u=u.nextSibling,d++){var f=void 0;if(1==u.nodeType)f=u.getClientRects();else{if(3!=u.nodeType)continue;f=An(u).getClientRects()}for(var h=0;h<f.length;h++){var p=f[h];if(p.top<=c&&p.bottom>=l){c=Math.max(p.bottom,c),l=Math.min(p.top,l);var m=p.left>e.left?p.left-e.left:p.right<e.left?e.left-p.right:0;if(m<s){n=u,s=m,r=m&&3==n.nodeType?{left:p.right<e.left?p.right:p.left,top:e.top}:e,1==u.nodeType&&m&&(a=d+(e.left>=(p.left+p.right)/2?1:0));continue}}else p.top>e.top&&!o&&p.left<=e.left&&p.right>=e.left&&(o=u,i={left:Math.max(p.left,Math.min(p.right,e.left)),top:p.top});!n&&(e.left>=p.right&&e.top>=p.top||e.left>=p.left&&e.top>=p.bottom)&&(a=d+1)}}return!n&&o&&(n=o,r=i,s=0),n&&3==n.nodeType?function(t,e){for(var n,r=t.nodeValue.length,o=document.createRange(),i=0;i<r;i++){o.setEnd(t,i+1),o.setStart(t,i);var s=fr(o,1);if(s.top!=s.bottom&&cr(e,s)){n={node:t,offset:i+(e.left>=(s.left+s.right)/2?1:0)};break}}return o.detach(),n||{node:t,offset:0}}(n,r):!n||s&&1==n.nodeType?{node:t,offset:a}:ar(n,r)}function cr(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function lr(t,e,n){var r=t.childNodes.length;if(r&&n.top<n.bottom)for(var o=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=o;;){var s=t.childNodes[i];if(1==s.nodeType)for(var a=s.getClientRects(),c=0;c<a.length;c++){var l=a[c];if(cr(e,l))return lr(s,e,l)}if((i=(i+1)%r)==o)break}return t}function ur(t,e){var n,r=t.dom.ownerDocument,o=0,i=function(t,e,n){if(t.caretPositionFromPoint)try{var r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(Rn(r.offsetNode),r.offset)}}catch(t){}if(t.caretRangeFromPoint){var o=t.caretRangeFromPoint(e,n);if(o)return{node:o.startContainer,offset:Math.min(Rn(o.startContainer),o.startOffset)}}}(r,e.left,e.top);i&&(n=i.node,o=i.offset);var s,a=(t.root.elementFromPoint?t.root:r).elementFromPoint(e.left,e.top);if(!a||!t.dom.contains(1!=a.nodeType?a.parentNode:a)){var c=t.dom.getBoundingClientRect();if(!cr(e,c))return null;if(!(a=lr(t.dom,e,c)))return null}if(Un)for(var l=a;n&&l;l=Mn(l))l.draggable&&(n=void 0);if(a=function(t,e){var n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}(a,e),n){if(Vn&&1==n.nodeType&&(o=Math.min(o,n.childNodes.length))<n.childNodes.length){var u,d=n.childNodes[o];"IMG"==d.nodeName&&(u=d.getBoundingClientRect()).right<=e.left&&u.bottom>e.top&&o++}var f;Xn&&o&&1==n.nodeType&&1==(f=n.childNodes[o-1]).nodeType&&"false"==f.contentEditable&&f.getBoundingClientRect().top>=e.top&&o--,n==t.dom&&o==n.childNodes.length-1&&1==n.lastChild.nodeType&&e.top>n.lastChild.getBoundingClientRect().bottom?s=t.state.doc.content.size:0!=o&&1==n.nodeType&&"BR"==n.childNodes[o-1].nodeName||(s=function(t,e,n,r){for(var o=-1,i=e,s=!1;i!=t.dom;){var a=t.docView.nearestDesc(i,!0),c=void 0;if(!a)return null;if(1==a.dom.nodeType&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((c=a.dom.getBoundingClientRect()).width||c.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!s&&c.left>r.left||c.top>r.top?o=a.posBefore:(!s&&c.right<r.left||c.bottom<r.top)&&(o=a.posAfter),s=!0),!a.contentDOM&&o<0&&!a.node.isText))return(a.node.isBlock?r.top<(c.top+c.bottom)/2:r.left<(c.left+c.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return o>-1?o:t.docView.posFromDOM(e,n,-1)}(t,n,o,e))}null==s&&(s=function(t,e,n){var r=ar(e,n),o=r.node,i=r.offset,s=-1;if(1==o.nodeType&&!o.firstChild){var a=o.getBoundingClientRect();s=a.left!=a.right&&n.left>(a.left+a.right)/2?1:-1}return t.docView.posFromDOM(o,i,s)}(t,a,e));var h=t.docView.nearestDesc(a,!0);return{pos:s,inside:h?h.posAtStart-h.border:-1}}function dr(t){return t.top<t.bottom||t.left<t.right}function fr(t,e){var n=t.getClientRects();if(n.length){var r=n[e<0?0:n.length-1];if(dr(r))return r}return Array.prototype.find.call(n,dr)||t.getBoundingClientRect()}var hr=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function pr(t,e,n){var r=t.docView.domFromPos(e,n<0?-1:1),o=r.node,i=r.offset,s=r.atom,a=Xn||Vn;if(3==o.nodeType){if(!a||!hr.test(o.nodeValue)&&(n<0?i:i!=o.nodeValue.length)){var c=i,l=i,u=n<0?1:-1;return n<0&&!i?(l++,u=-1):n>=0&&i==o.nodeValue.length?(c--,u=1):n<0?c--:l++,mr(fr(An(o,c,l),u),u<0)}var d=fr(An(o,i,i),n);if(Vn&&i&&/\s/.test(o.nodeValue[i-1])&&i<o.nodeValue.length){var f=fr(An(o,i-1,i-1),-1);if(f.top==d.top){var h=fr(An(o,i,i+1),-1);if(h.top!=d.top)return mr(h,h.left<f.left)}}return d}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(null==s&&i&&(n<0||i==Rn(o))){var p=o.childNodes[i-1];if(1==p.nodeType)return vr(p.getBoundingClientRect(),!1)}if(null==s&&i<Rn(o)){var m=o.childNodes[i];if(1==m.nodeType)return vr(m.getBoundingClientRect(),!0)}return vr(o.getBoundingClientRect(),n>=0)}if(null==s&&i&&(n<0||i==Rn(o))){var v=o.childNodes[i-1],g=3==v.nodeType?An(v,Rn(v)-(a?0:1)):1!=v.nodeType||"BR"==v.nodeName&&v.nextSibling?null:v;if(g)return mr(fr(g,1),!1)}if(null==s&&i<Rn(o)){for(var y=o.childNodes[i];y.pmViewDesc&&y.pmViewDesc.ignoreForCoords;)y=y.nextSibling;var k=y?3==y.nodeType?An(y,0,a?0:1):1==y.nodeType?y:null:null;if(k)return mr(fr(k,-1),!0)}return mr(fr(3==o.nodeType?An(o):o,-n),n>=0)}function mr(t,e){if(0==t.width)return t;var n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function vr(t,e){if(0==t.height)return t;var n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function gr(t,e,n){var r=t.state,o=t.root.activeElement;r!=e&&t.updateState(e),o!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),o!=t.dom&&o&&o.focus()}}var yr=/[\u0590-\u08ac]/,kr=null,br=null,wr=!1;var xr=function(){function t(t,e,n,r){this.parent=t,this.children=e,this.dom=n,this.contentDOM=r,this.dirty=0,n.pmViewDesc=this}var e=t.prototype;return e.matchesWidget=function(t){return!1},e.matchesMark=function(t){return!1},e.matchesNode=function(t,e,n){return!1},e.matchesHack=function(t){return!1},e.parseRule=function(){return null},e.stopEvent=function(t){return!1},e.destroy=function(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(var t=0;t<this.children.length;t++)this.children[t].destroy()},e.posBeforeChild=function(t){for(var e=0,n=this.posAtStart;;e++){var r=this.children[e];if(r==t)return n;n+=r.size}},e.localPosFromDOM=function(t,e,n){if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(n<0){var r,o;if(t==this.contentDOM)r=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;r=t.previousSibling}for(;r&&(!(o=r.pmViewDesc)||o.parent!=this);)r=r.previousSibling;return r?this.posBeforeChild(o)+o.size:this.posAtStart}var i,s;if(t==this.contentDOM)i=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;i=t.nextSibling}for(;i&&(!(s=i.pmViewDesc)||s.parent!=this);)i=i.nextSibling;return i?this.posBeforeChild(s):this.posAtEnd}var a;if(t==this.dom&&this.contentDOM)a=e>Cn(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))a=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(var c=t;;c=c.parentNode){if(c==this.dom){a=!1;break}if(c.previousSibling)break}if(null==a&&e==t.childNodes.length)for(var l=t;;l=l.parentNode){if(l==this.dom){a=!0;break}if(l.nextSibling)break}}return(null==a?n>0:a)?this.posAtEnd:this.posAtStart},e.nearestDesc=function(t,e){void 0===e&&(e=!1);for(var n=!0,r=t;r;r=r.parentNode){var o=this.getDesc(r),i=void 0;if(o&&(!e||o.node)){if(!n||!(i=o.nodeDOM)||(1==i.nodeType?i.contains(1==t.nodeType?t:t.parentNode):i==t))return o;n=!1}}},e.getDesc=function(t){for(var e=t.pmViewDesc,n=e;n;n=n.parent)if(n==this)return e},e.posFromDOM=function(t,e,n){for(var r=t;r;r=r.parentNode){var o=this.getDesc(r);if(o)return o.localPosFromDOM(t,e,n)}return-1},e.descAt=function(t){for(var e=0,n=0;e<this.children.length;e++){var r=this.children[e],o=n+r.size;if(n==t&&o!=n){for(;!r.border&&r.children.length;)for(var i=0;i<r.children.length;i++){var s=r.children[i];if(s.size){r=s;break}}return r}if(t<o)return r.descAt(t-n-r.border);n=o}},e.domFromPos=function(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};for(var n,r=0,o=0,i=0;r<this.children.length;r++){var s=this.children[r],a=i+s.size;if(a>t||s instanceof Er){o=t-i;break}i=a}if(o)return this.children[r].domFromPos(o-this.children[r].border,e);for(;r&&!(n=this.children[r-1]).size&&n instanceof Sr&&n.side>=0;r--);if(e<=0){for(var c,l=!0;(c=r?this.children[r-1]:null)&&c.dom.parentNode!=this.contentDOM;r--,l=!1);return c&&e&&l&&!c.border&&!c.domAtom?c.domFromPos(c.size,e):{node:this.contentDOM,offset:c?Cn(c.dom)+1:0}}for(var u,d=!0;(u=r<this.children.length?this.children[r]:null)&&u.dom.parentNode!=this.contentDOM;r++,d=!1);return u&&d&&!u.border&&!u.domAtom?u.domFromPos(0,e):{node:this.contentDOM,offset:u?Cn(u.dom):this.contentDOM.childNodes.length}},e.parseRange=function(t,e,n){if(void 0===n&&(n=0),0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};for(var r=-1,o=-1,i=n,s=0;;s++){var a=this.children[s],c=i+a.size;if(-1==r&&t<=c){var l=i+a.border;if(t>=l&&e<=c-a.border&&a.node&&a.contentDOM&&this.contentDOM.contains(a.contentDOM))return a.parseRange(t,e,l);t=i;for(var u=s;u>0;u--){var d=this.children[u-1];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(1)){r=Cn(d.dom)+1;break}t-=d.size}-1==r&&(r=0)}if(r>-1&&(c>e||s==this.children.length-1)){e=c;for(var f=s+1;f<this.children.length;f++){var h=this.children[f];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){o=Cn(h.dom);break}e+=h.size}-1==o&&(o=this.contentDOM.childNodes.length);break}i=c}return{node:this.contentDOM,from:t,to:e,fromOffset:r,toOffset:o}},e.emptyChildAt=function(t){if(this.border||!this.contentDOM||!this.children.length)return!1;var e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)},e.domAfterPos=function(t){var e=this.domFromPos(t,0),n=e.node,r=e.offset;if(1!=n.nodeType||r==n.childNodes.length)throw new RangeError("No node after pos "+t);return n.childNodes[r]},e.setSelection=function(t,e,n,r){void 0===r&&(r=!1);for(var o=Math.min(t,e),i=Math.max(t,e),s=0,a=0;s<this.children.length;s++){var c=this.children[s],l=a+c.size;if(o>a&&i<l)return c.setSelection(t-a-c.border,e-a-c.border,n,r);a=l}var u=this.domFromPos(t,t?-1:1),d=e==t?u:this.domFromPos(e,e?-1:1),f=n.root.getSelection(),h=n.domSelectionRange(),p=!1;if((Vn||Un)&&t==e){var m=u,v=m.node,g=m.offset;if(3==v.nodeType){if((p=!(!g||"\n"!=v.nodeValue[g-1]))&&g==v.nodeValue.length)for(var y,k=v;k;k=k.parentNode){if(y=k.nextSibling){"BR"==y.nodeName&&(u=d={node:y.parentNode,offset:Cn(y)+1});break}var b=k.pmViewDesc;if(b&&b.node&&b.node.isBlock)break}}else{var w=v.childNodes[g-1];p=w&&("BR"==w.nodeName||"false"==w.contentEditable)}}if(Vn&&h.focusNode&&h.focusNode!=d.node&&1==h.focusNode.nodeType){var x=h.focusNode.childNodes[h.focusOffset];x&&"false"==x.contentEditable&&(r=!0)}if(r||p&&Un||!On(u.node,u.offset,h.anchorNode,h.anchorOffset)||!On(d.node,d.offset,h.focusNode,h.focusOffset)){var S=!1;if((f.extend||t==e)&&(!p||!Vn)){f.collapse(u.node,u.offset);try{t!=e&&f.extend(d.node,d.offset),S=!0}catch(t){}}if(!S){if(t>e){var C=u;u=d,d=C}var M=document.createRange();M.setEnd(d.node,d.offset),M.setStart(u.node,u.offset),f.removeAllRanges(),f.addRange(M)}}},e.ignoreMutation=function(t){return!this.contentDOM&&"selection"!=t.type},e.markDirty=function(t,e){for(var n=0,r=0;r<this.children.length;r++){var o=this.children[r],i=n+o.size;if(n==i?t<=i&&e>=n:t<i&&e>n){var s=n+o.border,a=i-o.border;if(t>=s&&e<=a)return this.dirty=t==n||e==i?2:1,void(t!=s||e!=a||!o.contentLost&&o.dom.parentNode==this.contentDOM?o.markDirty(t-s,e-s):o.dirty=3);o.dirty=o.dom!=o.contentDOM||o.dom.parentNode!=this.contentDOM||o.children.length?3:2}n=i}this.dirty=2},e.markParentsDirty=function(){for(var t=1,e=this.parent;e;e=e.parent,t++){var n=1==t?2:1;e.dirty<n&&(e.dirty=n)}},e.isText=function(t){return!1},g(t,[{key:"size",get:function(){for(var t=0,e=0;e<this.children.length;e++)t+=this.children[e].size;return t}},{key:"border",get:function(){return 0}},{key:"posBefore",get:function(){return this.parent.posBeforeChild(this)}},{key:"posAtStart",get:function(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}},{key:"posAfter",get:function(){return this.posBefore+this.size}},{key:"posAtEnd",get:function(){return this.posAtStart+this.size-2*this.border}},{key:"contentLost",get:function(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}},{key:"domAtom",get:function(){return!1}},{key:"ignoreForCoords",get:function(){return!1}},{key:"ignoreForSelection",get:function(){return!1}}])}(),Sr=function(t){function e(e,n,r,o){var i,s,a=n.type.toDOM;if("function"==typeof a&&(a=a(r,function(){return s?s.parent?s.parent.posBeforeChild(s):void 0:o})),!n.type.spec.raw){if(1!=a.nodeType){var c=document.createElement("span");c.appendChild(a),a=c}a.contentEditable="false",a.classList.add("ProseMirror-widget")}return(i=t.call(this,e,[],a,null)||this).widget=n,i.widget=n,s=i,i}f(e,t);var n=e.prototype;return n.matchesWidget=function(t){return 0==this.dirty&&t.type.eq(this.widget.type)},n.parseRule=function(){return{ignore:!0}},n.stopEvent=function(t){var e=this.widget.spec.stopEvent;return!!e&&e(t)},n.ignoreMutation=function(t){return"selection"!=t.type||this.widget.spec.ignoreSelection},n.destroy=function(){this.widget.type.destroy(this.dom),t.prototype.destroy.call(this)},g(e,[{key:"domAtom",get:function(){return!0}},{key:"ignoreForSelection",get:function(){return!!this.widget.type.spec.relaxedSide}},{key:"side",get:function(){return this.widget.type.side}}])}(xr),Cr=function(t){function e(e,n,r,o){var i;return(i=t.call(this,e,[],n,null)||this).textDOM=r,i.text=o,i}f(e,t);var n=e.prototype;return n.localPosFromDOM=function(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e},n.domFromPos=function(t){return{node:this.textDOM,offset:t}},n.ignoreMutation=function(t){return"characterData"===t.type&&t.target.nodeValue==t.oldValue},g(e,[{key:"size",get:function(){return this.text.length}}])}(xr),Mr=function(t){function e(e,n,r,o,i){var s;return(s=t.call(this,e,[],r,o)||this).mark=n,s.spec=i,s}f(e,t),e.create=function(t,n,r,o){var i=o.nodeViews[n.type.name],s=i&&i(n,o,r);return s&&s.dom||(s=Et.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new e(t,n,s.dom,s.contentDOM||s.dom,s)};var n=e.prototype;return n.parseRule=function(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}},n.matchesMark=function(t){return 3!=this.dirty&&this.mark.eq(t)},n.markDirty=function(e,n){if(t.prototype.markDirty.call(this,e,n),0!=this.dirty){for(var r=this.parent;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=0}},n.slice=function(t,n,r){var o=e.create(this.parent,this.mark,!0,r),i=this.children,s=this.size;n<s&&(i=Fr(i,n,s,r)),t>0&&(i=Fr(i,0,t,r));for(var a=0;a<i.length;a++)i[a].parent=o;return o.children=i,o},n.ignoreMutation=function(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):t.prototype.ignoreMutation.call(this,e)},n.destroy=function(){this.spec.destroy&&this.spec.destroy(),t.prototype.destroy.call(this)},e}(xr),Tr=function(t){function e(e,n,r,o,i,s,a,c,l){var u;return(u=t.call(this,e,[],i,s)||this).node=n,u.outerDeco=r,u.innerDeco=o,u.nodeDOM=a,u}f(e,t),e.create=function(t,n,r,o,i,s){var a,c=i.nodeViews[n.type.name],l=c&&c(n,i,function(){return a?a.parent?a.parent.posBeforeChild(a):void 0:s},r,o),u=l&&l.dom,d=l&&l.contentDOM;if(n.isText)if(u){if(3!=u.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else u=document.createTextNode(n.text);else if(!u){var f=Et.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs);u=f.dom,d=f.contentDOM}d||n.isText||"BR"==u.nodeName||(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));var h=u;return u=Br(u,r,n),l?a=new Nr(t,n,r,o,u,d||null,h,l,i,s+1):n.isText?new Or(t,n,r,o,u,h,i):new e(t,n,r,o,u,d||null,h,i,s+1)};var n=e.prototype;return n.parseRule=function(){var t=this;if(this.node.type.spec.reparseInView)return null;var e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(var n=this.children.length-1;n>=0;n--){var r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=function(){return A.empty})}else e.contentElement=this.contentDOM;else e.getContent=function(){return t.node.content};return e},n.matchesNode=function(t,e,n){return 0==this.dirty&&t.eq(this.node)&&$r(e,this.outerDeco)&&n.eq(this.innerDeco)},n.updateChildren=function(t,e){var n=this,r=this.node.inlineContent,o=e,i=t.composing?this.localCompositionInfo(t,e):null,s=i&&i.pos>-1?i:null,a=i&&i.pos<0,c=new _r(this,s&&s.node,t);!function(t,e,n,r){var o=e.locals(t),i=0;if(0!=o.length)for(var s=0,a=[],c=null,l=0;;){for(var u=void 0,d=void 0;s<o.length&&o[s].to==i;){var f=o[s++];f.widget&&(u?(d||(d=[u])).push(f):u=f)}if(u)if(d){d.sort(jr);for(var h=0;h<d.length;h++)n(d[h],l,!!c)}else n(u,l,!!c);var p=void 0,m=void 0;if(c)m=-1,p=c,c=null;else{if(!(l<t.childCount))break;m=l,p=t.child(l++)}for(var v=0;v<a.length;v++)a[v].to<=i&&a.splice(v--,1);for(;s<o.length&&o[s].from<=i&&o[s].to>i;)a.push(o[s++]);var g=i+p.nodeSize;if(p.isText){var y=g;s<o.length&&o[s].from<y&&(y=o[s].from);for(var k=0;k<a.length;k++)a[k].to<y&&(y=a[k].to);y<g&&(c=p.cut(y-i),p=p.cut(0,y-i),g=y,m=-1)}else for(;s<o.length&&o[s].to<g;)s++;r(p,p.isInline&&!p.isLeaf?a.filter(function(t){return!t.inline}):a.slice(),e.forChild(i,p),m),i=g}else for(var b=0;b<t.childCount;b++){var w=t.child(b);r(w,o,e.forChild(i,w),b),i+=w.nodeSize}}(this.node,this.innerDeco,function(e,i,s){e.spec.marks?c.syncToMarks(e.spec.marks,r,t,i):e.type.side>=0&&!s&&c.syncToMarks(i==n.node.childCount?R.none:n.node.child(i).marks,r,t,i),c.placeWidget(e,t,o)},function(e,n,s,l){var u;c.syncToMarks(e.marks,r,t,l),c.findNodeMatch(e,n,s,l)||a&&t.state.selection.from>o&&t.state.selection.to<o+e.nodeSize&&(u=c.findIndexWithChild(i.node))>-1&&c.updateNodeAt(e,n,s,u,t)||c.updateNextNode(e,n,s,t,l,o)||c.addNode(e,n,s,t,o),o+=e.nodeSize}),c.syncToMarks([],r,t,0),this.node.isTextblock&&c.addTextblockHacks(),c.destroyRest(),(c.changed||2==this.dirty)&&(s&&this.protectLocalComposition(t,s),Rr(this.contentDOM,this.children,t),Jn&&function(t){if("UL"==t.nodeName||"OL"==t.nodeName){var e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}(this.dom))},n.localCompositionInfo=function(t,e){var n=t.state.selection,r=n.from,o=n.to;if(!(t.state.selection instanceof Ee)||r<e||o>e+this.node.content.size)return null;var i=t.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){var s=i.nodeValue,a=function(t,e,n,r){for(var o=0,i=0;o<t.childCount&&i<=r;){var s=t.child(o++),a=i;if(i+=s.nodeSize,s.isText){for(var c=s.text;o<t.childCount;){var l=t.child(o++);if(i+=l.nodeSize,!l.isText)break;c+=l.text}if(i>=n){if(i>=r&&c.slice(r-e.length-a,r-a)==e)return r-e.length;var u=a<r?c.lastIndexOf(e,r-a-1):-1;if(u>=0&&u+e.length+a>=n)return a+u;if(n==r&&c.length>=r+e.length-a&&c.slice(r-a,r-a+e.length)==e)return r}}}return-1}(this.node.content,s,r-e,o-e);return a<0?null:{node:i,pos:a,text:s}}return{node:i,pos:-1,text:""}},n.protectLocalComposition=function(t,e){var n=e.node,r=e.pos,o=e.text;if(!this.getDesc(n)){for(var i=n;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}var s=new Cr(this,i,n,o);t.input.compositionNodes.push(s),this.children=Fr(this.children,r,r+o.length,t,s)}},n.update=function(t,e,n,r){return!(3==this.dirty||!t.sameMarkup(this.node)||(this.updateInner(t,e,n,r),0))},n.updateInner=function(t,e,n,r){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=0},n.updateOuterDeco=function(t){if(!$r(t,this.outerDeco)){var e=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=Pr(this.dom,this.nodeDOM,Lr(this.outerDeco,this.node,e),Lr(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}},n.selectNode=function(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.nodeDOM.draggable=!0))},n.deselectNode=function(){1==this.nodeDOM.nodeType&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.nodeDOM.removeAttribute("draggable"))},g(e,[{key:"size",get:function(){return this.node.nodeSize}},{key:"border",get:function(){return this.node.isLeaf?0:1}},{key:"domAtom",get:function(){return this.node.isAtom}}])}(xr);function Ar(t,e,n,r,o){Br(r,e,t);var i=new Tr(void 0,t,e,n,r,r,r,o,0);return i.contentDOM&&i.updateChildren(o,0),i}var Or=function(t){function e(e,n,r,o,i,s,a){return t.call(this,e,n,r,o,i,null,s,a,0)||this}f(e,t);var n=e.prototype;return n.parseRule=function(){for(var t=this.nodeDOM.parentNode;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}},n.update=function(t,e,n,r){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!t.sameMarkup(this.node)||(this.updateOuterDeco(e),0==this.dirty&&t.text==this.node.text||t.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=t.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=t,this.dirty=0,0))},n.inParent=function(){for(var t=this.parent.contentDOM,e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1},n.domFromPos=function(t){return{node:this.nodeDOM,offset:t}},n.localPosFromDOM=function(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):t.prototype.localPosFromDOM.call(this,e,n,r)},n.ignoreMutation=function(t){return"characterData"!=t.type&&"selection"!=t.type},n.slice=function(t,n,r){var o=this.node.cut(t,n),i=document.createTextNode(o.text);return new e(this.parent,o,this.outerDeco,this.innerDeco,i,i,r)},n.markDirty=function(e,n){t.prototype.markDirty.call(this,e,n),this.dom==this.nodeDOM||0!=e&&n!=this.nodeDOM.nodeValue.length||(this.dirty=3)},n.isText=function(t){return this.node.text==t},g(e,[{key:"domAtom",get:function(){return!1}}])}(Tr),Er=function(t){function e(){return t.apply(this,arguments)||this}f(e,t);var n=e.prototype;return n.parseRule=function(){return{ignore:!0}},n.matchesHack=function(t){return 0==this.dirty&&this.dom.nodeName==t},g(e,[{key:"domAtom",get:function(){return!0}},{key:"ignoreForCoords",get:function(){return"IMG"==this.dom.nodeName}}])}(xr),Nr=function(t){function e(e,n,r,o,i,s,a,c,l,u){var d;return(d=t.call(this,e,n,r,o,i,s,a,l,u)||this).spec=c,d}f(e,t);var n=e.prototype;return n.update=function(e,n,r,o){if(3==this.dirty)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){var i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,o),i}return!(!this.contentDOM&&!e.isLeaf)&&t.prototype.update.call(this,e,n,r,o)},n.selectNode=function(){this.spec.selectNode?this.spec.selectNode():t.prototype.selectNode.call(this)},n.deselectNode=function(){this.spec.deselectNode?this.spec.deselectNode():t.prototype.deselectNode.call(this)},n.setSelection=function(e,n,r,o){this.spec.setSelection?this.spec.setSelection(e,n,r.root):t.prototype.setSelection.call(this,e,n,r,o)},n.destroy=function(){this.spec.destroy&&this.spec.destroy(),t.prototype.destroy.call(this)},n.stopEvent=function(t){return!!this.spec.stopEvent&&this.spec.stopEvent(t)},n.ignoreMutation=function(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):t.prototype.ignoreMutation.call(this,e)},e}(Tr);function Rr(t,e,n){for(var r=t.firstChild,o=!1,i=0;i<e.length;i++){var s=e[i],a=s.dom;if(a.parentNode==t){for(;a!=r;)r=Hr(r),o=!0;r=r.nextSibling}else o=!0,t.insertBefore(a,r);if(s instanceof Mr){var c=r?r.previousSibling:t.lastChild;Rr(s.contentDOM,s.children,n),r=c?c.nextSibling:t.firstChild}}for(;r;)r=Hr(r),o=!0;o&&n.trackWrites==t&&(n.trackWrites=null)}var Dr=function(t){t&&(this.nodeName=t)};Dr.prototype=Object.create(null);var Ir=[new Dr];function Lr(t,e,n){if(0==t.length)return Ir;for(var r=n?Ir[0]:new Dr,o=[r],i=0;i<t.length;i++){var s=t[i].type.attrs;if(s)for(var a in s.nodeName&&o.push(r=new Dr(s.nodeName)),s){var c=s[a];null!=c&&(n&&1==o.length&&o.push(r=new Dr(e.isInline?"span":"div")),"class"==a?r.class=(r.class?r.class+" ":"")+c:"style"==a?r.style=(r.style?r.style+";":"")+c:"nodeName"!=a&&(r[a]=c))}}return o}function Pr(t,e,n,r){if(n==Ir&&r==Ir)return e;for(var o=e,i=0;i<r.length;i++){var s=r[i],a=n[i];if(i){var c=void 0;a&&a.nodeName==s.nodeName&&o!=t&&(c=o.parentNode)&&c.nodeName.toLowerCase()==s.nodeName||((c=document.createElement(s.nodeName)).pmIsDeco=!0,c.appendChild(o),a=Ir[0]),o=c}zr(o,a||Ir[0],s)}return o}function zr(t,e,n){for(var r in e)"class"==r||"style"==r||"nodeName"==r||r in n||t.removeAttribute(r);for(var o in n)"class"!=o&&"style"!=o&&"nodeName"!=o&&n[o]!=e[o]&&t.setAttribute(o,n[o]);if(e.class!=n.class){for(var i=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[],a=0;a<i.length;a++)-1==s.indexOf(i[a])&&t.classList.remove(i[a]);for(var c=0;c<s.length;c++)-1==i.indexOf(s[c])&&t.classList.add(s[c]);0==t.classList.length&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style)for(var l,u=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;l=u.exec(e.style);)t.style.removeProperty(l[1]);n.style&&(t.style.cssText+=n.style)}}function Br(t,e,n){return Pr(t,t,Ir,Lr(e,n,1!=t.nodeType))}function $r(t,e){if(t.length!=e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function Hr(t){var e=t.nextSibling;return t.parentNode.removeChild(t),e}var _r=function(){function t(t,e,n){this.lock=e,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=function(t,e){var n=e,r=n.children.length,o=t.childCount,i=new Map,s=[];t:for(;o>0;){for(var a=void 0;;)if(r){var c=n.children[r-1];if(!(c instanceof Mr)){a=c,r--;break}n=c,r=c.children.length}else{if(n==e)break t;r=n.parent.children.indexOf(n),n=n.parent}var l=a.node;if(l){if(l!=t.child(o-1))break;--o,i.set(a,o),s.push(a)}}return{index:o,matched:i,matches:s.reverse()}}(t.node.content,t)}var e=t.prototype;return e.destroyBetween=function(t,e){if(t!=e){for(var n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}},e.destroyRest=function(){this.destroyBetween(this.index,this.top.children.length)},e.syncToMarks=function(t,e,n,r){for(var o=0,i=this.stack.length>>1,s=Math.min(i,t.length);o<s&&(o==i-1?this.top:this.stack[o+1<<1]).matchesMark(t[o])&&!1!==t[o].type.spec.spanning;)o++;for(;o<i;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<t.length;){this.stack.push(this.top,this.index+1);var a=-1,c=this.top.children.length;r<this.preMatch.index&&(c=Math.min(this.index+3,c));for(var l=this.index;l<c;l++){var u=this.top.children[l];if(u.matchesMark(t[i])&&!this.isLocked(u.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{var d=Mr.create(this.top,t[i],e,n);this.top.children.splice(this.index,0,d),this.top=d,this.changed=!0}this.index=0,i++}},e.findNodeMatch=function(t,e,n,r){var o,i=-1;if(r>=this.preMatch.index&&(o=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&o.matchesNode(t,e,n))i=this.top.children.indexOf(o,this.index);else for(var s=this.index,a=Math.min(this.top.children.length,s+5);s<a;s++){var c=this.top.children[s];if(c.matchesNode(t,e,n)&&!this.preMatch.matched.has(c)){i=s;break}}return!(i<0||(this.destroyBetween(this.index,i),this.index++,0))},e.updateNodeAt=function(t,e,n,r,o){var i=this.top.children[r];return 3==i.dirty&&i.dom==i.contentDOM&&(i.dirty=2),!!i.update(t,e,n,o)&&(this.destroyBetween(this.index,r),this.index++,!0)},e.findIndexWithChild=function(t){for(;;){var e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){var n=t.pmViewDesc;if(n)for(var r=this.index;r<this.top.children.length;r++)if(this.top.children[r]==n)return r;return-1}t=e}},e.updateNextNode=function(t,e,n,r,o,i){for(var s=this.index;s<this.top.children.length;s++){var a=this.top.children[s];if(a instanceof Tr){var c=this.preMatch.matched.get(a);if(null!=c&&c!=o)return!1;var l=a.dom,u=void 0,d=this.isLocked(l)&&!(t.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==t.text&&3!=a.dirty&&$r(e,a.outerDeco));if(!d&&a.update(t,e,n,r))return this.destroyBetween(this.index,s),a.dom!=l&&(this.changed=!0),this.index++,!0;if(!d&&(u=this.recreateWrapper(a,t,e,n,r,i)))return this.destroyBetween(this.index,s),this.top.children[this.index]=u,u.contentDOM&&(u.dirty=2,u.updateChildren(r,i+1),u.dirty=0),this.changed=!0,this.index++,!0;break}}return!1},e.recreateWrapper=function(t,e,n,r,o,i){if(t.dirty||e.isAtom||!t.children.length||!t.node.content.eq(e.content)||!$r(n,t.outerDeco)||!r.eq(t.innerDeco))return null;var s=Tr.create(this.top,e,n,r,o,i);if(s.contentDOM){s.children=t.children,t.children=[];for(var a,c=xn(s.children);!(a=c()).done;)a.value.parent=s}return t.destroy(),s},e.addNode=function(t,e,n,r,o){var i=Tr.create(this.top,t,e,n,r,o);i.contentDOM&&i.updateChildren(r,o+1),this.top.children.splice(this.index++,0,i),this.changed=!0},e.placeWidget=function(t,e,n){var r=this.index<this.top.children.length?this.top.children[this.index]:null;if(!r||!r.matchesWidget(t)||t!=r.widget&&r.widget.type.toDOM.parentNode){var o=new Sr(this.top,t,e,n);this.top.children.splice(this.index++,0,o),this.changed=!0}else this.index++},e.addTextblockHacks=function(){for(var t=this.top.children[this.index-1],e=this.top;t instanceof Mr;)t=(e=t).children[e.children.length-1];(!t||!(t instanceof Or)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((Un||qn)&&t&&"false"==t.dom.contentEditable&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))},e.addHackNode=function(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{var n=document.createElement(t);"IMG"==t&&(n.className="ProseMirror-separator",n.alt=""),"BR"==t&&(n.className="ProseMirror-trailingBreak");var r=new Er(this.top,[],n,null);e!=this.top?e.children.push(r):e.children.splice(this.index++,0,r),this.changed=!0}},e.isLocked=function(t){return this.lock&&(t==this.lock||1==t.nodeType&&t.contains(this.lock.parentNode))},t}();function jr(t,e){return t.type.side-e.type.side}function Fr(t,e,n,r,o){for(var i=[],s=0,a=0;s<t.length;s++){var c=t[s],l=a,u=a+=c.size;l>=n||u<=e?i.push(c):(l<e&&i.push(c.slice(0,e-l,r)),o&&(i.push(o),o=void 0),u>n&&i.push(c.slice(n-l,c.size,r)))}return i}function Vr(t,e){void 0===e&&(e=null);var n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;var o=t.docView.nearestDesc(n.focusNode),i=o&&0==o.size,s=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(s<0)return null;var a,c,l=r.resolve(s);if(In(n)){for(a=s;o&&!o.node;)o=o.parent;var u=o.node;if(o&&u.isAtom&&Re.isSelectable(u)&&o.parent&&(!u.isInline||!function(t,e,n){for(var r=0==e,o=e==Rn(t);r||o;){if(t==n)return!0;var i=Cn(t);if(!(t=t.parentNode))return!1;r=r&&0==i,o=o&&i==Rn(t)}}(n.focusNode,n.focusOffset,o.dom))){var d=o.posBefore;c=new Re(s==d?l:r.resolve(d))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){for(var f=s,h=s,p=0;p<n.rangeCount;p++){var m=n.getRangeAt(p);f=Math.min(f,t.docView.posFromDOM(m.startContainer,m.startOffset,1)),h=Math.max(h,t.docView.posFromDOM(m.endContainer,m.endOffset,-1))}if(f<0)return null;var v=h==t.state.selection.anchor?[h,f]:[f,h];a=v[0],s=v[1],l=r.resolve(s)}else a=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(a<0)return null}var g=r.resolve(a);return c||(c=Xr(t,g,l,"pointer"==e||t.state.selection.head<l.pos&&!i?1:-1)),c}function Wr(t){return t.editable?t.hasFocus():to(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function qr(t,e){void 0===e&&(e=!1);var n=t.state.selection;if(Zr(t,n),Wr(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&qn){var r=t.domSelectionRange(),o=t.domObserver.currentSelection;if(r.anchorNode&&o.anchorNode&&On(r.anchorNode,r.anchorOffset,o.anchorNode,o.anchorOffset))return t.input.mouseDown.delayedSelectionSync=!0,void t.domObserver.setCurSelection()}if(t.domObserver.disconnectSelection(),t.cursorWrapper)!function(t){var e=t.domSelection();if(e){var n=t.cursorWrapper.dom,r="IMG"==n.nodeName;r?e.collapse(n.parentNode,Cn(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&jn&&Fn<=11&&(n.disabled=!0,n.disabled=!1)}}(t);else{var i,s,a=n.anchor,c=n.head;!Kr||n instanceof Ee||(n.$from.parent.inlineContent||(i=Ur(t,n.from)),n.empty||n.$from.parent.inlineContent||(s=Ur(t,n.to))),t.docView.setSelection(a,c,t,e),Kr&&(i&&Gr(i),s&&Gr(s)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(t){var e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);var n=t.domSelectionRange(),r=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=function(){n.anchorNode==r&&n.anchorOffset==o||(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(function(){Wr(t)&&!t.state.selection.visible||t.dom.classList.remove("ProseMirror-hideselection")},20))})}(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}var Kr=Un||qn&&Kn<63;function Ur(t,e){var n=t.docView.domFromPos(e,0),r=n.node,o=n.offset,i=o<r.childNodes.length?r.childNodes[o]:null,s=o?r.childNodes[o-1]:null;if(Un&&i&&"false"==i.contentEditable)return Jr(i);if(!(i&&"false"!=i.contentEditable||s&&"false"!=s.contentEditable)){if(i)return Jr(i);if(s)return Jr(s)}}function Jr(t){return t.contentEditable="true",Un&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Gr(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Zr(t,e){if(e instanceof Re){var n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(Qr(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else Qr(t)}function Qr(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function Xr(t,e,n,r){return t.someProp("createSelectionBetween",function(r){return r(t,e,n)})||Ee.between(e,n,r)}function Yr(t){return!(t.editable&&!t.hasFocus())&&to(t)}function to(t){var e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(t){return!1}}function eo(t,e){var n=t.selection,r=n.$anchor,o=n.$head,i=e>0?r.max(o):r.min(o),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&Me.findFrom(s,e)}function no(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function ro(t,e,n){var r=t.state.selection;if(!(r instanceof Ee)){if(r instanceof Re&&r.node.isInline)return no(t,new Ee(e>0?r.$to:r.$from));var o=eo(t.state,e);return!!o&&no(t,o)}if(n.indexOf("s")>-1){var i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText||!s.isLeaf)return!1;var a=t.state.doc.resolve(i.pos+s.nodeSize*(e<0?-1:1));return no(t,new Ee(r.$anchor,a))}if(!r.empty)return!1;if(t.endOfTextblock(e>0?"forward":"backward")){var c=eo(t.state,e);return!!(c&&c instanceof Re)&&no(t,c)}if(!(Gn&&n.indexOf("m")>-1)){var l,u=r.$head,d=u.textOffset?null:e<0?u.nodeBefore:u.nodeAfter;if(!d||d.isText)return!1;var f=e<0?u.pos-d.nodeSize:u.pos;return!!(d.isAtom||(l=t.docView.descAt(f))&&!l.contentDOM)&&(Re.isSelectable(d)?no(t,new Re(e<0?t.state.doc.resolve(u.pos-d.nodeSize):u)):!!Xn&&no(t,new Ee(t.state.doc.resolve(e<0?f:f+d.nodeSize))))}}function oo(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function io(t,e){var n=t.pmViewDesc;return n&&0==n.size&&(e<0||t.nextSibling||"BR"!=t.nodeName)}function so(t,e){return e<0?function(t){var e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(n){var o,i,s=!1;for(Vn&&1==n.nodeType&&r<oo(n)&&io(n.childNodes[r],-1)&&(s=!0);;)if(r>0){if(1!=n.nodeType)break;var a=n.childNodes[r-1];if(io(a,-1))o=n,i=--r;else{if(3!=a.nodeType)break;r=(n=a).nodeValue.length}}else{if(ao(n))break;for(var c=n.previousSibling;c&&io(c,-1);)o=n.parentNode,i=Cn(c),c=c.previousSibling;if(c)r=oo(n=c);else{if((n=n.parentNode)==t.dom)break;r=0}}s?co(t,n,r):o&&co(t,o,i)}}(t):function(t){var e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(n){for(var o,i,s=oo(n);;)if(r<s){if(1!=n.nodeType)break;if(!io(n.childNodes[r],1))break;o=n,i=++r}else{if(ao(n))break;for(var a=n.nextSibling;a&&io(a,1);)o=a.parentNode,i=Cn(a)+1,a=a.nextSibling;if(a)r=0,s=oo(n=a);else{if((n=n.parentNode)==t.dom)break;r=s=0}}o&&co(t,o,i)}}(t)}function ao(t){var e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function co(t,e,n){var r,o;3!=e.nodeType&&((o=function(t,e){for(;t&&e==t.childNodes.length&&!Dn(t);)e=Cn(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){var n=t.childNodes[e];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;t=n,e=0}}(e,n))?(e=o,n=0):(r=function(t,e){for(;t&&!e&&!Dn(t);)e=Cn(t),t=t.parentNode;for(;t&&e;){var n=t.childNodes[e-1];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;e=(t=n).childNodes.length}}(e,n))&&(e=r,n=r.nodeValue.length));var i=t.domSelection();if(i){if(In(i)){var s=document.createRange();s.setEnd(e,n),s.setStart(e,n),i.removeAllRanges(),i.addRange(s)}else i.extend&&i.extend(e,n);t.domObserver.setCurSelection();var a=t.state;setTimeout(function(){t.state==a&&qr(t)},50)}}function lo(t,e){var n=t.state.doc.resolve(e);if(!qn&&!Zn&&n.parent.inlineContent){var r=t.coordsAtPos(e);if(e>n.start()){var o=t.coordsAtPos(e-1),i=(o.top+o.bottom)/2;if(i>r.top&&i<r.bottom&&Math.abs(o.left-r.left)>1)return o.left<r.left?"ltr":"rtl"}if(e<n.end()){var s=t.coordsAtPos(e+1),a=(s.top+s.bottom)/2;if(a>r.top&&a<r.bottom&&Math.abs(s.left-r.left)>1)return s.left>r.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(t.dom).direction?"rtl":"ltr"}function uo(t,e,n){var r=t.state.selection;if(r instanceof Ee&&!r.empty||n.indexOf("s")>-1)return!1;if(Gn&&n.indexOf("m")>-1)return!1;var o=r.$from,i=r.$to;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){var s=eo(t.state,e);if(s&&s instanceof Re)return no(t,s)}if(!o.parent.inlineContent){var a=e<0?o:i,c=r instanceof Ie?Me.near(a,e):Me.findFrom(a,e);return!!c&&no(t,c)}return!1}function fo(t,e){if(!(t.state.selection instanceof Ee))return!0;var n=t.state.selection,r=n.$head,o=n.$anchor,i=n.empty;if(!r.sameParent(o))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;var s=!r.textOffset&&(e<0?r.nodeBefore:r.nodeAfter);if(s&&!s.isText){var a=t.state.tr;return e<0?a.delete(r.pos-s.nodeSize,r.pos):a.delete(r.pos,r.pos+s.nodeSize),t.dispatch(a),!0}return!1}function ho(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function po(t,e){t.someProp("transformCopied",function(n){e=n(e,t)});for(var n=[],r=e,o=r.content,i=r.openStart,s=r.openEnd;i>1&&s>1&&1==o.childCount&&1==o.firstChild.childCount;){i--,s--;var a=o.firstChild;n.push(a.type.name,a.attrs!=a.type.defaultAttrs?a.attrs:null),o=a.content}var c=t.someProp("clipboardSerializer")||Et.fromSchema(t.state.schema),l=Co(),u=l.createElement("div");u.appendChild(c.serializeFragment(o,{document:l}));for(var d,f=u.firstChild,h=0;f&&1==f.nodeType&&(d=xo[f.nodeName.toLowerCase()]);){for(var p=d.length-1;p>=0;p--){for(var m=l.createElement(d[p]);u.firstChild;)m.appendChild(u.firstChild);u.appendChild(m),h++}f=u.firstChild}return f&&1==f.nodeType&&f.setAttribute("data-pm-slice",i+" "+s+(h?" -"+h:"")+" "+JSON.stringify(n)),{dom:u,text:t.someProp("clipboardTextSerializer",function(n){return n(e,t)})||e.content.textBetween(0,e.content.size,"\n\n"),slice:e}}function mo(t,e,n,r,o){var i,s,a=o.parent.type.spec.code;if(!n&&!e)return null;var c=!!e&&(r||a||!n);if(c){if(t.someProp("transformPastedText",function(n){e=n(e,a||r,t)}),a)return s=new I(A.from(t.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0),t.someProp("transformPasted",function(e){s=e(s,t,!0)}),s;var l=t.someProp("clipboardTextParser",function(n){return n(e,o,r,t)});if(l)s=l;else{var u=o.marks(),d=t.state.schema,f=Et.fromSchema(d);i=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(function(t){var e=i.appendChild(document.createElement("p"));t&&e.appendChild(f.serializeNode(d.text(t,u)))})}}else t.someProp("transformPastedHTML",function(e){n=e(n,t)}),i=function(t){var e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));var n,r=Co().createElement("div"),o=/<([a-z][^>\s]+)/i.exec(t);if((n=o&&xo[o[1].toLowerCase()])&&(t=n.map(function(t){return"<"+t+">"}).join("")+t+n.map(function(t){return"</"+t+">"}).reverse().join("")),r.innerHTML=function(t){var e=window.trustedTypes;return e?(Mo||(Mo=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:function(t){return t}})),Mo.createHTML(t)):t}(t),n)for(var i=0;i<n.length;i++)r=r.querySelector(n[i])||r;return r}(n),Xn&&function(t){for(var e=t.querySelectorAll(qn?"span:not([class]):not([style])":"span.Apple-converted-space"),n=0;n<e.length;n++){var r=e[n];1==r.childNodes.length&&" "==r.textContent&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}(i);var h=i&&i.querySelector("[data-pm-slice]"),p=h&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(h.getAttribute("data-pm-slice")||"");if(p&&p[3])for(var m=+p[3];m>0;m--){for(var v=i.firstChild;v&&1!=v.nodeType;)v=v.nextSibling;if(!v)break;i=v}if(!s){var g=t.someProp("clipboardParser")||t.someProp("domParser")||kt.fromSchema(t.state.schema);s=g.parseSlice(i,{preserveWhitespace:!(!c&&!p),context:o,ruleFromNode:function(t){return"BR"!=t.nodeName||t.nextSibling||!t.parentNode||vo.test(t.parentNode.nodeName)?null:{ignore:!0}}})}if(p)s=function(t,e){if(!t.size)return t;var n,r=t.content.firstChild.type.schema;try{n=JSON.parse(e)}catch(e){return t}for(var o=t.content,i=t.openStart,s=t.openEnd,a=n.length-2;a>=0;a-=2){var c=r.nodes[n[a]];if(!c||c.hasRequiredAttrs())break;o=A.from(c.create(n[a+1],o)),i++,s++}return new I(o,i,s)}(wo(s,+p[1],+p[2]),p[4]);else if(s=I.maxOpen(function(t,e){if(t.childCount<2)return t;for(var n,r=function(){var n,r=e.node(o).contentMatchAt(e.index(o)),i=[];if(t.forEach(function(t){if(i){var e,o=r.findWrapping(t.type);if(!o)return i=null;if(e=i.length&&n.length&&yo(o,n,t,i[i.length-1],0))i[i.length-1]=e;else{i.length&&(i[i.length-1]=ko(i[i.length-1],n.length));var s=go(t,o);i.push(s),r=r.matchType(s.type),n=o}}}),i)return{v:A.from(i)}},o=e.depth;o>=0;o--)if(n=r())return n.v;return t}(s.content,o),!0),s.openStart||s.openEnd){for(var y=0,k=0,b=s.content.firstChild;y<s.openStart&&!b.type.spec.isolating;y++,b=b.firstChild);for(var w=s.content.lastChild;k<s.openEnd&&!w.type.spec.isolating;k++,w=w.lastChild);s=wo(s,y,k)}return t.someProp("transformPasted",function(e){s=e(s,t,c)}),s}var vo=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function go(t,e,n){void 0===n&&(n=0);for(var r=e.length-1;r>=n;r--)t=e[r].create(null,A.from(t));return t}function yo(t,e,n,r,o){if(o<t.length&&o<e.length&&t[o]==e[o]){var i=yo(t,e,n,r.lastChild,o+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(o==t.length-1?n.type:t[o+1]))return r.copy(r.content.append(A.from(go(n,t,o+1))))}}function ko(t,e){if(0==e)return t;var n=t.content.replaceChild(t.childCount-1,ko(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(A.empty,!0);return t.copy(n.append(r))}function bo(t,e,n,r,o,i){var s=e<0?t.firstChild:t.lastChild,a=s.content;return t.childCount>1&&(i=0),o<r-1&&(a=bo(a,e,n,r,o+1,i)),o>=n&&(a=e<0?s.contentMatchAt(0).fillBefore(a,i<=o).append(a):a.append(s.contentMatchAt(s.childCount).fillBefore(A.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,s.copy(a))}function wo(t,e,n){return e<t.openStart&&(t=new I(bo(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new I(bo(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}var xo={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},So=null;function Co(){return So||(So=document.implementation.createHTMLDocument("title"))}var Mo=null,To={},Ao={},Oo={touchstart:!0,touchmove:!0},Eo=function(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null};function No(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function Ro(t){t.someProp("handleDOMEvents",function(e){for(var n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=function(e){return Do(t,e)})})}function Do(t,e){return t.someProp("handleDOMEvents",function(n){var r=n[e.type];return!!r&&(r(t,e)||e.defaultPrevented)})}function Io(t){return{left:t.clientX,top:t.clientY}}function Lo(t,e,n,r,o){if(-1==r)return!1;for(var i,s=t.state.doc.resolve(r),a=function(r){if(t.someProp(e,function(e){return r>s.depth?e(t,n,s.nodeAfter,s.before(r),o,!0):e(t,n,s.node(r),s.before(r),o,!1)}))return{v:!0}},c=s.depth+1;c>0;c--)if(i=a(c))return i.v;return!1}function Po(t,e,n){if(t.focused||t.focus(),!t.state.selection.eq(e)){var r=t.state.tr.setSelection(e);"pointer"==n&&r.setMeta("pointer",!0),t.dispatch(r)}}function zo(t,e,n,r){return Lo(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",function(n){return n(t,e,r)})}function Bo(t,e,n,r){return Lo(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",function(n){return n(t,e,r)})||function(t,e,n){if(0!=n.button)return!1;var r=t.state.doc;if(-1==e)return!!r.inlineContent&&(Po(t,Ee.create(r,0,r.content.size),"pointer"),!0);for(var o=r.resolve(e),i=o.depth+1;i>0;i--){var s=i>o.depth?o.nodeAfter:o.node(i),a=o.before(i);if(s.inlineContent)Po(t,Ee.create(r,a+1,a+1+s.content.size),"pointer");else{if(!Re.isSelectable(s))continue;Po(t,Re.create(r,a),"pointer")}return!0}}(t,n,r)}function $o(t){return qo(t)}Ao.keydown=function(t,e){var n=e;if(t.input.shiftKey=16==n.keyCode||n.shiftKey,!jo(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!Qn||!qn||13!=n.keyCode))if(229!=n.keyCode&&t.domObserver.forceFlush(),!Jn||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)t.someProp("handleKeyDown",function(e){return e(t,n)})||function(t,e){var n=e.keyCode,r=function(t){var e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}(e);if(8==n||Gn&&72==n&&"c"==r)return fo(t,-1)||so(t,-1);if(46==n&&!e.shiftKey||Gn&&68==n&&"c"==r)return fo(t,1)||so(t,1);if(13==n||27==n)return!0;if(37==n||Gn&&66==n&&"c"==r){var o=37==n?"ltr"==lo(t,t.state.selection.from)?-1:1:-1;return ro(t,o,r)||so(t,o)}if(39==n||Gn&&70==n&&"c"==r){var i=39==n?"ltr"==lo(t,t.state.selection.from)?1:-1:1;return ro(t,i,r)||so(t,i)}return 38==n||Gn&&80==n&&"c"==r?uo(t,-1,r)||so(t,-1):40==n||Gn&&78==n&&"c"==r?function(t){if(!Un||t.state.selection.$head.parentOffset>0)return!1;var e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(n&&1==n.nodeType&&0==r&&n.firstChild&&"false"==n.firstChild.contentEditable){var o=n.firstChild;ho(t,o,"true"),setTimeout(function(){return ho(t,o,"false")},20)}return!1}(t)||uo(t,1,r)||so(t,1):r==(Gn?"m":"c")&&(66==n||73==n||89==n||90==n)}(t,n)?n.preventDefault():No(t,"key");else{var r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(function(){t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",function(e){return e(t,Ln(13,"Enter"))}),t.input.lastIOSEnter=0)},200)}},Ao.keyup=function(t,e){16==e.keyCode&&(t.input.shiftKey=!1)},Ao.keypress=function(t,e){var n=e;if(!(jo(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Gn&&n.metaKey))if(t.someProp("handleKeyPress",function(e){return e(t,n)}))n.preventDefault();else{var r=t.state.selection;if(!(r instanceof Ee&&r.$from.sameParent(r.$to))){var o=String.fromCharCode(n.charCode),i=function(){return t.state.tr.insertText(o).scrollIntoView()};/[\r\n]/.test(o)||t.someProp("handleTextInput",function(e){return e(t,r.$from.pos,r.$to.pos,o,i)})||t.dispatch(i()),n.preventDefault()}}};var Ho=Gn?"metaKey":"ctrlKey";To.mousedown=function(t,e){var n=e;t.input.shiftKey=n.shiftKey;var r=$o(t),o=Date.now(),i="singleClick";o-t.input.lastClick.time<500&&function(t,e){var n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}(n,t.input.lastClick)&&!n[Ho]&&t.input.lastClick.button==n.button&&("singleClick"==t.input.lastClick.type?i="doubleClick":"doubleClick"==t.input.lastClick.type&&(i="tripleClick")),t.input.lastClick={time:o,x:n.clientX,y:n.clientY,type:i,button:n.button};var s=t.posAtCoords(Io(n));s&&("singleClick"==i?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new _o(t,s,n,!!r)):("doubleClick"==i?zo:Bo)(t,s.pos,s.inside,n)?n.preventDefault():No(t,"pointer"))};var _o=function(){function t(t,e,n,r){var o,i,s=this;if(this.view=t,this.pos=e,this.event=n,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!n[Ho],this.allowDefault=n.shiftKey,e.inside>-1)o=t.state.doc.nodeAt(e.inside),i=e.inside;else{var a=t.state.doc.resolve(e.pos);o=a.parent,i=a.depth?a.before():0}var c=r?null:n.target,l=c?t.docView.nearestDesc(c,!0):null;this.target=l&&1==l.nodeDOM.nodeType?l.nodeDOM:null;var u=t.state.selection;(0==n.button&&o.type.spec.draggable&&!1!==o.type.spec.selectable||u instanceof Re&&u.from<=i&&u.to>i)&&(this.mightDrag={node:o,pos:i,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!Vn||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(function(){s.view.input.mouseDown==s&&s.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),No(t,"pointer")}var e=t.prototype;return e.done=function(){var t=this;this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(function(){return qr(t.view)}),this.view.input.mouseDown=null},e.up=function(t){if(this.done(),this.view.dom.contains(t.target)){var e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(Io(t))),this.updateAllowDefault(t),this.allowDefault||!e?No(this.view,"pointer"):function(t,e,n,r,o){return Lo(t,"handleClickOn",e,n,r)||t.someProp("handleClick",function(n){return n(t,e,r)})||(o?function(t,e){if(-1==e)return!1;var n,r,o=t.state.selection;o instanceof Re&&(n=o.node);for(var i=t.state.doc.resolve(e),s=i.depth+1;s>0;s--){var a=s>i.depth?i.nodeAfter:i.node(s);if(Re.isSelectable(a)){r=n&&o.$from.depth>0&&s>=o.$from.depth&&i.before(o.$from.depth+1)==o.$from.pos?i.before(o.$from.depth):i.before(s);break}}return null!=r&&(Po(t,Re.create(t.state.doc,r),"pointer"),!0)}(t,n):function(t,e){if(-1==e)return!1;var n=t.state.doc.resolve(e),r=n.nodeAfter;return!!(r&&r.isAtom&&Re.isSelectable(r))&&(Po(t,new Re(n),"pointer"),!0)}(t,n))}(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():0==t.button&&(this.flushed||Un&&this.mightDrag&&!this.mightDrag.node.isAtom||qn&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(Po(this.view,Me.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):No(this.view,"pointer")}},e.move=function(t){this.updateAllowDefault(t),No(this.view,"pointer"),0==t.buttons&&this.done()},e.updateAllowDefault=function(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)},t}();function jo(t,e){return!!t.composing||!!(Un&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500)&&(t.input.compositionEndedAt=-2e8,!0)}To.touchstart=function(t){t.input.lastTouch=Date.now(),$o(t),No(t,"pointer")},To.touchmove=function(t){t.input.lastTouch=Date.now(),No(t,"pointer")},To.contextmenu=function(t){return $o(t)};var Fo=Qn?5e3:-1;function Vo(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(function(){return qo(t)},e))}function Wo(t){var e;for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=((e=document.createEvent("Event")).initEvent("event",!0,!0),e.timeStamp));t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function qo(t,e){if(void 0===e&&(e=!1),!(Qn&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),Wo(t),e||t.docView&&t.docView.dirty){var n=Vr(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):!t.markCursor&&!e||r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.updateState(t.state):t.dispatch(t.state.tr.deleteSelection()),!0}return!1}}Ao.compositionstart=Ao.compositionupdate=function(t){if(!t.composing){t.domObserver.flush();var e=t.state,n=e.selection.$to;if(e.selection instanceof Ee&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(function(t){return!1===t.type.spec.inclusive})||qn&&Zn&&function(t){var e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n||1!=n.nodeType||r>=n.childNodes.length)return!1;var o=n.childNodes[r];return 1==o.nodeType&&"false"==o.contentEditable}(t)))t.markCursor=t.state.storedMarks||n.marks(),qo(t,!0),t.markCursor=null;else if(qo(t,!e.selection.empty),Vn&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length)for(var r=t.domSelectionRange(),o=r.focusNode,i=r.focusOffset;o&&1==o.nodeType&&0!=i;){var s=i<0?o.lastChild:o.childNodes[i-1];if(!s)break;if(3==s.nodeType){var a=t.domSelection();a&&a.collapse(s,s.nodeValue.length);break}o=s,i=-1}t.input.composing=!0}Vo(t,Fo)},Ao.compositionend=function(t,e){t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(function(){return t.domObserver.flush()}),t.input.compositionID++,Vo(t,20))};var Ko=jn&&Fn<15||Jn&&Yn<604;function Uo(t,e,n,r,o){var i=mo(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",function(e){return e(t,o,i||I.empty)}))return!0;if(!i)return!1;var s=function(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}(i),a=s?t.state.tr.replaceSelectionWith(s,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Jo(t){var e=t.getData("text/plain")||t.getData("Text");if(e)return e;var n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}To.copy=Ao.cut=function(t,e){var n=e,r=t.state.selection,o="cut"==n.type;if(!r.empty){var i=Ko?null:n.clipboardData,s=po(t,r.content()),a=s.dom,c=s.text;i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",c)):function(t,e){if(t.dom.parentNode){var n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";var r=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(o),setTimeout(function(){n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}}(t,a),o&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))}},Ao.paste=function(t,e){var n=e;if(!t.composing||Qn){var r=Ko?null:n.clipboardData,o=t.input.shiftKey&&45!=t.input.lastKeyCode;r&&Uo(t,Jo(r),r.getData("text/html"),o,n)?n.preventDefault():function(t,e){if(t.dom.parentNode){var n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();var o=t.input.shiftKey&&45!=t.input.lastKeyCode;setTimeout(function(){t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?Uo(t,r.value,null,o,e):Uo(t,r.textContent,r.innerHTML,o,e)},50)}}(t,n)}};var Go=function(t,e,n){this.slice=t,this.move=e,this.node=n},Zo=Gn?"altKey":"ctrlKey";function Qo(t,e){var n=t.someProp("dragCopies",function(t){return!t(e)});return null!=n?n:!e[Zo]}for(var Xo in To.dragstart=function(t,e){var n=e,r=t.input.mouseDown;if(r&&r.done(),n.dataTransfer){var o,i=t.state.selection,s=i.empty?null:t.posAtCoords(Io(n));if(s&&s.pos>=i.from&&s.pos<=(i instanceof Re?i.to-1:i.to));else if(r&&r.mightDrag)o=Re.create(t.state.doc,r.mightDrag.pos);else if(n.target&&1==n.target.nodeType){var a=t.docView.nearestDesc(n.target,!0);a&&a.node.type.spec.draggable&&a!=t.docView&&(o=Re.create(t.state.doc,a.posBefore))}var c=po(t,(o||t.state.selection).content()),l=c.dom,u=c.text,d=c.slice;(!n.dataTransfer.files.length||!qn||Kn>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(Ko?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",Ko||n.dataTransfer.setData("text/plain",u),t.dragging=new Go(d,Qo(t,n),o)}},To.dragend=function(t){var e=t.dragging;window.setTimeout(function(){t.dragging==e&&(t.dragging=null)},50)},Ao.dragover=Ao.dragenter=function(t,e){return e.preventDefault()},Ao.drop=function(t,e){try{!function(t,e,n){if(e.dataTransfer){var r=t.posAtCoords(Io(e));if(r){var o=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",function(e){i=e(i,t,!1)}):i=mo(t,Jo(e.dataTransfer),Ko?null:e.dataTransfer.getData("text/html"),!1,o);var s=!(!n||!Qo(t,e));if(t.someProp("handleDrop",function(n){return n(t,e,i||I.empty,s)}))e.preventDefault();else if(i){e.preventDefault();var a=i?ce(t.state.doc,o.pos,i):o.pos;null==a&&(a=o.pos);var c=t.state.tr;if(s){var l=n.node;l?l.replace(c):c.deleteSelection()}var u=c.mapping.map(a),d=0==i.openStart&&0==i.openEnd&&1==i.content.childCount,f=c.doc;if(d?c.replaceRangeWith(u,u,i.content.firstChild):c.replaceRange(u,u,i),!c.doc.eq(f)){var h=c.doc.resolve(u);if(d&&Re.isSelectable(i.content.firstChild)&&h.nodeAfter&&h.nodeAfter.sameMarkup(i.content.firstChild))c.setSelection(new Re(h));else{var p=c.mapping.map(a);c.mapping.maps[c.mapping.maps.length-1].forEach(function(t,e,n,r){return p=r}),c.setSelection(Xr(t,h,c.doc.resolve(p)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))}}}}}(t,e,t.dragging)}finally{t.dragging=null}},To.focus=function(t){t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(function(){t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&qr(t)},20))},To.blur=function(t,e){var n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},To.beforeinput=function(t,e){if(qn&&Qn&&"deleteContentBackward"==e.inputType){t.domObserver.flushSoon();var n=t.input.domChangeCount;setTimeout(function(){if(t.input.domChangeCount==n&&(t.dom.blur(),t.focus(),!t.someProp("handleKeyDown",function(e){return e(t,Ln(8,"Backspace"))}))){var e=t.state.selection.$cursor;e&&e.pos>0&&t.dispatch(t.state.tr.delete(e.pos-1,e.pos).scrollIntoView())}},50)}},Ao)To[Xo]=Ao[Xo];function Yo(t,e){if(t==e)return!0;for(var n in t)if(t[n]!==e[n])return!1;for(var r in e)if(!(r in t))return!1;return!0}var ti=function(){function t(t,e){this.toDOM=t,this.spec=e||ii,this.side=this.spec.side||0}var e=t.prototype;return e.map=function(t,e,n,r){var o=t.mapResult(e.from+r,this.side<0?-1:1),i=o.pos;return o.deleted?null:new ri(i-n,i-n,this)},e.valid=function(){return!0},e.eq=function(e){return this==e||e instanceof t&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Yo(this.spec,e.spec))},e.destroy=function(t){this.spec.destroy&&this.spec.destroy(t)},t}(),ei=function(){function t(t,e){this.attrs=t,this.spec=e||ii}var e=t.prototype;return e.map=function(t,e,n,r){var o=t.map(e.from+r,this.spec.inclusiveStart?-1:1)-n,i=t.map(e.to+r,this.spec.inclusiveEnd?1:-1)-n;return o>=i?null:new ri(o,i,this)},e.valid=function(t,e){return e.from<e.to},e.eq=function(e){return this==e||e instanceof t&&Yo(this.attrs,e.attrs)&&Yo(this.spec,e.spec)},t.is=function(e){return e.type instanceof t},e.destroy=function(){},t}(),ni=function(){function t(t,e){this.attrs=t,this.spec=e||ii}var e=t.prototype;return e.map=function(t,e,n,r){var o=t.mapResult(e.from+r,1);if(o.deleted)return null;var i=t.mapResult(e.to+r,-1);return i.deleted||i.pos<=o.pos?null:new ri(o.pos-n,i.pos-n,this)},e.valid=function(t,e){var n,r=t.content.findIndex(e.from),o=r.index,i=r.offset;return i==e.from&&!(n=t.child(o)).isText&&i+n.nodeSize==e.to},e.eq=function(e){return this==e||e instanceof t&&Yo(this.attrs,e.attrs)&&Yo(this.spec,e.spec)},e.destroy=function(){},t}(),ri=function(){function t(t,e,n){this.from=t,this.to=e,this.type=n}var e=t.prototype;return e.copy=function(e,n){return new t(e,n,this.type)},e.eq=function(t,e){return void 0===e&&(e=0),this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to},e.map=function(t,e,n){return this.type.map(t,this,e,n)},t.widget=function(e,n,r){return new t(e,e,new ti(n,r))},t.inline=function(e,n,r,o){return new t(e,n,new ei(r,o))},t.node=function(e,n,r,o){return new t(e,n,new ni(r,o))},g(t,[{key:"spec",get:function(){return this.type.spec}},{key:"inline",get:function(){return this.type instanceof ei}},{key:"widget",get:function(){return this.type instanceof ti}}])}(),oi=[],ii={},si=function(){function t(t,e){this.local=t.length?t:oi,this.children=e.length?e:oi}t.create=function(t,e){return e.length?hi(e,t,0,ii):ai};var e=t.prototype;return e.find=function(t,e,n){var r=[];return this.findInner(null==t?0:t,null==e?1e9:e,r,0,n),r},e.findInner=function(t,e,n,r,o){for(var i=0;i<this.local.length;i++){var s=this.local[i];s.from<=e&&s.to>=t&&(!o||o(s.spec))&&n.push(s.copy(s.from+r,s.to+r))}for(var a=0;a<this.children.length;a+=3)if(this.children[a]<e&&this.children[a+1]>t){var c=this.children[a]+1;this.children[a+2].findInner(t-c,e-c,n,r+c,o)}},e.map=function(t,e,n){return this==ai||0==t.maps.length?this:this.mapInner(t,e,0,0,n||ii)},e.mapInner=function(e,n,r,o,i){for(var s,a=0;a<this.local.length;a++){var c=this.local[a].map(e,r,o);c&&c.type.valid(n,c)?(s||(s=[])).push(c):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?li(this.children,s||[],e,n,r,o,i):s?new t(s.sort(pi),oi):ai},e.add=function(e,n){return n.length?this==ai?t.create(e,n):this.addInner(e,n,0):this},e.addInner=function(e,n,r){var o,i=this,s=0;e.forEach(function(t,e){var a,c=e+r;if(a=di(n,t,c)){for(o||(o=i.children.slice());s<o.length&&o[s]<e;)s+=3;o[s]==e?o[s+2]=o[s+2].addInner(t,a,c+1):o.splice(s,0,e,e+t.nodeSize,hi(a,t,c+1,ii)),s+=3}});for(var a=ui(s?fi(n):n,-r),c=0;c<a.length;c++)a[c].type.valid(e,a[c])||a.splice(c--,1);return new t(a.length?this.local.concat(a).sort(pi):this.local,o||this.children)},e.remove=function(t){return 0==t.length||this==ai?this:this.removeInner(t,0)},e.removeInner=function(e,n){for(var r=this.children,o=this.local,i=0;i<r.length;i+=3){for(var s,a=void 0,c=r[i]+n,l=r[i+1]+n,u=0;u<e.length;u++)(s=e[u])&&s.from>c&&s.to<l&&(e[u]=null,(a||(a=[])).push(s));if(a){r==this.children&&(r=this.children.slice());var d=r[i+2].removeInner(a,c+1);d!=ai?r[i+2]=d:(r.splice(i,3),i-=3)}}if(o.length)for(var f,h=0;h<e.length;h++)if(f=e[h])for(var p=0;p<o.length;p++)o[p].eq(f,n)&&(o==this.local&&(o=this.local.slice()),o.splice(p--,1));return r==this.children&&o==this.local?this:o.length||r.length?new t(o,r):ai},e.forChild=function(e,n){if(this==ai)return this;if(n.isLeaf)return t.empty;for(var r,o,i=0;i<this.children.length;i+=3)if(this.children[i]>=e){this.children[i]==e&&(r=this.children[i+2]);break}for(var s=e+1,a=s+n.content.size,c=0;c<this.local.length;c++){var l=this.local[c];if(l.from<a&&l.to>s&&l.type instanceof ei){var u=Math.max(s,l.from)-s,d=Math.min(a,l.to)-s;u<d&&(o||(o=[])).push(l.copy(u,d))}}if(o){var f=new t(o.sort(pi),oi);return r?new ci([f,r]):f}return r||ai},e.eq=function(e){if(this==e)return!0;if(!(e instanceof t)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(var n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(var r=0;r<this.children.length;r+=3)if(this.children[r]!=e.children[r]||this.children[r+1]!=e.children[r+1]||!this.children[r+2].eq(e.children[r+2]))return!1;return!0},e.locals=function(t){return mi(this.localsInner(t))},e.localsInner=function(t){if(this==ai)return oi;if(t.inlineContent||!this.local.some(ei.is))return this.local;for(var e=[],n=0;n<this.local.length;n++)this.local[n].type instanceof ei||e.push(this.local[n]);return e},e.forEachSet=function(t){t(this)},t}();si.empty=new si([],[]),si.removeOverlap=mi;var ai=si.empty,ci=function(){function t(t){this.members=t}var e=t.prototype;return e.map=function(e,n){var r=this.members.map(function(t){return t.map(e,n,ii)});return t.from(r)},e.forChild=function(e,n){if(n.isLeaf)return si.empty;for(var r=[],o=0;o<this.members.length;o++){var i=this.members[o].forChild(e,n);i!=ai&&(i instanceof t?r=r.concat(i.members):r.push(i))}return t.from(r)},e.eq=function(e){if(!(e instanceof t)||e.members.length!=this.members.length)return!1;for(var n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0},e.locals=function(t){for(var e,n=!0,r=0;r<this.members.length;r++){var o=this.members[r].localsInner(t);if(o.length)if(e){n&&(e=e.slice(),n=!1);for(var i=0;i<o.length;i++)e.push(o[i])}else e=o}return e?mi(n?e:e.sort(pi)):oi},t.from=function(e){switch(e.length){case 0:return ai;case 1:return e[0];default:return new t(e.every(function(t){return t instanceof si})?e:e.reduce(function(t,e){return t.concat(e instanceof si?e:e.members)},[]))}},e.forEachSet=function(t){for(var e=0;e<this.members.length;e++)this.members[e].forEachSet(t)},t}();function li(t,e,n,r,o,i,s){for(var a=t.slice(),c=function(t){var e=0;n.maps[l].forEach(function(n,r,o,i){for(var s=i-o-(r-n),c=0;c<a.length;c+=3){var l=a[c+1];if(!(l<0||n>l+t-e)){var u=a[c]+t-e;r>=u?a[c+1]=n<=u?-2:-1:n>=t&&s&&(a[c]+=s,a[c+1]+=s)}}e+=s}),t=n.maps[l].map(t,-1),u=t},l=0,u=i;l<n.maps.length;l++)c(u);for(var d=!1,f=0;f<a.length;f+=3)if(a[f+1]<0){if(-2==a[f+1]){d=!0,a[f+1]=-1;continue}var h=n.map(t[f]+i),p=h-o;if(p<0||p>=r.content.size){d=!0;continue}var m=n.map(t[f+1]+i,-1)-o,v=r.content.findIndex(p),g=v.index,y=v.offset,k=r.maybeChild(g);if(k&&y==p&&y+k.nodeSize==m){var b=a[f+2].mapInner(n,k,h+1,t[f]+i+1,s);b!=ai?(a[f]=p,a[f+1]=m,a[f+2]=b):(a[f+1]=-2,d=!0)}else d=!0}if(d){var w=function(t,e,n,r,o,i,s){function a(t,e){for(var i=0;i<t.local.length;i++){var c=t.local[i].map(r,o,e);c?n.push(c):s.onRemove&&s.onRemove(t.local[i].spec)}for(var l=0;l<t.children.length;l+=3)a(t.children[l+2],t.children[l]+e+1)}for(var c=0;c<t.length;c+=3)-1==t[c+1]&&a(t[c+2],e[c]+i+1);return n}(a,t,e,n,o,i,s),x=hi(w,r,0,s);e=x.local;for(var S=0;S<a.length;S+=3)a[S+1]<0&&(a.splice(S,3),S-=3);for(var C=0,M=0;C<x.children.length;C+=3){for(var T=x.children[C];M<a.length&&a[M]<T;)M+=3;a.splice(M,0,x.children[C],x.children[C+1],x.children[C+2])}}return new si(e.sort(pi),a)}function ui(t,e){if(!e||!t.length)return t;for(var n=[],r=0;r<t.length;r++){var o=t[r];n.push(new ri(o.from+e,o.to+e,o.type))}return n}function di(t,e,n){if(e.isLeaf)return null;for(var r,o=n+e.nodeSize,i=null,s=0;s<t.length;s++)(r=t[s])&&r.from>n&&r.to<o&&((i||(i=[])).push(r),t[s]=null);return i}function fi(t){for(var e=[],n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function hi(t,e,n,r){var o=[],i=!1;e.forEach(function(e,s){var a=di(t,e,s+n);if(a){i=!0;var c=hi(a,e,n+s+1,r);c!=ai&&o.push(s,s+e.nodeSize,c)}});for(var s=ui(i?fi(t):t,-n).sort(pi),a=0;a<s.length;a++)s[a].type.valid(e,s[a])||(r.onRemove&&r.onRemove(s[a].spec),s.splice(a--,1));return s.length||o.length?new si(s,o):ai}function pi(t,e){return t.from-e.from||t.to-e.to}function mi(t){for(var e=t,n=0;n<e.length-1;n++){var r=e[n];if(r.from!=r.to)for(var o=n+1;o<e.length;o++){var i=e[o];if(i.from!=r.from){i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),vi(e,o,r.copy(i.from,r.to)));break}i.to!=r.to&&(e==t&&(e=t.slice()),e[o]=i.copy(i.from,r.to),vi(e,o+1,i.copy(r.to,i.to)))}}return e}function vi(t,e,n){for(;e<t.length&&pi(n,t[e])>0;)e++;t.splice(e,0,n)}function gi(t){var e=[];return t.someProp("decorations",function(n){var r=n(t.state);r&&r!=ai&&e.push(r)}),t.cursorWrapper&&e.push(si.create(t.state.doc,[t.cursorWrapper.deco])),ci.from(e)}var yi={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},ki=jn&&Fn<=11,bi=function(){function t(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}var e=t.prototype;return e.set=function(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset},e.clear=function(){this.anchorNode=this.focusNode=null},e.eq=function(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset},t}(),wi=function(){function t(t,e){var n=this;this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new bi,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(function(e){for(var r=0;r<e.length;r++)n.queue.push(e[r]);jn&&Fn<=11&&e.some(function(t){return"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length})?n.flushSoon():Un&&t.composing&&e.some(function(t){return"childList"==t.type&&"TR"==t.target.nodeName})?(t.input.badSafariComposition=!0,n.flushSoon()):n.flush()}),ki&&(this.onCharData=function(t){n.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),n.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}var e=t.prototype;return e.flushSoon=function(){var t=this;this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(function(){t.flushingSoon=-1,t.flush()},20))},e.forceFlush=function(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())},e.start=function(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,yi)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()},e.stop=function(){var t=this;if(this.observer){var e=this.observer.takeRecords();if(e.length){for(var n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(function(){return t.flush()},20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()},e.connectSelection=function(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)},e.disconnectSelection=function(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)},e.suppressSelectionUpdates=function(){var t=this;this.suppressingSelectionUpdates=!0,setTimeout(function(){return t.suppressingSelectionUpdates=!1},50)},e.onSelectionChange=function(){if(Yr(this.view)){if(this.suppressingSelectionUpdates)return qr(this.view);if(jn&&Fn<=11&&!this.view.state.selection.empty){var t=this.view.domSelectionRange();if(t.focusNode&&On(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}},e.setCurSelection=function(){this.currentSelection.set(this.view.domSelectionRange())},e.ignoreSelectionChange=function(t){if(!t.focusNode)return!0;for(var e,n=new Set,r=t.focusNode;r;r=Mn(r))n.add(r);for(var o=t.anchorNode;o;o=Mn(o))if(n.has(o)){e=o;break}var i=e&&this.view.docView.nearestDesc(e);return i&&i.ignoreMutation({type:"selection",target:3==e.nodeType?e.parentNode:e})?(this.setCurSelection(),!0):void 0},e.pendingRecords=function(){if(this.observer)for(var t,e=xn(this.observer.takeRecords());!(t=e()).done;){var n=t.value;this.queue.push(n)}return this.queue},e.flush=function(){var t=this.view;if(t.docView&&!(this.flushingSoon>-1)){var e=this.pendingRecords();e.length&&(this.queue=[]);var n=t.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&Yr(t)&&!this.ignoreSelectionChange(n),o=-1,i=-1,s=!1,a=[];if(t.editable)for(var c=0;c<e.length;c++){var l=this.registerMutation(e[c],a);l&&(o=o<0?l.from:Math.min(l.from,o),i=i<0?l.to:Math.max(l.to,i),l.typeOver&&(s=!0))}if(Vn&&a.length){var u=a.filter(function(t){return"BR"==t.nodeName});if(2==u.length){var d=u[0],f=u[1];d.parentNode&&d.parentNode.parentNode==f.parentNode?f.remove():d.remove()}else for(var h,p=this.currentSelection.focusNode,m=xn(u);!(h=m()).done;){var v=h.value,g=v.parentNode;!g||"LI"!=g.nodeName||p&&Mi(t,p)==g||v.remove()}}else if((qn||Un)&&a.some(function(t){return"BR"==t.nodeName})&&(8==t.input.lastKeyCode||46==t.input.lastKeyCode))for(var y,k=xn(a);!(y=k()).done;){var b=y.value;if("BR"==b.nodeName&&b.parentNode){var w=b.nextSibling;w&&1==w.nodeType&&"false"==w.contentEditable&&b.parentNode.removeChild(b)}}var x=null;o<0&&r&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&In(n)&&(x=Vr(t))&&x.eq(Me.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,qr(t),this.currentSelection.set(n),t.scrollToSelection()):(o>-1||r)&&(o>-1&&(t.docView.markDirty(o,i),function(t){if(!xi.has(t)&&(xi.set(t,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace))){if(t.requiresGeckoHackNode=Vn,Si)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Si=!0}}(t)),t.input.badSafariComposition&&(t.input.badSafariComposition=!1,function(t,e){for(var n,r,o=t.domSelectionRange(),i=o.focusNode,s=o.focusOffset,a=xn(e);!(r=a()).done;){var c=r.value;if("TR"==(null===(n=c.parentNode)||void 0===n?void 0:n.nodeName)){for(var l=c.nextSibling;l&&"TD"!=l.nodeName&&"TH"!=l.nodeName;)l=l.nextSibling;if(l){for(var u=l;;){var d=u.firstChild;if(!d||1!=d.nodeType||"false"==d.contentEditable||/^(BR|IMG)$/.test(d.nodeName))break;u=d}u.insertBefore(c,u.firstChild),i==c&&t.domSelection().collapse(c,s)}else c.parentNode.removeChild(c)}}}(t,a)),this.handleDOMChange(o,i,s,a),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(n)||qr(t),this.currentSelection.set(n))}},e.registerMutation=function(t,e){if(e.indexOf(t.target)>-1)return null;var n=this.view.docView.nearestDesc(t.target);if("attributes"==t.type&&(n==this.view.docView||"contenteditable"==t.attributeName||"style"==t.attributeName&&!t.oldValue&&!t.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(t))return null;if("childList"==t.type){for(var r=0;r<t.addedNodes.length;r++){var o=t.addedNodes[r];e.push(o),3==o.nodeType&&(this.lastChangedTextNode=o)}if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(t.target))return{from:n.posBefore,to:n.posAfter};var i=t.previousSibling,s=t.nextSibling;if(jn&&Fn<=11&&t.addedNodes.length)for(var a=0;a<t.addedNodes.length;a++){var c=t.addedNodes[a],l=c.previousSibling,u=c.nextSibling;(!l||Array.prototype.indexOf.call(t.addedNodes,l)<0)&&(i=l),(!u||Array.prototype.indexOf.call(t.addedNodes,u)<0)&&(s=u)}var d=i&&i.parentNode==t.target?Cn(i)+1:0,f=n.localPosFromDOM(t.target,d,-1),h=s&&s.parentNode==t.target?Cn(s):t.target.childNodes.length;return{from:f,to:n.localPosFromDOM(t.target,h,1)}}return"attributes"==t.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:(this.lastChangedTextNode=t.target,{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue})},t}(),xi=new WeakMap,Si=!1;function Ci(t,e){var n=e.startContainer,r=e.startOffset,o=e.endContainer,i=e.endOffset,s=t.domAtPos(t.state.selection.anchor);if(On(s.node,s.offset,o,i)){var a=[o,i,n,r];n=a[0],r=a[1],o=a[2],i=a[3]}return{anchorNode:n,anchorOffset:r,focusNode:o,focusOffset:i}}function Mi(t,e){for(var n=e.parentNode;n&&n!=t.dom;n=n.parentNode){var r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function Ti(t){var e=t.pmViewDesc;if(e)return e.parseRule();if("BR"==t.nodeName&&t.parentNode){if(Un&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){var n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}if(t.parentNode.lastChild==t||Un&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if("IMG"==t.nodeName&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}var Ai=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Oi(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:Xr(t,e.resolve(n.anchor),e.resolve(n.head))}function Ei(t,e,n){for(var r=t.depth,o=e?t.end():t.pos;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,o++,e=!1;if(n)for(var i=t.node(r).maybeChild(t.indexAfter(r));i&&!i.isLeaf;)i=i.firstChild,o++;return o}function Ni(t){if(2!=t.length)return!1;var e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}var Ri=function(){function t(t,e){var n=this;this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Eo,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(zi),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):"function"==typeof t?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=Li(this),Ii(this),this.nodeViews=Pi(this),this.docView=Ar(this.state.doc,Di(this),gi(this),this.dom,this),this.domObserver=new wi(this,function(t,e,r,o){return function(t,e,n,r,o){var i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){var s=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,a=Vr(t,s);if(a&&!t.state.selection.eq(a)){if(qn&&Qn&&13===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",function(e){return e(t,Ln(13,"Enter"))}))return;var c=t.state.tr.setSelection(a);"pointer"==s?c.setMeta("pointer",!0):"key"==s&&c.scrollIntoView(),i&&c.setMeta("composition",i),t.dispatch(c)}}else{var l=t.state.doc.resolve(e),u=l.sharedDepth(n);e=l.before(u+1),n=t.state.doc.resolve(n).after(u+1);var d,f,h=t.state.selection,p=function(t,e,n){var r,o=t.docView.parseRange(e,n),i=o.node,s=o.fromOffset,a=o.toOffset,c=o.from,l=o.to,u=t.domSelectionRange(),d=u.anchorNode;if(d&&t.dom.contains(1==d.nodeType?d:d.parentNode)&&(r=[{node:d,offset:u.anchorOffset}],In(u)||r.push({node:u.focusNode,offset:u.focusOffset})),qn&&8===t.input.lastKeyCode)for(var f=a;f>s;f--){var h=i.childNodes[f-1],p=h.pmViewDesc;if("BR"==h.nodeName&&!p){a=f;break}if(!p||p.size)break}var m=t.state.doc,v=t.someProp("domParser")||kt.fromSchema(t.state.schema),g=m.resolve(c),y=null,k=v.parse(i,{topNode:g.parent,topMatch:g.parent.contentMatchAt(g.index()),topOpen:!0,from:s,to:a,preserveWhitespace:"pre"!=g.parent.type.whitespace||"full",findPositions:r,ruleFromNode:Ti,context:g});if(r&&null!=r[0].pos){var b=r[0].pos,w=r[1]&&r[1].pos;null==w&&(w=b),y={anchor:b+c,head:w+c}}return{doc:k,sel:y,from:c,to:l}}(t,e,n),m=t.state.doc,v=m.slice(p.from,p.to);8===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime?(d=t.state.selection.to,f="end"):(d=t.state.selection.from,f="start"),t.input.lastKeyCode=null;var g=function(t,e,n,r,o){var i=t.findDiffStart(e,n);if(null==i)return null;var s=t.findDiffEnd(e,n+t.size,n+e.size),a=s.a,c=s.b;if("end"==o&&(r-=a+Math.max(0,i-Math.min(a,c))-i),a<i&&t.size<e.size){var l=r<=i&&r>=a?i-r:0;(i-=l)&&i<e.size&&Ni(e.textBetween(i-1,i+1))&&(i+=l?1:-1),c=i+(c-a),a=i}else if(c<i){var u=r<=i&&r>=c?i-r:0;(i-=u)&&i<t.size&&Ni(t.textBetween(i-1,i+1))&&(i+=u?1:-1),a=i+(a-c),c=i}return{start:i,endA:a,endB:c}}(v.content,p.doc.content,p.from,d,f);if(g&&t.input.domChangeCount++,(Jn&&t.input.lastIOSEnter>Date.now()-225||Qn)&&o.some(function(t){return 1==t.nodeType&&!Ai.test(t.nodeName)})&&(!g||g.endA>=g.endB)&&t.someProp("handleKeyDown",function(e){return e(t,Ln(13,"Enter"))}))t.input.lastIOSEnter=0;else{if(!g){if(!(r&&h instanceof Ee&&!h.empty&&h.$head.sameParent(h.$anchor))||t.composing||p.sel&&p.sel.anchor!=p.sel.head){if(p.sel){var y=Oi(t,t.state.doc,p.sel);if(y&&!y.eq(t.state.selection)){var k=t.state.tr.setSelection(y);i&&k.setMeta("composition",i),t.dispatch(k)}}return}g={start:h.from,endA:h.to,endB:h.to}}t.state.selection.from<t.state.selection.to&&g.start==g.endB&&t.state.selection instanceof Ee&&(g.start>t.state.selection.from&&g.start<=t.state.selection.from+2&&t.state.selection.from>=p.from?g.start=t.state.selection.from:g.endA<t.state.selection.to&&g.endA>=t.state.selection.to-2&&t.state.selection.to<=p.to&&(g.endB+=t.state.selection.to-g.endA,g.endA=t.state.selection.to)),jn&&Fn<=11&&g.endB==g.start+1&&g.endA==g.start&&g.start>p.from&&"  "==p.doc.textBetween(g.start-p.from-1,g.start-p.from+1)&&(g.start--,g.endA--,g.endB--);var b=p.doc.resolveNoCache(g.start-p.from),w=p.doc.resolveNoCache(g.endB-p.from),x=m.resolve(g.start),S=b.sameParent(w)&&b.parent.inlineContent&&x.end()>=g.endA;if((Jn&&t.input.lastIOSEnter>Date.now()-225&&(!S||o.some(function(t){return"DIV"==t.nodeName||"P"==t.nodeName}))||!S&&b.pos<p.doc.content.size&&(!b.sameParent(w)||!b.parent.inlineContent)&&b.pos<w.pos&&!/\S/.test(p.doc.textBetween(b.pos,w.pos,"","")))&&t.someProp("handleKeyDown",function(e){return e(t,Ln(13,"Enter"))}))t.input.lastIOSEnter=0;else if(t.state.selection.anchor>g.start&&function(t,e,n,r,o){if(n-e<=o.pos-r.pos||Ei(r,!0,!1)<o.pos)return!1;var i=t.resolve(e);if(!r.parent.isTextblock){var s=i.nodeAfter;return null!=s&&n==e+s.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;var a=t.resolve(Ei(i,!0,!0));return!(!a.parent.isTextblock||a.pos>n||Ei(a,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(a.parent.content)}(m,g.start,g.endA,b,w)&&t.someProp("handleKeyDown",function(e){return e(t,Ln(8,"Backspace"))}))Qn&&qn&&t.domObserver.suppressSelectionUpdates();else{qn&&g.endB==g.start&&(t.input.lastChromeDelete=Date.now()),Qn&&!S&&b.start()!=w.start()&&0==w.parentOffset&&b.depth==w.depth&&p.sel&&p.sel.anchor==p.sel.head&&p.sel.head==g.endA&&(g.endB-=2,w=p.doc.resolveNoCache(g.endB-p.from),setTimeout(function(){t.someProp("handleKeyDown",function(e){return e(t,Ln(13,"Enter"))})},20));var C,M=g.start,T=g.endA,O=function(e){var n=e||t.state.tr.replace(M,T,p.doc.slice(g.start-p.from,g.endB-p.from));if(p.sel){var r=Oi(t,n.doc,p.sel);r&&!(qn&&t.composing&&r.empty&&(g.start!=g.endB||t.input.lastChromeDelete<Date.now()-100)&&(r.head==M||r.head==n.mapping.map(T)-1)||jn&&r.empty&&r.head==M)&&n.setSelection(r)}return i&&n.setMeta("composition",i),n.scrollIntoView()};if(S)if(b.pos==w.pos){jn&&Fn<=11&&0==b.parentOffset&&(t.domObserver.suppressSelectionUpdates(),setTimeout(function(){return qr(t)},20));var E=O(t.state.tr.delete(M,T)),N=m.resolve(g.start).marksAcross(m.resolve(g.endA));N&&E.ensureMarks(N),t.dispatch(E)}else if(g.endA==g.endB&&(C=function(t,e){for(var n,r,o,i=t.firstChild.marks,s=e.firstChild.marks,a=i,c=s,l=0;l<s.length;l++)a=s[l].removeFromSet(a);for(var u=0;u<i.length;u++)c=i[u].removeFromSet(c);if(1==a.length&&0==c.length)r=a[0],n="add",o=function(t){return t.mark(r.addToSet(t.marks))};else{if(0!=a.length||1!=c.length)return null;r=c[0],n="remove",o=function(t){return t.mark(r.removeFromSet(t.marks))}}for(var d=[],f=0;f<e.childCount;f++)d.push(o(e.child(f)));if(A.from(d).eq(t))return{mark:r,type:n}}(b.parent.content.cut(b.parentOffset,w.parentOffset),x.parent.content.cut(x.parentOffset,g.endA-x.start())))){var R=O(t.state.tr);"add"==C.type?R.addMark(M,T,C.mark):R.removeMark(M,T,C.mark),t.dispatch(R)}else if(b.parent.child(b.index()).isText&&b.index()==w.index()-(w.textOffset?0:1)){var D=b.parent.textBetween(b.parentOffset,w.parentOffset),I=function(){return O(t.state.tr.insertText(D,M,T))};t.someProp("handleTextInput",function(e){return e(t,M,T,D,I)})||t.dispatch(I())}else t.dispatch(O());else t.dispatch(O())}}}}(n,t,e,r,o)}),this.domObserver.start(),function(t){var e=function(){var e=To[n];t.dom.addEventListener(n,t.input.eventHandlers[n]=function(n){!function(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(var n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}(t,n)||Do(t,n)||!t.editable&&n.type in Ao||e(t,n)},Oo[n]?{passive:!0}:void 0)};for(var n in To)e();Un&&t.dom.addEventListener("input",function(){return null}),Ro(t)}(this),this.updatePluginViews()}var e=t.prototype;return e.update=function(t){t.handleDOMEvents!=this._props.handleDOMEvents&&Ro(this);var e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(zi),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)},e.setProps=function(t){var e={};for(var n in this._props)e[n]=this._props[n];for(var r in e.state=this.state,t)e[r]=t[r];this.update(e)},e.updateState=function(t){this.updateStateInner(t,this._props)},e.updateStateInner=function(t,e){var n,r=this.state,o=!1,i=!1;t.storedMarks&&this.composing&&(Wo(this),i=!0),this.state=t;var s=r.plugins!=t.plugins||this._props.plugins!=e.plugins;if(s||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){var a=Pi(this);(function(t,e){var n=0,r=0;for(var o in t){if(t[o]!=e[o])return!0;n++}for(var i in e)r++;return n!=r})(a,this.nodeViews)&&(this.nodeViews=a,o=!0)}(s||e.handleDOMEvents!=this._props.handleDOMEvents)&&Ro(this),this.editable=Li(this),Ii(this);var c=gi(this),l=Di(this),u=r.plugins==t.plugins||r.doc.eq(t.doc)?t.scrollToSelection>r.scrollToSelection?"to selection":"preserve":"reset",d=o||!this.docView.matchesNode(t.doc,l,c);!d&&t.selection.eq(r.selection)||(i=!0);var f,h,p,m,v,g,y,k,b,w,x="preserve"==u&&i&&null==this.dom.style.overflowAnchor&&function(t){for(var e,n,r=t.dom.getBoundingClientRect(),o=Math.max(0,r.top),i=(r.left+r.right)/2,s=o+1;s<Math.min(innerHeight,r.bottom);s+=5){var a=t.root.elementFromPoint(i,s);if(a&&a!=t.dom&&t.dom.contains(a)){var c=a.getBoundingClientRect();if(c.top>=o-20){e=a,n=c.top;break}}}return{refDOM:e,refTop:n,stack:or(t.dom)}}(this);if(i){this.domObserver.stop();var S=d&&(jn||qn)&&!this.composing&&!r.selection.empty&&!t.selection.empty&&(m=r.selection,v=t.selection,g=Math.min(m.$anchor.sharedDepth(m.head),v.$anchor.sharedDepth(v.head)),m.$anchor.start(g)!=v.$anchor.start(g));if(d){var C=qn?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=function(t){var e=t.domSelectionRange();if(!e.focusNode)return null;var n=function(t,e){for(;;){if(3==t.nodeType&&e)return t;if(1==t.nodeType&&e>0){if("false"==t.contentEditable)return null;e=Rn(t=t.childNodes[e-1])}else{if(!t.parentNode||Dn(t))return null;e=Cn(t),t=t.parentNode}}}(e.focusNode,e.focusOffset),r=function(t,e){for(;;){if(3==t.nodeType&&e<t.nodeValue.length)return t;if(1==t.nodeType&&e<t.childNodes.length){if("false"==t.contentEditable)return null;t=t.childNodes[e],e=0}else{if(!t.parentNode||Dn(t))return null;e=Cn(t)+1,t=t.parentNode}}}(e.focusNode,e.focusOffset);if(n&&r&&n!=r){var o=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!o||!o.isText(r.nodeValue))return r;if(t.input.compositionNode==r){var s=n.pmViewDesc;if(s&&s.isText(n.nodeValue))return r}}return n||r}(this)),!o&&this.docView.update(t.doc,l,c,this)||(this.docView.updateOuterDeco(l),this.docView.destroy(),this.docView=Ar(t.doc,l,c,this.dom,this)),!C||this.trackWrites&&this.dom.contains(this.trackWrites)||(S=!0)}S||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&(f=this,h=f.docView.domFromPos(f.state.selection.anchor,0),p=f.domSelectionRange(),On(h.node,h.offset,p.anchorNode,p.anchorOffset)))?qr(this,S):(Zr(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(r),(null===(n=this.dragging)||void 0===n?void 0:n.node)&&!r.doc.eq(t.doc)&&this.updateDraggedNode(this.dragging,r),"reset"==u?this.dom.scrollTop=0:"to selection"==u?this.scrollToSelection():x&&(k=(y=x).refDOM,b=y.refTop,ir(y.stack,0==(w=k?k.getBoundingClientRect().top:0)?0:w-b))},e.scrollToSelection=function(){var t=this,e=this.domSelectionRange().focusNode;if(e&&this.dom.contains(1==e.nodeType?e:e.parentNode))if(this.someProp("handleScrollToSelection",function(e){return e(t)}));else if(this.state.selection instanceof Re){var n=this.docView.domAfterPos(this.state.selection.from);1==n.nodeType&&rr(this,n.getBoundingClientRect(),e)}else rr(this,this.coordsAtPos(this.state.selection.head,1),e)},e.destroyPluginViews=function(){for(var t;t=this.pluginViews.pop();)t.destroy&&t.destroy()},e.updatePluginViews=function(t){if(t&&t.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(var e=0;e<this.pluginViews.length;e++){var n=this.pluginViews[e];n.update&&n.update(this,t)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(var r=0;r<this.directPlugins.length;r++){var o=this.directPlugins[r];o.spec.view&&this.pluginViews.push(o.spec.view(this))}for(var i=0;i<this.state.plugins.length;i++){var s=this.state.plugins[i];s.spec.view&&this.pluginViews.push(s.spec.view(this))}}},e.updateDraggedNode=function(t,e){var n=t.node,r=-1;if(this.state.doc.nodeAt(n.from)==n.node)r=n.from;else{var o=n.from+(this.state.doc.content.size-e.doc.content.size);(o>0&&this.state.doc.nodeAt(o))==n.node&&(r=o)}this.dragging=new Go(t.slice,t.move,r<0?void 0:Re.create(this.state.doc,r))},e.someProp=function(t,e){var n,r=this._props&&this._props[t];if(null!=r&&(n=e?e(r):r))return n;for(var o=0;o<this.directPlugins.length;o++){var i=this.directPlugins[o].props[t];if(null!=i&&(n=e?e(i):i))return n}var s=this.state.plugins;if(s)for(var a=0;a<s.length;a++){var c=s[a].props[t];if(null!=c&&(n=e?e(c):c))return n}},e.hasFocus=function(){if(jn){var t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if("false"==t.contentEditable)return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom},e.focus=function(){this.domObserver.stop(),this.editable&&function(t){if(t.setActive)return t.setActive();if(sr)return t.focus(sr);var e=or(t);t.focus(null==sr?{get preventScroll(){return sr={preventScroll:!0},!0}}:void 0),sr||(sr=!1,ir(e,0))}(this.dom),qr(this),this.domObserver.start()},e.updateRoot=function(){this._root=null},e.posAtCoords=function(t){return ur(this,t)},e.coordsAtPos=function(t,e){return void 0===e&&(e=1),pr(this,t,e)},e.domAtPos=function(t,e){return void 0===e&&(e=0),this.docView.domFromPos(t,e)},e.nodeDOM=function(t){var e=this.docView.descAt(t);return e?e.nodeDOM:null},e.posAtDOM=function(t,e,n){void 0===n&&(n=-1);var r=this.docView.posFromDOM(t,e,n);if(null==r)throw new RangeError("DOM position not inside the editor");return r},e.endOfTextblock=function(t,e){return function(t,e,n){return kr==e&&br==n?wr:(kr=e,br=n,wr="up"==n||"down"==n?function(t,e,n){var r=e.selection,o="up"==n?r.$from:r.$to;return gr(t,e,function(){for(var e=t.docView.domFromPos(o.pos,"up"==n?-1:1).node;;){var r=t.docView.nearestDesc(e,!0);if(!r)break;if(r.node.isBlock){e=r.contentDOM||r.dom;break}e=r.dom.parentNode}for(var i=pr(t,o.pos,1),s=e.firstChild;s;s=s.nextSibling){var a=void 0;if(1==s.nodeType)a=s.getClientRects();else{if(3!=s.nodeType)continue;a=An(s,0,s.nodeValue.length).getClientRects()}for(var c=0;c<a.length;c++){var l=a[c];if(l.bottom>l.top+1&&("up"==n?i.top-l.top>2*(l.bottom-i.top):l.bottom-i.bottom>2*(i.bottom-l.top)))return!1}}return!0})}(t,e,n):function(t,e,n){var r=e.selection.$head;if(!r.parent.isTextblock)return!1;var o=r.parentOffset,i=!o,s=o==r.parent.content.size,a=t.domSelection();return a?yr.test(r.parent.textContent)&&a.modify?gr(t,e,function(){var e=t.domSelectionRange(),o=e.focusNode,i=e.focusOffset,s=e.anchorNode,c=e.anchorOffset,l=a.caretBidiLevel;a.modify("move",n,"character");var u=r.depth?t.docView.domAfterPos(r.before()):t.dom,d=t.domSelectionRange(),f=d.focusNode,h=d.focusOffset,p=f&&!u.contains(1==f.nodeType?f:f.parentNode)||o==f&&i==h;try{a.collapse(s,c),o&&(o!=s||i!=c)&&a.extend&&a.extend(o,i)}catch(t){}return null!=l&&(a.caretBidiLevel=l),p}):"left"==n||"backward"==n?i:s:r.pos==r.start()||r.pos==r.end()}(t,e,n))}(this,e||this.state,t)},e.pasteHTML=function(t,e){return Uo(this,"",t,!1,e||new ClipboardEvent("paste"))},e.pasteText=function(t,e){return Uo(this,t,null,!0,e||new ClipboardEvent("paste"))},e.serializeForClipboard=function(t){return po(this,t)},e.destroy=function(){this.docView&&(function(t){for(var e in t.domObserver.stop(),t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],gi(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,Tn=null)},e.dispatchEvent=function(t){return function(t,e){Do(t,e)||!To[e.type]||!t.editable&&e.type in Ao||To[e.type](t,e)}(this,t)},e.domSelectionRange=function(){var t=this.domSelection();return t?Un&&11===this.root.nodeType&&function(t){for(var e=t.activeElement;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}(this.dom.ownerDocument)==this.dom&&function(t,e){if(e.getComposedRanges){var n=e.getComposedRanges(t.root)[0];if(n)return Ci(t,n)}var r;function o(t){t.preventDefault(),t.stopImmediatePropagation(),r=t.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",o,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",o,!0),r?Ci(t,r):null}(this,t)||t:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}},e.domSelection=function(){return this.root.getSelection()},g(t,[{key:"composing",get:function(){return this.input.composing}},{key:"props",get:function(){if(this._props.state!=this.state){var t=this._props;for(var e in this._props={},t)this._props[e]=t[e];this._props.state=this.state}return this._props}},{key:"root",get:function(){var t=this,e=this._root;if(null==e)for(var n,r=function(e){if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=function(){return e.ownerDocument.getSelection()}),{v:t._root=e}},o=this.dom.parentNode;o;o=o.parentNode)if(n=r(o))return n.v;return e||document}},{key:"isDestroyed",get:function(){return null==this.docView}}])}();function Di(t){var e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",function(n){if("function"==typeof n&&(n=n(t.state)),n)for(var r in n)"class"==r?e.class+=" "+n[r]:"style"==r?e.style=(e.style?e.style+";":"")+n[r]:e[r]||"contenteditable"==r||"nodeName"==r||(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[ri.node(0,t.state.doc.content.size,e)]}function Ii(t){if(t.markCursor){var e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:ri.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function Li(t){return!t.someProp("editable",function(e){return!1===e(t.state)})}function Pi(t){var e=Object.create(null);function n(t){for(var n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function zi(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}Ri.prototype.dispatch=function(t){var e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};for(var Bi={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},$i={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},Hi="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),_i="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),ji=0;ji<10;ji++)Bi[48+ji]=Bi[96+ji]=String(ji);for(ji=1;ji<=24;ji++)Bi[ji+111]="F"+ji;for(ji=65;ji<=90;ji++)Bi[ji]=String.fromCharCode(ji+32),$i[ji]=String.fromCharCode(ji);for(var Fi in Bi)$i.hasOwnProperty(Fi)||($i[Fi]=Bi[Fi]);var Vi="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),Wi="undefined"!=typeof navigator&&/Win/.test(navigator.platform);function qi(t){var e,n,r,o,i=t.split(/-(?!$)/),s=i[i.length-1];"Space"==s&&(s=" ");for(var a=0;a<i.length-1;a++){var c=i[a];if(/^(cmd|meta|m)$/i.test(c))o=!0;else if(/^a(lt)?$/i.test(c))e=!0;else if(/^(c|ctrl|control)$/i.test(c))n=!0;else if(/^s(hift)?$/i.test(c))r=!0;else{if(!/^mod$/i.test(c))throw new Error("Unrecognized modifier name: "+c);Vi?o=!0:n=!0}}return e&&(s="Alt-"+s),n&&(s="Ctrl-"+s),o&&(s="Meta-"+s),r&&(s="Shift-"+s),s}function Ki(t,e,n){return void 0===n&&(n=!0),e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function Ui(t){var e=function(t){var e=Object.create(null);for(var n in t)e[qi(n)]=t[n];return e}(t);return function(t,n){var r,o=function(t){var e=!(Hi&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||_i&&t.shiftKey&&t.key&&1==t.key.length||"Unidentified"==t.key)&&t.key||(t.shiftKey?$i:Bi)[t.keyCode]||t.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}(n),i=e[Ki(o,n)];if(i&&i(t.state,t.dispatch,t))return!0;if(1==o.length&&" "!=o){if(n.shiftKey){var s=e[Ki(o,n,!1)];if(s&&s(t.state,t.dispatch,t))return!0}if((n.altKey||n.metaKey||n.ctrlKey)&&!(Wi&&n.ctrlKey&&n.altKey)&&(r=Bi[n.keyCode])&&r!=o){var a=e[Ki(r,n)];if(a&&a(t.state,t.dispatch,t))return!0}}return!1}}var Ji=Object.defineProperty,Gi=function(t,e){for(var n in e)Ji(t,n,{get:e[n],enumerable:!0})};function Zi(t){var e=t.state,n=t.transaction,r=n.selection,o=n.doc,i=n.storedMarks;return y({},e,{apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return o},get tr(){return r=n.selection,o=n.doc,i=n.storedMarks,n}})}var Qi=function(){function t(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}var e=t.prototype;return e.createChain=function(t,e){var n=this;void 0===e&&(e=!0);var r=this.rawCommands,o=this.editor,i=this.state,s=o.view,a=[],c=!!t,l=t||i.tr,u=y({},Object.fromEntries(Object.entries(r).map(function(t){var r=t[0],o=t[1];return[r,function(){var t=n.buildProps(l,e),r=o.apply(void 0,arguments)(t);return a.push(r),u}]})),{run:function(){return c||!e||l.getMeta("preventDispatch")||n.hasCustomState||s.dispatch(l),a.every(function(t){return!0===t})}});return u},e.createCan=function(t){var e=this,n=this.rawCommands,r=this.state,o=!1,i=t||r.tr,s=this.buildProps(i,o),a=Object.fromEntries(Object.entries(n).map(function(t){var e=t[0],n=t[1];return[e,function(){return n.apply(void 0,arguments)(y({},s,{dispatch:void 0}))}]}));return y({},a,{chain:function(){return e.createChain(i,o)}})},e.buildProps=function(t,e){var n=this;void 0===e&&(e=!0);var r=this.rawCommands,o=this.editor,i=this.state,s=o.view,a={tr:t,editor:o,view:s,state:Zi({state:i,transaction:t}),dispatch:e?function(){}:void 0,chain:function(){return n.createChain(t,e)},can:function(){return n.createCan(t)},get commands(){return Object.fromEntries(Object.entries(r).map(function(t){var e=t[0],n=t[1];return[e,function(){return n.apply(void 0,arguments)(a)}]}))}};return a},g(t,[{key:"hasCustomState",get:function(){return!!this.customState}},{key:"state",get:function(){return this.customState||this.editor.state}},{key:"commands",get:function(){var t=this,e=this.rawCommands,n=this.editor,r=this.state,o=n.view,i=r.tr,s=this.buildProps(i);return Object.fromEntries(Object.entries(e).map(function(e){var n=e[0],r=e[1];return[n,function(){var e=r.apply(void 0,arguments)(s);return i.getMeta("preventDispatch")||t.hasCustomState||o.dispatch(i),e}]}))}},{key:"chain",get:function(){var t=this;return function(){return t.createChain()}}},{key:"can",get:function(){var t=this;return function(){return t.createCan()}}}])}(),Xi={};Gi(Xi,{blur:function(){return Yi},clearContent:function(){return ts},clearNodes:function(){return es},command:function(){return ns},createParagraphNear:function(){return rs},cut:function(){return is},deleteCurrentNode:function(){return ss},deleteNode:function(){return cs},deleteRange:function(){return ls},deleteSelection:function(){return us},enter:function(){return ds},exitCode:function(){return fs},extendMarkRange:function(){return ks},first:function(){return bs},focus:function(){return Ts},forEach:function(){return As},insertContent:function(){return Os},insertContentAt:function(){return Ds},joinBackward:function(){return Ps},joinDown:function(){return Ls},joinForward:function(){return zs},joinItemBackward:function(){return Bs},joinItemForward:function(){return $s},joinTextblockBackward:function(){return Hs},joinTextblockForward:function(){return _s},joinUp:function(){return Is},keyboardShortcut:function(){return Fs},lift:function(){return Ws},liftEmptyBlock:function(){return qs},liftListItem:function(){return Ks},newlineInCode:function(){return Us},resetAttributes:function(){return Zs},scrollIntoView:function(){return Qs},selectAll:function(){return Xs},selectNodeBackward:function(){return Ys},selectNodeForward:function(){return ta},selectParentNode:function(){return ea},selectTextblockEnd:function(){return na},selectTextblockStart:function(){return ra},setContent:function(){return ia},setMark:function(){return _a},setMeta:function(){return ja},setNode:function(){return Fa},setNodeSelection:function(){return Va},setTextDirection:function(){return Wa},setTextSelection:function(){return qa},sinkListItem:function(){return Ka},splitBlock:function(){return Ja},splitListItem:function(){return Ga},toggleList:function(){return Xa},toggleMark:function(){return Ya},toggleNode:function(){return tc},toggleWrap:function(){return ec},undoInputRule:function(){return nc},unsetAllMarks:function(){return rc},unsetMark:function(){return oc},unsetTextDirection:function(){return ic},updateAttributes:function(){return sc},wrapIn:function(){return ac},wrapInList:function(){return cc}});var Yi=function(){return function(t){var e=t.editor,n=t.view;return requestAnimationFrame(function(){var t;e.isDestroyed||(n.dom.blur(),null==(t=null==window?void 0:window.getSelection())||t.removeAllRanges())}),!0}},ts=function(t){return void 0===t&&(t=!0),function(e){return e.commands.setContent("",{emitUpdate:t})}},es=function(){return function(t){var e=t.state,n=t.tr,r=t.dispatch,o=n.selection.ranges;return!r||(o.forEach(function(t){var r=t.$from,o=t.$to;e.doc.nodesBetween(r.pos,o.pos,function(t,e){if(!t.type.isText){var r=n.doc,o=n.mapping,i=r.resolve(o.map(e)),s=r.resolve(o.map(e+t.nodeSize)),a=i.blockRange(s);if(a){var c=Yt(a);if(t.type.isTextblock){var l=i.parent.contentMatchAt(i.index()).defaultType;n.setNodeMarkup(a.start,l)}(c||0===c)&&n.lift(a,c)}}})}),!0)}},ns=function(t){return function(e){return t(e)}},rs=function(){return function(t){var e=t.state,n=t.dispatch;return ln(e,n)}},is=function(t,e){return function(n){var r=n.editor,o=n.tr,i=r.state.doc.slice(t.from,t.to);o.deleteRange(t.from,t.to);var s=o.mapping.map(e);return o.insert(s,i.content),o.setSelection(new Ee(o.doc.resolve(Math.max(s-1,0)))),!0}},ss=function(){return function(t){var e=t.tr,n=t.dispatch,r=e.selection.$anchor.node();if(r.content.size>0)return!1;for(var o=e.selection.$anchor,i=o.depth;i>0;i-=1)if(o.node(i).type===r.type){if(n){var s=o.before(i),a=o.after(i);e.delete(s,a).scrollIntoView()}return!0}return!1}};function as(t,e){if("string"==typeof t){if(!e.nodes[t])throw Error("There is no node type named '"+t+"'. Maybe you forgot to add the extension?");return e.nodes[t]}return t}var cs=function(t){return function(e){for(var n=e.tr,r=e.state,o=e.dispatch,i=as(t,r.schema),s=n.selection.$anchor,a=s.depth;a>0;a-=1)if(s.node(a).type===i){if(o){var c=s.before(a),l=s.after(a);n.delete(c,l).scrollIntoView()}return!0}return!1}},ls=function(t){return function(e){var n=e.tr,r=e.dispatch,o=t.from,i=t.to;return r&&n.delete(o,i),!0}},us=function(){return function(t){var e=t.state,n=t.dispatch;return Je(e,n)}},ds=function(){return function(t){return t.commands.keyboardShortcut("Enter")}},fs=function(){return function(t){var e=t.state,n=t.dispatch;return cn(e,n)}};function hs(t){return"[object RegExp]"===Object.prototype.toString.call(t)}function ps(t,e,n){void 0===n&&(n={strict:!0});var r=Object.keys(e);return!r.length||r.every(function(r){return n.strict?e[r]===t[r]:hs(e[r])?e[r].test(t[r]):e[r]===t[r]})}function ms(t,e,n){return void 0===n&&(n={}),t.find(function(t){return t.type===e&&ps(Object.fromEntries(Object.keys(n).map(function(e){return[e,t.attrs[e]]})),n)})}function vs(t,e,n){return void 0===n&&(n={}),!!ms(t,e,n)}function gs(t,e,n){var r;if(t&&e){var o=t.parent.childAfter(t.parentOffset);if(o.node&&o.node.marks.some(function(t){return t.type===e})||(o=t.parent.childBefore(t.parentOffset)),o.node&&o.node.marks.some(function(t){return t.type===e})&&(n=n||(null==(r=o.node.marks[0])?void 0:r.attrs),ms([].concat(o.node.marks),e,n))){for(var i=o.index,s=t.start()+o.offset,a=i+1,c=s+o.node.nodeSize;i>0&&vs([].concat(t.parent.child(i-1).marks),e,n);)i-=1,s-=t.parent.child(i).nodeSize;for(;a<t.parent.childCount&&vs([].concat(t.parent.child(a).marks),e,n);)c+=t.parent.child(a).nodeSize,a+=1;return{from:s,to:c}}}}function ys(t,e){if("string"==typeof t){if(!e.marks[t])throw Error("There is no mark type named '"+t+"'. Maybe you forgot to add the extension?");return e.marks[t]}return t}var ks=function(t,e){return void 0===e&&(e={}),function(n){var r=n.tr,o=n.state,i=n.dispatch,s=ys(t,o.schema),a=r.doc,c=r.selection,l=c.$from,u=c.from,d=c.to;if(i){var f=gs(l,s,e);if(f&&f.from<=u&&f.to>=d){var h=Ee.create(a,f.from,f.to);r.setSelection(h)}}return!0}},bs=function(t){return function(e){for(var n="function"==typeof t?t(e):t,r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1}};function ws(t){return t instanceof Ee}function xs(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),Math.min(Math.max(t,e),n)}function Ss(t,e){if(void 0===e&&(e=null),!e)return null;var n=Me.atStart(t),r=Me.atEnd(t);if("start"===e||!0===e)return n;if("end"===e)return r;var o=n.from,i=r.to;return"all"===e?Ee.create(t,xs(0,o,i),xs(t.content.size,o,i)):Ee.create(t,xs(e,o,i),xs(e,o,i))}function Cs(){return"Android"===navigator.platform||/android/i.test(navigator.userAgent)}function Ms(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}var Ts=function(t,e){return void 0===t&&(t=null),void 0===e&&(e={}),function(n){var r=n.editor,o=n.view,i=n.tr,s=n.dispatch;e=y({scrollIntoView:!0},e);var a=function(){(Ms()||Cs())&&o.dom.focus(),"undefined"==typeof navigator||!/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||Ms()||Cs()||o.dom.focus({preventScroll:!0}),requestAnimationFrame(function(){r.isDestroyed||(o.focus(),(null==e?void 0:e.scrollIntoView)&&r.commands.scrollIntoView())})};if(o.hasFocus()&&null===t||!1===t)return!0;if(s&&null===t&&!ws(r.state.selection))return a(),!0;var c=Ss(i.doc,t)||r.state.selection,l=r.state.selection.eq(c);return s&&(l||i.setSelection(c),l&&i.storedMarks&&i.setStoredMarks(i.storedMarks),a()),!0}},As=function(t,e){return function(n){return t.every(function(t,r){return e(t,y({},n,{index:r}))})}},Os=function(t,e){return function(n){var r=n.tr;return n.commands.insertContentAt({from:r.selection.from,to:r.selection.to},t,e)}},Es=function(t){for(var e=t.childNodes,n=e.length-1;n>=0;n-=1){var r=e[n];3===r.nodeType&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):1===r.nodeType&&Es(r)}return t};function Ns(t){if("undefined"==typeof window)throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");var e="<body>"+t+"</body>",n=(new window.DOMParser).parseFromString(e,"text/html").body;return Es(n)}function Rs(t,e,n){if(t instanceof Q||t instanceof A)return t;n=y({slice:!0,parseOptions:{}},n);var r="string"==typeof t;if("object"==typeof t&&null!==t)try{if(Array.isArray(t)&&t.length>0)return A.fromArray(t.map(function(t){return e.nodeFromJSON(t)}));var o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(r){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:r});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",r),Rs("",e,n)}if(r){if(n.errorOnInvalidContent){var i=!1,s="",a=new gt({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:function(t){return i=!0,s="string"==typeof t?t:t.outerHTML,null}}]}})});if(n.slice?kt.fromSchema(a).parseSlice(Ns(t),n.parseOptions):kt.fromSchema(a).parse(Ns(t),n.parseOptions),n.errorOnInvalidContent&&i)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error("Invalid element found: "+s)})}var c=kt.fromSchema(e);return n.slice?c.parseSlice(Ns(t),n.parseOptions).content:c.parse(Ns(t),n.parseOptions)}return Rs("",e,n)}var Ds=function(t,e,n){return function(r){var o,i=r.tr,s=r.dispatch,a=r.editor;if(s){var c;n=y({parseOptions:a.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1},n);var l=function(t){a.emit("contentError",{editor:a,error:t,disableCollaboration:function(){"collaboration"in a.storage&&"object"==typeof a.storage.collaboration&&a.storage.collaboration&&(a.storage.collaboration.isDisabled=!0)}})},u=y({preserveWhitespace:"full"},n.parseOptions);if(!n.errorOnInvalidContent&&!a.options.enableContentCheck&&a.options.emitContentError)try{Rs(e,a.schema,{parseOptions:u,errorOnInvalidContent:!0})}catch(t){l(t)}try{c=Rs(e,a.schema,{parseOptions:u,errorOnInvalidContent:null!=(o=n.errorOnInvalidContent)?o:a.options.enableContentCheck})}catch(t){return l(t),!1}var d,f="number"==typeof t?{from:t,to:t}:{from:t.from,to:t.to},h=f.from,p=f.to,m=!0,v=!0;if(("type"in c?[c]:c).forEach(function(t){t.check(),m=!!m&&t.isText&&0===t.marks.length,v=!!v&&t.isBlock}),h===p&&v){var g=i.doc.resolve(h).parent;g.isTextblock&&!g.type.spec.code&&!g.childCount&&(h-=1,p+=1)}if(m){if(Array.isArray(e))d=e.map(function(t){return t.text||""}).join("");else if(e instanceof A){var k="";e.forEach(function(t){t.text&&(k+=t.text)}),d=k}else d="object"==typeof e&&e&&e.text?e.text:e;i.insertText(d,h,p)}else{d=c;var b=i.doc.resolve(h),w=b.node(),x=0===b.parentOffset,S=w.isText||w.isTextblock,C=w.content.size>0;x&&S&&C&&(h=Math.max(0,h-1)),i.replaceWith(h,p,d)}n.updateSelection&&function(t,e){var n=t.steps.length-1;if(!(n<e)){var r=t.steps[n];if(r instanceof Jt||r instanceof Gt){var o=t.mapping.maps[n],i=0;o.forEach(function(t,e,n,r){0===i&&(i=r)}),t.setSelection(Me.near(t.doc.resolve(i),-1))}}}(i,i.steps.length-1),n.applyInputRules&&i.setMeta("applyInputRules",{from:h,text:d}),n.applyPasteRules&&i.setMeta("applyPasteRules",{from:h,text:d})}return!0}},Is=function(){return function(t){return function(t,e){var n,r=t.selection,o=r instanceof Re;if(o){if(r.node.isTextblock||!ie(t.doc,r.from))return!1;n=r.from}else if(null==(n=ae(t.doc,r.from,-1)))return!1;if(e){var i=t.tr.join(n);o&&i.setSelection(Re.create(i.doc,n-t.doc.resolve(n).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0}(t.state,t.dispatch)}},Ls=function(){return function(t){return function(t,e){var n,r=t.selection;if(r instanceof Re){if(r.node.isTextblock||!ie(t.doc,r.to))return!1;n=r.to}else if(null==(n=ae(t.doc,r.to,1)))return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0}(t.state,t.dispatch)}},Ps=function(){return function(t){var e=t.state,n=t.dispatch;return Ze(e,n)}},zs=function(){return function(t){var e=t.state,n=t.dispatch;return nn(e,n)}},Bs=function(){return function(t){var e=t.state,n=t.dispatch,r=t.tr;try{var o=ae(e.doc,e.selection.$from.pos,-1);return null!=o&&(r.join(o,2),n&&n(r),!0)}catch(t){return!1}}},$s=function(){return function(t){var e=t.state,n=t.dispatch,r=t.tr;try{var o=ae(e.doc,e.selection.$from.pos,1);return null!=o&&(r.join(o,2),n&&n(r),!0)}catch(t){return!1}}},Hs=function(){return function(t){return function(t,e){var n=Ge(t,void 0);if(!n)return!1;var r=tn(n);return!!r&&Qe(t,r,e)}(t.state,t.dispatch)}},_s=function(){return function(t){return function(t,e){var n=en(t,void 0);if(!n)return!1;var r=on(n);return!!r&&Qe(t,r,e)}(t.state,t.dispatch)}};function js(){return"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)}var Fs=function(t){return function(e){var n=e.editor,r=e.view,o=e.tr,i=e.dispatch,s=function(t){var e,n,r,o,i=t.split(/-(?!$)/),s=i[i.length-1];"Space"===s&&(s=" ");for(var a=0;a<i.length-1;a+=1){var c=i[a];if(/^(cmd|meta|m)$/i.test(c))o=!0;else if(/^a(lt)?$/i.test(c))e=!0;else if(/^(c|ctrl|control)$/i.test(c))n=!0;else if(/^s(hift)?$/i.test(c))r=!0;else{if(!/^mod$/i.test(c))throw new Error("Unrecognized modifier name: "+c);Ms()||js()?o=!0:n=!0}}return e&&(s="Alt-"+s),n&&(s="Ctrl-"+s),o&&(s="Meta-"+s),r&&(s="Shift-"+s),s}(t).split(/-(?!$)/),a=s.find(function(t){return!["Alt","Ctrl","Meta","Shift"].includes(t)}),c=new KeyboardEvent("keydown",{key:"Space"===a?" ":a,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),l=n.captureTransaction(function(){r.someProp("handleKeyDown",function(t){return t(r,c)})});return null==l||l.steps.forEach(function(t){var e=t.map(o.mapping);e&&i&&o.maybeStep(e)}),!0}};function Vs(t,e,n){void 0===n&&(n={});var r=t.selection,o=r.from,i=r.to,s=r.empty,a=e?as(e,t.schema):null,c=[];t.doc.nodesBetween(o,i,function(t,e){if(!t.isText){var n=Math.max(o,e),r=Math.min(i,e+t.nodeSize);c.push({node:t,from:n,to:r})}});var l=i-o,u=c.filter(function(t){return!a||a.name===t.node.type.name}).filter(function(t){return ps(t.node.attrs,n,{strict:!1})});return s?!!u.length:u.reduce(function(t,e){return t+e.to-e.from},0)>=l}var Ws=function(t,e){return void 0===e&&(e={}),function(n){var r=n.state,o=n.dispatch;return!!Vs(r,as(t,r.schema),e)&&function(t,e){var n=t.selection,r=n.$from,o=n.$to,i=r.blockRange(o),s=i&&Yt(i);return null!=s&&(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)}(r,o)}},qs=function(){return function(t){var e=t.state,n=t.dispatch;return un(e,n)}},Ks=function(t){return function(e){var n,r=e.state,o=e.dispatch;return(n=as(t,r.schema),function(t,e){var r=t.selection,o=r.$from,i=r.$to,s=o.blockRange(i,function(t){return t.childCount>0&&t.firstChild.type==n});return!!s&&(!e||(o.node(s.depth-1).type==n?function(t,e,n,r){var o=t.tr,i=r.end,s=r.$to.end(r.depth);i<s&&(o.step(new Gt(i-1,s,i,s,new I(A.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new G(o.doc.resolve(r.$from.pos),o.doc.resolve(s),r.depth));var a=Yt(r);if(null==a)return!1;o.lift(r,a);var c=o.doc.resolve(o.mapping.map(i,-1)-1);return ie(o.doc,c.pos)&&c.nodeBefore.type==c.nodeAfter.type&&o.join(c.pos),e(o.scrollIntoView()),!0}(t,e,n,s):function(t,e,n){for(var r=t.tr,o=n.parent,i=n.end,s=n.endIndex-1,a=n.startIndex;s>a;s--)i-=o.child(s).nodeSize,r.delete(i-1,i+1);var c=r.doc.resolve(n.start),l=c.nodeAfter;if(r.mapping.map(n.end)!=n.start+c.nodeAfter.nodeSize)return!1;var u=0==n.startIndex,d=n.endIndex==o.childCount,f=c.node(-1),h=c.index(-1);if(!f.canReplace(h+(u?0:1),h+1,l.content.append(d?A.empty:A.from(o))))return!1;var p=c.pos,m=p+l.nodeSize;return r.step(new Gt(p-(u?1:0),m+(d?1:0),p+1,m-1,new I((u?A.empty:A.from(o.copy(A.empty))).append(d?A.empty:A.from(o.copy(A.empty))),u?0:1,d?0:1),u?0:1)),e(r.scrollIntoView()),!0}(t,e,s)))})(r,o)}},Us=function(){return function(t){var e=t.state,n=t.dispatch;return sn(e,n)}};function Js(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function Gs(t,e){var n="string"==typeof e?[e]:e;return Object.keys(t).reduce(function(e,r){return n.includes(r)||(e[r]=t[r]),e},{})}var Zs=function(t,e){return function(n){var r=n.tr,o=n.state,i=n.dispatch,s=null,a=null,c=Js("string"==typeof t?t:t.name,o.schema);if(!c)return!1;"node"===c&&(s=as(t,o.schema)),"mark"===c&&(a=ys(t,o.schema));var l=!1;return r.selection.ranges.forEach(function(t){o.doc.nodesBetween(t.$from.pos,t.$to.pos,function(t,n){s&&s===t.type&&(l=!0,i&&r.setNodeMarkup(n,void 0,Gs(t.attrs,e))),a&&t.marks.length&&t.marks.forEach(function(o){a===o.type&&(l=!0,i&&r.addMark(n,n+t.nodeSize,a.create(Gs(o.attrs,e))))})})}),l}},Qs=function(){return function(t){var e=t.tr;return t.dispatch&&e.scrollIntoView(),!0}},Xs=function(){return function(t){var e=t.tr;if(t.dispatch){var n=new Ie(e.doc);e.setSelection(n)}return!0}},Ys=function(){return function(t){var e=t.state,n=t.dispatch;return Ye(e,n)}},ta=function(){return function(t){var e=t.state,n=t.dispatch;return rn(e,n)}},ea=function(){return function(t){return e=t.state,n=t.dispatch,o=e.selection,i=o.$from,s=o.to,0!=(a=i.sharedDepth(s))&&(r=i.before(a),n&&n(e.tr.setSelection(Re.create(e.doc,r))),!0);var e,n,r,o,i,s,a}},na=function(){return function(t){var e=t.state,n=t.dispatch;return pn(e,n)}},ra=function(){return function(t){var e=t.state,n=t.dispatch;return hn(e,n)}};function oa(t,e,n,r){return void 0===n&&(n={}),void 0===r&&(r={}),Rs(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}var ia=function(t,e){var n=void 0===e?{}:e,r=n.errorOnInvalidContent,o=n.emitUpdate,i=void 0===o||o,s=n.parseOptions,a=void 0===s?{}:s;return function(e){var n=e.editor,o=e.tr,s=e.dispatch,c=e.commands,l=o.doc;if("full"!==a.preserveWhitespace){var u=oa(t,n.schema,a,{errorOnInvalidContent:null!=r?r:n.options.enableContentCheck});return s&&o.replaceWith(0,l.content.size,u).setMeta("preventUpdate",!i),!0}return s&&o.setMeta("preventUpdate",!i),c.insertContentAt({from:0,to:l.content.size},t,{parseOptions:a,errorOnInvalidContent:null!=r?r:n.options.enableContentCheck})}};function sa(t,e){var n=ys(e,t.schema),r=t.selection,o=r.from,i=r.to,s=r.empty,a=[];s?(t.storedMarks&&a.push.apply(a,t.storedMarks),a.push.apply(a,t.selection.$head.marks())):t.doc.nodesBetween(o,i,function(t){a.push.apply(a,t.marks)});var c=a.find(function(t){return t.type.name===n.name});return c?y({},c.attrs):{}}function aa(t,e){var n=new Se(t);return e.forEach(function(t){t.steps.forEach(function(t){n.step(t)})}),n}function ca(t,e){for(var n=t.depth;n>0;n-=1){var r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function la(t){return function(e){return ca(e.$from,t)}}function ua(t,e,n){return void 0===t.config[e]&&t.parent?ua(t.parent,e,n):"function"==typeof t.config[e]?t.config[e].bind(y({},n,{parent:t.parent?ua(t.parent,e,n):null})):t.config[e]}function da(t){return t.map(function(t){var e=ua(t,"addExtensions",{name:t.name,options:t.options,storage:t.storage});return e?[t].concat(da(e())):t}).flat(10)}function fa(t,e){var n=Et.fromSchema(e).serializeFragment(t),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(n),r.innerHTML}function ha(t){return"function"==typeof t}function pa(t,e){if(void 0===e&&(e=void 0),ha(t)){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return e?t.bind(e).apply(void 0,r):t.apply(void 0,r)}return t}function ma(t){return{baseExtensions:t.filter(function(t){return"extension"===t.type}),nodeExtensions:t.filter(function(t){return"node"===t.type}),markExtensions:t.filter(function(t){return"mark"===t.type})}}function va(t){var e=[],n=ma(t),r=n.nodeExtensions,o=n.markExtensions,i=[].concat(r,o),s={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(function(t){var n=ua(t,"addGlobalAttributes",{name:t.name,options:t.options,storage:t.storage,extensions:i});n&&n().forEach(function(t){t.types.forEach(function(n){Object.entries(t.attributes).forEach(function(t){var r=t[0],o=t[1];e.push({type:n,name:r,attribute:y({},s,o)})})})})}),i.forEach(function(t){var n={name:t.name,options:t.options,storage:t.storage},r=ua(t,"addAttributes",n);if(r){var o=r();Object.entries(o).forEach(function(n){var r=n[0],o=n[1],i=y({},s,o);"function"==typeof(null==i?void 0:i.default)&&(i.default=i.default()),(null==i?void 0:i.isRequired)&&void 0===(null==i?void 0:i.default)&&delete i.default,e.push({type:t.name,name:r,attribute:i})})}}),e}function ga(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.filter(function(t){return!!t}).reduce(function(t,e){var n=y({},t);return Object.entries(e).forEach(function(t){var e=t[0],r=t[1];if(n[e])if("class"===e){var o=r?String(r).split(" "):[],i=n[e]?n[e].split(" "):[],s=o.filter(function(t){return!i.includes(t)});n[e]=[].concat(i,s).join(" ")}else if("style"===e){var a=r?r.split(";").map(function(t){return t.trim()}).filter(Boolean):[],c=n[e]?n[e].split(";").map(function(t){return t.trim()}).filter(Boolean):[],l=new Map;c.forEach(function(t){var e=t.split(":").map(function(t){return t.trim()}),n=e[0],r=e[1];l.set(n,r)}),a.forEach(function(t){var e=t.split(":").map(function(t){return t.trim()}),n=e[0],r=e[1];l.set(n,r)}),n[e]=Array.from(l.entries()).map(function(t){return t[0]+": "+t[1]}).join("; ")}else n[e]=r;else n[e]=r}),n},{})}function ya(t,e){return e.filter(function(e){return e.type===t.type.name}).filter(function(t){return t.attribute.rendered}).map(function(e){var n;return e.attribute.renderHTML?e.attribute.renderHTML(t.attrs)||{}:((n={})[e.name]=t.attrs[e.name],n)}).reduce(function(t,e){return ga(t,e)},{})}function ka(t,e){return"style"in t?t:y({},t,{getAttrs:function(n){var r=t.getAttrs?t.getAttrs(n):t.attrs;if(!1===r)return!1;var o=e.reduce(function(t,e){var r,o=e.attribute.parseHTML?e.attribute.parseHTML(n):function(t){return"string"!=typeof t?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):"true"===t||"false"!==t&&t}(n.getAttribute(e.name));return null==o?t:y({},t,((r={})[e.name]=o,r))},{});return y({},r,o)}})}function ba(t){return Object.fromEntries(Object.entries(t).filter(function(t){var e=t[0],n=t[1];return("attrs"!==e||!function(t){return void 0===t&&(t={}),0===Object.keys(t).length&&t.constructor===Object}(n))&&null!=n}))}function wa(t){var e,n,r={};return!(null==(e=null==t?void 0:t.attribute)?void 0:e.isRequired)&&"default"in((null==t?void 0:t.attribute)||{})&&(r.default=t.attribute.default),void 0!==(null==(n=null==t?void 0:t.attribute)?void 0:n.validate)&&(r.validate=t.attribute.validate),[t.name,r]}function xa(t,e){var n,r=va(t),o=ma(t),i=o.nodeExtensions,s=o.markExtensions,a=null==(n=i.find(function(t){return ua(t,"topNode")}))?void 0:n.name,c=Object.fromEntries(i.map(function(n){var o=r.filter(function(t){return t.type===n.name}),i={name:n.name,options:n.options,storage:n.storage,editor:e},s=t.reduce(function(t,e){var r=ua(e,"extendNodeSchema",i);return y({},t,r?r(n):{})},{}),a=ba(y({},s,{content:pa(ua(n,"content",i)),marks:pa(ua(n,"marks",i)),group:pa(ua(n,"group",i)),inline:pa(ua(n,"inline",i)),atom:pa(ua(n,"atom",i)),selectable:pa(ua(n,"selectable",i)),draggable:pa(ua(n,"draggable",i)),code:pa(ua(n,"code",i)),whitespace:pa(ua(n,"whitespace",i)),linebreakReplacement:pa(ua(n,"linebreakReplacement",i)),defining:pa(ua(n,"defining",i)),isolating:pa(ua(n,"isolating",i)),attrs:Object.fromEntries(o.map(wa))})),c=pa(ua(n,"parseHTML",i));c&&(a.parseDOM=c.map(function(t){return ka(t,o)}));var l=ua(n,"renderHTML",i);l&&(a.toDOM=function(t){return l({node:t,HTMLAttributes:ya(t,o)})});var u=ua(n,"renderText",i);return u&&(a.toText=u),[n.name,a]})),l=Object.fromEntries(s.map(function(n){var o=r.filter(function(t){return t.type===n.name}),i={name:n.name,options:n.options,storage:n.storage,editor:e},s=t.reduce(function(t,e){var r=ua(e,"extendMarkSchema",i);return y({},t,r?r(n):{})},{}),a=ba(y({},s,{inclusive:pa(ua(n,"inclusive",i)),excludes:pa(ua(n,"excludes",i)),group:pa(ua(n,"group",i)),spanning:pa(ua(n,"spanning",i)),code:pa(ua(n,"code",i)),attrs:Object.fromEntries(o.map(wa))})),c=pa(ua(n,"parseHTML",i));c&&(a.parseDOM=c.map(function(t){return ka(t,o)}));var l=ua(n,"renderHTML",i);return l&&(a.toDOM=function(t){return l({mark:t,HTMLAttributes:ya(t,o)})}),[n.name,a]}));return new gt({topNode:a,nodes:c,marks:l})}function Sa(t){return t.sort(function(t,e){var n=ua(t,"priority")||100,r=ua(e,"priority")||100;return n>r?-1:n<r?1:0})}function Ca(t){var e,n,r=Sa(da(t)),o=(n=(e=r.map(function(t){return t.name})).filter(function(t,n){return e.indexOf(t)!==n}),Array.from(new Set(n)));return o.length&&console.warn("[tiptap warn]: Duplicate extension names found: ["+o.map(function(t){return"'"+t+"'"}).join(", ")+"]. This can lead to issues."),r}function Ma(t,e,n){var r=e.from,o=e.to,i=n||{},s=i.blockSeparator,a=void 0===s?"\n\n":s,c=i.textSerializers,l=void 0===c?{}:c,u="";return t.nodesBetween(r,o,function(t,n,i,s){var c;t.isBlock&&n>r&&(u+=a);var d=null==l?void 0:l[t.type.name];if(d)return i&&(u+=d({node:t,pos:n,parent:i,index:s,range:e})),!1;t.isText&&(u+=null==(c=null==t?void 0:t.text)?void 0:c.slice(Math.max(r,n)-n,o-n))}),u}function Ta(t){return Object.fromEntries(Object.entries(t.nodes).filter(function(t){return t[1].spec.toText}).map(function(t){return[t[0],t[1].spec.toText]}))}function Aa(t,e){var n=Js("string"==typeof e?e:e.name,t.schema);return"node"===n?function(t,e){var n=as(e,t.schema),r=t.selection,o=r.from,i=r.to,s=[];t.doc.nodesBetween(o,i,function(t){s.push(t)});var a=s.reverse().find(function(t){return t.type.name===n.name});return a?y({},a.attrs):{}}(t,e):"mark"===n?sa(t,e):{}}function Oa(t){var e=t.mapping,n=t.steps,r=[];return e.maps.forEach(function(t,o){var i=[];if(t.ranges.length)t.forEach(function(t,e){i.push({from:t,to:e})});else{var s=n[o],a=s.from,c=s.to;if(void 0===a||void 0===c)return;i.push({from:a,to:c})}i.forEach(function(t){var n=t.from,i=t.to,s=e.slice(o).map(n,-1),a=e.slice(o).map(i),c=e.invert().map(s,-1),l=e.invert().map(a);r.push({oldRange:{from:c,to:l},newRange:{from:s,to:a}})})}),function(t){var e=function(t,e){void 0===e&&(e=JSON.stringify);var n={};return t.filter(function(t){var r=e(t);return!Object.prototype.hasOwnProperty.call(n,r)&&(n[r]=!0)})}(t);return 1===e.length?e:e.filter(function(t,n){var r=e.filter(function(t,e){return e!==n});return!r.some(function(e){return t.oldRange.from>=e.oldRange.from&&t.oldRange.to<=e.oldRange.to&&t.newRange.from>=e.newRange.from&&t.newRange.to<=e.newRange.to})})}(r)}function Ea(t,e,n){var r=[];return t===e?n.resolve(t).marks().forEach(function(e){var o=gs(n.resolve(t),e.type);o&&r.push(y({mark:e},o))}):n.nodesBetween(t,e,function(t,e){t&&void 0!==(null==t?void 0:t.nodeSize)&&r.push.apply(r,t.marks.map(function(n){return{from:e,to:e+t.nodeSize,mark:n}}))}),r}function Na(t,e){return e.nodes[t]||e.marks[t]||null}function Ra(t,e,n){return Object.fromEntries(Object.entries(n).filter(function(n){var r=n[0],o=t.find(function(t){return t.type===e&&t.name===r});return!!o&&o.attribute.keepOnSplit}))}function Da(t,e,n){void 0===n&&(n={});var r=t.selection,o=r.empty,i=r.ranges,s=e?ys(e,t.schema):null;if(o)return!!(t.storedMarks||t.selection.$from.marks()).filter(function(t){return!s||s.name===t.type.name}).find(function(t){return ps(t.attrs,n,{strict:!1})});var a=0,c=[];if(i.forEach(function(e){var n=e.$from,r=e.$to,o=n.pos,i=r.pos;t.doc.nodesBetween(o,i,function(t,e){if(t.isText||t.marks.length){var n=Math.max(o,e),r=Math.min(i,e+t.nodeSize);a+=r-n,c.push.apply(c,t.marks.map(function(t){return{mark:t,from:n,to:r}}))}})}),0===a)return!1;var l=c.filter(function(t){return!s||s.name===t.mark.type.name}).filter(function(t){return ps(t.mark.attrs,n,{strict:!1})}).reduce(function(t,e){return t+e.to-e.from},0),u=c.filter(function(t){return!s||t.mark.type!==s&&t.mark.type.excludes(s)}).reduce(function(t,e){return t+e.to-e.from},0);return(l>0?l+u:l)>=a}function Ia(t,e){return Array.isArray(e)?e.some(function(e){return("string"==typeof e?e:e.name)===t.name}):e}function La(t,e){var n=ma(e).nodeExtensions.find(function(e){return e.name===t});if(!n)return!1;var r=pa(ua(n,"group",{name:n.name,options:n.options,storage:n.storage}));return"string"==typeof r&&r.split(" ").includes("list")}function Pa(t,e){var n,r=void 0===e?{}:e,o=r.checkChildren,i=void 0===o||o,s=r.ignoreWhitespace,a=void 0!==s&&s;if(a){if("hardBreak"===t.type.name)return!0;if(t.isText)return/^\s*$/m.test(null!=(n=t.text)?n:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(0===t.content.childCount)return!0;if(i){var c=!0;return t.content.forEach(function(t){!1!==c&&(Pa(t,{ignoreWhitespace:a,checkChildren:i})||(c=!1))}),c}return!1}function za(t){return t instanceof Re}var Ba=function(){function t(t){this.position=t}return t.fromJSON=function(e){return new t(e.position)},t.prototype.toJSON=function(){return{position:this.position}},t}();function $a(t,e){var n=e.mapping.mapResult(t.position);return{position:new Ba(n.pos),mapResult:n}}function Ha(t){return new Ba(t)}var _a=function(t,e){return void 0===e&&(e={}),function(n){var r=n.tr,o=n.state,i=n.dispatch,s=r.selection,a=s.empty,c=s.ranges,l=ys(t,o.schema);if(i)if(a){var u=sa(o,l);r.addStoredMark(l.create(y({},u,e)))}else c.forEach(function(t){var n=t.$from.pos,i=t.$to.pos;o.doc.nodesBetween(n,i,function(t,o){var s=Math.max(o,n),a=Math.min(o+t.nodeSize,i);t.marks.find(function(t){return t.type===l})?t.marks.forEach(function(t){l===t.type&&r.addMark(s,a,l.create(y({},t.attrs,e)))}):r.addMark(s,a,l.create(e))})});return function(t,e,n){var r,o=e.selection,i=null;if(ws(o)&&(i=o.$cursor),i){var s=null!=(r=t.storedMarks)?r:i.marks();return i.parent.type.allowsMarkType(n)&&(!!n.isInSet(s)||!s.some(function(t){return t.type.excludes(n)}))}return o.ranges.some(function(e){var r=e.$from,o=e.$to,i=0===r.depth&&t.doc.inlineContent&&t.doc.type.allowsMarkType(n);return t.doc.nodesBetween(r.pos,o.pos,function(t,e,r){if(i)return!1;if(t.isInline){var o=!r||r.type.allowsMarkType(n),s=!!n.isInSet(t.marks)||!t.marks.some(function(t){return t.type.excludes(n)});i=o&&s}return!i}),i})}(o,r,l)}},ja=function(t,e){return function(n){return n.tr.setMeta(t,e),!0}},Fa=function(t,e){return void 0===e&&(e={}),function(n){var r,o=n.state,i=n.dispatch,s=n.chain,a=as(t,o.schema);return o.selection.$anchor.sameParent(o.selection.$head)&&(r=o.selection.$anchor.parent.attrs),a.isTextblock?s().command(function(t){var n=t.commands;return!!mn(a,y({},r,e))(o)||n.clearNodes()}).command(function(t){var n=t.state;return mn(a,y({},r,e))(n,i)}).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)}},Va=function(t){return function(e){var n=e.tr;if(e.dispatch){var r=n.doc,o=xs(t,0,r.content.size),i=Re.create(r,o);n.setSelection(i)}return!0}},Wa=function(t,e){return function(n){var r,o,i=n.tr,s=n.state,a=n.dispatch,c=s.selection;return"number"==typeof e?(r=e,o=e):e&&"from"in e&&"to"in e?(r=e.from,o=e.to):(r=c.from,o=c.to),a&&i.doc.nodesBetween(r,o,function(e,n){e.isText||i.setNodeMarkup(n,void 0,y({},e.attrs,{dir:t}))}),!0}},qa=function(t){return function(e){var n=e.tr;if(e.dispatch){var r=n.doc,o="number"==typeof t?{from:t,to:t}:t,i=o.from,s=o.to,a=Ee.atStart(r).from,c=Ee.atEnd(r).to,l=xs(i,a,c),u=xs(s,a,c),d=Ee.create(r,l,u);n.setSelection(d)}return!0}},Ka=function(t){return function(e){var n,r=e.state,o=e.dispatch,i=as(t,r.schema);return(n=i,function(t,e){var r=t.selection,o=r.$from,i=r.$to,s=o.blockRange(i,function(t){return t.childCount>0&&t.firstChild.type==n});if(!s)return!1;var a=s.startIndex;if(0==a)return!1;var c=s.parent,l=c.child(a-1);if(l.type!=n)return!1;if(e){var u=l.lastChild&&l.lastChild.type==c.type,d=A.from(u?n.create():null),f=new I(A.from(n.create(null,A.from(c.type.create(null,d)))),u?3:1,0),h=s.start,p=s.end;e(t.tr.step(new Gt(h-(u?3:1),p,h,p,f,1,!0)).scrollIntoView())}return!0})(r,o)}};function Ua(t,e){var n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){var r=n.filter(function(t){return null==e?void 0:e.includes(t.type.name)});t.tr.ensureMarks(r)}}var Ja=function(t){var e=(void 0===t?{}:t).keepMarks,n=void 0===e||e;return function(t){var e=t.tr,r=t.state,o=t.dispatch,i=t.editor,s=e.selection,a=e.doc,c=s.$from,l=s.$to,u=Ra(i.extensionManager.attributes,c.node().type.name,c.node().attrs);if(s instanceof Re&&s.node.isBlock)return!(!c.parentOffset||!oe(a,c.pos)||(o&&(n&&Ua(r,i.extensionManager.splittableMarks),e.split(c.pos).scrollIntoView()),0));if(!c.parent.isBlock)return!1;var d=l.parentOffset===l.parent.content.size,f=0===c.depth?void 0:function(t){for(var e=0;e<t.edgeCount;e+=1){var n=t.edge(e).type;if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}(c.node(-1).contentMatchAt(c.indexAfter(-1))),h=d&&f?[{type:f,attrs:u}]:void 0,p=oe(e.doc,e.mapping.map(c.pos),1,h);if(h||p||!oe(e.doc,e.mapping.map(c.pos),1,f?[{type:f}]:void 0)||(p=!0,h=f?[{type:f,attrs:u}]:void 0),o){if(p&&(s instanceof Ee&&e.deleteSelection(),e.split(e.mapping.map(c.pos),1,h),f&&!d&&!c.parentOffset&&c.parent.type!==f)){var m=e.mapping.map(c.before()),v=e.doc.resolve(m);c.node(-1).canReplaceWith(v.index(),v.index()+1,f)&&e.setNodeMarkup(e.mapping.map(c.before()),f)}n&&Ua(r,i.extensionManager.splittableMarks),e.scrollIntoView()}return p}},Ga=function(t,e){return void 0===e&&(e={}),function(n){var r,o=n.tr,i=n.state,s=n.dispatch,a=n.editor,c=as(t,i.schema),l=i.selection,u=l.$from,d=l.$to,f=i.selection.node;if(f&&f.isBlock||u.depth<2||!u.sameParent(d))return!1;var h=u.node(-1);if(h.type!==c)return!1;var p=a.extensionManager.attributes;if(0===u.parent.content.size&&u.node(-1).childCount===u.indexAfter(-1)){if(2===u.depth||u.node(-3).type!==c||u.index(-2)!==u.node(-2).childCount-1)return!1;if(s){for(var m=A.empty,v=u.index(-1)?1:u.index(-2)?2:3,g=u.depth-v;g>=u.depth-3;g-=1)m=A.from(u.node(g).copy(m));var k=u.indexAfter(-1)<u.node(-2).childCount?1:u.indexAfter(-2)<u.node(-3).childCount?2:3,b=y({},Ra(p,u.node().type.name,u.node().attrs),e),w=(null==(r=c.contentMatch.defaultType)?void 0:r.createAndFill(b))||void 0;m=m.append(A.from(c.createAndFill(null,w)||void 0));var x=u.before(u.depth-(v-1));o.replace(x,u.after(-k),new I(m,4-v,0));var S=-1;o.doc.nodesBetween(x,o.doc.content.size,function(t,e){if(S>-1)return!1;t.isTextblock&&0===t.content.size&&(S=e+1)}),S>-1&&o.setSelection(Ee.near(o.doc.resolve(S))),o.scrollIntoView()}return!0}var C=d.pos===u.end()?h.contentMatchAt(0).defaultType:null,M=y({},Ra(p,h.type.name,h.attrs),e),T=y({},Ra(p,u.node().type.name,u.node().attrs),e);o.delete(u.pos,d.pos);var O=C?[{type:c,attrs:M},{type:C,attrs:T}]:[{type:c,attrs:M}];if(!oe(o.doc,u.pos,2))return!1;if(s){var E=i.selection,N=i.storedMarks,R=a.extensionManager.splittableMarks,D=N||E.$to.parentOffset&&E.$from.marks();if(o.split(u.pos,2,O).scrollIntoView(),!D||!s)return!0;var L=D.filter(function(t){return R.includes(t.type.name)});o.ensureMarks(L)}return!0}},Za=function(t,e){var n=la(function(t){return t.type===e})(t.selection);if(!n)return!0;var r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===r)return!0;var o=t.doc.nodeAt(r);return n.node.type!==(null==o?void 0:o.type)||!ie(t.doc,n.pos)||(t.join(n.pos),!0)},Qa=function(t,e){var n=la(function(t){return t.type===e})(t.selection);if(!n)return!0;var r=t.doc.resolve(n.start).after(n.depth);if(void 0===r)return!0;var o=t.doc.nodeAt(r);return n.node.type!==(null==o?void 0:o.type)||!ie(t.doc,r)||(t.join(r),!0)},Xa=function(t,e,n,r){return void 0===r&&(r={}),function(o){var i=o.editor,s=o.tr,a=o.state,c=o.dispatch,l=o.chain,u=o.commands,d=o.can,f=i.extensionManager,h=f.extensions,p=f.splittableMarks,m=as(t,a.schema),v=as(e,a.schema),g=a.selection,y=a.storedMarks,k=g.$from,b=g.$to,w=k.blockRange(b),x=y||g.$to.parentOffset&&g.$from.marks();if(!w)return!1;var S=la(function(t){return La(t.type.name,h)})(g);if(w.depth>=1&&S&&w.depth-S.depth<=1){if(S.node.type===m)return u.liftListItem(v);if(La(S.node.type.name,h)&&m.validContent(S.node.content)&&c)return l().command(function(){return s.setNodeMarkup(S.pos,m),!0}).command(function(){return Za(s,m)}).command(function(){return Qa(s,m)}).run()}return n&&x&&c?l().command(function(){var t=d().wrapInList(m,r),e=x.filter(function(t){return p.includes(t.type.name)});return s.ensureMarks(e),!!t||u.clearNodes()}).wrapInList(m,r).command(function(){return Za(s,m)}).command(function(){return Qa(s,m)}).run():l().command(function(){return!!d().wrapInList(m,r)||u.clearNodes()}).wrapInList(m,r).command(function(){return Za(s,m)}).command(function(){return Qa(s,m)}).run()}},Ya=function(t,e,n){return void 0===e&&(e={}),void 0===n&&(n={}),function(r){var o=r.state,i=r.commands,s=n.extendEmptyMarkRange,a=void 0!==s&&s,c=ys(t,o.schema);return Da(o,c,e)?i.unsetMark(c,{extendEmptyMarkRange:a}):i.setMark(c,e)}},tc=function(t,e,n){return void 0===n&&(n={}),function(r){var o,i=r.state,s=r.commands,a=as(t,i.schema),c=as(e,i.schema),l=Vs(i,a,n);return i.selection.$anchor.sameParent(i.selection.$head)&&(o=i.selection.$anchor.parent.attrs),l?s.setNode(c,o):s.setNode(a,y({},o,n))}},ec=function(t,e){return void 0===e&&(e={}),function(n){var r=n.state,o=n.commands,i=as(t,r.schema);return Vs(r,i,e)?o.lift(i):o.wrapIn(i,e)}},nc=function(){return function(t){for(var e=t.state,n=t.dispatch,r=e.plugins,o=0;o<r.length;o+=1){var i=r[o],s=void 0;if(i.spec.isInputRules&&(s=i.getState(e))){if(n){for(var a=e.tr,c=s.transform,l=c.steps.length-1;l>=0;l-=1)a.step(c.steps[l].invert(c.docs[l]));if(s.text){var u=a.doc.resolve(s.from).marks();a.replaceWith(s.from,s.to,e.schema.text(s.text,u))}else a.delete(s.from,s.to)}return!0}}return!1}},rc=function(){return function(t){var e=t.tr,n=t.dispatch,r=e.selection,o=r.empty,i=r.ranges;return o||n&&i.forEach(function(t){e.removeMark(t.$from.pos,t.$to.pos)}),!0}},oc=function(t,e){return void 0===e&&(e={}),function(n){var r,o=n.tr,i=n.state,s=n.dispatch,a=e.extendEmptyMarkRange,c=void 0!==a&&a,l=o.selection,u=ys(t,i.schema),d=l.$from,f=l.empty,h=l.ranges;if(!s)return!0;if(f&&c){var p=l.from,m=l.to,v=null==(r=d.marks().find(function(t){return t.type===u}))?void 0:r.attrs,g=gs(d,u,v);g&&(p=g.from,m=g.to),o.removeMark(p,m,u)}else h.forEach(function(t){o.removeMark(t.$from.pos,t.$to.pos,u)});return o.removeStoredMark(u),!0}},ic=function(t){return function(e){var n,r,o=e.tr,i=e.state,s=e.dispatch,a=i.selection;return"number"==typeof t?(n=t,r=t):t&&"from"in t&&"to"in t?(n=t.from,r=t.to):(n=a.from,r=a.to),s&&o.doc.nodesBetween(n,r,function(t,e){if(!t.isText){var n=y({},t.attrs);delete n.dir,o.setNodeMarkup(e,void 0,n)}}),!0}},sc=function(t,e){return void 0===e&&(e={}),function(n){var r=n.tr,o=n.state,i=n.dispatch,s=null,a=null,c=Js("string"==typeof t?t:t.name,o.schema);if(!c)return!1;"node"===c&&(s=as(t,o.schema)),"mark"===c&&(a=ys(t,o.schema));var l=!1;return r.selection.ranges.forEach(function(t){var n,c,u,d,f=t.$from.pos,h=t.$to.pos;r.selection.empty?o.doc.nodesBetween(f,h,function(t,e){s&&s===t.type&&(l=!0,u=Math.max(e,f),d=Math.min(e+t.nodeSize,h),n=e,c=t)}):o.doc.nodesBetween(f,h,function(t,o){o<f&&s&&s===t.type&&(l=!0,u=Math.max(o,f),d=Math.min(o+t.nodeSize,h),n=o,c=t),o>=f&&o<=h&&(s&&s===t.type&&(l=!0,i&&r.setNodeMarkup(o,void 0,y({},t.attrs,e))),a&&t.marks.length&&t.marks.forEach(function(n){if(a===n.type&&(l=!0,i)){var s=Math.max(o,f),c=Math.min(o+t.nodeSize,h);r.addMark(s,c,a.create(y({},n.attrs,e)))}}))}),c&&(void 0!==n&&i&&r.setNodeMarkup(n,void 0,y({},c.attrs,e)),a&&c.marks.length&&c.marks.forEach(function(t){a===t.type&&i&&r.addMark(u,d,a.create(y({},t.attrs,e)))}))}),l}},ac=function(t,e){return void 0===e&&(e={}),function(n){var r,o,i=n.state,s=n.dispatch,a=as(t,i.schema);return(r=a,void 0===(o=e)&&(o=null),function(t,e){var n=t.selection,i=n.$from,s=n.$to,a=i.blockRange(s),c=a&&te(a,r,o);return!!c&&(e&&e(t.tr.wrap(a,c).scrollIntoView()),!0)})(i,s)}},cc=function(t,e){return void 0===e&&(e={}),function(n){var r,o,i=n.state,s=n.dispatch;return(r=as(t,i.schema),void 0===(o=e)&&(o=null),function(t,e){var n=t.selection,i=n.$from,s=n.$to,a=i.blockRange(s);if(!a)return!1;var c=e?t.tr:null;return!!function(t,e,n,r){void 0===r&&(r=null);var o=!1,i=e,s=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&0==e.startIndex){if(0==e.$from.index(e.depth-1))return!1;var a=s.resolve(e.start-2);i=new G(a,a,e.depth),e.endIndex<e.parent.childCount&&(e=new G(e.$from,s.resolve(e.$to.end(e.depth)),e.depth)),o=!0}var c=te(i,n,r,e);return!!c&&(t&&function(t,e,n,r,o){for(var i=A.empty,s=n.length-1;s>=0;s--)i=A.from(n[s].type.create(n[s].attrs,i));t.step(new Gt(e.start-(r?2:0),e.end,e.start,e.end,new I(i,0,0),n.length,!0));for(var a=0,c=0;c<n.length;c++)n[c].type==o&&(a=c+1);for(var l=n.length-a,u=e.start+n.length-(r?2:0),d=e.parent,f=e.startIndex,h=e.endIndex,p=!0;f<h;f++,p=!1)!p&&oe(t.doc,u,l)&&(t.split(u,l),u+=2*l),u+=d.child(f).nodeSize}(t,e,c,o,n),!0)}(c,a,r,o)&&(e&&e(c.scrollIntoView()),!0)})(i,s)}},lc=function(){function t(){this.callbacks={}}var e=t.prototype;return e.on=function(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this},e.emit=function(t){for(var e=this,n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];var i=this.callbacks[t];return i&&i.forEach(function(t){return t.apply(e,r)}),this},e.off=function(t,e){var n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(function(t){return t!==e}):delete this.callbacks[t]),this},e.once=function(t,e){var n=this,r=function(){n.off(t,r);for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];e.apply(n,i)};return this.on(t,r)},e.removeAllListeners=function(){this.callbacks={}},t}(),uc=function(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=null==(e=t.undoable)||e};function dc(t){var e,n=t.editor,r=t.from,o=t.to,i=t.text,s=t.rules,a=t.plugin,c=n.view;if(c.composing)return!1;var l=c.state.doc.resolve(r);if(l.parent.type.spec.code||(null==(e=l.nodeBefore||l.nodeAfter)?void 0:e.marks.find(function(t){return t.type.spec.code})))return!1;var u=!1,d=function(t,e){void 0===e&&(e=500);var n="",r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,function(t,e,o,i){var s,a,c=(null==(a=(s=t.type.spec).toText)?void 0:a.call(s,{node:t,pos:e,parent:o,index:i}))||t.textContent||"%leaf%";n+=t.isAtom&&!t.isText?c:c.slice(0,Math.max(0,r-e))}),n}(l)+i;return s.forEach(function(t){if(!u){var e=function(t,e){if(hs(e))return e.exec(t);var n=e(t);if(!n)return null;var r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r}(d,t.find);if(e){var s=c.state.tr,l=Zi({state:c.state,transaction:s}),f={from:r-(e[0].length-i.length),to:o},h=new Qi({editor:n,state:l}),p=h.commands,m=h.chain,v=h.can;null!==t.handler({state:l,range:f,match:e,commands:p,chain:m,can:v})&&s.steps.length&&(t.undoable&&s.setMeta(a,{transform:s,from:r,to:o,text:i}),c.dispatch(s),u=!0)}}}),u}function fc(t){return"Object"===function(t){return Object.prototype.toString.call(t).slice(8,-1)}(t)&&t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function hc(t,e){var n=y({},t);return fc(t)&&fc(e)&&Object.keys(e).forEach(function(r){fc(e[r])&&fc(t[r])?n[r]=hc(t[r],e[r]):n[r]=e[r]}),n}var pc=function(){function t(t){void 0===t&&(t={}),this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config=y({},this.config,t),this.name=this.config.name}var e=t.prototype;return e.configure=function(t){var e=this;void 0===t&&(t={});var n=this.extend(y({},this.config,{addOptions:function(){return hc(e.options,t)}}));return n.name=this.name,n.parent=this.parent,n},e.extend=function(t){void 0===t&&(t={});var e=new this.constructor(y({},this.config,t));return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e},g(t,[{key:"options",get:function(){return y({},pa(ua(this,"addOptions",{name:this.name}))||{})}},{key:"storage",get:function(){return y({},pa(ua(this,"addStorage",{name:this.name,options:this.options}))||{})}}])}(),mc=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).type="mark",e}f(e,t),e.create=function(t){return void 0===t&&(t={}),new e("function"==typeof t?t():t)},e.handleExit=function(t){var e=t.editor,n=t.mark,r=e.state.tr,o=e.state.selection.$from;if(o.pos===o.end()){var i=o.marks();if(!i.find(function(t){return(null==t?void 0:t.type.name)===n.name}))return!1;var s=i.find(function(t){return(null==t?void 0:t.type.name)===n.name});return s&&r.removeStoredMark(s),r.insertText(" ",o.pos),e.view.dispatch(r),!0}return!1};var n=e.prototype;return n.configure=function(e){return t.prototype.configure.call(this,e)},n.extend=function(e){var n="function"==typeof e?e():e;return t.prototype.extend.call(this,n)},e}(pc),vc=function(t){this.find=t.find,this.handler=t.handler};var gc=null;function yc(t){var e,n=t.editor,r=t.rules,o=null,i=!1,s=!1,a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null;try{e="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch(t){e=null}var c=function(t){var r=t.state,o=t.from,i=t.to,s=t.rule,c=t.pasteEvt,l=r.tr,u=Zi({state:r,transaction:l});if(function(t){var e=t.editor,n=t.state,r=t.from,o=t.to,i=t.rule,s=t.pasteEvent,a=t.dropEvent,c=new Qi({editor:e,state:n}),l=c.commands,u=c.chain,d=c.can,f=[];return n.doc.nodesBetween(r,o,function(t,e){var c,h,p,m,v;if(!(null==(h=null==(c=t.type)?void 0:c.spec)?void 0:h.code)&&(t.isText||t.isTextblock||t.isInline)){var g=null!=(v=null!=(m=null==(p=t.content)?void 0:p.size)?m:t.nodeSize)?v:0,y=Math.max(r,e),k=Math.min(o,e+g);y>=k||function(t,e,n){if(hs(e))return[].concat(t.matchAll(e));var r=e(t,n);return r?r.map(function(e){var n=[e.text];return n.index=e.index,n.input=t,n.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),n.push(e.replaceWith)),n}):[]}(t.isText?t.text||"":t.textBetween(y-e,k-e,void 0,"￼"),i.find,s).forEach(function(t){if(void 0!==t.index){var e=y+t.index+1,r=e+t[0].length,o={from:n.tr.mapping.map(e),to:n.tr.mapping.map(r)},c=i.handler({state:n,range:o,match:t,commands:l,chain:u,can:d,pasteEvent:s,dropEvent:a});f.push(c)}})}}),f.every(function(t){return null!==t})}({editor:n,state:u,from:Math.max(o-1,0),to:i.b-1,rule:s,pasteEvent:c,dropEvent:e})&&l.steps.length){try{e="undefined"!=typeof DragEvent?new DragEvent("drop"):null}catch(t){e=null}return a="undefined"!=typeof ClipboardEvent?new ClipboardEvent("paste"):null,l}};return r.map(function(t){return new We({view:function(t){var e=function(e){var r;(o=(null==(r=t.dom.parentElement)?void 0:r.contains(e.target))?t.dom.parentElement:null)&&(gc=n)},r=function(){gc&&(gc=null)};return window.addEventListener("dragstart",e),window.addEventListener("dragend",r),{destroy:function(){window.removeEventListener("dragstart",e),window.removeEventListener("dragend",r)}}},props:{handleDOMEvents:{drop:function(t,n){if(s=o===t.dom.parentElement,e=n,!s){var r=gc;(null==r?void 0:r.isEditable)&&setTimeout(function(){var t=r.state.selection;t&&r.commands.deleteRange({from:t.from,to:t.to})},10)}return!1},paste:function(t,e){var n,r=null==(n=e.clipboardData)?void 0:n.getData("text/html");return a=e,i=!!(null==r?void 0:r.includes("data-pm-slice")),!1}}},appendTransaction:function(e,n,r){var o=e[0],l="paste"===o.getMeta("uiEvent")&&!i,u="drop"===o.getMeta("uiEvent")&&!s,d=o.getMeta("applyPasteRules"),f=!!d;if(l||u||f){if(f){var h=d.text;"string"==typeof h||(h=fa(A.from(h),r.schema));var p=d.from,m=p+h.length,v=function(t){var e,n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return null==(e=n.clipboardData)||e.setData("text/html",t),n}(h);return c({rule:t,state:r,from:p,to:{b:m},pasteEvt:v})}var g=n.doc.content.findDiffStart(r.doc.content),y=n.doc.content.findDiffEnd(r.doc.content);if("number"==typeof g&&y&&g!==y.b)return c({rule:t,state:r,from:g,to:y,pasteEvt:a})}}})})}var kc=function(){function t(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=Ca(t),this.schema=xa(this.extensions,e),this.setupExtensions()}var e=t.prototype;return e.dispatchTransaction=function(t){var e=this,n=this.editor;return Sa([].concat(this.extensions).reverse()).reduceRight(function(t,r){var o={name:r.name,options:r.options,storage:e.editor.extensionStorage[r.name],editor:n,type:Na(r.name,e.schema)},i=ua(r,"dispatchTransaction",o);return i?function(e){i.call(o,{transaction:e,next:t})}:t},t)},e.setupExtensions=function(){var t=this,e=this.extensions;this.editor.extensionStorage=Object.fromEntries(e.map(function(t){return[t.name,t.storage]})),e.forEach(function(e){var n,r={name:e.name,options:e.options,storage:t.editor.extensionStorage[e.name],editor:t.editor,type:Na(e.name,t.schema)};"mark"===e.type&&(null==(n=pa(ua(e,"keepOnSplit",r)))||n)&&t.splittableMarks.push(e.name);var o=ua(e,"onBeforeCreate",r),i=ua(e,"onCreate",r),s=ua(e,"onUpdate",r),a=ua(e,"onSelectionUpdate",r),c=ua(e,"onTransaction",r),l=ua(e,"onFocus",r),u=ua(e,"onBlur",r),d=ua(e,"onDestroy",r);o&&t.editor.on("beforeCreate",o),i&&t.editor.on("create",i),s&&t.editor.on("update",s),a&&t.editor.on("selectionUpdate",a),c&&t.editor.on("transaction",c),l&&t.editor.on("focus",l),u&&t.editor.on("blur",u),d&&t.editor.on("destroy",d)})},g(t,[{key:"commands",get:function(){var t=this;return this.extensions.reduce(function(e,n){var r=ua(n,"addCommands",{name:n.name,options:n.options,storage:t.editor.extensionStorage[n.name],editor:t.editor,type:Na(n.name,t.schema)});return r?y({},e,r()):e},{})}},{key:"plugins",get:function(){var t=this,e=this.editor,n=Sa([].concat(this.extensions).reverse()).flatMap(function(n){var r={name:n.name,options:n.options,storage:t.editor.extensionStorage[n.name],editor:e,type:Na(n.name,t.schema)},o=[],i=ua(n,"addKeyboardShortcuts",r),s={};"mark"===n.type&&ua(n,"exitable",r)&&(s.ArrowRight=function(){return mc.handleExit({editor:e,mark:n})}),i&&(s=y({},s,Object.fromEntries(Object.entries(i()).map(function(t){var n=t[0],r=t[1];return[n,function(){return r({editor:e})}]}))));var a=new We({props:{handleKeyDown:Ui(s)}});o.push(a);var c=ua(n,"addInputRules",r);if(Ia(n,e.options.enableInputRules)&&c){var l=c();if(l&&l.length){var u=function(t){var e=t.editor,n=t.rules,r=new We({state:{init:function(){return null},apply:function(t,o,i){var s=t.getMeta(r);if(s)return s;var a=t.getMeta("applyInputRules");return!!a&&setTimeout(function(){var t=a.text;"string"==typeof t||(t=fa(A.from(t),i.schema));var o=a.from,s=o+t.length;dc({editor:e,from:o,to:s,text:t,rules:n,plugin:r})}),t.selectionSet||t.docChanged?null:o}},props:{handleTextInput:function(t,o,i,s){return dc({editor:e,from:o,to:i,text:s,rules:n,plugin:r})},handleDOMEvents:{compositionend:function(t){return setTimeout(function(){var o=t.state.selection.$cursor;o&&dc({editor:e,from:o.pos,to:o.pos,text:"",rules:n,plugin:r})}),!1}},handleKeyDown:function(t,o){if("Enter"!==o.key)return!1;var i=t.state.selection.$cursor;return!!i&&dc({editor:e,from:i.pos,to:i.pos,text:"\n",rules:n,plugin:r})}},isInputRules:!0});return r}({editor:e,rules:l}),d=Array.isArray(u)?u:[u];o.push.apply(o,d)}}var f=ua(n,"addPasteRules",r);if(Ia(n,e.options.enablePasteRules)&&f){var h=f();if(h&&h.length){var p=yc({editor:e,rules:h});o.push.apply(o,p)}}var m=ua(n,"addProseMirrorPlugins",r);if(m){var v=m();o.push.apply(o,v)}return o});return n}},{key:"attributes",get:function(){return va(this.extensions)}},{key:"nodeViews",get:function(){var t=this,e=this.editor,n=ma(this.extensions).nodeExtensions;return Object.fromEntries(n.filter(function(t){return!!ua(t,"addNodeView")}).map(function(n){var r=t.attributes.filter(function(t){return t.type===n.name}),o={name:n.name,options:n.options,storage:t.editor.extensionStorage[n.name],editor:e,type:as(n.name,t.schema)},i=ua(n,"addNodeView",o);if(!i)return[];var s=i();return s?[n.name,function(t,o,i,a,c){var l=ya(t,r);return s({node:t,view:o,getPos:i,decorations:a,innerDecorations:c,editor:e,extension:n,HTMLAttributes:l})}]:[]}))}},{key:"markViews",get:function(){var t=this,e=this.editor,n=ma(this.extensions).markExtensions;return Object.fromEntries(n.filter(function(t){return!!ua(t,"addMarkView")}).map(function(n){var r=t.attributes.filter(function(t){return t.type===n.name}),o={name:n.name,options:n.options,storage:t.editor.extensionStorage[n.name],editor:e,type:ys(n.name,t.schema)},i=ua(n,"addMarkView",o);return i?[n.name,function(t,o,s){var a=ya(t,r);return i()({mark:t,view:o,inline:s,editor:e,extension:n,HTMLAttributes:a,updateAttributes:function(n){!function(t,e,n){void 0===n&&(n={});var r=e.state,o=r.doc,i=r.tr,s=t;o.descendants(function(e,r){var o=i.mapping.map(r),a=i.mapping.map(r)+e.nodeSize,c=null;if(e.marks.forEach(function(t){if(t!==s)return!1;c=t}),c){var l=!1;if(Object.keys(n).forEach(function(t){n[t]!==c.attrs[t]&&(l=!0)}),l){var u=t.type.create(y({},t.attrs,n));i.removeMark(o,a,t.type),i.addMark(o,a,u)}}}),i.docChanged&&e.view.dispatch(i)}(t,e,n)}})}]:[]}))}}])}();kc.resolve=Ca,kc.sort=Sa,kc.flatten=da,Gi({},{ClipboardTextSerializer:function(){return wc},Commands:function(){return xc},Delete:function(){return Sc},Drop:function(){return Cc},Editable:function(){return Mc},FocusEvents:function(){return Ac},Keymap:function(){return Oc},Paste:function(){return Ec},Tabindex:function(){return Nc},TextDirection:function(){return Rc},focusEventsPluginKey:function(){return Tc}});var bc=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).type="extension",e}f(e,t),e.create=function(t){return void 0===t&&(t={}),new e("function"==typeof t?t():t)};var n=e.prototype;return n.configure=function(e){return t.prototype.configure.call(this,e)},n.extend=function(e){var n="function"==typeof e?e():e;return t.prototype.extend.call(this,n)},e}(pc),wc=bc.create({name:"clipboardTextSerializer",addOptions:function(){return{blockSeparator:void 0}},addProseMirrorPlugins:function(){var t=this;return[new We({key:new Ue("clipboardTextSerializer"),props:{clipboardTextSerializer:function(){var e=t.editor,n=e.state,r=e.schema,o=n.doc,i=n.selection.ranges,s=Math.min.apply(Math,i.map(function(t){return t.$from.pos})),a=Math.max.apply(Math,i.map(function(t){return t.$to.pos})),c=Ta(r);return Ma(o,{from:s,to:a},y({},void 0!==t.options.blockSeparator?{blockSeparator:t.options.blockSeparator}:{},{textSerializers:c}))}}})]}}),xc=bc.create({name:"commands",addCommands:function(){return y({},Xi)}}),Sc=bc.create({name:"delete",onUpdate:function(t){var e,n,r,o=this,i=t.transaction,s=t.appendedTransactions,a=function(){var t,e,n,r;if(!(null!=(r=null==(n=null==(e=null==(t=o.editor.options.coreExtensionOptions)?void 0:t.delete)?void 0:e.filterTransaction)?void 0:n.call(e,i))?r:i.getMeta("y-sync$"))){var a=aa(i.before,[i].concat(s));Oa(a).forEach(function(t){a.mapping.mapResult(t.oldRange.from).deletedAfter&&a.mapping.mapResult(t.oldRange.to).deletedBefore&&a.before.nodesBetween(t.oldRange.from,t.oldRange.to,function(e,n){var r=n+e.nodeSize-2,s=t.oldRange.from<=n&&r<=t.oldRange.to;o.editor.emit("delete",{type:"node",node:e,from:n,to:r,newFrom:a.mapping.map(n),newTo:a.mapping.map(r),deletedRange:t.oldRange,newRange:t.newRange,partial:!s,editor:o.editor,transaction:i,combinedTransform:a})})});var c=a.mapping;a.steps.forEach(function(t,e){var n,r;if(t instanceof qt){var s=c.slice(e).map(t.from,-1),l=c.slice(e).map(t.to),u=c.invert().map(s,-1),d=c.invert().map(l),f=null==(n=a.doc.nodeAt(s-1))?void 0:n.marks.some(function(e){return e.eq(t.mark)}),h=null==(r=a.doc.nodeAt(l))?void 0:r.marks.some(function(e){return e.eq(t.mark)});o.editor.emit("delete",{type:"mark",mark:t.mark,from:t.from,to:t.to,deletedRange:{from:u,to:d},newRange:{from:s,to:l},partial:Boolean(h||f),editor:o.editor,transaction:i,combinedTransform:a})}})}};null==(r=null==(n=null==(e=this.editor.options.coreExtensionOptions)?void 0:e.delete)?void 0:n.async)||r?setTimeout(a,0):a()}}),Cc=bc.create({name:"drop",addProseMirrorPlugins:function(){var t=this;return[new We({key:new Ue("tiptapDrop"),props:{handleDrop:function(e,n,r,o){t.editor.emit("drop",{editor:t.editor,event:n,slice:r,moved:o})}}})]}}),Mc=bc.create({name:"editable",addProseMirrorPlugins:function(){var t=this;return[new We({key:new Ue("editable"),props:{editable:function(){return t.editor.options.editable}}})]}}),Tc=new Ue("focusEvents"),Ac=bc.create({name:"focusEvents",addProseMirrorPlugins:function(){var t=this.editor;return[new We({key:Tc,props:{handleDOMEvents:{focus:function(e,n){t.isFocused=!0;var r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:function(e,n){t.isFocused=!1;var r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),Oc=bc.create({name:"keymap",addKeyboardShortcuts:function(){var t=this,e=function(){return t.editor.commands.first(function(t){var e=t.commands;return[function(){return e.undoInputRule()},function(){return e.command(function(t){var n=t.tr,r=n.selection,o=n.doc,i=r.empty,s=r.$anchor,a=s.pos,c=s.parent,l=s.parent.isTextblock&&a>0?n.doc.resolve(a-1):s,u=l.parent.type.spec.isolating,d=s.pos-s.parentOffset,f=u&&1===l.parent.childCount?d===s.pos:Me.atStart(o).from===a;return!(!i||!c.type.isTextblock||c.textContent.length||!f||f&&"paragraph"===s.parent.type.name)&&e.clearNodes()})},function(){return e.deleteSelection()},function(){return e.joinBackward()},function(){return e.selectNodeBackward()}]})},n=function(){return t.editor.commands.first(function(t){var e=t.commands;return[function(){return e.deleteSelection()},function(){return e.deleteCurrentNode()},function(){return e.joinForward()},function(){return e.selectNodeForward()}]})},r={Enter:function(){return t.editor.commands.first(function(t){var e=t.commands;return[function(){return e.newlineInCode()},function(){return e.createParagraphNear()},function(){return e.liftEmptyBlock()},function(){return e.splitBlock()}]})},"Mod-Enter":function(){return t.editor.commands.exitCode()},Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:n,"Mod-Delete":n,"Mod-a":function(){return t.editor.commands.selectAll()}},o=y({},r),i=y({},r,{"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":n,"Ctrl-Alt-Backspace":n,"Alt-Delete":n,"Alt-d":n,"Ctrl-a":function(){return t.editor.commands.selectTextblockStart()},"Ctrl-e":function(){return t.editor.commands.selectTextblockEnd()}});return Ms()||js()?i:o},addProseMirrorPlugins:function(){var t=this;return[new We({key:new Ue("clearDocument"),appendTransaction:function(e,n,r){if(!e.some(function(t){return t.getMeta("composition")})){var o=e.some(function(t){return t.docChanged})&&!n.doc.eq(r.doc),i=e.some(function(t){return t.getMeta("preventClearDocument")});if(o&&!i){var s=n.selection,a=s.empty,c=s.from,l=s.to,u=Me.atStart(n.doc).from,d=Me.atEnd(n.doc).to;if(!a&&c===u&&l===d&&Pa(r.doc)){var f=r.tr,h=Zi({state:r,transaction:f});if(new Qi({editor:t.editor,state:h}).commands.clearNodes(),f.steps.length)return f}}}}})]}}),Ec=bc.create({name:"paste",addProseMirrorPlugins:function(){var t=this;return[new We({key:new Ue("tiptapPaste"),props:{handlePaste:function(e,n,r){t.editor.emit("paste",{editor:t.editor,event:n,slice:r})}}})]}}),Nc=bc.create({name:"tabindex",addProseMirrorPlugins:function(){var t=this;return[new We({key:new Ue("tabindex"),props:{attributes:function(){return t.editor.isEditable?{tabindex:"0"}:{}}}})]}}),Rc=bc.create({name:"textDirection",addOptions:function(){return{direction:void 0}},addGlobalAttributes:function(){var t=this;return this.options.direction?[{types:ma(this.extensions).nodeExtensions.filter(function(t){return"text"!==t.name}).map(function(t){return t.name}),attributes:{dir:{default:this.options.direction,parseHTML:function(e){var n=e.getAttribute("dir");return!n||"ltr"!==n&&"rtl"!==n&&"auto"!==n?t.options.direction:n},renderHTML:function(t){return t.dir?{dir:t.dir}:{}}}}}]:[]},addProseMirrorPlugins:function(){var t=this;return[new We({key:new Ue("textDirection"),props:{attributes:function(){var e=t.options.direction;return e?{dir:e}:{}}}})]}}),Dc=function(){function t(t,e,n,r){void 0===n&&(n=!1),void 0===r&&(r=null),this.currentNode=null,this.actualDepth=null,this.isBlock=n,this.resolvedPos=t,this.editor=e,this.currentNode=r}var e=t.prototype;return e.closest=function(t,e){void 0===e&&(e={});for(var n=null,r=this.parent;r&&!n;){if(r.node.type.name===t)if(Object.keys(e).length>0)for(var o=r.node.attrs,i=Object.keys(e),s=0;s<i.length;s+=1){var a=i[s];if(o[a]!==e[a])break}else n=r;r=r.parent}return n},e.querySelector=function(t,e){return void 0===e&&(e={}),this.querySelectorAll(t,e,!0)[0]||null},e.querySelectorAll=function(t,e,n){void 0===e&&(e={}),void 0===n&&(n=!1);var r=[];if(!this.children||0===this.children.length)return r;var o=Object.keys(e);return this.children.forEach(function(i){if(!(n&&r.length>0)){if(i.node.type.name===t){var s=o.every(function(t){return e[t]===i.node.attrs[t]});s&&r.push(i)}n&&r.length>0||(r=r.concat(i.querySelectorAll(t,e,n)))}}),r},e.setAttribute=function(t){var e=this.editor.state.tr;e.setNodeMarkup(this.from,void 0,y({},this.node.attrs,t)),this.editor.view.dispatch(e)},g(t,[{key:"name",get:function(){return this.node.type.name}},{key:"node",get:function(){return this.currentNode||this.resolvedPos.node()}},{key:"element",get:function(){return this.editor.view.domAtPos(this.pos).node}},{key:"depth",get:function(){var t;return null!=(t=this.actualDepth)?t:this.resolvedPos.depth}},{key:"pos",get:function(){return this.resolvedPos.pos}},{key:"content",get:function(){return this.node.content},set:function(t){var e=this.from,n=this.to;if(this.isBlock){if(0===this.content.size)return void console.error("You can’t set content on a block node. Tried to set content on "+this.name+" at "+this.pos);e=this.from+1,n=this.to-1}this.editor.commands.insertContentAt({from:e,to:n},t)}},{key:"attributes",get:function(){return this.node.attrs}},{key:"textContent",get:function(){return this.node.textContent}},{key:"size",get:function(){return this.node.nodeSize}},{key:"from",get:function(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}},{key:"range",get:function(){return{from:this.from,to:this.to}}},{key:"to",get:function(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}},{key:"parent",get:function(){if(0===this.depth)return null;var e=this.resolvedPos.start(this.resolvedPos.depth-1);return new t(this.resolvedPos.doc.resolve(e),this.editor)}},{key:"before",get:function(){var e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new t(e,this.editor)}},{key:"after",get:function(){var e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new t(e,this.editor)}},{key:"children",get:function(){var e=this,n=[];return this.node.content.forEach(function(r,o){var i=r.isBlock&&!r.isTextblock,s=r.isAtom&&!r.isText,a=e.pos+o+(s?0:1);if(!(a<0||a>e.resolvedPos.doc.nodeSize-2)){var c=e.resolvedPos.doc.resolve(a);if(i||!(c.depth<=e.depth)){var l=new t(c,e.editor,i,i?r:null);i&&(l.actualDepth=e.depth+1),n.push(new t(c,e.editor,i,i?r:null))}}}),n}},{key:"firstChild",get:function(){return this.children[0]||null}},{key:"lastChild",get:function(){var t=this.children;return t[t.length-1]||null}}])}(),Ic=function(t){function e(e){var n;void 0===e&&(e={}),(n=t.call(this)||this).css=null,n.className="tiptap",n.editorView=null,n.isFocused=!1,n.isInitialized=!1,n.extensionStorage={},n.instanceId=Math.random().toString(36).slice(2,9),n.options={element:"undefined"!=typeof document?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:function(){return null},onCreate:function(){return null},onMount:function(){return null},onUnmount:function(){return null},onUpdate:function(){return null},onSelectionUpdate:function(){return null},onTransaction:function(){return null},onFocus:function(){return null},onBlur:function(){return null},onDestroy:function(){return null},onContentError:function(t){throw t.error},onPaste:function(){return null},onDrop:function(){return null},onDelete:function(){return null},enableExtensionDispatchTransaction:!0},n.isCapturingTransaction=!1,n.capturedTransaction=null,n.utils={getUpdatedPosition:$a,createMappablePosition:Ha},n.setOptions(e),n.createExtensionManager(),n.createCommandManager(),n.createSchema(),n.on("beforeCreate",n.options.onBeforeCreate),n.emit("beforeCreate",{editor:n}),n.on("mount",n.options.onMount),n.on("unmount",n.options.onUnmount),n.on("contentError",n.options.onContentError),n.on("create",n.options.onCreate),n.on("update",n.options.onUpdate),n.on("selectionUpdate",n.options.onSelectionUpdate),n.on("transaction",n.options.onTransaction),n.on("focus",n.options.onFocus),n.on("blur",n.options.onBlur),n.on("destroy",n.options.onDestroy),n.on("drop",function(t){var e=t.event,r=t.slice,o=t.moved;return n.options.onDrop(e,r,o)}),n.on("paste",function(t){var e=t.event,r=t.slice;return n.options.onPaste(e,r)}),n.on("delete",n.options.onDelete);var r=n.createDoc(),o=Ss(r,n.options.autofocus);return n.editorState=Fe.create({doc:r,schema:n.schema,selection:o||void 0}),n.options.element&&n.mount(n.options.element),n}f(e,t);var n=e.prototype;return n.mount=function(t){var e=this;if("undefined"==typeof document)throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(function(){e.isDestroyed||(!1!==e.options.autofocus&&null!==e.options.autofocus&&e.commands.focus(e.options.autofocus),e.emit("create",{editor:e}),e.isInitialized=!0)},0)},n.unmount=function(){if(this.editorView){var t=this.editorView.dom;(null==t?void 0:t.editor)&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll("."+this.className).length)try{"function"==typeof this.css.remove?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})},n.chain=function(){return this.commandManager.chain()},n.can=function(){return this.commandManager.can()},n.injectCSS=function(){this.options.injectCSS&&"undefined"!=typeof document&&(this.css=function(t,e){var n=document.querySelector("style[data-tiptap-style]");if(null!==n)return n;var r=document.createElement("style");return e&&r.setAttribute("nonce",e),r.setAttribute("data-tiptap-style",""),r.innerHTML='.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 0 !important;\n  height: 0 !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}',document.getElementsByTagName("head")[0].appendChild(r),r}(0,this.options.injectNonce))},n.setOptions=function(t){void 0===t&&(t={}),this.options=y({},this.options,t),this.editorView&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))},n.setEditable=function(t,e){void 0===e&&(e=!0),this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})},n.registerPlugin=function(t,e){var n=ha(e)?e(t,[].concat(this.state.plugins)):[].concat(this.state.plugins,[t]),r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r},n.unregisterPlugin=function(t){if(!this.isDestroyed){var e=this.state.plugins,n=e;if([].concat(t).forEach(function(t){var e="string"==typeof t?t+"$":t.key;n=n.filter(function(t){return!t.key.startsWith(e)})}),e.length!==n.length){var r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}}},n.createExtensionManager=function(){var t,e,n=this,r=this.options.enableCoreExtensions?[Mc,wc.configure({blockSeparator:null==(e=null==(t=this.options.coreExtensionOptions)?void 0:t.clipboardTextSerializer)?void 0:e.blockSeparator}),xc,Ac,Oc,Nc,Cc,Ec,Sc,Rc.configure({direction:this.options.textDirection})].filter(function(t){return"object"!=typeof n.options.enableCoreExtensions||!1!==n.options.enableCoreExtensions[t.name]}):[],o=[].concat(r,this.options.extensions).filter(function(t){return["extension","node","mark"].includes(null==t?void 0:t.type)});this.extensionManager=new kc(o,this)},n.createCommandManager=function(){this.commandManager=new Qi({editor:this})},n.createSchema=function(){this.schema=this.extensionManager.schema},n.createDoc=function(){var t,e=this;try{t=oa(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(n){if(!(n instanceof Error&&["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(n.message)))throw n;this.emit("contentError",{editor:this,error:n,disableCollaboration:function(){"collaboration"in e.storage&&"object"==typeof e.storage.collaboration&&e.storage.collaboration&&(e.storage.collaboration.isDisabled=!0),e.options.extensions=e.options.extensions.filter(function(t){return"collaboration"!==t.name}),e.createExtensionManager()}}),t=oa(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t},n.createView=function(t){var e=this.options,n=e.editorProps,r=e.enableExtensionDispatchTransaction,o=n.dispatchTransaction||this.dispatchTransaction.bind(this),i=r?this.extensionManager.dispatchTransaction(o):o;this.editorView=new Ri(t,y({},n,{attributes:y({role:"textbox"},null==n?void 0:n.attributes),dispatchTransaction:i,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews}));var s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.prependClass(),this.injectCSS(),this.view.dom.editor=this},n.createNodeViews=function(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})},n.prependClass=function(){this.view.dom.className=this.className+" "+this.view.dom.className},n.captureTransaction=function(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;var e=this.capturedTransaction;return this.capturedTransaction=null,e},n.dispatchTransaction=function(t){var e=this;if(!this.view.isDestroyed){if(this.isCapturingTransaction)return this.capturedTransaction?void t.steps.forEach(function(t){var n;return null==(n=e.capturedTransaction)?void 0:n.step(t)}):void(this.capturedTransaction=t);var n=this.state.applyTransaction(t),r=n.state,o=n.transactions,i=!this.state.selection.eq(r.selection),s=o.includes(t),a=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:r}),s){this.view.updateState(r),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:o.slice(1)}),i&&this.emit("selectionUpdate",{editor:this,transaction:t});var c=o.findLast(function(t){return t.getMeta("focus")||t.getMeta("blur")}),l=null==c?void 0:c.getMeta("focus"),u=null==c?void 0:c.getMeta("blur");l&&this.emit("focus",{editor:this,event:l.event,transaction:c}),u&&this.emit("blur",{editor:this,event:u.event,transaction:c}),t.getMeta("preventUpdate")||!o.some(function(t){return t.docChanged})||a.doc.eq(r.doc)||this.emit("update",{editor:this,transaction:t,appendedTransactions:o.slice(1)})}}},n.getAttributes=function(t){return Aa(this.state,t)},n.isActive=function(t,e){var n="string"==typeof t?t:null,r="string"==typeof t?e:t;return function(t,e,n){if(void 0===n&&(n={}),!e)return Vs(t,null,n)||Da(t,null,n);var r=Js(e,t.schema);return"node"===r?Vs(t,e,n):"mark"===r&&Da(t,e,n)}(this.state,n,r)},n.getJSON=function(){return this.state.doc.toJSON()},n.getHTML=function(){return fa(this.state.doc.content,this.schema)},n.getText=function(t){var e=t||{},n=e.blockSeparator,r=void 0===n?"\n\n":n,o=e.textSerializers,i=void 0===o?{}:o;return function(t,e){return Ma(t,{from:0,to:t.content.size},e)}(this.state.doc,{blockSeparator:r,textSerializers:y({},Ta(this.schema),i)})},n.destroy=function(){this.emit("destroy"),this.unmount(),this.removeAllListeners()},n.$node=function(t,e){var n;return(null==(n=this.$doc)?void 0:n.querySelector(t,e))||null},n.$nodes=function(t,e){var n;return(null==(n=this.$doc)?void 0:n.querySelectorAll(t,e))||null},n.$pos=function(t){var e=this.state.doc.resolve(t);return new Dc(e,this)},g(e,[{key:"storage",get:function(){return this.extensionStorage}},{key:"commands",get:function(){return this.commandManager.commands}},{key:"isEditable",get:function(){return this.options.editable&&this.view&&this.view.editable}},{key:"view",get:function(){var t=this;return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:function(e){t.editorState=e},dispatch:function(e){t.dispatchTransaction(e)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:function(e,n){if(t.editorView)return t.editorView[n];if("state"===n)return t.editorState;if(n in e)return Reflect.get(e,n);throw new Error("[tiptap error]: The editor view is not available. Cannot access view['"+n+"']. The editor may not be mounted yet.")}})}},{key:"state",get:function(){return this.editorView&&(this.editorState=this.view.state),this.editorState}},{key:"isEmpty",get:function(){return Pa(this.state.doc)}},{key:"isDestroyed",get:function(){var t,e;return null==(e=null==(t=this.editorView)?void 0:t.isDestroyed)||e}},{key:"$doc",get:function(){return this.$pos(0)}}])}(lc);function Lc(t){return new uc({find:t.find,handler:function(e){var n=e.state,r=e.range,o=e.match,i=pa(t.getAttributes,void 0,o);if(!1===i||null===i)return null;var s=n.tr,a=o[o.length-1],c=o[0];if(a){var l=c.search(/\S/),u=r.from+c.indexOf(a),d=u+a.length;if(Ea(r.from,r.to,n.doc).filter(function(e){return e.mark.type.excluded.find(function(n){return n===t.type&&n!==e.mark.type})}).filter(function(t){return t.to>u}).length)return null;d<r.to&&s.delete(d,r.to),u>r.from&&s.delete(r.from+l,u);var f=r.from+l+a.length;s.addMark(r.from+l,f,t.type.create(i||{})),s.removeStoredMark(t.type)}},undoable:t.undoable})}function Pc(t){return new uc({find:t.find,handler:function(e){var n=e.state,r=e.range,o=e.match,i=n.doc.resolve(r.from),s=pa(t.getAttributes,void 0,o)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;n.tr.delete(r.from,r.to).setBlockType(r.from,r.from,t.type,s)},undoable:t.undoable})}function zc(t){return new uc({find:t.find,handler:function(e){var n=e.state,r=e.range,o=e.match,i=e.chain,s=pa(t.getAttributes,void 0,o)||{},a=n.tr.delete(r.from,r.to),c=a.doc.resolve(r.from).blockRange(),l=c&&te(c,t.type,s);if(!l)return null;if(a.wrap(c,l),t.keepMarks&&t.editor){var u=n.selection,d=n.storedMarks,f=t.editor.extensionManager.splittableMarks,h=d||u.$to.parentOffset&&u.$from.marks();if(h){var p=h.filter(function(t){return f.includes(t.type.name)});a.ensureMarks(p)}}if(t.keepAttributes){var m="bulletList"===t.type.name||"orderedList"===t.type.name?"listItem":"taskList";i().updateAttributes(m,s).run()}var v=a.doc.resolve(r.from-1).nodeBefore;v&&v.type===t.type&&ie(a.doc,r.from-1)&&(!t.joinPredicate||t.joinPredicate(o,v))&&a.join(r.from-1)},undoable:t.undoable})}function Bc(t){if(!(null==t?void 0:t.trim()))return{};var e={},n=[],r=t.replace(/["']([^"']*)["']/g,function(t){return n.push(t),"__QUOTED_"+(n.length-1)+"__"}),o=r.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(o){var i=o.map(function(t){return t.trim().slice(1)});e.class=i.join(" ")}var s=r.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);s&&(e.id=s[1]),Array.from(r.matchAll(/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g)).forEach(function(t){var r,o=t[1],i=t[2],s=parseInt((null==(r=i.match(/__QUOTED_(\d+)__/))?void 0:r[1])||"0",10),a=n[s];a&&(e[o]=a.slice(1,-1))});var a=r.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return a&&a.split(/\s+/).filter(Boolean).forEach(function(t){t.match(/^[a-zA-Z][\w-]*$/)&&(e[t]=!0)}),e}function $c(t){if(!t||0===Object.keys(t).length)return"";var e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(function(t){return e.push("."+t)}),t.id&&e.push("#"+t.id),Object.entries(t).forEach(function(t){var n=t[0],r=t[1];"class"!==n&&"id"!==n&&(!0===r?e.push(n):!1!==r&&null!=r&&e.push(n+'="'+String(r)+'"'))}),e.join(" ")}function Hc(t){var e=t.nodeName,n=t.name,r=t.parseAttributes,o=void 0===r?Bc:r,i=t.serializeAttributes,s=void 0===i?$c:i,a=t.defaultAttributes,c=void 0===a?{}:a,l=t.requiredAttributes,u=void 0===l?[]:l,d=t.allowedAttributes,f=n||e;return{parseMarkdown:function(t,n){var r=y({},c,t.attributes);return n.createNode(e,r,[])},markdownTokenizer:{name:e,level:"block",start:function(t){var e,n=new RegExp("^:::"+f+"(?:\\s|$)","m"),r=null==(e=t.match(n))?void 0:e.index;return void 0!==r?r:-1},tokenize:function(t,n,r){var i=new RegExp("^:::"+f+"(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)"),s=t.match(i);if(s){var a=s[1]||"",c=o(a);if(!u.find(function(t){return!(t in c)}))return{type:e,raw:s[0],attributes:c}}}},renderMarkdown:function(t){var e=function(t){if(!d)return t;var e={};return d.forEach(function(n){n in t&&(e[n]=t[n])}),e}(t.attrs||{}),n=s(e);return":::"+f+(n?" {"+n+"}":"")+" :::"}}}function _c(t){var e=t.nodeName,n=t.name,r=t.getContent,o=t.parseAttributes,i=void 0===o?Bc:o,s=t.serializeAttributes,a=void 0===s?$c:s,c=t.defaultAttributes,l=void 0===c?{}:c,u=t.content,d=void 0===u?"block":u,f=t.allowedAttributes,h=n||e;return{parseMarkdown:function(t,n){var o;if(r){var i=r(t);o="string"==typeof i?[{type:"text",text:i}]:i}else o="block"===d?n.parseChildren(t.tokens||[]):n.parseInline(t.tokens||[]);var s=y({},l,t.attributes);return n.createNode(e,s,o)},markdownTokenizer:{name:e,level:"block",start:function(t){var e,n=new RegExp("^:::"+h,"m"),r=null==(e=t.match(n))?void 0:e.index;return void 0!==r?r:-1},tokenize:function(t,n,r){var o,s=new RegExp("^:::"+h+"(?:\\s+\\{([^}]*)\\})?\\s*\\n"),a=t.match(s);if(a){var c=a[0],l=a[1],u=i(void 0===l?"":l),f=1,p=c.length,m="",v=/^:::([\w-]*)(\s.*)?/gm,g=t.slice(p);for(v.lastIndex=0;;){var y=v.exec(g);if(null===y)break;var k=y.index,b=y[1];if(!(null==(o=y[2])?void 0:o.endsWith(":::")))if(b)f+=1;else if(0==(f-=1)){var w=g.slice(0,k);m=w.trim();var x=t.slice(0,p+k+y[0].length),S=[];if(m)if("block"===d)for((S=r.blockTokens(w)).forEach(function(t){!t.text||t.tokens&&0!==t.tokens.length||(t.tokens=r.inlineTokens(t.text))});S.length>0;){var C=S[S.length-1];if("paragraph"!==C.type||C.text&&""!==C.text.trim())break;S.pop()}else S=r.inlineTokens(m);return{type:e,raw:x,attributes:u,content:m,tokens:S}}}}}},renderMarkdown:function(t,e){var n=function(t){if(!f)return t;var e={};return f.forEach(function(n){n in t&&(e[n]=t[n])}),e}(t.attrs||{}),r=a(n),o=r?" {"+r+"}":"",i=e.renderChildren(t.content||[],"\n\n");return":::"+h+o+"\n\n"+i+"\n\n:::"}}}function jc(t){if(!t.trim())return{};for(var e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g,r=n.exec(t);null!==r;){var o=r,i=o[1],s=o[2],a=o[3];e[i]=s||a,r=n.exec(t)}return e}function Fc(t){return Object.entries(t).filter(function(t){return null!=t[1]}).map(function(t){return t[0]+'="'+t[1]+'"'}).join(" ")}function Vc(t){var e=t.nodeName,n=t.name,r=t.getContent,o=t.parseAttributes,i=void 0===o?jc:o,s=t.serializeAttributes,a=void 0===s?Fc:s,c=t.defaultAttributes,l=void 0===c?{}:c,u=t.selfClosing,d=void 0!==u&&u,f=t.allowedAttributes,h=n||e,p=h.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:function(t,n){var o=y({},l,t.attributes);if(d)return n.createNode(e,o);var i=r?r(t):t.content||"";return i?n.createNode(e,o,[n.createTextNode(i)]):n.createNode(e,o,[])},markdownTokenizer:{name:e,level:"inline",start:function(t){var e=d?new RegExp("\\["+p+"\\s*[^\\]]*\\]"):new RegExp("\\["+p+"\\s*[^\\]]*\\][\\s\\S]*?\\[\\/"+p+"\\]"),n=t.match(e),r=null==n?void 0:n.index;return void 0!==r?r:-1},tokenize:function(t,n,r){var o=d?new RegExp("^\\["+p+"\\s*([^\\]]*)\\]"):new RegExp("^\\["+p+"\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/"+p+"\\]"),s=t.match(o);if(s){var a="",c="";d?c=s[1]:(c=s[1],a=s[2]||"");var l=i(c.trim());return{type:e,raw:s[0],content:a.trim(),attributes:l}}}},renderMarkdown:function(t){var e="";r?e=r(t):t.content&&t.content.length>0&&(e=t.content.filter(function(t){return"text"===t.type}).map(function(t){return t.text}).join(""));var n=function(t){if(!f)return t;var e={};return f.forEach(function(n){var r="string"==typeof n?n:n.name,o="string"==typeof n?void 0:n.skipIfDefault;if(r in t){var i=t[r];if(void 0!==o&&i===o)return;e[r]=i}}),e}(t.attrs||{}),o=a(n),i=o?" "+o:"";return d?"["+h+i+"]":"["+h+i+"]"+e+"[/"+h+"]"}}}function Wc(t,e,n){for(var r,o,i,s,a,c=t.split("\n"),l=[],u="",d=0,f=e.baseIndentSize||2,h=function(){var t=c[d],a=t.match(e.itemPattern);if(!a)return l.length>0?0:""===t.trim()?(d+=1,u=""+u+t+"\n",1):{v:void 0};var h=e.extractItemData(a),p=h.indentLevel,m=h.mainContent;u=""+u+t+"\n";var v,g=[m];for(d+=1;d<c.length;){var y=c[d];if(""===y.trim()){var k=c.slice(d+1).findIndex(function(t){return""!==t.trim()});if(-1===k)break;var b=c[d+1+k];if(((null==(o=null==(r=b.match(/^(\s*)/))?void 0:r[1])?void 0:o.length)||0)>p){g.push(y),u=""+u+y+"\n",d+=1;continue}break}if(!(((null==(s=null==(i=y.match(/^(\s*)/))?void 0:i[1])?void 0:s.length)||0)>p))break;g.push(y),u=""+u+y+"\n",d+=1}var w=g.slice(1);if(w.length>0){var x=w.map(function(t){return t.slice(p+f)}).join("\n");x.trim()&&(v=e.customNestedParser?e.customNestedParser(x):n.blockTokens(x))}var S=e.createToken(h,v);l.push(S)};d<c.length&&0!==(a=h());)if(1!==a&&a)return a.v;if(0!==l.length)return{items:l,raw:u}}function qc(t,e,n,r){if(!t||!Array.isArray(t.content))return"";var o="function"==typeof n?n(r):n,i=t.content,s=i[0],a=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}(i).slice(1),c=[""+o+e.renderChildren([s])];return a&&a.length>0&&a.forEach(function(t){var n=e.renderChildren([t]);if(n){var r=n.split("\n").map(function(t){return t?e.indent(t):""}).join("\n");c.push(r)}}),c.join("\n")}Gi({},{createAtomBlockMarkdownSpec:function(){return Hc},createBlockMarkdownSpec:function(){return _c},createInlineMarkdownSpec:function(){return Vc},parseAttributes:function(){return Bc},parseIndentedBlocks:function(){return Wc},renderNestedMarkdownContent:function(){return qc},serializeAttributes:function(){return $c}});var Kc=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).type="node",e}f(e,t),e.create=function(t){return void 0===t&&(t={}),new e("function"==typeof t?t():t)};var n=e.prototype;return n.configure=function(e){return t.prototype.configure.call(this,e)},n.extend=function(e){var n="function"==typeof e?e():e;return t.prototype.extend.call(this,n)},e}(pc);function Uc(t){return new vc({find:t.find,handler:function(e){var n=e.state,r=e.range,o=e.match,i=e.pasteEvent,s=pa(t.getAttributes,void 0,o,i);if(!1===s||null===s)return null;var a=n.tr,c=o[o.length-1],l=o[0],u=r.to;if(c){var d=l.search(/\S/),f=r.from+l.indexOf(c),h=f+c.length;if(Ea(r.from,r.to,n.doc).filter(function(e){return e.mark.type.excluded.find(function(n){return n===t.type&&n!==e.mark.type})}).filter(function(t){return t.to>f}).length)return null;h<r.to&&a.delete(h,r.to),f>r.from&&a.delete(r.from+d,f),u=r.from+d+c.length,a.addMark(r.from+d,u,t.type.create(s||{})),a.removeStoredMark(t.type)}}})}function Jc(t,e){if(null==t)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(-1!==e.indexOf(r))continue;n[r]=t[r]}return n}var Gc=["children"],Zc=function(t,e){if("slot"===t)return 0;if(t instanceof Function)return t(e);var n=null!=e?e:{},r=n.children,o=Jc(n,Gc);if("svg"===t)throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,o,r]},Qc=/^\s*>\s$/,Xc=Kc.create({name:"blockquote",addOptions:function(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML:function(){return[{tag:"blockquote"}]},renderHTML:function(t){var e=t.HTMLAttributes;return Zc("blockquote",y({},ga(this.options.HTMLAttributes,e),{children:Zc("slot",{})}))},parseMarkdown:function(t,e){return e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[]))},renderMarkdown:function(t,e){if(!t.content)return"";var n=[];return t.content.forEach(function(t){var r=e.renderChildren([t]).split("\n").map(function(t){return""===t.trim()?">":"> "+t});n.push(r.join("\n"))}),n.join("\n>\n")},addCommands:function(){var t=this;return{setBlockquote:function(){return function(e){return e.commands.wrapIn(t.name)}},toggleBlockquote:function(){return function(e){return e.commands.toggleWrap(t.name)}},unsetBlockquote:function(){return function(e){return e.commands.lift(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-b":function(){return t.editor.commands.toggleBlockquote()}}},addInputRules:function(){return[zc({find:Qc,type:this.type})]}}),Yc=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,tl=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,el=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,nl=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,rl=mc.create({name:"bold",addOptions:function(){return{HTMLAttributes:{}}},parseHTML:function(){var t=this;return[{tag:"strong"},{tag:"b",getAttrs:function(t){return"normal"!==t.style.fontWeight&&null}},{style:"font-weight=400",clearMark:function(e){return e.type.name===t.name}},{style:"font-weight",getAttrs:function(t){return/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}}]},renderHTML:function(t){var e=t.HTMLAttributes;return Zc("strong",y({},ga(this.options.HTMLAttributes,e),{children:Zc("slot",{})}))},markdownTokenName:"strong",parseMarkdown:function(t,e){return e.applyMark("bold",e.parseInline(t.tokens||[]))},renderMarkdown:function(t,e){return"**"+e.renderChildren(t)+"**"},addCommands:function(){var t=this;return{setBold:function(){return function(e){return e.commands.setMark(t.name)}},toggleBold:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetBold:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-b":function(){return t.editor.commands.toggleBold()},"Mod-B":function(){return t.editor.commands.toggleBold()}}},addInputRules:function(){return[Lc({find:Yc,type:this.type}),Lc({find:el,type:this.type})]},addPasteRules:function(){return[Uc({find:tl,type:this.type}),Uc({find:nl,type:this.type})]}}),ol=/(^|[^`])`([^`]+)`(?!`)$/,il=/(^|[^`])`([^`]+)`(?!`)/g,sl=mc.create({name:"code",addOptions:function(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML:function(){return[{tag:"code"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["code",ga(this.options.HTMLAttributes,e),0]},markdownTokenName:"codespan",parseMarkdown:function(t,e){return e.applyMark("code",[{type:"text",text:t.text||""}])},renderMarkdown:function(t,e){return t.content?"`"+e.renderChildren(t.content)+"`":""},addCommands:function(){var t=this;return{setCode:function(){return function(e){return e.commands.setMark(t.name)}},toggleCode:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetCode:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-e":function(){return t.editor.commands.toggleCode()}}},addInputRules:function(){return[Lc({find:ol,type:this.type})]},addPasteRules:function(){return[Uc({find:il,type:this.type})]}}),al=/^```([a-z]+)?[\s\n]$/,cl=/^~~~([a-z]+)?[\s\n]$/,ll=Kc.create({name:"codeBlock",addOptions:function(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:4,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes:function(){var t=this;return{language:{default:this.options.defaultLanguage,parseHTML:function(e){var n,r=t.options.languageClassPrefix;return r&&[].concat((null==(n=e.firstElementChild)?void 0:n.classList)||[]).filter(function(t){return t.startsWith(r)}).map(function(t){return t.replace(r,"")})[0]||null},rendered:!1}}},parseHTML:function(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML:function(t){var e=t.node,n=t.HTMLAttributes;return["pre",ga(this.options.HTMLAttributes,n),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:function(t,e){var n;return!1===(null==(n=t.raw)?void 0:n.startsWith("```"))&&"indented"!==t.codeBlockStyle?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:function(t,e){var n,r=(null==(n=t.attrs)?void 0:n.language)||"";return t.content?["```"+r,e.renderChildren(t.content),"```"].join("\n"):"```"+r+"\n\n```"},addCommands:function(){var t=this;return{setCodeBlock:function(e){return function(n){return n.commands.setNode(t.name,e)}},toggleCodeBlock:function(e){return function(n){return n.commands.toggleNode(t.name,"paragraph",e)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Alt-c":function(){return t.editor.commands.toggleCodeBlock()},Backspace:function(){var e=t.editor.state.selection,n=e.empty,r=e.$anchor,o=1===r.pos;return!(!n||r.parent.type.name!==t.name)&&!(!o&&r.parent.textContent.length)&&t.editor.commands.clearNodes()},Tab:function(e){var n,r=e.editor;if(!t.options.enableTabIndentation)return!1;var o=null!=(n=t.options.tabSize)?n:4,i=r.state,s=i.selection,a=s.$from,c=s.empty;if(a.parent.type!==t.type)return!1;var l=" ".repeat(o);return c?r.commands.insertContent(l):r.commands.command(function(t){var e=t.tr,n=s.from,r=s.to,o=i.doc.textBetween(n,r,"\n","\n").split("\n").map(function(t){return l+t}).join("\n");return e.replaceWith(n,r,i.schema.text(o)),!0})},"Shift-Tab":function(e){var n,r=e.editor;if(!t.options.enableTabIndentation)return!1;var o=null!=(n=t.options.tabSize)?n:4,i=r.state,s=i.selection,a=s.$from,c=s.empty;return a.parent.type===t.type&&(c?r.commands.command(function(t){for(var e,n=t.tr,r=a.pos,s=a.start(),c=a.end(),l=i.doc.textBetween(s,c,"\n","\n").split("\n"),u=0,d=0,f=r-s,h=0;h<l.length;h+=1){if(d+l[h].length>=f){u=h;break}d+=l[h].length+1}var p=(null==(e=l[u].match(/^ */))?void 0:e[0])||"",m=Math.min(p.length,o);if(0===m)return!0;for(var v=s,g=0;g<u;g+=1)v+=l[g].length+1;return n.delete(v,v+m),r-v<=m&&n.setSelection(Ee.create(n.doc,v)),!0}):r.commands.command(function(t){var e=t.tr,n=s.from,r=s.to,a=i.doc.textBetween(n,r,"\n","\n").split("\n").map(function(t){var e,n=(null==(e=t.match(/^ */))?void 0:e[0])||"",r=Math.min(n.length,o);return t.slice(r)}).join("\n");return e.replaceWith(n,r,i.schema.text(a)),!0}))},Enter:function(e){var n=e.editor;if(!t.options.exitOnTripleEnter)return!1;var r=n.state.selection,o=r.$from;if(!r.empty||o.parent.type!==t.type)return!1;var i=o.parentOffset===o.parent.nodeSize-2,s=o.parent.textContent.endsWith("\n\n");return!(!i||!s)&&n.chain().command(function(t){return t.tr.delete(o.pos-2,o.pos),!0}).exitCode().run()},ArrowDown:function(e){var n=e.editor;if(!t.options.exitOnArrowDown)return!1;var r=n.state,o=r.selection,i=r.doc,s=o.$from;if(!o.empty||s.parent.type!==t.type)return!1;if(s.parentOffset!==s.parent.nodeSize-2)return!1;var a=s.after();return void 0!==a&&(i.nodeAt(a)?n.commands.command(function(t){return t.tr.setSelection(Me.near(i.resolve(a))),!0}):n.commands.exitCode())}}},addInputRules:function(){return[Pc({find:al,type:this.type,getAttributes:function(t){return{language:t[1]}}}),Pc({find:cl,type:this.type,getAttributes:function(t){return{language:t[1]}}})]},addProseMirrorPlugins:function(){var t=this;return[new We({key:new Ue("codeBlockVSCodeHandler"),props:{handlePaste:function(e,n){if(!n.clipboardData)return!1;if(t.editor.isActive(t.type.name))return!1;var r=n.clipboardData.getData("text/plain"),o=n.clipboardData.getData("vscode-editor-data"),i=o?JSON.parse(o):void 0,s=null==i?void 0:i.mode;if(!r||!s)return!1;var a=e.state,c=a.tr,l=a.schema.text(r.replace(/\r\n?/g,"\n"));return c.replaceSelectionWith(t.type.create({language:s},l)),c.selection.$from.parent.type!==t.type&&c.setSelection(Ee.near(c.doc.resolve(Math.max(0,c.selection.from-2)))),c.setMeta("paste",!0),e.dispatch(c),!0}}})]}}),ul=Kc.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:function(t,e){return t.content?e.renderChildren(t.content,"\n\n"):""}}),dl=Kc.create({name:"hardBreak",markdownTokenName:"br",addOptions:function(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML:function(){return[{tag:"br"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["br",ga(this.options.HTMLAttributes,e)]},renderText:function(){return"\n"},renderMarkdown:function(){return"  \n"},parseMarkdown:function(){return{type:"hardBreak"}},addCommands:function(){var t=this;return{setHardBreak:function(){return function(e){var n=e.commands,r=e.chain,o=e.state,i=e.editor;return n.first([function(){return n.exitCode()},function(){return n.command(function(){var e=o.selection,n=o.storedMarks;if(e.$from.parent.type.spec.isolating)return!1;var s=t.options.keepMarks,a=i.extensionManager.splittableMarks,c=n||e.$to.parentOffset&&e.$from.marks();return r().insertContent({type:t.name}).command(function(t){var e=t.tr;if(t.dispatch&&c&&s){var n=c.filter(function(t){return a.includes(t.type.name)});e.ensureMarks(n)}return!0}).run()})}])}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Enter":function(){return t.editor.commands.setHardBreak()},"Shift-Enter":function(){return t.editor.commands.setHardBreak()}}}}),fl=Kc.create({name:"heading",addOptions:function(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes:function(){return{level:{default:1,rendered:!1}}},parseHTML:function(){return this.options.levels.map(function(t){return{tag:"h"+t,attrs:{level:t}}})},renderHTML:function(t){var e=t.node,n=t.HTMLAttributes;return["h"+(this.options.levels.includes(e.attrs.level)?e.attrs.level:this.options.levels[0]),ga(this.options.HTMLAttributes,n),0]},parseMarkdown:function(t,e){return e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[]))},renderMarkdown:function(t,e){var n,r=(null==(n=t.attrs)?void 0:n.level)?parseInt(t.attrs.level,10):1,o="#".repeat(r);return t.content?o+" "+e.renderChildren(t.content):""},addCommands:function(){var t=this;return{setHeading:function(e){return function(n){var r=n.commands;return!!t.options.levels.includes(e.level)&&r.setNode(t.name,e)}},toggleHeading:function(e){return function(n){var r=n.commands;return!!t.options.levels.includes(e.level)&&r.toggleNode(t.name,"paragraph",e)}}}},addKeyboardShortcuts:function(){var t=this;return this.options.levels.reduce(function(e,n){var r;return y({},e,((r={})["Mod-Alt-"+n]=function(){return t.editor.commands.toggleHeading({level:n})},r))},{})},addInputRules:function(){var t=this;return this.options.levels.map(function(e){return Pc({find:new RegExp("^(#{"+Math.min.apply(Math,t.options.levels)+","+e+"})\\s$"),type:t.type,getAttributes:{level:e}})})}}),hl=Kc.create({name:"horizontalRule",addOptions:function(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML:function(){return[{tag:"hr"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["hr",ga(this.options.HTMLAttributes,e)]},markdownTokenName:"hr",parseMarkdown:function(t,e){return e.createNode("horizontalRule")},renderMarkdown:function(){return"---"},addCommands:function(){var t=this;return{setHorizontalRule:function(){return function(e){var n=e.chain,r=e.state;if(!function(t,e){var n=t.selection,r=n.$from;if(n instanceof Re){var o=r.index();return r.parent.canReplaceWith(o,o+1,e)}for(var i=r.depth;i>=0;){var s=r.index(i);if(r.node(i).contentMatchAt(s).matchType(e))return!0;i-=1}return!1}(r,r.schema.nodes[t.name]))return!1;var o=r.selection,i=o.$to,s=n();return za(o)?s.insertContentAt(i.pos,{type:t.name}):s.insertContent({type:t.name}),s.command(function(e){var n=e.state,r=e.tr;if(e.dispatch){var o=r.selection.$to,i=o.end();if(o.nodeAfter)o.nodeAfter.isTextblock?r.setSelection(Ee.create(r.doc,o.pos+1)):o.nodeAfter.isBlock?r.setSelection(Re.create(r.doc,o.pos)):r.setSelection(Ee.create(r.doc,o.pos));else{var s=n.schema.nodes[t.options.nextNodeType]||o.parent.type.contentMatch.defaultType,a=null==s?void 0:s.create();a&&(r.insert(i,a),r.setSelection(Ee.create(r.doc,i+1)))}r.scrollIntoView()}return!0}).run()}}}},addInputRules:function(){return[(t={find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type},new uc({find:t.find,handler:function(e){var n=e.state,r=e.range,o=e.match,i=pa(t.getAttributes,void 0,o)||{},s=n.tr,a=r.from,c=r.to,l=t.type.create(i);if(o[1]){var u=a+o[0].lastIndexOf(o[1]);u>c?u=c:c=u+o[1].length;var d=o[0][o[0].length-1];s.insertText(d,a+o[0].length-1),s.replaceWith(u,c,l)}else if(o[0]){var f=t.type.isInline?a:a-1;s.insert(f,t.type.create(i)).delete(s.mapping.map(a),s.mapping.map(c))}s.scrollIntoView()},undoable:t.undoable}))];var t}}),pl=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,ml=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,vl=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,gl=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,yl=mc.create({name:"italic",addOptions:function(){return{HTMLAttributes:{}}},parseHTML:function(){var t=this;return[{tag:"em"},{tag:"i",getAttrs:function(t){return"normal"!==t.style.fontStyle&&null}},{style:"font-style=normal",clearMark:function(e){return e.type.name===t.name}},{style:"font-style=italic"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["em",ga(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setItalic:function(){return function(e){return e.commands.setMark(t.name)}},toggleItalic:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetItalic:function(){return function(e){return e.commands.unsetMark(t.name)}}}},markdownTokenName:"em",parseMarkdown:function(t,e){return e.applyMark("italic",e.parseInline(t.tokens||[]))},renderMarkdown:function(t,e){return"*"+e.renderChildren(t)+"*"},addKeyboardShortcuts:function(){var t=this;return{"Mod-i":function(){return t.editor.commands.toggleItalic()},"Mod-I":function(){return t.editor.commands.toggleItalic()}}},addInputRules:function(){return[Lc({find:pl,type:this.type}),Lc({find:vl,type:this.type})]},addPasteRules:function(){return[Uc({find:ml,type:this.type}),Uc({find:gl,type:this.type})]}});const kl="numeric",bl="ascii",wl="alpha",xl="asciinumeric",Sl="alphanumeric",Cl="domain",Ml="emoji",Tl="scheme",Al="slashscheme",Ol="whitespace";function El(t,e){return t in e||(e[t]=[]),e[t]}function Nl(t,e,n){e[kl]&&(e[xl]=!0,e[Sl]=!0),e[bl]&&(e[xl]=!0,e[wl]=!0),e[xl]&&(e[Sl]=!0),e[wl]&&(e[Sl]=!0),e[Sl]&&(e[Cl]=!0),e[Ml]&&(e[Cl]=!0);for(const r in e){const e=El(r,n);e.indexOf(t)<0&&e.push(t)}}function Rl(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Rl.groups={},Rl.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let n=0;n<e.jr.length;n++){const r=e.jr[n][0],o=e.jr[n][1];if(o&&r.test(t))return o}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let o=0;o<t.length;o++)this.tt(t[o],e,n,r)},tr(t,e,n,r){let o;return r=r||Rl.groups,e&&e.j?o=e:(o=new Rl(e),n&&r&&Nl(e,n,r)),this.jr.push([t,o]),o},ts(t,e,n,r){let o=this;const i=t.length;if(!i)return o;for(let e=0;e<i-1;e++)o=o.tt(t[e]);return o.tt(t[i-1],e,n,r)},tt(t,e,n,r){r=r||Rl.groups;const o=this;if(e&&e.j)return o.j[t]=e,e;const i=e;let s,a=o.go(t);if(a?(s=new Rl,Object.assign(s.j,a.j),s.jr.push.apply(s.jr,a.jr),s.jd=a.jd,s.t=a.t):s=new Rl,i){if(r)if(s.t&&"string"==typeof s.t){const t=Object.assign(function(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}(s.t,r),n);Nl(i,t,r)}else n&&Nl(i,n,r);s.t=i}return o.j[t]=s,s}};const Dl=(t,e,n,r,o)=>t.ta(e,n,r,o),Il=(t,e,n,r,o)=>t.tr(e,n,r,o),Ll=(t,e,n,r,o)=>t.ts(e,n,r,o),Pl=(t,e,n,r,o)=>t.tt(e,n,r,o),zl="WORD",Bl="UWORD",$l="ASCIINUMERICAL",Hl="ALPHANUMERICAL",_l="LOCALHOST",jl="TLD",Fl="UTLD",Vl="SCHEME",Wl="SLASH_SCHEME",ql="NUM",Kl="WS",Ul="NL",Jl="OPENBRACE",Gl="CLOSEBRACE",Zl="OPENBRACKET",Ql="CLOSEBRACKET",Xl="OPENPAREN",Yl="CLOSEPAREN",tu="OPENANGLEBRACKET",eu="CLOSEANGLEBRACKET",nu="FULLWIDTHLEFTPAREN",ru="FULLWIDTHRIGHTPAREN",ou="LEFTCORNERBRACKET",iu="RIGHTCORNERBRACKET",su="LEFTWHITECORNERBRACKET",au="RIGHTWHITECORNERBRACKET",cu="FULLWIDTHLESSTHAN",lu="FULLWIDTHGREATERTHAN",uu="AMPERSAND",du="APOSTROPHE",fu="ASTERISK",hu="AT",pu="BACKSLASH",mu="BACKTICK",vu="CARET",gu="COLON",yu="COMMA",ku="DOLLAR",bu="DOT",wu="EQUALS",xu="EXCLAMATION",Su="HYPHEN",Cu="PERCENT",Mu="PIPE",Tu="PLUS",Au="POUND",Ou="QUERY",Eu="QUOTE",Nu="FULLWIDTHMIDDLEDOT",Ru="SEMI",Du="SLASH",Iu="TILDE",Lu="UNDERSCORE",Pu="EMOJI",zu="SYM";var Bu=Object.freeze({__proto__:null,ALPHANUMERICAL:Hl,AMPERSAND:uu,APOSTROPHE:du,ASCIINUMERICAL:$l,ASTERISK:fu,AT:hu,BACKSLASH:pu,BACKTICK:mu,CARET:vu,CLOSEANGLEBRACKET:eu,CLOSEBRACE:Gl,CLOSEBRACKET:Ql,CLOSEPAREN:Yl,COLON:gu,COMMA:yu,DOLLAR:ku,DOT:bu,EMOJI:Pu,EQUALS:wu,EXCLAMATION:xu,FULLWIDTHGREATERTHAN:lu,FULLWIDTHLEFTPAREN:nu,FULLWIDTHLESSTHAN:cu,FULLWIDTHMIDDLEDOT:Nu,FULLWIDTHRIGHTPAREN:ru,HYPHEN:Su,LEFTCORNERBRACKET:ou,LEFTWHITECORNERBRACKET:su,LOCALHOST:_l,NL:Ul,NUM:ql,OPENANGLEBRACKET:tu,OPENBRACE:Jl,OPENBRACKET:Zl,OPENPAREN:Xl,PERCENT:Cu,PIPE:Mu,PLUS:Tu,POUND:Au,QUERY:Ou,QUOTE:Eu,RIGHTCORNERBRACKET:iu,RIGHTWHITECORNERBRACKET:au,SCHEME:Vl,SEMI:Ru,SLASH:Du,SLASH_SCHEME:Wl,SYM:zu,TILDE:Iu,TLD:jl,UNDERSCORE:Lu,UTLD:Fl,UWORD:Bl,WORD:zl,WS:Kl});const $u=/[a-z]/,Hu=/\p{L}/u,_u=/\p{Emoji}/u,ju=/\d/,Fu=/\s/;let Vu=null,Wu=null;function qu(t,e){const n=function(t){const e=[],n=t.length;let r=0;for(;r<n;){let o,i=t.charCodeAt(r),s=i<55296||i>56319||r+1===n||(o=t.charCodeAt(r+1))<56320||o>57343?t[r]:t.slice(r,r+2);e.push(s),r+=s.length}return e}(e.replace(/[A-Z]/g,t=>t.toLowerCase())),r=n.length,o=[];let i=0,s=0;for(;s<r;){let a=t,c=null,l=0,u=null,d=-1,f=-1;for(;s<r&&(c=a.go(n[s]));)a=c,a.accepts()?(d=0,f=0,u=a):d>=0&&(d+=n[s].length,f++),l+=n[s].length,i+=n[s].length,s++;i-=d,s-=f,l-=d,o.push({t:u.t,v:e.slice(i-l,i),s:i-l,e:i})}return o}function Ku(t,e,n,r,o){let i;const s=e.length;for(let n=0;n<s-1;n++){const s=e[n];t.j[s]?i=t.j[s]:(i=new Rl(r),i.jr=o.slice(),t.j[s]=i),t=i}return i=new Rl(n),i.jr=o.slice(),t.j[e[s-1]]=i,i}function Uu(t){const e=[],n=[];let r=0;for(;r<t.length;){let o=0;for(;"0123456789".indexOf(t[r+o])>=0;)o++;if(o>0){e.push(n.join(""));for(let e=parseInt(t.substring(r,r+o),10);e>0;e--)n.pop();r+=o}else n.push(t[r]),r++}return e}const Ju={defaultProtocol:"http",events:null,format:Zu,formatHref:Zu,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Gu(t,e=null){let n=Object.assign({},Ju);t&&(n=Object.assign(n,t instanceof Gu?t.o:t));const r=n.ignoreTags,o=[];for(let t=0;t<r.length;t++)o.push(r[t].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=o}function Zu(t){return t}function Qu(t,e){this.t="token",this.v=t,this.tk=e}function Xu(t,e){class n extends Qu{constructor(e,n){super(e,n),this.t=t}}for(const t in e)n.prototype[t]=e[t];return n.t=t,n}Gu.prototype={o:Ju,ignoreTags:[],defaultRender:t=>t,check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=null!=e;let o=this.o[t];return o?("object"==typeof o?(o=n.t in o?o[n.t]:Ju[t],"function"==typeof o&&r&&(o=o(e,n))):"function"==typeof o&&r&&(o=o(e,n.t,n)),o):o},getObj(t,e,n){let r=this.o[t];return"function"==typeof r&&null!=e&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}},Qu.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"…":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Ju.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),o=t.get("tagName",n,e),i=this.toFormattedString(t),s={},a=t.get("className",n,e),c=t.get("target",n,e),l=t.get("rel",n,e),u=t.getObj("attributes",n,e),d=t.getObj("events",n,e);return s.href=r,a&&(s.class=a),c&&(s.target=c),l&&(s.rel=l),u&&Object.assign(s,u),{tagName:o,attributes:s,content:i,eventListeners:d}}};const Yu=Xu("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),td=Xu("text"),ed=Xu("nl"),nd=Xu("url",{isLink:!0,toHref(t=Ju.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==_l&&t[1].t===gu}}),rd=t=>new Rl(t);function od(t,e,n){const r=n[0].s,o=n[n.length-1].e;return new t(e.slice(r,o),n)}const id="undefined"!=typeof console&&console&&console.warn||(()=>{}),sd={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function ad(t,e=!1){if(sd.initialized&&id(`linkifyjs: already initialized - will not register custom scheme "${t}" until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error('linkifyjs: incorrect scheme format.\n1. Must only contain digits, lowercase ASCII letters or "-"\n2. Cannot start or end with "-"\n3. "-" cannot repeat');sd.customSchemes.push([t,e])}function cd(t){return sd.initialized||function(){sd.scanner=function(t=[]){const e={};Rl.groups=e;const n=new Rl;null==Vu&&(Vu=Uu("aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mögensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2")),null==Wu&&(Wu=Uu("ελ1υ2бг1ел3дети4ею2католик6ом3мкд2он1сква6онлайн5рг3рус2ф2сайт3рб3укр3қаз3հայ3ישראל5קום3ابوظبي5رامكو5لاردن4بحرين5جزائر5سعودية6عليان5مغرب5مارات5یران5بارت2زار4يتك3ھارت5تونس4سودان3رية5شبكة4عراق2ب2مان4فلسطين6قطر3كاثوليك6وم3مصر2ليسيا5وريتانيا7قع4همراه5پاکستان7ڀارت4कॉम3नेट3भारत0म्3ोत5संगठन5বাংলা5ভারত2ৰত4ਭਾਰਤ4ભારત4ଭାରତ4இந்தியா6லங்கை6சிங்கப்பூர்11భారత్5ಭಾರತ4ഭാരതം5ලංකා4คอม3ไทย3ລາວ3გე2みんな3アマゾン4クラウド4グーグル4コム2ストア3セール3ファッション6ポイント4世界2中信1国1國1文网3亚马逊3企业2佛山2信息2健康2八卦2公司1益2台湾1灣2商城1店1标2嘉里0大酒店5在线2大拿2天主教3娱乐2家電2广东2微博2慈善2我爱你3手机2招聘2政务1府2新加坡2闻2时尚2書籍2机构2淡马锡3游戏2澳門2点看2移动2组织机构4网址1店1站1络2联通2谷歌2购物2通販2集团2電訊盈科4飞利浦3食品2餐厅2香格里拉3港2닷넷1컴2삼성2한국2")),Pl(n,"'",du),Pl(n,"{",Jl),Pl(n,"}",Gl),Pl(n,"[",Zl),Pl(n,"]",Ql),Pl(n,"(",Xl),Pl(n,")",Yl),Pl(n,"<",tu),Pl(n,">",eu),Pl(n,"（",nu),Pl(n,"）",ru),Pl(n,"「",ou),Pl(n,"」",iu),Pl(n,"『",su),Pl(n,"』",au),Pl(n,"＜",cu),Pl(n,"＞",lu),Pl(n,"&",uu),Pl(n,"*",fu),Pl(n,"@",hu),Pl(n,"`",mu),Pl(n,"^",vu),Pl(n,":",gu),Pl(n,",",yu),Pl(n,"$",ku),Pl(n,".",bu),Pl(n,"=",wu),Pl(n,"!",xu),Pl(n,"-",Su),Pl(n,"%",Cu),Pl(n,"|",Mu),Pl(n,"+",Tu),Pl(n,"#",Au),Pl(n,"?",Ou),Pl(n,'"',Eu),Pl(n,"/",Du),Pl(n,";",Ru),Pl(n,"~",Iu),Pl(n,"_",Lu),Pl(n,"\\",pu),Pl(n,"・",Nu);const r=Il(n,ju,ql,{[kl]:!0});Il(r,ju,r);const o=Il(r,$u,$l,{[xl]:!0}),i=Il(r,Hu,Hl,{[Sl]:!0}),s=Il(n,$u,zl,{[bl]:!0});Il(s,ju,o),Il(s,$u,s),Il(o,ju,o),Il(o,$u,o);const a=Il(n,Hu,Bl,{[wl]:!0});Il(a,$u),Il(a,ju,i),Il(a,Hu,a),Il(i,ju,i),Il(i,$u),Il(i,Hu,i);const c=Pl(n,"\n",Ul,{[Ol]:!0}),l=Pl(n,"\r",Kl,{[Ol]:!0}),u=Il(n,Fu,Kl,{[Ol]:!0});Pl(n,"￼",u),Pl(l,"\n",c),Pl(l,"￼",u),Il(l,Fu,u),Pl(u,"\r"),Pl(u,"\n"),Il(u,Fu,u),Pl(u,"￼",u);const d=Il(n,_u,Pu,{[Ml]:!0});Pl(d,"#"),Il(d,_u,d),Pl(d,"️",d);const f=Pl(d,"‍");Pl(f,"#"),Il(f,_u,d);const h=[[$u,s],[ju,o]],p=[[$u,null],[Hu,a],[ju,i]];for(let t=0;t<Vu.length;t++)Ku(n,Vu[t],jl,zl,h);for(let t=0;t<Wu.length;t++)Ku(n,Wu[t],Fl,Bl,p);Nl(jl,{tld:!0,ascii:!0},e),Nl(Fl,{utld:!0,alpha:!0},e),Ku(n,"file",Vl,zl,h),Ku(n,"mailto",Vl,zl,h),Ku(n,"http",Wl,zl,h),Ku(n,"https",Wl,zl,h),Ku(n,"ftp",Wl,zl,h),Ku(n,"ftps",Wl,zl,h),Nl(Vl,{scheme:!0,ascii:!0},e),Nl(Wl,{slashscheme:!0,ascii:!0},e),t=t.sort((t,e)=>t[0]>e[0]?1:-1);for(let e=0;e<t.length;e++){const r=t[e][0],o=t[e][1]?{[Tl]:!0}:{[Al]:!0};r.indexOf("-")>=0?o[Cl]=!0:$u.test(r)?ju.test(r)?o[xl]=!0:o[bl]=!0:o[kl]=!0,Ll(n,r,r,o)}return Ll(n,"localhost",_l,{ascii:!0}),n.jd=new Rl(zu),{start:n,tokens:Object.assign({groups:e},Bu)}}(sd.customSchemes);for(let t=0;t<sd.tokenQueue.length;t++)sd.tokenQueue[t][1]({scanner:sd.scanner});sd.parser=function({groups:t}){const e=t.domain.concat([uu,fu,hu,pu,mu,vu,ku,wu,Su,ql,Cu,Mu,Tu,Au,Du,zu,Iu,Lu]),n=[du,gu,yu,bu,xu,Cu,Ou,Eu,Ru,tu,eu,Jl,Gl,Ql,Zl,Xl,Yl,nu,ru,ou,iu,su,au,cu,lu],r=[uu,du,fu,pu,mu,vu,ku,wu,Su,Jl,Gl,Cu,Mu,Tu,Au,Ou,Du,zu,Iu,Lu],o=rd(),i=Pl(o,Iu);Dl(i,r,i),Dl(i,t.domain,i);const s=rd(),a=rd(),c=rd();Dl(o,t.domain,s),Dl(o,t.scheme,a),Dl(o,t.slashscheme,c),Dl(s,r,i),Dl(s,t.domain,s);const l=Pl(s,hu);Pl(i,hu,l),Pl(a,hu,l),Pl(c,hu,l);const u=Pl(i,bu);Dl(u,r,i),Dl(u,t.domain,i);const d=rd();Dl(l,t.domain,d),Dl(d,t.domain,d);const f=Pl(d,bu);Dl(f,t.domain,d);const h=rd(Yu);Dl(f,t.tld,h),Dl(f,t.utld,h),Pl(l,_l,h);const p=Pl(d,Su);Pl(p,Su,p),Dl(p,t.domain,d),Dl(h,t.domain,d),Pl(h,bu,f),Pl(h,Su,p);const m=Pl(h,gu);Dl(m,t.numeric,Yu);const v=Pl(s,Su),g=Pl(s,bu);Pl(v,Su,v),Dl(v,t.domain,s),Dl(g,r,i),Dl(g,t.domain,s);const y=rd(nd);Dl(g,t.tld,y),Dl(g,t.utld,y),Dl(y,t.domain,s),Dl(y,r,i),Pl(y,bu,g),Pl(y,Su,v),Pl(y,hu,l);const k=Pl(y,gu),b=rd(nd);Dl(k,t.numeric,b);const w=rd(nd),x=rd();Dl(w,e,w),Dl(w,n,x),Dl(x,e,w),Dl(x,n,x),Pl(y,Du,w),Pl(b,Du,w);const S=Pl(a,gu),C=Pl(c,gu),M=Pl(C,Du),T=Pl(M,Du);Dl(a,t.domain,s),Pl(a,bu,g),Pl(a,Su,v),Dl(c,t.domain,s),Pl(c,bu,g),Pl(c,Su,v),Dl(S,t.domain,w),Pl(S,Du,w),Pl(S,Ou,w),Dl(T,t.domain,w),Dl(T,e,w),Pl(T,Du,w);const A=[[Jl,Gl],[Zl,Ql],[Xl,Yl],[tu,eu],[nu,ru],[ou,iu],[su,au],[cu,lu]];for(let t=0;t<A.length;t++){const[r,o]=A[t],i=Pl(w,r);Pl(x,r,i),Pl(i,o,w);const s=rd(nd);Dl(i,e,s);const a=rd();Dl(i,n),Dl(s,e,s),Dl(s,n,a),Dl(a,e,s),Dl(a,n,a),Pl(s,o,w),Pl(a,o,w)}return Pl(o,_l,y),Pl(o,Ul,ed),{start:o,tokens:Bu}}(sd.scanner.tokens);for(let t=0;t<sd.pluginQueue.length;t++)sd.pluginQueue[t][1]({scanner:sd.scanner,parser:sd.parser});sd.initialized=!0}(),function(t,e,n){let r=n.length,o=0,i=[],s=[];for(;o<r;){let a=t,c=null,l=null,u=0,d=null,f=-1;for(;o<r&&!(c=a.go(n[o].t));)s.push(n[o++]);for(;o<r&&(l=c||a.go(n[o].t));)c=null,a=l,a.accepts()?(f=0,d=a):f>=0&&f++,o++,u++;if(f<0)o-=u,o<r&&(s.push(n[o]),o++);else{s.length>0&&(i.push(od(td,e,s)),s=[]),o-=f,u-=f;const t=d.t,r=n.slice(o-u,o);i.push(od(t,e,r))}}return s.length>0&&i.push(od(td,e,s)),i}(sd.parser.start,t,qu(sd.scanner.start,t))}function ld(t,e=null,n=null){if(e&&"object"==typeof e){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new Gu(n),o=cd(t),i=[];for(let t=0;t<o.length;t++){const n=o[t];!n.isLink||e&&n.t!==e||!r.check(n)||i.push(n.toFormattedObject(r))}return i}cd.scan=qu;var ud="[\0-   ᠎ -\u2029 　]",dd=new RegExp(ud),fd=new RegExp(ud+"$"),hd=new RegExp(ud,"g");function pd(t,e){var n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(function(t){var e="string"==typeof t?t:t.scheme;e&&n.push(e)}),!t||t.replace(hd,"").match(new RegExp("^(?:(?:"+n.join("|")+"):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))","i"))}var md=mc.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate:function(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(function(t){"string"!=typeof t?ad(t.scheme,t.optionalSlashes):ad(t)})},onDestroy:function(){Rl.groups={},sd.scanner=null,sd.parser=null,sd.tokenQueue=[],sd.pluginQueue=[],sd.customSchemes=[],sd.initialized=!1},inclusive:function(){return this.options.autolink},addOptions:function(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:function(t,e){return!!pd(t,e.protocols)},validate:function(t){return!!t},shouldAutoLink:function(t){var e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),n=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||n&&!t.includes("@"))return!0;var r=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!/^\d{1,3}(\.\d{1,3}){3}$/.test(r)&&!!/\./.test(r)}}},addAttributes:function(){return{href:{default:null,parseHTML:function(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML:function(){var t=this;return[{tag:"a[href]",getAttrs:function(e){var n=e.getAttribute("href");return!(!n||!t.options.isAllowedUri(n,{defaultValidate:function(e){return!!pd(e,t.options.protocols)},protocols:t.options.protocols,defaultProtocol:t.options.defaultProtocol}))&&null}}]},renderHTML:function(t){var e=this,n=t.HTMLAttributes;return this.options.isAllowedUri(n.href,{defaultValidate:function(t){return!!pd(t,e.options.protocols)},protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",ga(this.options.HTMLAttributes,n),0]:["a",ga(this.options.HTMLAttributes,y({},n,{href:""})),0]},markdownTokenName:"link",parseMarkdown:function(t,e){return e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null})},renderMarkdown:function(t,e){var n,r=(null==(n=t.attrs)?void 0:n.href)||"";return"["+e.renderChildren(t)+"]("+r+")"},addCommands:function(){var t=this;return{setLink:function(e){return function(n){var r=n.chain,o=e.href;return!!t.options.isAllowedUri(o,{defaultValidate:function(e){return!!pd(e,t.options.protocols)},protocols:t.options.protocols,defaultProtocol:t.options.defaultProtocol})&&r().setMark(t.name,e).setMeta("preventAutolink",!0).run()}},toggleLink:function(e){return function(n){var r=n.chain,o=(e||{}).href;return!(o&&!t.options.isAllowedUri(o,{defaultValidate:function(e){return!!pd(e,t.options.protocols)},protocols:t.options.protocols,defaultProtocol:t.options.defaultProtocol}))&&r().toggleMark(t.name,e,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},unsetLink:function(){return function(e){return(0,e.chain)().unsetMark(t.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}}}},addPasteRules:function(){var t=this;return[Uc({find:function(e){var n=[];if(e){var r=t.options,o=r.protocols,i=r.defaultProtocol,s=ld(e).filter(function(e){return e.isLink&&t.options.isAllowedUri(e.value,{defaultValidate:function(t){return!!pd(t,o)},protocols:o,defaultProtocol:i})});s.length&&s.forEach(function(e){t.options.shouldAutoLink(e.value)&&n.push({text:e.value,data:{href:e.href},index:e.start})})}return n},type:this.type,getAttributes:function(t){var e;return{href:null==(e=t.data)?void 0:e.href}}})]},addProseMirrorPlugins:function(){var t,e=this,n=[],r=this.options,o=r.protocols,i=r.defaultProtocol;return this.options.autolink&&n.push((t={type:this.type,defaultProtocol:this.options.defaultProtocol,validate:function(t){return e.options.isAllowedUri(t,{defaultValidate:function(t){return!!pd(t,o)},protocols:o,defaultProtocol:i})},shouldAutoLink:this.options.shouldAutoLink},new We({key:new Ue("autolink"),appendTransaction:function(e,n,r){var o=e.some(function(t){return t.docChanged})&&!n.doc.eq(r.doc),i=e.some(function(t){return t.getMeta("preventAutolink")});if(o&&!i){var s=r.tr;if(Oa(aa(n.doc,[].concat(e))).forEach(function(e){var n,o,i,a,c,l,u,d=e.newRange,f=(n=r.doc,o=d,i=function(t){return t.isTextblock},a=[],n.nodesBetween(o.from,o.to,function(t,e){i(t)&&a.push({node:t,pos:e})}),a);if(f.length>1)c=f[0],l=r.doc.textBetween(c.pos,c.pos+c.node.nodeSize,void 0," ");else if(f.length){var h=r.doc.textBetween(d.from,d.to," "," ");if(!fd.test(h))return;c=f[0],l=r.doc.textBetween(c.pos,d.to,void 0," ")}if(c&&l){var p=l.split(dd).filter(Boolean);if(p.length<=0)return!1;var m=p[p.length-1],v=c.pos+l.lastIndexOf(m);if(!m)return!1;var g=cd(m).map(function(e){return e.toObject(t.defaultProtocol)});if(!(1===(u=g).length?u[0].isLink:3===u.length&&u[1].isLink&&["()","[]"].includes(u[0].value+u[2].value)))return!1;g.filter(function(t){return t.isLink}).map(function(t){return y({},t,{from:v+t.start+1,to:v+t.end+1})}).filter(function(t){return!r.schema.marks.code||!r.doc.rangeHasMark(t.from,t.to,r.schema.marks.code)}).filter(function(e){return t.validate(e.value)}).filter(function(e){return t.shouldAutoLink(e.value)}).forEach(function(e){Ea(e.from,e.to,r.doc).some(function(e){return e.mark.type===t.type})||s.addMark(e.from,e.to,t.type.create({href:e.href}))})}}),s.steps.length)return s}}}))),n.push(function(t){return new We({key:new Ue("handleClickLink"),props:{handleClick:function(e,n,r){var o,i;if(0!==r.button)return!1;if(!e.editable)return!1;var s=!1;if(t.enableClickSelection&&(s=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){var a=null;if(r.target instanceof HTMLAnchorElement)a=r.target;else{for(var c=r.target,l=[];"DIV"!==c.nodeName;)l.push(c),c=c.parentNode;a=l.find(function(t){return"A"===t.nodeName})}if(!a)return s;var u=Aa(e.state,t.type.name),d=null!=(o=null==a?void 0:a.href)?o:u.href,f=null!=(i=null==a?void 0:a.target)?i:u.target;a&&d&&(window.open(d,f),s=!0)}return s}}})}({type:this.type,editor:this.editor,openOnClick:"whenNotEditable"===this.options.openOnClick||this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&n.push(function(t){return new We({key:new Ue("handlePasteLink"),props:{handlePaste:function(e,n,r){var o=t.shouldAutoLink;if(e.state.selection.empty)return!1;var i="";r.content.forEach(function(t){i+=t.textContent});var s=ld(i,{defaultProtocol:t.defaultProtocol}).find(function(t){return t.isLink&&t.value===i});return!(!i||!s||void 0!==o&&!o(s.value))&&t.editor.commands.setMark(t.type,{href:s.href})}}})}({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),n}}),vd=["start"],gd=Object.defineProperty,yd="textStyle",kd=/^\s*([-+*])\s$/,bd=Kc.create({name:"bulletList",addOptions:function(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content:function(){return this.options.itemTypeName+"+"},parseHTML:function(){return[{tag:"ul"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["ul",ga(this.options.HTMLAttributes,e),0]},markdownTokenName:"list",parseMarkdown:function(t,e){return"list"!==t.type||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]}},renderMarkdown:function(t,e){return t.content?e.renderChildren(t.content,"\n"):""},markdownOptions:{indentsContent:!0},addCommands:function(){var t=this;return{toggleBulletList:function(){return function(e){var n=e.commands,r=e.chain;return t.options.keepAttributes?r().toggleList(t.name,t.options.itemTypeName,t.options.keepMarks).updateAttributes("listItem",t.editor.getAttributes(yd)).run():n.toggleList(t.name,t.options.itemTypeName,t.options.keepMarks)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-8":function(){return t.editor.commands.toggleBulletList()}}},addInputRules:function(){var t=this,e=zc({find:kd,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=zc({find:kd,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:function(){return t.editor.getAttributes(yd)},editor:this.editor})),[e]}}),wd=Kc.create({name:"listItem",addOptions:function(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML:function(){return[{tag:"li"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["li",ga(this.options.HTMLAttributes,e),0]},markdownTokenName:"list_item",parseMarkdown:function(t,e){if("list_item"!==t.type)return[];var n=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(function(t){return"paragraph"===t.type}))n=e.parseChildren(t.tokens);else{var r=t.tokens[0];if(r&&"text"===r.type&&r.tokens&&r.tokens.length>0){if(n=[{type:"paragraph",content:e.parseInline(r.tokens)}],t.tokens.length>1){var o,i=t.tokens.slice(1),s=e.parseChildren(i);(o=n).push.apply(o,s)}}else n=e.parseChildren(t.tokens)}return 0===n.length&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:function(t,e,n){return qc(t,e,function(t){return"bulletList"===t.parentType?"- ":"orderedList"===t.parentType?t.index+1+". ":"- "},n)},addKeyboardShortcuts:function(){var t=this;return{Enter:function(){return t.editor.commands.splitListItem(t.name)},Tab:function(){return t.editor.commands.sinkListItem(t.name)},"Shift-Tab":function(){return t.editor.commands.liftListItem(t.name)}}}});!function(t,e){for(var n in e)gd(t,n,{get:e[n],enumerable:!0})}({},{findListItemPos:function(){return xd},getNextListDepth:function(){return Sd},handleBackspace:function(){return Ad},handleDelete:function(){return Nd},hasListBefore:function(){return Cd},hasListItemAfter:function(){return Rd},hasListItemBefore:function(){return Md},listItemHasSubList:function(){return Td},nextListIsDeeper:function(){return Od},nextListIsHigher:function(){return Ed}});var xd=function(t,e){for(var n=e.selection.$from,r=as(t,e.schema),o=n.depth,i=n.pos,s=null;o>0&&null===s;)n.node(o).type===r?s=o:(o-=1,i-=1);return null===s?null:{$pos:e.doc.resolve(i),depth:s}},Sd=function(t,e){var n=xd(t,e);if(!n)return!1;var r=function(t,e,n,r){void 0===r&&(r=20);for(var o=t.doc.resolve(n),i=r,s=null;i>0&&null===s;){var a=o.node(i);(null==a?void 0:a.type.name)===e?s=a:i-=1}return[s,i]}(e,t,n.$pos.pos+4);return r[1]},Cd=function(t,e,n){var r=t.selection.$anchor,o=Math.max(0,r.pos-2),i=t.doc.resolve(o).node();return!(!i||!n.includes(i.type.name))},Md=function(t,e){var n,r=e.selection.$anchor,o=e.doc.resolve(r.pos-2);return 0!==o.index()&&(null==(n=o.nodeBefore)?void 0:n.type.name)===t},Td=function(t,e,n){if(!n)return!1;var r=as(t,e.schema),o=!1;return n.descendants(function(t){t.type===r&&(o=!0)}),o},Ad=function(t,e,n){if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!Vs(t.state,e)&&Cd(t.state,e,n)){var r=t.state.selection.$anchor,o=t.state.doc.resolve(r.before()-1),i=[];o.node().descendants(function(t,n){t.type.name===e&&i.push({node:t,pos:n})});var s=i.at(-1);if(!s)return!1;var a=t.state.doc.resolve(o.start()+s.pos+1);return t.chain().cut({from:r.start()-1,to:r.end()+1},a.end()).joinForward().run()}if(!Vs(t.state,e))return!1;if(l=(c=t.state.selection).$from,u=c.$to,l.parentOffset>0||l.pos!==u.pos)return!1;var c,l,u,d=xd(e,t.state);if(!d)return!1;var f=t.state.doc.resolve(d.$pos.pos-2).node(d.depth),h=Td(e,t.state,f);return Md(e,t.state)&&!h?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},Od=function(t,e){var n=Sd(t,e),r=xd(t,e);return!(!r||!n)&&n>r.depth},Ed=function(t,e){var n=Sd(t,e),r=xd(t,e);return!(!r||!n)&&n<r.depth},Nd=function(t,e){if(!Vs(t.state,e))return!1;if(!function(t,e){var n=t.selection,r=n.$from,o=n.$to,i=n.$anchor;if(e){var s=la(function(t){return t.type.name===e})(t.selection);if(!s)return!1;var a=t.doc.resolve(s.pos+1);return i.pos+1===a.end()}return!(o.parentOffset<o.parent.nodeSize-2||r.pos!==o.pos)}(t.state,e))return!1;var n=t.state.selection,r=n.$from,o=n.$to;return!(!n.empty&&r.sameParent(o))&&(Od(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():Ed(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward())},Rd=function(t,e){var n,r=e.selection.$anchor,o=e.doc.resolve(r.pos-r.parentOffset-2);return o.index()!==o.parent.childCount-1&&(null==(n=o.nodeAfter)?void 0:n.type.name)===t},Dd=bc.create({name:"listKeymap",addOptions:function(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts:function(){var t=this;return{Delete:function(e){var n=e.editor,r=!1;return t.options.listTypes.forEach(function(t){var e=t.itemName;void 0!==n.state.schema.nodes[e]&&Nd(n,e)&&(r=!0)}),r},"Mod-Delete":function(e){var n=e.editor,r=!1;return t.options.listTypes.forEach(function(t){var e=t.itemName;void 0!==n.state.schema.nodes[e]&&Nd(n,e)&&(r=!0)}),r},Backspace:function(e){var n=e.editor,r=!1;return t.options.listTypes.forEach(function(t){var e=t.itemName,o=t.wrapperNames;void 0!==n.state.schema.nodes[e]&&Ad(n,e,o)&&(r=!0)}),r},"Mod-Backspace":function(e){var n=e.editor,r=!1;return t.options.listTypes.forEach(function(t){var e=t.itemName,o=t.wrapperNames;void 0!==n.state.schema.nodes[e]&&Ad(n,e,o)&&(r=!0)}),r}}}}),Id=/^(\s*)(\d+)\.\s+(.*)$/,Ld=/^\s/;function Pd(t,e,n){for(var r,o=[],i=0;i<t.length;){var s=t[i];if(s.indent===e){var a=s.content.split("\n"),c=(null==(r=a[0])?void 0:r.trim())||"",l=[];c&&l.push({type:"paragraph",raw:c,tokens:n.inlineTokens(c)});var u=a.slice(1).join("\n").trim();if(u){var d=n.blockTokens(u);l.push.apply(l,d)}for(var f=i+1,h=[];f<t.length&&t[f].indent>e;)h.push(t[f]),f+=1;if(h.length>0){var p=Math.min.apply(Math,h.map(function(t){return t.indent})),m=Pd(h,p,n);l.push({type:"list",ordered:!0,start:h[0].number,items:m,raw:h.map(function(t){return t.raw}).join("\n")})}o.push({type:"list_item",raw:s.raw,tokens:l}),i=f}else i+=1}return o}var zd="textStyle",Bd=/^(\d+)\.\s$/,$d=Kc.create({name:"orderedList",addOptions:function(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content:function(){return this.options.itemTypeName+"+"},addAttributes:function(){return{start:{default:1,parseHTML:function(t){return t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1}},type:{default:null,parseHTML:function(t){return t.getAttribute("type")}}}},parseHTML:function(){return[{tag:"ol"}]},renderHTML:function(t){var e=t.HTMLAttributes,n=e.start,r=Jc(e,vd);return 1===n?["ol",ga(this.options.HTMLAttributes,r),0]:["ol",ga(this.options.HTMLAttributes,e),0]},markdownTokenName:"list",parseMarkdown:function(t,e){if("list"!==t.type||!t.ordered)return[];var n=t.start||1,r=t.items?function(t,e){return t.map(function(t){if("list_item"!==t.type)return e.parseChildren([t])[0];var n=[];return t.tokens&&t.tokens.length>0&&t.tokens.forEach(function(t){if("paragraph"===t.type||"list"===t.type||"blockquote"===t.type||"code"===t.type)n.push.apply(n,e.parseChildren([t]));else if("text"===t.type&&t.tokens){var r=e.parseChildren([t]);n.push({type:"paragraph",content:r})}else{var o=e.parseChildren([t]);o.length>0&&n.push.apply(n,o)}}),{type:"listItem",content:n}})}(t.items,e):[];return 1!==n?{type:"orderedList",attrs:{start:n},content:r}:{type:"orderedList",content:r}},renderMarkdown:function(t,e){return t.content?e.renderChildren(t.content,"\n"):""},markdownTokenizer:{name:"orderedList",level:"block",start:function(t){var e=t.match(/^(\s*)(\d+)\.\s+/),n=null==e?void 0:e.index;return void 0!==n?n:-1},tokenize:function(t,e,n){var r,o=t.split("\n"),i=function(t){for(var e=[],n=0,r=0;n<t.length;){var o=t[n],i=o.match(Id);if(!i)break;for(var s=i[1],a=i[2],c=i[3],l=s.length,u=c,d=n+1,f=[o];d<t.length;){var h=t[d];if(h.match(Id))break;if(""===h.trim())f.push(h),u+="\n",d+=1;else{if(!h.match(Ld))break;f.push(h),u+="\n"+h.slice(l+2),d+=1}}e.push({indent:l,number:parseInt(a,10),content:u.trim(),raw:f.join("\n")}),r=d,n=d}return[e,r]}(o),s=i[0],a=i[1];if(0!==s.length){var c=Pd(s,0,n);if(0!==c.length)return{type:"list",ordered:!0,start:(null==(r=s[0])?void 0:r.number)||1,items:c,raw:o.slice(0,a).join("\n")}}}},markdownOptions:{indentsContent:!0},addCommands:function(){var t=this;return{toggleOrderedList:function(){return function(e){var n=e.commands,r=e.chain;return t.options.keepAttributes?r().toggleList(t.name,t.options.itemTypeName,t.options.keepMarks).updateAttributes("listItem",t.editor.getAttributes(zd)).run():n.toggleList(t.name,t.options.itemTypeName,t.options.keepMarks)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-7":function(){return t.editor.commands.toggleOrderedList()}}},addInputRules:function(){var t=this,e=zc({find:Bd,type:this.type,getAttributes:function(t){return{start:+t[1]}},joinPredicate:function(t,e){return e.childCount+e.attrs.start===+t[1]}});return(this.options.keepMarks||this.options.keepAttributes)&&(e=zc({find:Bd,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:function(e){return y({start:+e[1]},t.editor.getAttributes(zd))},joinPredicate:function(t,e){return e.childCount+e.attrs.start===+t[1]},editor:this.editor})),[e]}}),Hd=/^\s*(\[([( |x])?\])\s$/,_d=Kc.create({name:"taskItem",addOptions:function(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content:function(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes:function(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:function(t){var e=t.getAttribute("data-checked");return""===e||"true"===e},renderHTML:function(t){return{"data-checked":t.checked}}}}},parseHTML:function(){return[{tag:'li[data-type="'+this.name+'"]',priority:51}]},renderHTML:function(t){var e=t.node,n=t.HTMLAttributes;return["li",ga(this.options.HTMLAttributes,n,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:e.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:function(t,e){var n=[];if(t.tokens&&t.tokens.length>0?n.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?n.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):n.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){var r=e.parseChildren(t.nestedTokens);n.push.apply(n,r)}return e.createNode("taskItem",{checked:t.checked||!1},n)},renderMarkdown:function(t,e){var n;return qc(t,e,"- ["+((null==(n=t.attrs)?void 0:n.checked)?"x":" ")+"] ")},addKeyboardShortcuts:function(){var t=this,e={Enter:function(){return t.editor.commands.splitListItem(t.name)},"Shift-Tab":function(){return t.editor.commands.liftListItem(t.name)}};return this.options.nested?y({},e,{Tab:function(){return t.editor.commands.sinkListItem(t.name)}}):e},addNodeView:function(){var t=this;return function(e){var n=e.node,r=e.HTMLAttributes,o=e.getPos,i=e.editor,s=document.createElement("li"),a=document.createElement("label"),c=document.createElement("span"),l=document.createElement("input"),u=document.createElement("div"),d=function(e){var n,r;l.ariaLabel=(null==(r=null==(n=t.options.a11y)?void 0:n.checkboxLabel)?void 0:r.call(n,e,l.checked))||"Task item checkbox for "+(e.textContent||"empty task item")};d(n),a.contentEditable="false",l.type="checkbox",l.addEventListener("mousedown",function(t){return t.preventDefault()}),l.addEventListener("change",function(e){if(i.isEditable||t.options.onReadOnlyChecked){var r=e.target.checked;i.isEditable&&"function"==typeof o&&i.chain().focus(void 0,{scrollIntoView:!1}).command(function(t){var e=t.tr,n=o();if("number"!=typeof n)return!1;var i=e.doc.nodeAt(n);return e.setNodeMarkup(n,void 0,y({},null==i?void 0:i.attrs,{checked:r})),!0}).run(),!i.isEditable&&t.options.onReadOnlyChecked&&(t.options.onReadOnlyChecked(n,r)||(l.checked=!l.checked))}else l.checked=!l.checked}),Object.entries(t.options.HTMLAttributes).forEach(function(t){var e=t[0],n=t[1];s.setAttribute(e,n)}),s.dataset.checked=n.attrs.checked,l.checked=n.attrs.checked,a.append(l,c),s.append(a,u),Object.entries(r).forEach(function(t){var e=t[0],n=t[1];s.setAttribute(e,n)});var f=new Set(Object.keys(r));return{dom:s,contentDOM:u,update:function(e){if(e.type!==t.type)return!1;s.dataset.checked=e.attrs.checked,l.checked=e.attrs.checked,d(e);var n=ya(e,i.extensionManager.attributes),r=new Set(Object.keys(n)),o=t.options.HTMLAttributes;return f.forEach(function(t){r.has(t)||(t in o?s.setAttribute(t,o[t]):s.removeAttribute(t))}),Object.entries(n).forEach(function(t){var e=t[0],n=t[1];null==n?e in o?s.setAttribute(e,o[e]):s.removeAttribute(e):s.setAttribute(e,n)}),f=r,!0}}}},addInputRules:function(){return[zc({find:Hd,type:this.type,getAttributes:function(t){return{checked:"x"===t[t.length-1]}}})]}}),jd=Kc.create({name:"taskList",addOptions:function(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content:function(){return this.options.itemTypeName+"+"},parseHTML:function(){return[{tag:'ul[data-type="'+this.name+'"]',priority:51}]},renderHTML:function(t){var e=t.HTMLAttributes;return["ul",ga(this.options.HTMLAttributes,e,{"data-type":this.name}),0]},parseMarkdown:function(t,e){return e.createNode("taskList",{},e.parseChildren(t.items||[]))},renderMarkdown:function(t,e){return t.content?e.renderChildren(t.content,"\n"):""},markdownTokenizer:{name:"taskList",level:"block",start:function(t){var e,n=null==(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))?void 0:e.index;return void 0!==n?n:-1},tokenize:function(t,e,n){var r=function(t){var e=Wc(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:function(t){return{indentLevel:t[1].length,mainContent:t[4],checked:"x"===t[3].toLowerCase()}},createToken:function(t,e){return{type:"taskItem",raw:"",mainContent:t.mainContent,indentLevel:t.indentLevel,checked:t.checked,text:t.mainContent,tokens:n.inlineTokens(t.mainContent),nestedTokens:e}},customNestedParser:r},n);return e?[{type:"taskList",raw:e.raw,items:e.items}]:n.blockTokens(t)},o=Wc(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:function(t){return{indentLevel:t[1].length,mainContent:t[4],checked:"x"===t[3].toLowerCase()}},createToken:function(t,e){return{type:"taskItem",raw:"",mainContent:t.mainContent,indentLevel:t.indentLevel,checked:t.checked,text:t.mainContent,tokens:n.inlineTokens(t.mainContent),nestedTokens:e}},customNestedParser:r},n);if(o)return{type:"taskList",raw:o.raw,items:o.items}}},markdownOptions:{indentsContent:!0},addCommands:function(){var t=this;return{toggleTaskList:function(){return function(e){return e.commands.toggleList(t.name,t.options.itemTypeName)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-9":function(){return t.editor.commands.toggleTaskList()}}}}),Fd=(bc.create({name:"listKit",addExtensions:function(){var t=[];return!1!==this.options.bulletList&&t.push(bd.configure(this.options.bulletList)),!1!==this.options.listItem&&t.push(wd.configure(this.options.listItem)),!1!==this.options.listKeymap&&t.push(Dd.configure(this.options.listKeymap)),!1!==this.options.orderedList&&t.push($d.configure(this.options.orderedList)),!1!==this.options.taskItem&&t.push(_d.configure(this.options.taskItem)),!1!==this.options.taskList&&t.push(jd.configure(this.options.taskList)),t}}),Kc.create({name:"paragraph",priority:1e3,addOptions:function(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML:function(){return[{tag:"p"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["p",ga(this.options.HTMLAttributes,e),0]},parseMarkdown:function(t,e){var n=t.tokens||[];return 1===n.length&&"image"===n[0].type?e.parseChildren([n[0]]):e.createNode("paragraph",void 0,e.parseInline(n))},renderMarkdown:function(t,e){return t&&Array.isArray(t.content)?e.renderChildren(t.content):""},addCommands:function(){var t=this;return{setParagraph:function(){return function(e){return e.commands.setNode(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Alt-0":function(){return t.editor.commands.setParagraph()}}}})),Vd=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Wd=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,qd=mc.create({name:"strike",addOptions:function(){return{HTMLAttributes:{}}},parseHTML:function(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:function(t){return!!t.includes("line-through")&&{}}}]},renderHTML:function(t){var e=t.HTMLAttributes;return["s",ga(this.options.HTMLAttributes,e),0]},markdownTokenName:"del",parseMarkdown:function(t,e){return e.applyMark("strike",e.parseInline(t.tokens||[]))},renderMarkdown:function(t,e){return"~~"+e.renderChildren(t)+"~~"},addCommands:function(){var t=this;return{setStrike:function(){return function(e){return e.commands.setMark(t.name)}},toggleStrike:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetStrike:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-s":function(){return t.editor.commands.toggleStrike()}}},addInputRules:function(){return[Lc({find:Vd,type:this.type})]},addPasteRules:function(){return[Uc({find:Wd,type:this.type})]}}),Kd=Kc.create({name:"text",group:"inline",parseMarkdown:function(t){return{type:"text",text:t.text||""}},renderMarkdown:function(t){return t.text||""}}),Ud=mc.create({name:"underline",addOptions:function(){return{HTMLAttributes:{}}},parseHTML:function(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:function(t){return!!t.includes("underline")&&{}}}]},renderHTML:function(t){var e=t.HTMLAttributes;return["u",ga(this.options.HTMLAttributes,e),0]},parseMarkdown:function(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown:function(t,e){return"++"+e.renderChildren(t)+"++"},markdownTokenizer:{name:"underline",level:"inline",start:function(t){return t.indexOf("++")},tokenize:function(t,e,n){var r=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(r){var o=r[2].trim();return{type:"underline",raw:r[0],text:o,tokens:n.inlineTokens(o)}}}},addCommands:function(){var t=this;return{setUnderline:function(){return function(e){return e.commands.setMark(t.name)}},toggleUnderline:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetUnderline:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-u":function(){return t.editor.commands.toggleUnderline()},"Mod-U":function(){return t.editor.commands.toggleUnderline()}}}});var Jd=function(){function t(t,e){var n,r=this;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(n=e.width)&&void 0!==n?n:1,this.color=!1===e.color?void 0:e.color||"black",this.class=e.class,this.handlers=["dragover","dragend","drop","dragleave"].map(function(e){var n=function(t){r[e](t)};return t.dom.addEventListener(e,n),{name:e,handler:n}})}var e=t.prototype;return e.destroy=function(){var t=this;this.handlers.forEach(function(e){var n=e.name,r=e.handler;return t.editorView.dom.removeEventListener(n,r)})},e.update=function(t,e){null!=this.cursorPos&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())},e.setCursor=function(t){t!=this.cursorPos&&(this.cursorPos=t,null==t?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())},e.updateOverlay=function(){var t,e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r=this.editorView.dom,o=r.getBoundingClientRect(),i=o.width/r.offsetWidth,s=o.height/r.offsetHeight;if(n){var a=e.nodeBefore,c=e.nodeAfter;if(a||c){var l=this.editorView.nodeDOM(this.cursorPos-(a?a.nodeSize:0));if(l){var u=l.getBoundingClientRect(),d=a?u.bottom:u.top;a&&c&&(d=(d+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);var f=this.width/2*s;t={left:u.left,right:u.right,top:d-f,bottom:d+f}}}}if(!t){var h=this.editorView.coordsAtPos(this.cursorPos),p=this.width/2*i;t={left:h.left-p,right:h.left+p,top:h.top,bottom:h.bottom}}var m,v,g=this.editorView.dom.offsetParent;if(this.element||(this.element=g.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!g||g==document.body&&"static"==getComputedStyle(g).position)m=-pageXOffset,v=-pageYOffset;else{var y=g.getBoundingClientRect(),k=y.width/g.offsetWidth,b=y.height/g.offsetHeight;m=y.left-g.scrollLeft*k,v=y.top-g.scrollTop*b}this.element.style.left=(t.left-m)/i+"px",this.element.style.top=(t.top-v)/s+"px",this.element.style.width=(t.right-t.left)/i+"px",this.element.style.height=(t.bottom-t.top)/s+"px"},e.scheduleRemoval=function(t){var e=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){return e.setCursor(null)},t)},e.dragover=function(t){if(this.editorView.editable){var e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),n=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),r=n&&n.type.spec.disableDropCursor,o="function"==typeof r?r(this.editorView,e,t):r;if(e&&!o){var i=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){var s=ce(this.editorView.state.doc,i,this.editorView.dragging.slice);null!=s&&(i=s)}this.setCursor(i),this.scheduleRemoval(5e3)}}},e.dragend=function(){this.scheduleRemoval(20)},e.drop=function(){this.scheduleRemoval(20)},e.dragleave=function(t){this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)},t}(),Gd=function(t){function e(e){return t.call(this,e,e)||this}f(e,t);var n=e.prototype;return n.map=function(t,n){var r=t.resolve(n.map(this.head));return e.valid(r)?new e(r):Me.near(r)},n.content=function(){return I.empty},n.eq=function(t){return t instanceof e&&t.head==this.head},n.toJSON=function(){return{type:"gapcursor",pos:this.head}},e.fromJSON=function(t,n){if("number"!=typeof n.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new e(t.resolve(n.pos))},n.getBookmark=function(){return new Zd(this.anchor)},e.valid=function(t){var e=t.parent;if(e.isTextblock||!function(t){for(var e=t.depth;e>=0;e--){var n=t.index(e),r=t.node(e);if(0!=n)for(var o=r.child(n-1);;o=o.lastChild){if(0==o.childCount&&!o.inlineContent||Qd(o.type))return!0;if(o.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(t)||!function(t){for(var e=t.depth;e>=0;e--){var n=t.indexAfter(e),r=t.node(e);if(n!=r.childCount)for(var o=r.child(n);;o=o.firstChild){if(0==o.childCount&&!o.inlineContent||Qd(o.type))return!0;if(o.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(t))return!1;var n=e.type.spec.allowGapCursor;if(null!=n)return n;var r=e.contentMatchAt(t.index()).defaultType;return r&&r.isTextblock},e.findGapCursorFrom=function(t,n,r){void 0===r&&(r=!1);t:for(;;){if(!r&&e.valid(t))return t;for(var o=t.pos,i=null,s=t.depth;;s--){var a=t.node(s);if(n>0?t.indexAfter(s)<a.childCount:t.index(s)>0){i=a.child(n>0?t.indexAfter(s):t.index(s)-1);break}if(0==s)return null;o+=n;var c=t.doc.resolve(o);if(e.valid(c))return c}for(;;){var l=n>0?i.firstChild:i.lastChild;if(!l){if(i.isAtom&&!i.isText&&!Re.isSelectable(i)){t=t.doc.resolve(o+i.nodeSize*n),r=!1;continue t}break}i=l,o+=n;var u=t.doc.resolve(o);if(e.valid(u))return u}return null}},e}(Me);Gd.prototype.visible=!1,Gd.findFrom=Gd.findGapCursorFrom,Me.jsonID("gapcursor",Gd);var Zd=function(){function t(t){this.pos=t}var e=t.prototype;return e.map=function(e){return new t(e.map(this.pos))},e.resolve=function(t){var e=t.resolve(this.pos);return Gd.valid(e)?new Gd(e):Me.near(e)},t}();function Qd(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}var Xd=Ui({ArrowLeft:Yd("horiz",-1),ArrowRight:Yd("horiz",1),ArrowUp:Yd("vert",-1),ArrowDown:Yd("vert",1)});function Yd(t,e){var n="vert"==t?e>0?"down":"up":e>0?"right":"left";return function(t,r,o){var i=t.selection,s=e>0?i.$to:i.$from,a=i.empty;if(i instanceof Ee){if(!o.endOfTextblock(n)||0==s.depth)return!1;a=!1,s=t.doc.resolve(e>0?s.after():s.before())}var c=Gd.findGapCursorFrom(s,e,a);return!!c&&(r&&r(t.tr.setSelection(new Gd(c))),!0)}}function tf(t,e,n){if(!t||!t.editable)return!1;var r=t.state.doc.resolve(e);if(!Gd.valid(r))return!1;var o=t.posAtCoords({left:n.clientX,top:n.clientY});return!(o&&o.inside>-1&&Re.isSelectable(t.state.doc.nodeAt(o.inside))||(t.dispatch(t.state.tr.setSelection(new Gd(r))),0))}function ef(t,e){if("insertCompositionText"!=e.inputType||!(t.state.selection instanceof Gd))return!1;var n=t.state.selection.$from,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;for(var o=A.empty,i=r.length-1;i>=0;i--)o=A.from(r[i].createAndFill(null,o));var s=t.state.tr.replace(n.pos,n.pos,new I(o,0,0));return s.setSelection(Ee.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function nf(t){if(!(t.selection instanceof Gd))return null;var e=document.createElement("div");return e.className="ProseMirror-gapcursor",si.create(t.doc,[ri.widget(t.selection.head,e,{key:"gapcursor"})])}var rf=200,of=function(){};of.prototype.append=function(t){return t.length?(t=of.from(t),!this.length&&t||t.length<rf&&this.leafAppend(t)||this.length<rf&&t.leafPrepend(this)||this.appendInner(t)):this},of.prototype.prepend=function(t){return t.length?of.from(t).append(this):this},of.prototype.appendInner=function(t){return new af(this,t)},of.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.length),t>=e?of.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))},of.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)},of.prototype.forEach=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length),e<=n?this.forEachInner(t,e,n,0):this.forEachInvertedInner(t,e,n,0)},of.prototype.map=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length);var r=[];return this.forEach(function(e,n){return r.push(t(e,n))},e,n),r},of.from=function(t){return t instanceof of?t:t&&t.length?new sf(t):of.empty};var sf=function(t){function e(e){t.call(this),this.values=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(t,n){return 0==t&&n==this.length?this:new e(this.values.slice(t,n))},e.prototype.getInner=function(t){return this.values[t]},e.prototype.forEachInner=function(t,e,n,r){for(var o=e;o<n;o++)if(!1===t(this.values[o],r+o))return!1},e.prototype.forEachInvertedInner=function(t,e,n,r){for(var o=e-1;o>=n;o--)if(!1===t(this.values[o],r+o))return!1},e.prototype.leafAppend=function(t){if(this.length+t.length<=rf)return new e(this.values.concat(t.flatten()))},e.prototype.leafPrepend=function(t){if(this.length+t.length<=rf)return new e(t.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(of);of.empty=new sf([]);var af=function(t){function e(e,n){t.call(this),this.left=e,this.right=n,this.length=e.length+n.length,this.depth=Math.max(e.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(t){return t<this.left.length?this.left.get(t):this.right.get(t-this.left.length)},e.prototype.forEachInner=function(t,e,n,r){var o=this.left.length;return!(e<o&&!1===this.left.forEachInner(t,e,Math.min(n,o),r))&&!(n>o&&!1===this.right.forEachInner(t,Math.max(e-o,0),Math.min(this.length,n)-o,r+o))&&void 0},e.prototype.forEachInvertedInner=function(t,e,n,r){var o=this.left.length;return!(e>o&&!1===this.right.forEachInvertedInner(t,e-o,Math.max(n,o)-o,r+o))&&!(n<o&&!1===this.left.forEachInvertedInner(t,Math.min(e,o),n,r))&&void 0},e.prototype.sliceInner=function(t,e){if(0==t&&e==this.length)return this;var n=this.left.length;return e<=n?this.left.slice(t,e):t>=n?this.right.slice(t-n,e-n):this.left.slice(t,n).append(this.right.slice(0,e-n))},e.prototype.leafAppend=function(t){var n=this.right.leafAppend(t);if(n)return new e(this.left,n)},e.prototype.leafPrepend=function(t){var n=this.left.leafPrepend(t);if(n)return new e(n,this.right)},e.prototype.appendInner=function(t){return this.left.depth>=Math.max(this.right.depth,t.depth)+1?new e(this.left,new e(this.right,t)):new e(this,t)},e}(of);const cf=of;var lf=function(){function t(t,e){this.items=t,this.eventCount=e}var e=t.prototype;return e.popEvent=function(e,n){var r=this;if(0==this.eventCount)return null;for(var o,i,s=this.items.length;;s--)if(this.items.get(s-1).selection){--s;break}n&&(o=this.remapping(s,this.items.length),i=o.maps.length);var a,c,l=e.tr,u=[],d=[];return this.items.forEach(function(e,n){if(!e.step)return o||(o=r.remapping(s,n+1),i=o.maps.length),i--,void d.push(e);if(o){d.push(new uf(e.map));var f,h=e.step.map(o.slice(i));h&&l.maybeStep(h).doc&&(f=l.mapping.maps[l.mapping.maps.length-1],u.push(new uf(f,void 0,void 0,u.length+d.length))),i--,f&&o.appendMap(f,i)}else l.maybeStep(e.step);return e.selection?(a=o?e.selection.map(o.slice(i)):e.selection,c=new t(r.items.slice(0,s).append(d.reverse().concat(u)),r.eventCount-1),!1):void 0},this.items.length,0),{remaining:c,transform:l,selection:a}},e.addTransform=function(e,n,r,o){for(var i=[],s=this.eventCount,a=this.items,c=!o&&a.length?a.get(a.length-1):null,l=0;l<e.steps.length;l++){var u,d=e.steps[l].invert(e.docs[l]),f=new uf(e.mapping.maps[l],d,n);(u=c&&c.merge(f))&&(f=u,l?i.pop():a=a.slice(0,a.length-1)),i.push(f),n&&(s++,n=void 0),o||(c=f)}var h,p,m,v=s-r.depth;return v>ff&&(p=v,(h=a).forEach(function(t,e){if(t.selection&&0==p--)return m=e,!1}),a=h.slice(m),s-=v),new t(a.append(i),s)},e.remapping=function(t,e){var n=new Ht;return this.items.forEach(function(e,r){var o=null!=e.mirrorOffset&&r-e.mirrorOffset>=t?n.maps.length-e.mirrorOffset:void 0;n.appendMap(e.map,o)},t,e),n},e.addMaps=function(e){return 0==this.eventCount?this:new t(this.items.append(e.map(function(t){return new uf(t)})),this.eventCount)},e.rebased=function(e,n){if(!this.eventCount)return this;var r=[],o=Math.max(0,this.items.length-n),i=e.mapping,s=e.steps.length,a=this.eventCount;this.items.forEach(function(t){t.selection&&a--},o);var c=n;this.items.forEach(function(t){var n=i.getMirror(--c);if(null!=n){s=Math.min(s,n);var o=i.maps[n];if(t.step){var l=e.steps[n].invert(e.docs[n]),u=t.selection&&t.selection.map(i.slice(c+1,n));u&&a++,r.push(new uf(o,l,u))}else r.push(new uf(o))}},o);for(var l=[],u=n;u<s;u++)l.push(new uf(i.maps[u]));var d=new t(this.items.slice(0,o).append(l).append(r),a);return d.emptyItemCount()>500&&(d=d.compress(this.items.length-r.length)),d},e.emptyItemCount=function(){var t=0;return this.items.forEach(function(e){e.step||t++}),t},e.compress=function(e){void 0===e&&(e=this.items.length);var n=this.remapping(0,e),r=n.maps.length,o=[],i=0;return this.items.forEach(function(t,s){if(s>=e)o.push(t),t.selection&&i++;else if(t.step){var a=t.step.map(n.slice(r)),c=a&&a.getMap();if(r--,c&&n.appendMap(c,r),a){var l=t.selection&&t.selection.map(n.slice(r));l&&i++;var u,d=new uf(c.invert(),a,l),f=o.length-1;(u=o.length&&o[f].merge(d))?o[f]=u:o.push(d)}}else t.map&&r--},this.items.length,0),new t(cf.from(o.reverse()),i)},t}();lf.empty=new lf(cf.empty,0);var uf=function(){function t(t,e,n,r){this.map=t,this.step=e,this.selection=n,this.mirrorOffset=r}return t.prototype.merge=function(e){if(this.step&&e.step&&!e.selection){var n=e.step.merge(this.step);if(n)return new t(n.getMap().invert(),n,this.selection)}},t}(),df=function(t,e,n,r,o){this.done=t,this.undone=e,this.prevRanges=n,this.prevTime=r,this.prevComposition=o},ff=20;function hf(t){for(var e=[],n=t.length-1;n>=0&&0==e.length;n--)t[n].forEach(function(t,n,r,o){return e.push(r,o)});return e}function pf(t,e){if(!t)return null;for(var n=[],r=0;r<t.length;r+=2){var o=e.map(t[r],1),i=e.map(t[r+1],-1);o<=i&&n.push(o,i)}return n}var mf=!1,vf=null;function gf(t){var e=t.plugins;if(vf!=e){mf=!1,vf=e;for(var n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){mf=!0;break}}return mf}var yf=new Ue("history"),kf=new Ue("closeHistory");function bf(t,e){return function(n,r){var o=yf.getState(n);if(!o||0==(t?o.undone:o.done).eventCount)return!1;if(r){var i=function(t,e,n){var r=gf(e),o=yf.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;var s=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),o,r),c=new df(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(s).setMeta(yf,{redo:n,historyState:c})}(o,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}var wf=bf(!1,!0),xf=bf(!0,!0);bf(!1,!1),bf(!0,!1),bc.create({name:"characterCount",addOptions:function(){return{limit:null,mode:"textSize",textCounter:function(t){return t.length},wordCounter:function(t){return t.split(" ").filter(function(t){return""!==t}).length}}},addStorage:function(){return{characters:function(){return 0},words:function(){return 0}}},onBeforeCreate:function(){var t=this;this.storage.characters=function(e){var n=(null==e?void 0:e.node)||t.editor.state.doc;if("textSize"===((null==e?void 0:e.mode)||t.options.mode)){var r=n.textBetween(0,n.content.size,void 0," ");return t.options.textCounter(r)}return n.nodeSize},this.storage.words=function(e){var n=(null==e?void 0:e.node)||t.editor.state.doc,r=n.textBetween(0,n.content.size," "," ");return t.options.wordCounter(r)}},addProseMirrorPlugins:function(){var t=this,e=!1;return[new We({key:new Ue("characterCount"),appendTransaction:function(n,r,o){if(!e){var i=t.options.limit;if(null!=i&&0!==i){var s=t.storage.characters({node:o.doc});if(s>i){var a=s-i;console.warn("[CharacterCount] Initial content exceeded limit of "+i+" characters. Content was automatically trimmed.");var c=o.tr.deleteRange(0,a);return e=!0,c}e=!0}else e=!0}},filterTransaction:function(e,n){var r=t.options.limit;if(!e.docChanged||0===r||null==r)return!0;var o=t.storage.characters({node:n.doc}),i=t.storage.characters({node:e.doc});if(i<=r)return!0;if(o>r&&i>r&&i<=o)return!0;if(o>r&&i>r&&i>o)return!1;if(!e.getMeta("paste"))return!1;var s=e.selection.$head.pos,a=s-(i-r),c=s;return e.deleteRange(a,c),!(t.storage.characters({node:e.doc})>r)}})]}});var Sf=bc.create({name:"dropCursor",addOptions:function(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins:function(){return[(t=this.options,void 0===t&&(t={}),new We({view:function(e){return new Jd(e,t)}}))];var t}}),Cf=(bc.create({name:"focus",addOptions:function(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins:function(){var t=this;return[new We({key:new Ue("focus"),props:{decorations:function(e){var n=e.doc,r=e.selection,o=t.editor,i=o.isEditable,s=o.isFocused,a=r.anchor,c=[];if(!i||!s)return si.create(n,[]);var l=0;"deepest"===t.options.mode&&n.descendants(function(t,e){if(!t.isText){if(!(a>=e&&a<=e+t.nodeSize-1))return!1;l+=1}});var u=0;return n.descendants(function(e,n){return!e.isText&&a>=n&&a<=n+e.nodeSize-1&&(u+=1,"deepest"===t.options.mode&&l-u>0||"shallowest"===t.options.mode&&u>1?"deepest"===t.options.mode:void c.push(ri.node(n,n+e.nodeSize,{class:t.options.className})))}),si.create(n,c)}}})]}}),bc.create({name:"gapCursor",addProseMirrorPlugins:function(){return[new We({props:{decorations:nf,createSelectionBetween:function(t,e,n){return e.pos==n.pos&&Gd.valid(n)?new Gd(n):null},handleClick:tf,handleKeyDown:Xd,handleDOMEvents:{beforeinput:ef}}})]},extendNodeSchema:function(t){var e;return{allowGapCursor:null!=(e=pa(ua(t,"allowGapCursor",{name:t.name,options:t.options,storage:t.storage})))?e:null}}})),Mf=bc.create({name:"placeholder",addOptions:function(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something …",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins:function(){var t=this;return[new We({key:new Ue("placeholder"),props:{decorations:function(e){var n=e.doc,r=e.selection,o=t.editor.isEditable||!t.options.showOnlyWhenEditable,i=r.anchor,s=[];if(!o)return null;var a=t.editor.isEmpty;return n.descendants(function(e,n){var r=i>=n&&i<=n+e.nodeSize,o=!e.isLeaf&&Pa(e);if((r||!t.options.showOnlyCurrent)&&o){var c=[t.options.emptyNodeClass];a&&c.push(t.options.emptyEditorClass);var l=ri.node(n,n+e.nodeSize,{class:c.join(" "),"data-placeholder":"function"==typeof t.options.placeholder?t.options.placeholder({editor:t.editor,node:e,pos:n,hasAnchor:r}):t.options.placeholder});s.push(l)}return t.options.includeChildren}),si.create(n,s)}}})]}});function Tf(t){var e=t.types,n=t.node;return n&&Array.isArray(e)&&e.includes(n.type)||(null==n?void 0:n.type)===e}bc.create({name:"selection",addOptions:function(){return{className:"selection"}},addProseMirrorPlugins:function(){var t=this.editor,e=this.options;return[new We({key:new Ue("selection"),props:{decorations:function(n){return n.selection.empty||t.isFocused||!t.isEditable||za(n.selection)||t.view.dragging?null:si.create(n.doc,[ri.inline(n.selection.from,n.selection.to,{class:e.className})])}}})]}});var Af=bc.create({name:"trailingNode",addOptions:function(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins:function(){var t,e=this,n=new Ue(this.name),r=this.options.node||(null==(t=this.editor.schema.topNodeType.contentMatch.defaultType)?void 0:t.name)||"paragraph",o=Object.entries(this.editor.schema.nodes).map(function(t){return t[1]}).filter(function(t){return(e.options.notAfter||[]).concat(r).includes(t.name)});return[new We({key:n,appendTransaction:function(t,e,o){var i=o.doc,s=o.tr,a=o.schema,c=n.getState(o),l=i.content.size,u=a.nodes[r];if(c)return s.insert(l,u.create())},state:{init:function(t,e){return!Tf({node:e.tr.doc.lastChild,types:o})},apply:function(t,e){return t.docChanged?t.getMeta("__uniqueIDTransaction")?e:!Tf({node:t.doc.lastChild,types:o}):e}}})]}}),Of=bc.create({name:"undoRedo",addOptions:function(){return{depth:100,newGroupDelay:500}},addCommands:function(){return{undo:function(){return function(t){var e=t.state,n=t.dispatch;return wf(e,n)}},redo:function(){return function(t){var e=t.state,n=t.dispatch;return xf(e,n)}}}},addProseMirrorPlugins:function(){return[(t=this.options,void 0===t&&(t={}),t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new We({key:yf,state:{init:function(){return new df(lf.empty,lf.empty,null,0,-1)},apply:function(e,n,r){return function(t,e,n,r){var o,i=n.getMeta(yf);if(i)return i.historyState;n.getMeta(kf)&&(t=new df(t.done,t.undone,null,0,-1));var s=n.getMeta("appendedTransaction");if(0==n.steps.length)return t;if(s&&s.getMeta(yf))return s.getMeta(yf).redo?new df(t.done.addTransform(n,void 0,r,gf(e)),t.undone,hf(n.mapping.maps),t.prevTime,t.prevComposition):new df(t.done,t.undone.addTransform(n,void 0,r,gf(e)),null,t.prevTime,t.prevComposition);if(!1===n.getMeta("addToHistory")||s&&!1===s.getMeta("addToHistory"))return(o=n.getMeta("rebased"))?new df(t.done.rebased(n,o),t.undone.rebased(n,o),pf(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new df(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),pf(t.prevRanges,n.mapping),t.prevTime,t.prevComposition);var a=n.getMeta("composition"),c=0==t.prevTime||!s&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!function(t,e){if(!e)return!1;if(!t.docChanged)return!0;var n=!1;return t.mapping.maps[0].forEach(function(t,r){for(var o=0;o<e.length;o+=2)t<=e[o+1]&&r>=e[o]&&(n=!0)}),n}(n,t.prevRanges)),l=s?pf(t.prevRanges,n.mapping):hf(n.mapping.maps);return new df(t.done.addTransform(n,c?e.selection.getBookmark():void 0,r,gf(e)),lf.empty,l,n.time,null==a?t.prevComposition:a)}(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput:function(t,e){var n=e.inputType,r="historyUndo"==n?wf:"historyRedo"==n?xf:null;return!(!r||!t.editable)&&(e.preventDefault(),r(t.state,t.dispatch))}}}}))];var t},addKeyboardShortcuts:function(){var t=this;return{"Mod-z":function(){return t.editor.commands.undo()},"Shift-Mod-z":function(){return t.editor.commands.redo()},"Mod-y":function(){return t.editor.commands.redo()},"Mod-я":function(){return t.editor.commands.undo()},"Shift-Mod-я":function(){return t.editor.commands.redo()}}}}),Ef=bc.create({name:"starterKit",addExtensions:function(){var t,e,n,r,o=[];return!1!==this.options.bold&&o.push(rl.configure(this.options.bold)),!1!==this.options.blockquote&&o.push(Xc.configure(this.options.blockquote)),!1!==this.options.bulletList&&o.push(bd.configure(this.options.bulletList)),!1!==this.options.code&&o.push(sl.configure(this.options.code)),!1!==this.options.codeBlock&&o.push(ll.configure(this.options.codeBlock)),!1!==this.options.document&&o.push(ul.configure(this.options.document)),!1!==this.options.dropcursor&&o.push(Sf.configure(this.options.dropcursor)),!1!==this.options.gapcursor&&o.push(Cf.configure(this.options.gapcursor)),!1!==this.options.hardBreak&&o.push(dl.configure(this.options.hardBreak)),!1!==this.options.heading&&o.push(fl.configure(this.options.heading)),!1!==this.options.undoRedo&&o.push(Of.configure(this.options.undoRedo)),!1!==this.options.horizontalRule&&o.push(hl.configure(this.options.horizontalRule)),!1!==this.options.italic&&o.push(yl.configure(this.options.italic)),!1!==this.options.listItem&&o.push(wd.configure(this.options.listItem)),!1!==this.options.listKeymap&&o.push(Dd.configure(null==(t=this.options)?void 0:t.listKeymap)),!1!==this.options.link&&o.push(md.configure(null==(e=this.options)?void 0:e.link)),!1!==this.options.orderedList&&o.push($d.configure(this.options.orderedList)),!1!==this.options.paragraph&&o.push(Fd.configure(this.options.paragraph)),!1!==this.options.strike&&o.push(qd.configure(this.options.strike)),!1!==this.options.text&&o.push(Kd.configure(this.options.text)),!1!==this.options.underline&&o.push(Ud.configure(null==(n=this.options)?void 0:n.underline)),!1!==this.options.trailingNode&&o.push(Af.configure(null==(r=this.options)?void 0:r.trailingNode)),o}}),Nf=n(709);function Rf(t,e){var n=e.split("\n").flatMap(function(t){return[t,""]}).map(function(e){return""+t+e}).join("\n");return n.slice(0,n.length-1)}function Df(t){var e=(t.raw||t.text||"").match(/^(\s*)[-+*]\s+\[([ xX])\]\s+/);return e?{isTask:!0,checked:"x"===e[2].toLowerCase(),indentLevel:e[1].length}:{isTask:!1,indentLevel:0}}function If(t,e){return"string"!=typeof t?"json":e}var Lf,Pf,zf=function(){function t(t){var e,n,r,o,i,s=this;this.baseExtensions=[],this.extensions=[],this.lastParseResult=null,this.markedInstance=null!=(e=null==t?void 0:t.marked)?e:Nf.marked,this.lexer=new this.markedInstance.Lexer,this.indentStyle=null!=(r=null==(n=null==t?void 0:t.indentation)?void 0:n.style)?r:"space",this.indentSize=null!=(i=null==(o=null==t?void 0:t.indentation)?void 0:o.size)?i:2,this.baseExtensions=(null==t?void 0:t.extensions)||[],(null==t?void 0:t.markedOptions)&&"function"==typeof this.markedInstance.setOptions&&this.markedInstance.setOptions(t.markedOptions),this.registry=new Map,this.nodeTypeRegistry=new Map,(null==t?void 0:t.extensions)&&(this.baseExtensions=t.extensions,da(t.extensions).forEach(function(t){return s.registerExtension(t,!1)})),this.lexer=new this.markedInstance.Lexer}var e=t.prototype;return e.hasMarked=function(){return!!this.markedInstance},e.registerExtension=function(t,e){var n,r;void 0===e&&(e=!0),this.extensions.push(t);var o=t.name,i=ua(t,"markdownTokenName")||o,s=ua(t,"parseMarkdown"),a=ua(t,"renderMarkdown"),c=ua(t,"markdownTokenizer"),l=null!=(n=ua(t,"markdownOptions"))?n:null,u={tokenName:i,nodeName:o,parseMarkdown:s,renderMarkdown:a,isIndenting:null!=(r=null==l?void 0:l.indentsContent)&&r,tokenizer:c};if(i&&s){var d=this.registry.get(i)||[];d.push(u),this.registry.set(i,d)}if(a){var f=this.nodeTypeRegistry.get(o)||[];f.push(u),this.nodeTypeRegistry.set(o,f)}c&&this.hasMarked()&&(this.registerTokenizer(c),e&&(this.lexer=new this.markedInstance.Lexer))},e.registerTokenizer=function(t){var e=this;if(this.hasMarked()){var n=t.name,r=t.start,o=t.level,i=void 0===o?"inline":o,s=t.tokenize,a={inlineTokens:function(t){return e.lexer.inlineTokens(t)},blockTokens:function(t){return e.lexer.blockTokens(t)}},c={name:n,level:i,start:r?"function"==typeof r?r:function(t){return t.indexOf(r)}:function(t){var e=s(t,[],a);return e&&e.raw?t.indexOf(e.raw):-1},tokenizer:function(t,e){var r=s(t,e,a);if(r&&r.type)return y({},r,{type:r.type||n,raw:r.raw||"",tokens:r.tokens||[]})},childTokens:[]};this.markedInstance.use({extensions:[c]})}},e.getHandlersForToken=function(t){try{return this.registry.get(t)||[]}catch(t){return[]}},e.getHandlerForToken=function(t){var e=this.getHandlersForToken(t);if(e.length>0)return e[0];var n=this.getHandlersForNodeType(t);return n.length>0?n[0]:void 0},e.getHandlersForNodeType=function(t){try{return this.nodeTypeRegistry.get(t)||[]}catch(t){return[]}},e.serialize=function(t){return t?(Array.isArray(t),this.renderNodes(t,t)):""},e.parse=function(t){if(!this.hasMarked())throw new Error("No marked instance available for parsing");var e=this.markedInstance.lexer(t);return{type:"doc",content:this.parseTokens(e)}},e.parseTokens=function(t){var e=this;return t.map(function(t){return e.parseToken(t)}).filter(function(t){return null!==t}).flatMap(function(t){return Array.isArray(t)?t:[t]})},e.parseToken=function(t){var e=this;if(!t.type)return null;if("list"===t.type)return this.parseListToken(t);var n=this.getHandlersForToken(t.type),r=this.createParseHelpers();if(n.find(function(n){if(!n.parseMarkdown)return!1;var o=n.parseMarkdown(t,r),i=e.normalizeParseResult(o);return!(!i||Array.isArray(i)&&!(i.length>0)||(e.lastParseResult=i,0))})&&this.lastParseResult){var o=this.lastParseResult;return this.lastParseResult=null,o}return this.parseFallbackToken(t)},e.parseListToken=function(t){var e=this;if(!t.items||0===t.items.length)return this.parseTokenWithHandlers(t);var n=t.items.some(function(t){return Df(t).isTask}),r=t.items.some(function(t){return!Df(t).isTask});if(!n||!r||0===this.getHandlersForToken("taskList").length)return this.parseTokenWithHandlers(t);for(var o=[],i=[],s=null,a=function(){var n=t.items[c],r=Df(n),a=r.isTask,l=r.checked,u=r.indentLevel,d=n;if(a){var f=(n.raw||n.text||"").split("\n"),h=f[0].match(/^\s*[-+*]\s+\[([ xX])\]\s+(.*)$/),p=h?h[2]:"",m=[];if(f.length>1&&f.slice(1).join("\n").trim()){var v=f.slice(1),g=v.filter(function(t){return t.trim()});if(g.length>0){var y=Math.min.apply(Math,g.map(function(t){return t.length-t.trimStart().length})),k=v.map(function(t){return t.trim()?t.slice(y):""}).join("\n").trim();k&&(m=e.markedInstance.lexer(k+"\n"))}}d={type:"taskItem",raw:"",mainContent:p,indentLevel:u,checked:null!=l&&l,text:p,tokens:e.lexer.inlineTokens(p),nestedTokens:m}}var b=a?"taskList":"list";s!==b?(i.length>0&&o.push({type:s,items:i}),i=[d],s=b):i.push(d)},c=0;c<t.items.length;c+=1)a();i.length>0&&o.push({type:s,items:i});for(var l=[],u=0;u<o.length;u+=1){var d=o[u],f=y({},t,{type:d.type,items:d.items}),h=this.parseToken(f);h&&(Array.isArray(h)?l.push.apply(l,h):l.push(h))}return l.length>0?l:null},e.parseTokenWithHandlers=function(t){var e=this;if(!t.type)return null;var n=this.getHandlersForToken(t.type),r=this.createParseHelpers();if(n.find(function(n){if(!n.parseMarkdown)return!1;var o=n.parseMarkdown(t,r),i=e.normalizeParseResult(o);return!(!i||Array.isArray(i)&&!(i.length>0)||(e.lastParseResult=i,0))})&&this.lastParseResult){var o=this.lastParseResult;return this.lastParseResult=null,o}return this.parseFallbackToken(t)},e.createParseHelpers=function(){var t=this;return{parseInline:function(e){return t.parseInlineTokens(e)},parseChildren:function(e){return t.parseTokens(e)},createTextNode:function(t,e){return{type:"text",text:t,marks:e||void 0}},createNode:function(t,e,n){var r={type:t,attrs:e||void 0,content:n||void 0};return e&&0!==Object.keys(e).length||delete r.attrs,r},applyMark:function(t,e,n){return{mark:t,content:e,attrs:n&&Object.keys(n).length>0?n:void 0}}}},e.escapeRegex=function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},e.parseInlineTokens=function(t){for(var e,n,r,o,i=[],s=0;s<t.length;s+=1){var a=t[s];if("text"===a.type)i.push({type:"text",text:a.text||""});else if("html"===a.type){var c=(null!=(n=null!=(e=a.raw)?e:a.text)?n:"").toString(),l=/^<\/[\s]*[\w-]+/i.test(c),u=c.match(/^<[\s]*([\w-]+)(\s|>|\/|$)/i);if(!l&&u&&!/\/>$/.test(c)){for(var d=u[1],f=this.escapeRegex(d),h=new RegExp("^<\\/\\s*"+f+"\\b","i"),p=-1,m=[c],v=s+1;v<t.length;v+=1){var g=t[v],y=(null!=(o=null!=(r=g.raw)?r:g.text)?o:"").toString();if(m.push(y),"html"===g.type&&h.test(y)){p=v;break}}if(-1!==p){var k=m.join(""),b={type:"html",raw:k,text:k,block:!1},w=this.parseHTMLToken(b);if(w){var x=this.normalizeParseResult(w);Array.isArray(x)?i.push.apply(i,x):x&&i.push(x)}s=p;continue}}var S=this.parseHTMLToken(a);if(S){var C=this.normalizeParseResult(S);Array.isArray(C)?i.push.apply(i,C):C&&i.push(C)}}else if(a.type){var M=this.getHandlerForToken(a.type);if(M&&M.parseMarkdown){var T=this.createParseHelpers(),A=M.parseMarkdown(a,T);if(this.isMarkResult(A)){var O=this.applyMarkToContent(A.mark,A.content,A.attrs);i.push.apply(i,O)}else{var E=this.normalizeParseResult(A);Array.isArray(E)?i.push.apply(i,E):E&&i.push(E)}}else a.tokens&&i.push.apply(i,this.parseInlineTokens(a.tokens))}}return i},e.applyMarkToContent=function(t,e,n){var r=this;return e.map(function(e){if("text"===e.type){var o=e.marks||[];return y({},e,{marks:[].concat(o,[n?{type:t,attrs:n}:{type:t}])})}return y({},e,{content:e.content?r.applyMarkToContent(t,e.content,n):void 0})})},e.isMarkResult=function(t){return t&&"object"==typeof t&&"mark"in t},e.normalizeParseResult=function(t){return t?this.isMarkResult(t)?t.content:t:null},e.parseFallbackToken=function(t){switch(t.type){case"paragraph":return{type:"paragraph",content:t.tokens?this.parseInlineTokens(t.tokens):[]};case"heading":return{type:"heading",attrs:{level:t.depth||1},content:t.tokens?this.parseInlineTokens(t.tokens):[]};case"text":return{type:"text",text:t.text||""};case"html":return this.parseHTMLToken(t);case"space":return null;default:return t.tokens?this.parseTokens(t.tokens):null}},e.parseHTMLToken=function(t){var e=t.text||t.raw||"";if(!e.trim())return null;try{var n=function(t,e){var n=function(t,e){return xa(Ca(t),e)}(e),r=Ns(t);return kt.fromSchema(n).parse(r).toJSON()}(e,this.baseExtensions);return"doc"===n.type&&n.content?t.block?n.content:1===n.content.length&&"paragraph"===n.content[0].type&&n.content[0].content?n.content[0].content:n.content:n}catch(t){throw new Error("Failed to parse HTML in markdown: "+t)}},e.renderNodeToMarkdown=function(t,e,n,r){var o,i=this;if(void 0===n&&(n=0),void 0===r&&(r=0),"text"===t.type)return t.text||"";if(!t.type)return"";var s=this.getHandlerForToken(t.type);if(!s)return"";var a={renderChildren:function(e,o){var a=s.isIndenting?r+1:r;return!Array.isArray(e)&&e.content?i.renderNodes(e.content,t,o||"",n,a):i.renderNodes(e,t,o||"",n,a)},indent:function(t){return i.indentString+t},wrapInBlock:Rf},c={index:n,level:r,parentType:null==e?void 0:e.type,meta:{}};return(null==(o=s.renderMarkdown)?void 0:o.call(s,t,a,c))||""},e.renderNodes=function(t,e,n,r,o){return void 0===n&&(n=""),void 0===r&&(r=0),void 0===o&&(o=0),Array.isArray(t)?this.renderNodesWithMarkBoundaries(t,e,n,o):t.type?this.renderNodeToMarkdown(t,e,r,o):""},e.renderNodesWithMarkBoundaries=function(t,e,n,r){var o=this;void 0===n&&(n=""),void 0===r&&(r=0);var i=[],s=new Map;return t.forEach(function(n,a){var c=a<t.length-1?t[a+1]:null;if(n.type)if("text"===n.type){var l=n.text||"",u=new Map((n.marks||[]).map(function(t){return[t.type,t]})),d=function(t,e){var n=[];return Array.from(t.keys()).forEach(function(t){e.has(t)||n.push(t)}),n}(s,u),f=function(t,e){var n=[];return Array.from(e.entries()).forEach(function(e){var r=e[0],o=e[1];t.has(r)||n.push({type:r,mark:o})}),n}(s,u);d.forEach(function(t){var e=s.get(t),n=o.getMarkClosing(t,e);n&&(l+=n),s.delete(t)});var h="";if(f.length>0){var p=l.match(/^(\s+)/);p&&(h=p[1],l=l.slice(h.length))}f.forEach(function(t){var e=t.type,n=t.mark,r=o.getMarkOpening(e,n);r&&(l=r+l),s.set(e,n)}),l=h+l;var m=function(t,e,n,r){var o=!n,i=n&&"text"===n.type&&(!n.marks||0===n.marks.length),s=n&&"text"===n.type&&n.marks&&!r(e,new Map(n.marks.map(function(t){return[t.type,t]}))),a=[];if(o||i||s)if(n&&"text"===n.type&&n.marks){var c=new Map(n.marks.map(function(t){return[t.type,t]}));Array.from(t.keys()).forEach(function(t){c.has(t)||a.push(t)})}else(o||i)&&a.push.apply(a,Array.from(t.keys()));return a}(s,u,c,o.markSetsEqual.bind(o)),v="";if(m.length>0){var g=l.match(/(\s+)$/);g&&(v=g[1],l=l.slice(0,-v.length))}m.forEach(function(t){var e=s.get(t),n=o.getMarkClosing(t,e);n&&(l+=n),s.delete(t)}),l+=v,i.push(l)}else{var y=new Map(s),k=function(t,e){var n="";return Array.from(t.keys()).reverse().forEach(function(r){var o=t.get(r),i=e(r,o);i&&(n=i+n)}),t.clear(),n}(s,o.getMarkClosing.bind(o)),b=o.renderNodeToMarkdown(n,e,a,r),w="hardBreak"===n.type?"":function(t,e,n){var r="";return Array.from(t.entries()).forEach(function(t){var o=t[0],i=t[1],s=n(o,i);s&&(r+=s),e.set(o,i)}),r}(y,s,o.getMarkOpening.bind(o));i.push(k+b+w)}}),i.join(n)},e.getMarkOpening=function(t,e){var n=this.getHandlersForNodeType(t),r=n.length>0?n[0]:void 0;if(!r||!r.renderMarkdown)return"";var o="__TIPTAP_MARKDOWN_PLACEHOLDER__",i={type:t,attrs:e.attrs||{},content:[{type:"text",text:o}]};try{var s=r.renderMarkdown(i,{renderChildren:function(){return o},indent:function(t){return t},wrapInBlock:function(t,e){return t+e}},{index:0,level:0,parentType:"text",meta:{}}),a=s.indexOf(o);return a>=0?s.substring(0,a):""}catch(e){throw new Error("Failed to get mark opening for "+t+": "+e)}},e.getMarkClosing=function(t,e){var n=this.getHandlersForNodeType(t),r=n.length>0?n[0]:void 0;if(!r||!r.renderMarkdown)return"";var o="__TIPTAP_MARKDOWN_PLACEHOLDER__",i={type:t,attrs:e.attrs||{},content:[{type:"text",text:o}]};try{var s=r.renderMarkdown(i,{renderChildren:function(){return o},indent:function(t){return t},wrapInBlock:function(t,e){return t+e}},{index:0,level:0,parentType:"text",meta:{}}),a=s.indexOf(o),c=a+33;return a>=0?s.substring(c):""}catch(e){throw new Error("Failed to get mark closing for "+t+": "+e)}},e.markSetsEqual=function(t,e){return t.size===e.size&&Array.from(t.keys()).every(function(t){return e.has(t)})},g(t,[{key:"instance",get:function(){return this.markedInstance}},{key:"indentCharacter",get:function(){return"space"===this.indentStyle?" ":"\t"}},{key:"indentString",get:function(){return this.indentCharacter.repeat(this.indentSize)}}])}(),Bf=zf,$f=bc.create({name:"markdown",addOptions:function(){return{indentation:{style:"space",size:2},marked:void 0,markedOptions:{}}},addCommands:function(){var t=this;return{setContent:function(e,n){if(!(null==n?void 0:n.contentType))return Xi.setContent(e,n);if("markdown"!==If(e,null==n?void 0:n.contentType)||!t.editor.markdown)return Xi.setContent(e,n);var r=t.editor.markdown.parse(e);return Xi.setContent(r,n)},insertContent:function(e,n){if(!(null==n?void 0:n.contentType))return Xi.insertContent(e,n);if("markdown"!==If(e,null==n?void 0:n.contentType)||!t.editor.markdown)return Xi.insertContent(e,n);var r=t.editor.markdown.parse(e);return Xi.insertContent(r,n)},insertContentAt:function(e,n,r){if(!(null==r?void 0:r.contentType))return Xi.insertContentAt(e,n,r);if("markdown"!==If(n,null==r?void 0:r.contentType)||!t.editor.markdown)return Xi.insertContentAt(e,n,r);var o=t.editor.markdown.parse(n);return Xi.insertContentAt(e,o,r)}}},addStorage:function(){return{manager:new Bf({indentation:this.options.indentation,marked:this.options.marked,markedOptions:this.options.markedOptions,extensions:[]})}},onBeforeCreate:function(){var t=this;if(this.editor.markdown)console.error("[tiptap][markdown]: There is already a `markdown` property on the editor instance. This might lead to unexpected behavior.");else if(this.storage.manager=new Bf({indentation:this.options.indentation,marked:this.options.marked,markedOptions:this.options.markedOptions,extensions:this.editor.extensionManager.baseExtensions}),this.editor.markdown=this.storage.manager,this.editor.getMarkdown=function(){return t.storage.manager.serialize(t.editor.getJSON())},this.editor.options.contentType&&"markdown"===If(this.editor.options.content,this.editor.options.contentType)){if(!this.editor.markdown)throw new Error('[tiptap][markdown]: The `contentType` option is set to "markdown", but the Markdown extension is not added to the editor. Please add the Markdown extension to use this feature.');if(void 0===this.editor.options.content||"string"!=typeof this.editor.options.content)throw new Error('[tiptap][markdown]: The `contentType` option is set to "markdown", but the initial content is not a string. Please provide the initial content as a markdown string.');var e=this.editor.markdown.parse(this.editor.options.content);this.editor.options.content=e}}});if("undefined"!=typeof WeakMap){var Hf=new WeakMap;Lf=function(t){return Hf.get(t)},Pf=function(t,e){return Hf.set(t,e),e}}else{var _f=[],jf=0;Lf=function(t){for(var e=0;e<_f.length;e+=2)if(_f[e]==t)return _f[e+1]},Pf=function(t,e){return 10==jf&&(jf=0),_f[jf++]=t,_f[jf++]=e}}var Ff=function(){function t(t,e,n,r){this.width=t,this.height=e,this.map=n,this.problems=r}var e=t.prototype;return e.findCell=function(t){for(var e=0;e<this.map.length;e++){var n=this.map[e];if(n==t){for(var r=e%this.width,o=e/this.width|0,i=r+1,s=o+1,a=1;i<this.width&&this.map[e+a]==n;a++)i++;for(var c=1;s<this.height&&this.map[e+this.width*c]==n;c++)s++;return{left:r,top:o,right:i,bottom:s}}}throw new RangeError("No cell with offset "+t+" found")},e.colCount=function(t){for(var e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError("No cell with offset "+t+" found")},e.nextCell=function(t,e,n){var r=this.findCell(t),o=r.left,i=r.right,s=r.top,a=r.bottom;return"horiz"==e?(n<0?0==o:i==this.width)?null:this.map[s*this.width+(n<0?o-1:i)]:(n<0?0==s:a==this.height)?null:this.map[o+this.width*(n<0?s-1:a)]},e.rectBetween=function(t,e){var n=this.findCell(t),r=n.left,o=n.right,i=n.top,s=n.bottom,a=this.findCell(e),c=a.left,l=a.right,u=a.top,d=a.bottom;return{left:Math.min(r,c),top:Math.min(i,u),right:Math.max(o,l),bottom:Math.max(s,d)}},e.cellsInRect=function(t){for(var e=[],n={},r=t.top;r<t.bottom;r++)for(var o=t.left;o<t.right;o++){var i=r*this.width+o,s=this.map[i];n[s]||(n[s]=!0,o==t.left&&o&&this.map[i-1]==s||r==t.top&&r&&this.map[i-this.width]==s||e.push(s))}return e},e.positionAt=function(t,e,n){for(var r=0,o=0;;r++){var i=o+n.child(r).nodeSize;if(r==t){for(var s=e+t*this.width,a=(t+1)*this.width;s<a&&this.map[s]<o;)s++;return s==a?i-1:this.map[s]}o=i}},t.get=function(t){return Lf(t)||Pf(t,Vf(t))},t}();function Vf(t){if("table"!=t.type.spec.tableRole)throw new RangeError("Not a table node: "+t.type.name);for(var e=function(t){for(var e=-1,n=!1,r=0;r<t.childCount;r++){var o=t.child(r),i=0;if(n)for(var s=0;s<r;s++)for(var a=t.child(s),c=0;c<a.childCount;c++){var l=a.child(c);s+l.attrs.rowspan>r&&(i+=l.attrs.colspan)}for(var u=0;u<o.childCount;u++){var d=o.child(u);i+=d.attrs.colspan,d.attrs.rowspan>1&&(n=!0)}-1==e?e=i:e!=i&&(e=Math.max(e,i))}return e}(t),n=t.childCount,r=[],o=0,i=null,s=[],a=0,c=e*n;a<c;a++)r[a]=0;for(var l=0,u=0;l<n;l++){var d=t.child(l);u++;for(var f=0;;f++){for(;o<r.length&&0!=r[o];)o++;if(f==d.childCount)break;for(var h=d.child(f),p=h.attrs,m=p.colspan,v=p.rowspan,g=p.colwidth,y=0;y<v;y++){if(y+l>=n){(i||(i=[])).push({type:"overlong_rowspan",pos:u,n:v-y});break}for(var k=o+y*e,b=0;b<m;b++){0==r[k+b]?r[k+b]=u:(i||(i=[])).push({type:"collision",row:l,pos:u,n:m-b});var w=g&&g[b];if(w){var x=(k+b)%e*2,S=s[x];null==S||S!=w&&1==s[x+1]?(s[x]=w,s[x+1]=1):S==w&&s[x+1]++}}}o+=m,u+=h.nodeSize}for(var C=(l+1)*e,M=0;o<C;)0==r[o++]&&M++;M&&(i||(i=[])).push({type:"missing",row:l,n:M}),u++}0!==e&&0!==n||(i||(i=[])).push({type:"zero_sized"});for(var T=new Ff(e,n,r,i),A=!1,O=0;!A&&O<s.length;O+=2)null!=s[O]&&s[O+1]<n&&(A=!0);return A&&function(t,e,n){t.problems||(t.problems=[]);for(var r={},o=0;o<t.map.length;o++){var i=t.map[o];if(!r[i]){r[i]=!0;var s=n.nodeAt(i);if(!s)throw new RangeError("No cell with offset "+i+" found");for(var a=null,c=s.attrs,l=0;l<c.colspan;l++){var u=e[(o+l)%t.width*2];null==u||c.colwidth&&c.colwidth[l]==u||((a||(a=Wf(c)))[l]=u)}a&&t.problems.unshift({type:"colwidth mismatch",pos:i,colwidth:a})}}}(T,s,t),T}function Wf(t){if(t.colwidth)return t.colwidth.slice();for(var e=[],n=0;n<t.colspan;n++)e.push(0);return e}function qf(t){var e=t.cached.tableNodeTypes;if(!e)for(var n in e=t.cached.tableNodeTypes={},t.nodes){var r=t.nodes[n],o=r.spec.tableRole;o&&(e[o]=r)}return e}var Kf=new Ue("selectingCells");function Uf(t){for(var e=t.depth-1;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return t.node(0).resolve(t.before(e+1));return null}function Jf(t){for(var e=t.selection.$head,n=e.depth;n>0;n--)if("row"==e.node(n).type.spec.tableRole)return!0;return!1}function Gf(t){var e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&"cell"==e.node.type.spec.tableRole)return e.$anchor;var n=Uf(e.$head)||function(t){for(var e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){var r=e.type.spec.tableRole;if("cell"==r||"header_cell"==r)return t.doc.resolve(n)}for(var o=t.nodeBefore,i=t.pos;o;o=o.lastChild,i--){var s=o.type.spec.tableRole;if("cell"==s||"header_cell"==s)return t.doc.resolve(i-o.nodeSize)}}(e.$head);if(n)return n;throw new RangeError("No cell found around position "+e.head)}function Zf(t){return"row"==t.parent.type.spec.tableRole&&!!t.nodeAfter}function Qf(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function Xf(t,e,n){var r=t.node(-1),o=Ff.get(r),i=t.start(-1),s=o.nextCell(t.pos-i,e,n);return null==s?null:t.node(0).resolve(i+s)}function Yf(t,e,n){void 0===n&&(n=1);var r=y({},t,{colspan:t.colspan-n});return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,n),r.colwidth.some(function(t){return t>0})||(r.colwidth=null)),r}function th(t,e,n){void 0===n&&(n=1);var r=y({},t,{colspan:t.colspan+n});if(r.colwidth){r.colwidth=r.colwidth.slice();for(var o=0;o<n;o++)r.colwidth.splice(e,0,0)}return r}var eh=function(t){function e(e,n){var r;void 0===n&&(n=e);var o=e.node(-1),i=Ff.get(o),s=e.start(-1),a=i.rectBetween(e.pos-s,n.pos-s),c=e.node(0),l=i.cellsInRect(a).filter(function(t){return t!=n.pos-s});l.unshift(n.pos-s);var u=l.map(function(t){var e=o.nodeAt(t);if(!e)throw new RangeError("No cell with offset "+t+" found");var n=s+t+1;return new Te(c.resolve(n),c.resolve(n+e.content.size))});return(r=t.call(this,u[0].$from,u[0].$to,u)||this).$anchorCell=e,r.$headCell=n,r}f(e,t);var n=e.prototype;return n.map=function(t,n){var r=t.resolve(n.map(this.$anchorCell.pos)),o=t.resolve(n.map(this.$headCell.pos));if(Zf(r)&&Zf(o)&&Qf(r,o)){var i=this.$anchorCell.node(-1)!=r.node(-1);return i&&this.isRowSelection()?e.rowSelection(r,o):i&&this.isColSelection()?e.colSelection(r,o):new e(r,o)}return Ee.between(r,o)},n.content=function(){for(var t=this.$anchorCell.node(-1),e=Ff.get(t),n=this.$anchorCell.start(-1),r=e.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),o={},i=[],s=r.top;s<r.bottom;s++){for(var a=[],c=s*e.width+r.left,l=r.left;l<r.right;l++,c++){var u=e.map[c];if(!o[u]){o[u]=!0;var d=e.findCell(u),f=t.nodeAt(u);if(!f)throw new RangeError("No cell with offset "+u+" found");var h=r.left-d.left,p=d.right-r.right;if(h>0||p>0){var m=f.attrs;if(h>0&&(m=Yf(m,0,h)),p>0&&(m=Yf(m,m.colspan-p,p)),d.left<r.left){if(!(f=f.type.createAndFill(m)))throw new RangeError("Could not create cell with attrs "+JSON.stringify(m))}else f=f.type.create(m,f.content)}if(d.top<r.top||d.bottom>r.bottom){var v=y({},f.attrs,{rowspan:Math.min(d.bottom,r.bottom)-Math.max(d.top,r.top)});f=d.top<r.top?f.type.createAndFill(v):f.type.create(v,f.content)}a.push(f)}}i.push(t.child(s).copy(A.from(a)))}var g=this.isColSelection()&&this.isRowSelection()?t:i;return new I(A.from(g),1,1)},n.replace=function(t,e){void 0===e&&(e=I.empty);for(var n=t.steps.length,r=this.ranges,o=0;o<r.length;o++){var i=r[o],s=i.$from,a=i.$to,c=t.mapping.slice(n);t.replace(c.map(s.pos),c.map(a.pos),o?I.empty:e)}var l=Me.findFrom(t.doc.resolve(t.mapping.slice(n).map(this.to)),-1);l&&t.setSelection(l)},n.replaceWith=function(t,e){this.replace(t,new I(A.from(e),0,0))},n.forEachCell=function(t){for(var e=this.$anchorCell.node(-1),n=Ff.get(e),r=this.$anchorCell.start(-1),o=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r)),i=0;i<o.length;i++)t(e.nodeAt(o[i]),r+o[i])},n.isColSelection=function(){var t=this.$anchorCell.index(-1),e=this.$headCell.index(-1);if(Math.min(t,e)>0)return!1;var n=t+this.$anchorCell.nodeAfter.attrs.rowspan,r=e+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,r)==this.$headCell.node(-1).childCount},e.colSelection=function(t,n){void 0===n&&(n=t);var r=t.node(-1),o=Ff.get(r),i=t.start(-1),s=o.findCell(t.pos-i),a=o.findCell(n.pos-i),c=t.node(0);return s.top<=a.top?(s.top>0&&(t=c.resolve(i+o.map[s.left])),a.bottom<o.height&&(n=c.resolve(i+o.map[o.width*(o.height-1)+a.right-1]))):(a.top>0&&(n=c.resolve(i+o.map[a.left])),s.bottom<o.height&&(t=c.resolve(i+o.map[o.width*(o.height-1)+s.right-1]))),new e(t,n)},n.isRowSelection=function(){var t=this.$anchorCell.node(-1),e=Ff.get(t),n=this.$anchorCell.start(-1),r=e.colCount(this.$anchorCell.pos-n),o=e.colCount(this.$headCell.pos-n);if(Math.min(r,o)>0)return!1;var i=r+this.$anchorCell.nodeAfter.attrs.colspan,s=o+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,s)==e.width},n.eq=function(t){return t instanceof e&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos},e.rowSelection=function(t,n){void 0===n&&(n=t);var r=t.node(-1),o=Ff.get(r),i=t.start(-1),s=o.findCell(t.pos-i),a=o.findCell(n.pos-i),c=t.node(0);return s.left<=a.left?(s.left>0&&(t=c.resolve(i+o.map[s.top*o.width])),a.right<o.width&&(n=c.resolve(i+o.map[o.width*(a.top+1)-1]))):(a.left>0&&(n=c.resolve(i+o.map[a.top*o.width])),s.right<o.width&&(t=c.resolve(i+o.map[o.width*(s.top+1)-1]))),new e(t,n)},n.toJSON=function(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}},e.fromJSON=function(t,n){return new e(t.resolve(n.anchor),t.resolve(n.head))},e.create=function(t,n,r){return void 0===r&&(r=n),new e(t.resolve(n),t.resolve(r))},n.getBookmark=function(){return new nh(this.$anchorCell.pos,this.$headCell.pos)},e}(Me);eh.prototype.visible=!1,Me.jsonID("cell",eh);var nh=function(){function t(t,e){this.anchor=t,this.head=e}var e=t.prototype;return e.map=function(e){return new t(e.map(this.anchor),e.map(this.head))},e.resolve=function(t){var e=t.resolve(this.anchor),n=t.resolve(this.head);return"row"==e.parent.type.spec.tableRole&&"row"==n.parent.type.spec.tableRole&&e.index()<e.parent.childCount&&n.index()<n.parent.childCount&&Qf(e,n)?new eh(e,n):Me.near(n,1)},t}();function rh(t){if(!(t.selection instanceof eh))return null;var e=[];return t.selection.forEachCell(function(t,n){e.push(ri.node(n,n+t.nodeSize,{class:"selectedCell"}))}),si.create(t.doc,e)}var oh=new Ue("fix-tables");function ih(t,e,n,r){var o=t.childCount,i=e.childCount;t:for(var s=0,a=0;s<i;s++){for(var c=e.child(s),l=a,u=Math.min(o,s+3);l<u;l++)if(t.child(l)==c){a=l+1,n+=c.nodeSize;continue t}r(c,n),a<o&&t.child(a).sameMarkup(c)?ih(t.child(a),c,n+1,r):c.nodesBetween(0,c.content.size,r,n+1),n+=c.nodeSize}}function sh(t,e){var n,r=function(e,r){"table"==e.type.spec.tableRole&&(n=function(t,e,n,r){var o=Ff.get(e);if(!o.problems)return r;r||(r=t.tr);for(var i,s,a=[],c=0;c<o.height;c++)a.push(0);for(var l=0;l<o.problems.length;l++){var u=o.problems[l];if("collision"==u.type){var d=e.nodeAt(u.pos);if(!d)continue;for(var f=d.attrs,h=0;h<f.rowspan;h++)a[u.row+h]+=u.n;r.setNodeMarkup(r.mapping.map(n+1+u.pos),null,Yf(f,f.colspan-u.n,u.n))}else if("missing"==u.type)a[u.row]+=u.n;else if("overlong_rowspan"==u.type){var p=e.nodeAt(u.pos);if(!p)continue;r.setNodeMarkup(r.mapping.map(n+1+u.pos),null,y({},p.attrs,{rowspan:p.attrs.rowspan-u.n}))}else if("colwidth mismatch"==u.type){var m=e.nodeAt(u.pos);if(!m)continue;r.setNodeMarkup(r.mapping.map(n+1+u.pos),null,y({},m.attrs,{colwidth:u.colwidth}))}else if("zero_sized"==u.type){var v=r.mapping.map(n);r.delete(v,v+e.nodeSize)}}for(var g=0;g<a.length;g++)a[g]&&(null==i&&(i=g),s=g);for(var k=0,b=n+1;k<o.height;k++){var w=e.child(k),x=b+w.nodeSize,S=a[k];if(S>0){var C="cell";w.firstChild&&(C=w.firstChild.type.spec.tableRole);for(var M=[],T=0;T<S;T++){var A=qf(t.schema)[C].createAndFill();A&&M.push(A)}var O=0!=k&&i!=k-1||s!=k?x-1:b+1;r.insert(r.mapping.map(O),M)}b=x}return r.setMeta(oh,{fixTables:!0})}(t,e,r,n))};return e?e.doc!=t.doc&&ih(e.doc,t.doc,0,r):t.doc.descendants(r),n}function ah(t){var e=t.selection,n=Gf(t),r=n.node(-1),o=n.start(-1),i=Ff.get(r);return y({},e instanceof eh?i.rectBetween(e.$anchorCell.pos-o,e.$headCell.pos-o):i.findCell(n.pos-o),{tableStart:o,map:i,table:r})}function ch(t,e,n){var r=e.map,o=e.tableStart,i=e.table,s=n>0?-1:0;(function(t,e,n){for(var r=qf(e.type.schema).header_cell,o=0;o<t.height;o++)if(e.nodeAt(t.map[n+o*t.width]).type!=r)return!1;return!0})(r,i,n+s)&&(s=0==n||n==r.width?null:0);for(var a=0;a<r.height;a++){var c=a*r.width+n;if(n>0&&n<r.width&&r.map[c-1]==r.map[c]){var l=r.map[c],u=i.nodeAt(l);t.setNodeMarkup(t.mapping.map(o+l),null,th(u.attrs,n-r.colCount(l))),a+=u.attrs.rowspan-1}else{var d=null==s?qf(i.type.schema).cell:i.nodeAt(r.map[c+s]).type,f=r.positionAt(a,n,i);t.insert(t.mapping.map(o+f),d.createAndFill())}}return t}function lh(t,e,n){for(var r=e.map,o=e.table,i=e.tableStart,s=t.mapping.maps.length,a=0;a<r.height;){var c=a*r.width+n,l=r.map[c],u=o.nodeAt(l),d=u.attrs;if(n>0&&r.map[c-1]==l||n<r.width-1&&r.map[c+1]==l)t.setNodeMarkup(t.mapping.slice(s).map(i+l),null,Yf(d,n-r.colCount(l)));else{var f=t.mapping.slice(s).map(i+l);t.delete(f,f+u.nodeSize)}a+=d.rowspan}}function uh(t,e,n){for(var r=e.map,o=e.tableStart,i=e.table,s=o,a=0;a<n;a++)s+=i.child(a).nodeSize;var c=[],l=n>0?-1:0;(function(t,e,n){for(var r,o=qf(e.type.schema).header_cell,i=0;i<t.width;i++)if((null===(r=e.nodeAt(t.map[i+n*t.width]))||void 0===r?void 0:r.type)!=o)return!1;return!0})(r,i,n+l)&&(l=0==n||n==r.height?null:0);for(var u=0,d=r.width*n;u<r.width;u++,d++)if(n>0&&n<r.height&&r.map[d]==r.map[d-r.width]){var f=r.map[d],h=i.nodeAt(f).attrs;t.setNodeMarkup(o+f,null,y({},h,{rowspan:h.rowspan+1})),u+=h.colspan-1}else{var p,m=null==l?qf(i.type.schema).cell:null===(p=i.nodeAt(r.map[d+l*r.width]))||void 0===p?void 0:p.type,v=null==m?void 0:m.createAndFill();v&&c.push(v)}return t.insert(s,qf(i.type.schema).row.create(null,c)),t}function dh(t,e,n){for(var r=e.map,o=e.table,i=e.tableStart,s=0,a=0;a<n;a++)s+=o.child(a).nodeSize;var c=s+o.child(n).nodeSize,l=t.mapping.maps.length;t.delete(s+i,c+i);for(var u=new Set,d=0,f=n*r.width;d<r.width;d++,f++){var h=r.map[f];if(!u.has(h))if(u.add(h),n>0&&h==r.map[f-r.width]){var p=o.nodeAt(h).attrs;t.setNodeMarkup(t.mapping.slice(l).map(h+i),null,y({},p,{rowspan:p.rowspan-1})),d+=p.colspan-1}else if(n<r.height&&h==r.map[f+r.width]){var m=o.nodeAt(h),v=m.attrs,g=m.type.create(y({},v,{rowspan:m.attrs.rowspan-1}),m.content),k=r.positionAt(n+1,d,o);t.insert(t.mapping.slice(l).map(i+k),g),d+=v.colspan-1}}}function fh(t){var e=t.content;return 1==e.childCount&&e.child(0).isTextblock&&0==e.child(0).childCount}function hh(t,e){var n=t.selection;if(!(n instanceof eh)||n.$anchorCell.pos==n.$headCell.pos)return!1;var r=ah(t),o=r.map;if(function(t,e){for(var n=t.width,r=t.height,o=t.map,i=e.top*n+e.left,s=i,a=(e.bottom-1)*n+e.left,c=i+(e.right-e.left-1),l=e.top;l<e.bottom;l++){if(e.left>0&&o[s]==o[s-1]||e.right<n&&o[c]==o[c+1])return!0;s+=n,c+=n}for(var u=e.left;u<e.right;u++){if(e.top>0&&o[i]==o[i-n]||e.bottom<r&&o[a]==o[a+n])return!0;i++,a++}return!1}(o,r))return!1;if(e){for(var i,s,a=t.tr,c={},l=A.empty,u=r.top;u<r.bottom;u++)for(var d=r.left;d<r.right;d++){var f=o.map[u*o.width+d],h=r.table.nodeAt(f);if(!c[f]&&h)if(c[f]=!0,null==i)i=f,s=h;else{fh(h)||(l=l.append(h.content));var p=a.mapping.map(f+r.tableStart);a.delete(p,p+h.nodeSize)}}if(null==i||null==s)return!0;if(a.setNodeMarkup(i+r.tableStart,null,y({},th(s.attrs,s.attrs.colspan,r.right-r.left-s.attrs.colspan),{rowspan:r.bottom-r.top})),l.size>0){var m=i+1+s.content.size,v=fh(s)?i+1:m;a.replaceWith(v+r.tableStart,m+r.tableStart,l)}a.setSelection(new eh(a.doc.resolve(i+r.tableStart))),e(a)}return!0}function ph(t,e){var n,r=qf(t.schema);return(n=function(t){var e=t.node;return r[e.type.spec.tableRole]},function(t,e){var r,o,i=t.selection;if(i instanceof eh){if(i.$anchorCell.pos!=i.$headCell.pos)return!1;r=i.$anchorCell.nodeAfter,o=i.$anchorCell.pos}else{var s;if(!(r=function(t){for(var e=t.depth;e>0;e--){var n=t.node(e).type.spec.tableRole;if("cell"===n||"header_cell"===n)return t.node(e)}return null}(i.$from)))return!1;o=null===(s=Uf(i.$from))||void 0===s?void 0:s.pos}if(null==r||null==o)return!1;if(1==r.attrs.colspan&&1==r.attrs.rowspan)return!1;if(e){var a=r.attrs,c=[],l=a.colwidth;a.rowspan>1&&(a=y({},a,{rowspan:1})),a.colspan>1&&(a=y({},a,{colspan:1}));for(var u,d=ah(t),f=t.tr,h=0;h<d.right-d.left;h++)c.push(l?y({},a,{colwidth:l&&l[h]?[l[h]]:null}):a);for(var p=d.top;p<d.bottom;p++){var m=d.map.positionAt(p,d.left,d.table);p==d.top&&(m+=r.nodeSize);for(var v=d.left,g=0;v<d.right;v++,g++)v==d.left&&p==d.top||f.insert(u=f.mapping.map(m+d.tableStart,1),n({node:r,row:p,col:v}).createAndFill(c[g]))}f.setNodeMarkup(o,n({node:r,row:d.top,col:d.left}),c[0]),i instanceof eh&&f.setSelection(new eh(f.doc.resolve(i.$anchorCell.pos),u?f.doc.resolve(u):void 0)),e(f)}return!0})(t,e)}function mh(t,e,n){for(var r=e.map.cellsInRect({left:0,top:0,right:"row"==t?e.map.width:1,bottom:"column"==t?e.map.height:1}),o=0;o<r.length;o++){var i=e.table.nodeAt(r[o]);if(i&&i.type!==n.header_cell)return!1}return!0}function vh(t,e){return(e=e||{useDeprecatedLogic:!1}).useDeprecatedLogic?function(t){return function(e,n){if(!Jf(e))return!1;if(n){for(var r=qf(e.schema),o=ah(e),i=e.tr,s=o.map.cellsInRect("column"==t?{left:o.left,top:0,right:o.right,bottom:o.map.height}:"row"==t?{left:0,top:o.top,right:o.map.width,bottom:o.bottom}:o),a=s.map(function(t){return o.table.nodeAt(t)}),c=0;c<s.length;c++)a[c].type==r.header_cell&&i.setNodeMarkup(o.tableStart+s[c],r.cell,a[c].attrs);if(0===i.steps.length)for(var l=0;l<s.length;l++)i.setNodeMarkup(o.tableStart+s[l],r.header_cell,a[l].attrs);n(i)}return!0}}(t):function(e,n){if(!Jf(e))return!1;if(n){var r=qf(e.schema),o=ah(e),i=e.tr,s=mh("row",o,r),a=mh("column",o,r),c=("column"===t?s:"row"===t&&a)?1:0,l="column"==t?{left:0,top:c,right:1,bottom:o.map.height}:"row"==t?{left:c,top:0,right:o.map.width,bottom:1}:o,u="column"==t?a?r.cell:r.header_cell:"row"==t?s?r.cell:r.header_cell:r.cell;o.map.cellsInRect(l).forEach(function(t){var e=t+o.tableStart,n=i.doc.nodeAt(e);n&&i.setNodeMarkup(e,u,n.attrs)}),n(i)}return!0}}vh("row",{useDeprecatedLogic:!0}),vh("column",{useDeprecatedLogic:!0});var gh=vh("cell",{useDeprecatedLogic:!0});function yh(t){return function(e,n){if(!Jf(e))return!1;var r,o=function(t,e){if(e<0){var n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(var r=t.index(-1)-1,o=t.before();r>=0;r--){var i=t.node(-1).child(r),s=i.lastChild;if(s)return o-1-s.nodeSize;o-=i.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;for(var a=t.node(-1),c=t.indexAfter(-1),l=t.after();c<a.childCount;c++){var u=a.child(c);if(u.childCount)return l+1;l+=u.nodeSize}}return null}(Gf(e),t);if(null==o)return!1;if(n){var i=e.doc.resolve(o);n(e.tr.setSelection(Ee.between(i,(r=i,r.node(0).resolve(r.pos+r.nodeAfter.nodeSize)))).scrollIntoView())}return!0}}function kh(t,e){var n=t.selection;if(!(n instanceof eh))return!1;if(e){var r=t.tr,o=qf(t.schema).cell.createAndFill().content;n.forEachCell(function(t,e){t.content.eq(o)||r.replace(r.mapping.map(e+1),r.mapping.map(e+t.nodeSize-1),new I(o,0,0))}),r.docChanged&&e(r)}return!0}function bh(t,e){var n=t.createAndFill();return new Se(n).replace(0,n.content.size,e).doc}function wh(t,e,n,r,o,i,s,a){if(0==s||s==e.height)return!1;for(var c=!1,l=o;l<i;l++){var u=s*e.width+l,d=e.map[u];if(e.map[u-e.width]==d){c=!0;var f=n.nodeAt(d),h=e.findCell(d),p=h.top,m=h.left;t.setNodeMarkup(t.mapping.slice(a).map(d+r),null,y({},f.attrs,{rowspan:s-p})),t.insert(t.mapping.slice(a).map(e.positionAt(s,m,n)),f.type.createAndFill(y({},f.attrs,{rowspan:p+f.attrs.rowspan-s}))),l+=f.attrs.colspan-1}}return c}function xh(t,e,n,r,o,i,s,a){if(0==s||s==e.width)return!1;for(var c=!1,l=o;l<i;l++){var u=l*e.width+s,d=e.map[u];if(e.map[u-1]==d){c=!0;var f=n.nodeAt(d),h=e.colCount(d),p=t.mapping.slice(a).map(d+r);t.setNodeMarkup(p,null,Yf(f.attrs,s-h,f.attrs.colspan-(s-h))),t.insert(p+f.nodeSize,f.type.createAndFill(Yf(f.attrs,0,s-h))),l+=f.attrs.rowspan-1}}return c}function Sh(t,e,n,r,o){var i=n?t.doc.nodeAt(n-1):t.doc;if(!i)throw new Error("No table found");var s=Ff.get(i),a=r.top,c=r.left,l=c+o.width,u=a+o.height,d=t.tr,f=0;function h(){if(!(i=n?d.doc.nodeAt(n-1):d.doc))throw new Error("No table found");s=Ff.get(i),f=d.mapping.maps.length}(function(t,e,n,r,o,i,s){var a,c,l=qf(t.doc.type.schema);if(o>e.width)for(var u=0,d=0;u<e.height;u++){var f=n.child(u);d+=f.nodeSize;var h,p=[];h=null==f.lastChild||f.lastChild.type==l.cell?a||(a=l.cell.createAndFill()):c||(c=l.header_cell.createAndFill());for(var m=e.width;m<o;m++)p.push(h);t.insert(t.mapping.slice(s).map(d-1+r),p)}if(i>e.height){for(var v=[],g=0,y=(e.height-1)*e.width;g<Math.max(e.width,o);g++){var k=!(g>=e.width)&&n.nodeAt(e.map[y+g]).type==l.header_cell;v.push(k?c||(c=l.header_cell.createAndFill()):a||(a=l.cell.createAndFill()))}for(var b=l.row.create(null,A.from(v)),w=[],x=e.height;x<i;x++)w.push(b);t.insert(t.mapping.slice(s).map(r+n.nodeSize-2),w)}return!(!a&&!c)})(d,s,i,n,l,u,f)&&h(),wh(d,s,i,n,c,l,a,f)&&h(),wh(d,s,i,n,c,l,u,f)&&h(),xh(d,s,i,n,a,u,c,f)&&h(),xh(d,s,i,n,a,u,l,f)&&h();for(var p=a;p<u;p++){var m=s.positionAt(p,c,i),v=s.positionAt(p,l,i);d.replace(d.mapping.slice(f).map(m+n),d.mapping.slice(f).map(v+n),new I(o.rows[p-a],0,0))}h(),d.setSelection(new eh(d.doc.resolve(n+s.positionAt(a,c,i)),d.doc.resolve(n+s.positionAt(u-1,l-1,i)))),e(d)}var Ch=Ui({ArrowLeft:Th("horiz",-1),ArrowRight:Th("horiz",1),ArrowUp:Th("vert",-1),ArrowDown:Th("vert",1),"Shift-ArrowLeft":Ah("horiz",-1),"Shift-ArrowRight":Ah("horiz",1),"Shift-ArrowUp":Ah("vert",-1),"Shift-ArrowDown":Ah("vert",1),Backspace:kh,"Mod-Backspace":kh,Delete:kh,"Mod-Delete":kh});function Mh(t,e,n){return!n.eq(t.selection)&&(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function Th(t,e){return function(n,r,o){if(!o)return!1;var i=n.selection;if(i instanceof eh)return Mh(n,r,Me.near(i.$headCell,e));if("horiz"!=t&&!i.empty)return!1;var s=Rh(o,t,e);if(null==s)return!1;if("horiz"==t)return Mh(n,r,Me.near(n.doc.resolve(i.head+e),e));var a,c=n.doc.resolve(s),l=Xf(c,t,e);return a=l?Me.near(l,1):e<0?Me.near(n.doc.resolve(c.before(-1)),-1):Me.near(n.doc.resolve(c.after(-1)),1),Mh(n,r,a)}}function Ah(t,e){return function(n,r,o){if(!o)return!1;var i,s=n.selection;if(s instanceof eh)i=s;else{var a=Rh(o,t,e);if(null==a)return!1;i=new eh(n.doc.resolve(a))}var c=Xf(i.$headCell,t,e);return!!c&&Mh(n,r,new eh(i.$anchorCell,c))}}function Oh(t,e){var n=Uf(t.state.doc.resolve(e));return!!n&&(t.dispatch(t.state.tr.setSelection(new eh(n))),!0)}function Eh(t,e,n){if(!Jf(t.state))return!1;var r=function(t){if(0===t.size)return null;for(var e=t.content,n=t.openStart,r=t.openEnd;1==e.childCount&&(n>0&&r>0||"table"==e.child(0).type.spec.tableRole);)n--,r--,e=e.child(0).content;var o=e.child(0),i=o.type.spec.tableRole,s=o.type.schema,a=[];if("row"==i)for(var c=0;c<e.childCount;c++){var l=e.child(c).content,u=c?0:Math.max(0,n-1),d=c<e.childCount-1?0:Math.max(0,r-1);(u||d)&&(l=bh(qf(s).row,new I(l,u,d)).content),a.push(l)}else{if("cell"!=i&&"header_cell"!=i)return null;a.push(n||r?bh(qf(s).row,new I(e,n,r)).content:e)}return function(t,e){for(var n=[],r=0;r<e.length;r++)for(var o=e[r],i=o.childCount-1;i>=0;i--)for(var s=o.child(i).attrs,a=s.rowspan,c=s.colspan,l=r;l<r+a;l++)n[l]=(n[l]||0)+c;for(var u=0,d=0;d<n.length;d++)u=Math.max(u,n[d]);for(var f=0;f<n.length;f++)if(f>=e.length&&e.push(A.empty),n[f]<u){for(var h=qf(t).cell.createAndFill(),p=[],m=n[f];m<u;m++)p.push(h);e[f]=e[f].append(A.from(p))}return{height:e.length,width:u,rows:e}}(s,a)}(n),o=t.state.selection;if(o instanceof eh){r||(r={width:1,height:1,rows:[A.from(bh(qf(t.state.schema).cell,n))]});var i=o.$anchorCell.node(-1),s=o.$anchorCell.start(-1),a=Ff.get(i).rectBetween(o.$anchorCell.pos-s,o.$headCell.pos-s);return r=function(t,e,n){var r=t.width,o=t.height,i=t.rows;if(r!=e){for(var s=[],a=[],c=0;c<i.length;c++){for(var l=i[c],u=[],d=s[c]||0,f=0;d<e;f++){var h=l.child(f%l.childCount);d+h.attrs.colspan>e&&(h=h.type.createChecked(Yf(h.attrs,h.attrs.colspan,d+h.attrs.colspan-e),h.content)),u.push(h),d+=h.attrs.colspan;for(var p=1;p<h.attrs.rowspan;p++)s[c+p]=(s[c+p]||0)+h.attrs.colspan}a.push(A.from(u))}i=a,r=e}if(o!=n){for(var m=[],v=0,g=0;v<n;v++,g++){for(var k=[],b=i[g%o],w=0;w<b.childCount;w++){var x=b.child(w);v+x.attrs.rowspan>n&&(x=x.type.create(y({},x.attrs,{rowspan:Math.max(1,n-x.attrs.rowspan)}),x.content)),k.push(x)}m.push(A.from(k))}i=m,o=n}return{width:r,height:o,rows:i}}(r,a.right-a.left,a.bottom-a.top),Sh(t.state,t.dispatch,s,a,r),!0}if(r){var c=Gf(t.state),l=c.start(-1);return Sh(t.state,t.dispatch,l,Ff.get(c.node(-1)).findCell(c.pos-l),r),!0}return!1}function Nh(t,e){var n;if(0==e.button&&!e.ctrlKey&&!e.metaKey){var r,o=Dh(t,e.target);if(e.shiftKey&&t.state.selection instanceof eh)i(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&o&&null!=(r=Uf(t.state.selection.$anchor))&&(null===(n=Ih(t,e))||void 0===n?void 0:n.pos)!=r.pos)i(r,e),e.preventDefault();else if(!o)return;t.root.addEventListener("mouseup",s),t.root.addEventListener("dragstart",s),t.root.addEventListener("mousemove",a)}function i(e,n){var r=Ih(t,n),o=null==Kf.getState(t.state);if(!r||!Qf(e,r)){if(!o)return;r=e}var i=new eh(e,r);if(o||!t.state.selection.eq(i)){var s=t.state.tr.setSelection(i);o&&s.setMeta(Kf,e.pos),t.dispatch(s)}}function s(){t.root.removeEventListener("mouseup",s),t.root.removeEventListener("dragstart",s),t.root.removeEventListener("mousemove",a),null!=Kf.getState(t.state)&&t.dispatch(t.state.tr.setMeta(Kf,-1))}function a(n){var r,a=n,c=Kf.getState(t.state);if(null!=c)r=t.state.doc.resolve(c);else if(Dh(t,a.target)!=o&&!(r=Ih(t,e)))return s();r&&i(r,a)}}function Rh(t,e,n){if(!(t.state.selection instanceof Ee))return null;for(var r=t.state.selection.$head,o=r.depth-1;o>=0;o--){var i=r.node(o);if((n<0?r.index(o):r.indexAfter(o))!=(n<0?0:i.childCount))return null;if("cell"==i.type.spec.tableRole||"header_cell"==i.type.spec.tableRole){var s=r.before(o),a="vert"==e?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(a)?s:null}}return null}function Dh(t,e){for(;e&&e!=t.dom;e=e.parentNode)if("TD"==e.nodeName||"TH"==e.nodeName)return e;return null}function Ih(t,e){var n=t.posAtCoords({left:e.clientX,top:e.clientY});if(!n)return null;var r=n.inside,o=n.pos;return r>=0&&Uf(t.state.doc.resolve(r))||Uf(t.state.doc.resolve(o))}var Lh=function(){function t(t,e){this.node=t,this.defaultCellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",e+"px"),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Ph(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}var e=t.prototype;return e.update=function(t){return t.type==this.node.type&&(this.node=t,Ph(t,this.colgroup,this.table,this.defaultCellMinWidth),!0)},e.ignoreMutation=function(t){return"attributes"==t.type&&(t.target==this.table||this.colgroup.contains(t.target))},t}();function Ph(t,e,n,r,o,i){var s=0,a=!0,c=e.firstChild,l=t.firstChild;if(l){for(var u=0,d=0;u<l.childCount;u++)for(var f=l.child(u).attrs,h=f.colspan,p=f.colwidth,m=0;m<h;m++,d++){var v=o==d?i:p&&p[m],g=v?v+"px":"";if(s+=v||r,v||(a=!1),c)c.style.width!=g&&(c.style.width=g),c=c.nextSibling;else{var y=document.createElement("col");y.style.width=g,e.appendChild(y)}}for(;c;){var k,b=c.nextSibling;null===(k=c.parentNode)||void 0===k||k.removeChild(c),c=b}a?(n.style.width=s+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=s+"px")}}var zh=new Ue("tableColumnResizing");var Bh=function(){function t(t,e){this.activeHandle=t,this.dragging=e}return t.prototype.apply=function(e){var n=this,r=e.getMeta(zh);if(r&&null!=r.setHandle)return new t(r.setHandle,!1);if(r&&void 0!==r.setDragging)return new t(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&e.docChanged){var o=e.mapping.map(n.activeHandle,-1);return Zf(e.doc.resolve(o))||(o=-1),new t(o,n.dragging)}return n},t}();function $h(t,e,n,r){var o="right"==n?-r:r,i=t.posAtCoords({left:e.clientX+o,top:e.clientY});if(!i)return-1;var s=i.pos,a=Uf(t.state.doc.resolve(s));if(!a)return-1;if("right"==n)return a.pos;var c=Ff.get(a.node(-1)),l=a.start(-1),u=c.map.indexOf(a.pos-l);return u%c.width==0?-1:l+c.map[u-1]}function Hh(t,e,n){var r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function _h(t,e){t.dispatch(t.state.tr.setMeta(zh,{setHandle:e}))}function jh(t,e,n,r){for(var o=t.state.doc.resolve(e),i=o.node(-1),s=o.start(-1),a=Ff.get(i).colCount(o.pos-s)+o.nodeAfter.attrs.colspan-1,c=t.domAtPos(o.start(-1)).node;c&&"TABLE"!=c.nodeName;)c=c.parentNode;c&&Ph(i,c.firstChild,c,r,a,n)}function Fh(t){return Array(t).fill(0)}var Vh=Kc.create({name:"tableCell",addOptions:function(){return{HTMLAttributes:{}}},content:"block+",addAttributes:function(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:function(t){var e,n,r=t.getAttribute("colwidth"),o=r?r.split(",").map(function(t){return parseInt(t,10)}):null;if(!o){var i=null==(e=t.closest("table"))?void 0:e.querySelectorAll("colgroup > col"),s=Array.from((null==(n=t.parentElement)?void 0:n.children)||[]).indexOf(t);if(s&&s>-1&&i&&i[s]){var a=i[s].getAttribute("width");return a?[parseInt(a,10)]:null}}return o}}}},tableRole:"cell",isolating:!0,parseHTML:function(){return[{tag:"td"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["td",ga(this.options.HTMLAttributes,e),0]}}),Wh=Kc.create({name:"tableHeader",addOptions:function(){return{HTMLAttributes:{}}},content:"block+",addAttributes:function(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:function(t){var e=t.getAttribute("colwidth");return e?e.split(",").map(function(t){return parseInt(t,10)}):null}}}},tableRole:"header_cell",isolating:!0,parseHTML:function(){return[{tag:"th"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["th",ga(this.options.HTMLAttributes,e),0]}}),qh=Kc.create({name:"tableRow",addOptions:function(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML:function(){return[{tag:"tr"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["tr",ga(this.options.HTMLAttributes,e),0]}});function Kh(t,e){return e?["width",Math.max(e,t)+"px"]:["min-width",t+"px"]}function Uh(t,e,n,r,o,i){var s,a=0,c=!0,l=e.firstChild,u=t.firstChild;if(null!==u)for(var d=0,f=0;d<u.childCount;d+=1)for(var h=u.child(d).attrs,p=h.colspan,m=h.colwidth,v=0;v<p;v+=1,f+=1){var g=o===f?i:m&&m[v],y=g?g+"px":"";if(a+=g||r,g||(c=!1),l){if(l.style.width!==y){var k=Kh(r,g),b=k[0],w=k[1];l.style.setProperty(b,w)}l=l.nextSibling}else{var x=document.createElement("col"),S=Kh(r,g),C=S[0],M=S[1];x.style.setProperty(C,M),e.appendChild(x)}}for(;l;){var T=l.nextSibling;null==(s=l.parentNode)||s.removeChild(l),l=T}var A=t.attrs.style&&"string"==typeof t.attrs.style&&/\bwidth\s*:/i.test(t.attrs.style);c&&!A?(n.style.width=a+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=a+"px")}var Jh=function(){function t(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),t.attrs.style&&(this.table.style.cssText=t.attrs.style),this.colgroup=this.table.appendChild(document.createElement("colgroup")),Uh(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}var e=t.prototype;return e.update=function(t){return t.type===this.node.type&&(this.node=t,Uh(t,this.colgroup,this.table,this.cellMinWidth),!0)},e.ignoreMutation=function(t){var e=t.target,n=this.dom.contains(e),r=this.contentDOM.contains(e);return!(!n||r||"attributes"!==t.type&&"childList"!==t.type&&"characterData"!==t.type)},t}();function Gh(t,e){return e?t.createChecked(null,e):t.createAndFill()}var Zh=function(t){var e=t.editor,n=e.state.selection;if(!(n instanceof eh))return!1;var r=0,o=ca(n.ranges[0].$from,function(t){return"table"===t.type.name});return null==o||o.node.descendants(function(t){if("table"===t.type.name)return!1;["tableCell","tableHeader"].includes(t.type.name)&&(r+=1)}),r===n.ranges.length&&(e.commands.deleteTable(),!0)},Qh=Kc.create({name:"table",addOptions:function(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:Jh,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML:function(){return[{tag:"table"}]},renderHTML:function(t){var e=t.node,n=t.HTMLAttributes,r=function(t,e){var n=0,r=!0,o=[],i=t.firstChild;if(!i)return{};for(var s=0,a=0;s<i.childCount;s+=1)for(var c=i.child(s).attrs,l=c.colspan,u=c.colwidth,d=0;d<l;d+=1,a+=1){var f=void 0===a?void 0:u&&u[d];n+=f||e,f||(r=!1);var h=Kh(e,f),p=h[0],m=h[1];o.push(["col",{style:p+": "+m}])}var v=r?n+"px":"",g=r?"":n+"px";return{colgroup:["colgroup",{}].concat(o),tableWidth:v,tableMinWidth:g}}(e,this.options.cellMinWidth),o=r.colgroup,i=r.tableWidth,s=r.tableMinWidth,a=n.style,c=["table",ga(this.options.HTMLAttributes,n,{style:a||(i?"width: "+i:"min-width: "+s)}),o,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},c]:c},parseMarkdown:function(t,e){var n=[];if(t.header){var r=[];t.header.forEach(function(t){r.push(e.createNode("tableHeader",{},[{type:"paragraph",content:e.parseInline(t.tokens)}]))}),n.push(e.createNode("tableRow",{},r))}return t.rows&&t.rows.forEach(function(t){var r=[];t.forEach(function(t){r.push(e.createNode("tableCell",{},[{type:"paragraph",content:e.parseInline(t.tokens)}]))}),n.push(e.createNode("tableRow",{},r))}),e.createNode("table",void 0,n)},renderMarkdown:function(t,e){return function(t,e,n){var r;void 0===n&&(n={});var o=null!=(r=n.cellLineSeparator)?r:"";if(!t||!t.content||0===t.content.length)return"";var i=[];t.content.forEach(function(t){var n=[];t.content&&t.content.forEach(function(t){var r=((t.content&&Array.isArray(t.content)&&t.content.length>1?t.content.map(function(t){return e.renderChildren(t)}).join(o):t.content?e.renderChildren(t.content):"")||"").replace(/\s+/g," ").trim(),i="tableHeader"===t.type;n.push({text:r,isHeader:i})}),i.push(n)});var s=i.reduce(function(t,e){return Math.max(t,e.length)},0);if(0===s)return"";var a=new Array(s).fill(0);i.forEach(function(t){for(var e,n=0;n<s;n+=1){var r=((null==(e=t[n])?void 0:e.text)||"").length;r>a[n]&&(a[n]=r),a[n]<3&&(a[n]=3)}});var c=function(t,e){return t+" ".repeat(Math.max(0,e-t.length))},l=i[0],u=l.some(function(t){return t.isHeader}),d="\n",f=new Array(s).fill(0).map(function(t,e){return u&&l[e]&&l[e].text||""});return d+="| "+f.map(function(t,e){return c(t,a[e])}).join(" | ")+" |\n",d+="| "+a.map(function(t){return"-".repeat(Math.max(3,t))}).join(" | ")+" |\n",(u?i.slice(1):i).forEach(function(t){d+="| "+new Array(s).fill(0).map(function(e,n){return c(t[n]&&t[n].text||"",a[n])}).join(" | ")+" |\n"}),d}(t,e)},addCommands:function(){return{insertTable:function(t){var e=void 0===t?{}:t,n=e.rows,r=void 0===n?3:n,o=e.cols,i=void 0===o?3:o,s=e.withHeaderRow,a=void 0===s||s;return function(t){var e=t.tr,n=t.dispatch,o=function(t,e,n,r,o){for(var i=function(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;var e={};return Object.keys(t.nodes).forEach(function(n){var r=t.nodes[n];r.spec.tableRole&&(e[r.spec.tableRole]=r)}),t.cached.tableNodeTypes=e,e}(t),s=[],a=[],c=0;c<n;c+=1){var l=Gh(i.cell,o);if(l&&a.push(l),r){var u=Gh(i.header_cell,o);u&&s.push(u)}}for(var d=[],f=0;f<e;f+=1)d.push(i.row.createChecked(null,r&&0===f?s:a));return i.table.createChecked(null,d)}(t.editor.schema,r,i,a);if(n){var s=e.selection.from+1;e.replaceSelectionWith(o).scrollIntoView().setSelection(Ee.near(e.doc.resolve(s)))}return!0}},addColumnBefore:function(){return function(t){return function(t,e){if(!Jf(t))return!1;if(e){var n=ah(t);e(ch(t.tr,n,n.left))}return!0}(t.state,t.dispatch)}},addColumnAfter:function(){return function(t){return function(t,e){if(!Jf(t))return!1;if(e){var n=ah(t);e(ch(t.tr,n,n.right))}return!0}(t.state,t.dispatch)}},deleteColumn:function(){return function(t){return function(t,e){if(!Jf(t))return!1;if(e){var n=ah(t),r=t.tr;if(0==n.left&&n.right==n.map.width)return!1;for(var o=n.right-1;lh(r,n,o),o!=n.left;o--){var i=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!i)throw new RangeError("No table found");n.table=i,n.map=Ff.get(i)}e(r)}return!0}(t.state,t.dispatch)}},addRowBefore:function(){return function(t){return function(t,e){if(!Jf(t))return!1;if(e){var n=ah(t);e(uh(t.tr,n,n.top))}return!0}(t.state,t.dispatch)}},addRowAfter:function(){return function(t){return function(t,e){if(!Jf(t))return!1;if(e){var n=ah(t);e(uh(t.tr,n,n.bottom))}return!0}(t.state,t.dispatch)}},deleteRow:function(){return function(t){return function(t,e){if(!Jf(t))return!1;if(e){var n=ah(t),r=t.tr;if(0==n.top&&n.bottom==n.map.height)return!1;for(var o=n.bottom-1;dh(r,n,o),o!=n.top;o--){var i=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!i)throw new RangeError("No table found");n.table=i,n.map=Ff.get(n.table)}e(r)}return!0}(t.state,t.dispatch)}},deleteTable:function(){return function(t){return function(t,e){for(var n=t.selection.$anchor,r=n.depth;r>0;r--)if("table"==n.node(r).type.spec.tableRole)return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}(t.state,t.dispatch)}},mergeCells:function(){return function(t){return hh(t.state,t.dispatch)}},splitCell:function(){return function(t){return ph(t.state,t.dispatch)}},toggleHeaderColumn:function(){return function(t){var e=t.state,n=t.dispatch;return vh("column")(e,n)}},toggleHeaderRow:function(){return function(t){var e=t.state,n=t.dispatch;return vh("row")(e,n)}},toggleHeaderCell:function(){return function(t){var e=t.state,n=t.dispatch;return gh(e,n)}},mergeOrSplit:function(){return function(t){var e=t.state,n=t.dispatch;return!!hh(e,n)||ph(e,n)}},setCellAttribute:function(t,e){return function(n){var r=n.state,o=n.dispatch;return function(t,e){return function(n,r){if(!Jf(n))return!1;var o=Gf(n);if(o.nodeAfter.attrs[t]===e)return!1;if(r){var i,s=n.tr;n.selection instanceof eh?n.selection.forEachCell(function(n,r){var o;n.attrs[t]!==e&&s.setNodeMarkup(r,null,y({},n.attrs,((o={})[t]=e,o)))}):s.setNodeMarkup(o.pos,null,y({},o.nodeAfter.attrs,((i={})[t]=e,i))),r(s)}return!0}}(t,e)(r,o)}},goToNextCell:function(){return function(t){var e=t.state,n=t.dispatch;return yh(1)(e,n)}},goToPreviousCell:function(){return function(t){var e=t.state,n=t.dispatch;return yh(-1)(e,n)}},fixTables:function(){return function(t){var e=t.state;return t.dispatch&&sh(e),!0}},setCellSelection:function(t){return function(e){var n=e.tr;if(e.dispatch){var r=eh.create(n.doc,t.anchorCell,t.headCell);n.setSelection(r)}return!0}}}},addKeyboardShortcuts:function(){var t=this;return{Tab:function(){return!!t.editor.commands.goToNextCell()||!!t.editor.can().addRowAfter()&&t.editor.chain().addRowAfter().goToNextCell().run()},"Shift-Tab":function(){return t.editor.commands.goToPreviousCell()},Backspace:Zh,"Mod-Backspace":Zh,Delete:Zh,"Mod-Delete":Zh}},addProseMirrorPlugins:function(){var t,e,n,r,o,i,s,a,c,l,u,d,f,h,p,m,v=this.options.resizable&&this.editor.isEditable;return[].concat(v?[(r={handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable},o=void 0===r?{}:r,i=o.handleWidth,s=void 0===i?5:i,a=o.cellMinWidth,c=void 0===a?25:a,l=o.defaultCellMinWidth,u=void 0===l?100:l,d=o.View,f=void 0===d?Lh:d,h=o.lastColumnResizable,p=void 0===h||h,m=new We({key:zh,state:{init:function(t,e){var n,r=null===(n=m.spec)||void 0===n||null===(n=n.props)||void 0===n?void 0:n.nodeViews,o=qf(e.schema).table.name;return f&&r&&(r[o]=function(t,e){return new f(t,u,e)}),new Bh(-1,!1)},apply:function(t,e){return e.apply(t)}},props:{attributes:function(t){var e=zh.getState(t);return e&&e.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:function(t,e){!function(t,e,n,r){if(t.editable){var o=zh.getState(t.state);if(o&&!o.dragging){var i=function(t){for(;t&&"TD"!=t.nodeName&&"TH"!=t.nodeName;)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}(e.target),s=-1;if(i){var a=i.getBoundingClientRect(),c=a.left,l=a.right;e.clientX-c<=n?s=$h(t,e,"left",n):l-e.clientX<=n&&(s=$h(t,e,"right",n))}if(s!=o.activeHandle){if(!r&&-1!==s){var u=t.state.doc.resolve(s),d=u.node(-1),f=Ff.get(d),h=u.start(-1);if(f.colCount(u.pos-h)+u.nodeAfter.attrs.colspan-1==f.width-1)return}_h(t,s)}}}}(t,e,s,p)},mouseleave:function(t){!function(t){if(t.editable){var e=zh.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&_h(t,-1)}}(t)},mousedown:function(t,e){!function(t,e,n,r){var o;if(!t.editable)return!1;var i=null!==(o=t.dom.ownerDocument.defaultView)&&void 0!==o?o:window,s=zh.getState(t.state);if(!s||-1==s.activeHandle||s.dragging)return!1;var a=t.state.doc.nodeAt(s.activeHandle),c=function(t,e,n){var r=n.colspan,o=n.colwidth,i=o&&o[o.length-1];if(i)return i;var s=t.domAtPos(e),a=s.node.childNodes[s.offset].offsetWidth,c=r;if(o)for(var l=0;l<r;l++)o[l]&&(a-=o[l],c--);return a/c}(t,s.activeHandle,a.attrs);function l(e){i.removeEventListener("mouseup",l),i.removeEventListener("mousemove",u);var r=zh.getState(t.state);(null==r?void 0:r.dragging)&&(function(t,e,n){for(var r=t.state.doc.resolve(e),o=r.node(-1),i=Ff.get(o),s=r.start(-1),a=i.colCount(r.pos-s)+r.nodeAfter.attrs.colspan-1,c=t.state.tr,l=0;l<i.height;l++){var u=l*i.width+a;if(!l||i.map[u]!=i.map[u-i.width]){var d=i.map[u],f=o.nodeAt(d).attrs,h=1==f.colspan?0:a-i.colCount(d);if(!f.colwidth||f.colwidth[h]!=n){var p=f.colwidth?f.colwidth.slice():Fh(f.colspan);p[h]=n,c.setNodeMarkup(s+d,null,y({},f,{colwidth:p}))}}}c.docChanged&&t.dispatch(c)}(t,r.activeHandle,Hh(r.dragging,e,n)),t.dispatch(t.state.tr.setMeta(zh,{setDragging:null})))}function u(e){if(!e.which)return l(e);var o=zh.getState(t.state);if(o&&o.dragging){var i=Hh(o.dragging,e,n);jh(t,o.activeHandle,i,r)}}t.dispatch(t.state.tr.setMeta(zh,{setDragging:{startX:e.clientX,startWidth:c}})),jh(t,s.activeHandle,c,r),i.addEventListener("mouseup",l),i.addEventListener("mousemove",u),e.preventDefault()}(t,e,c,u)}},decorations:function(t){var e=zh.getState(t);if(e&&e.activeHandle>-1)return function(t,e){var n=[],r=t.doc.resolve(e),o=r.node(-1);if(!o)return si.empty;for(var i=Ff.get(o),s=r.start(-1),a=i.colCount(r.pos-s)+r.nodeAfter.attrs.colspan-1,c=0;c<i.height;c++){var l=a+c*i.width;if(!(a!=i.width-1&&i.map[l]==i.map[l+1]||0!=c&&i.map[l]==i.map[l-i.width])){var u,d=i.map[l],f=s+d+o.nodeAt(d).nodeSize-1,h=document.createElement("div");h.className="column-resize-handle",(null===(u=zh.getState(t))||void 0===u?void 0:u.dragging)&&n.push(ri.node(s+d,s+d+o.nodeAt(d).nodeSize,{class:"column-resize-dragging"})),n.push(ri.widget(f,h))}}return si.create(t.doc,n)}(t,e.activeHandle)},nodeViews:{}}}),m)]:[],[(t={allowTableNodeSelection:this.options.allowTableNodeSelection},e=(void 0===t?{}:t).allowTableNodeSelection,n=void 0!==e&&e,new We({key:Kf,state:{init:function(){return null},apply:function(t,e){var n=t.getMeta(Kf);if(null!=n)return-1==n?null:n;if(null==e||!t.docChanged)return e;var r=t.mapping.mapResult(e),o=r.deleted,i=r.pos;return o?null:i}},props:{decorations:rh,handleDOMEvents:{mousedown:Nh},createSelectionBetween:function(t){return null!=Kf.getState(t.state)?t.state.selection:null},handleTripleClick:Oh,handleKeyDown:Ch,handlePaste:Eh},appendTransaction:function(t,e,r){return function(t,e,n){var r,o,i=(e||t).selection,s=(e||t).doc;if(i instanceof Re&&(o=i.node.type.spec.tableRole)){if("cell"==o||"header_cell"==o)r=eh.create(s,i.from);else if("row"==o){var a=s.resolve(i.from+1);r=eh.rowSelection(a,a)}else if(!n){var c=Ff.get(i.node),l=i.from+1,u=l+c.map[c.width*c.height-1];r=eh.create(s,l+1,u)}}else i instanceof Ee&&function(t){var e=t.$from,n=t.$to;if(e.pos==n.pos||e.pos<n.pos-6)return!1;for(var r=e.pos,o=n.pos,i=e.depth;i>=0&&!(e.after(i+1)<e.end(i));i--,r++);for(var s=n.depth;s>=0&&!(n.before(s+1)>n.start(s));s--,o--);return r==o&&/row|table/.test(e.node(i).type.spec.tableRole)}(i)?r=Ee.create(s,i.from):i instanceof Ee&&function(t){for(var e,n,r=t.$from,o=t.$to,i=r.depth;i>0;i--){var s=r.node(i);if("cell"===s.type.spec.tableRole||"header_cell"===s.type.spec.tableRole){e=s;break}}for(var a=o.depth;a>0;a--){var c=o.node(a);if("cell"===c.type.spec.tableRole||"header_cell"===c.type.spec.tableRole){n=c;break}}return e!==n&&0===o.parentOffset}(i)&&(r=Ee.create(s,i.$from.start(),i.$from.end()));return r&&(e||(e=t.tr)).setSelection(r),e}(r,sh(r,e),n)}}))])},extendNodeSchema:function(t){return{tableRole:pa(ua(t,"tableRole",{name:t.name,options:t.options,storage:t.storage}))}}}),Xh=bc.create({name:"tableKit",addExtensions:function(){var t=[];return!1!==this.options.table&&t.push(Qh.configure(this.options.table)),!1!==this.options.tableCell&&t.push(Vh.configure(this.options.tableCell)),!1!==this.options.tableHeader&&t.push(Wh.configure(this.options.tableHeader)),!1!==this.options.tableRow&&t.push(qh.configure(this.options.tableRow)),t}}),Yh=mc.create({name:"spoilerInline",addOptions:function(){return{HTMLAttributes:{class:"spoiler-inline"}}},parseHTML:function(){return[{tag:"span.spoiler-inline"},{tag:"span.spoiler_inline"}]},renderHTML:function(t){var e=t.HTMLAttributes;return["span",ga(this.options.HTMLAttributes,e),0]},addCommands:function(){var t=this;return{setSpoilerInline:function(){return function(e){return e.commands.setMark(t.name)}},toggleSpoilerInline:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetSpoilerInline:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-s":function(){return t.editor.commands.toggleSpoilerInline()}}},markdownTokenName:"spoiler_inline",markdownTokenizer:{name:"spoiler_inline",level:"inline",start:function(t){var e=t.indexOf(">!"),n=t.indexOf("||");return-1===e?n:-1===n?e:Math.min(e,n)},tokenize:function(t,e,n){var r=/^>!([^!]+)!</.exec(t);if(r)return{type:"spoiler_inline",raw:r[0],text:r[1],tokens:n.inlineTokens(r[1])};var o=/^\|\|([^|]+)\|\|/.exec(t);return o?{type:"spoiler_inline",raw:o[0],text:o[1],tokens:n.inlineTokens(o[1])}:void 0}},parseMarkdown:function(t,e){var n=e.parseInline(t.tokens||[]);return e.applyMark("spoilerInline",n)},renderMarkdown:function(t,e){return">!"+e.renderChildren(t.content||[])+"!<"}}),tp=Kc.create({name:"spoilerInlineParagraph",markdownTokenName:"spoiler_inline_paragraph",markdownTokenizer:{name:"spoiler_inline_paragraph",level:"block",start:function(t){return/^>![^\s]/.exec(t)?0:-1},tokenize:function(t,e){var n=/^(.*?)(?:\n|$)/.exec(t);if(n){var r=n[0];if(!/^>! /.test(r)&&/^>![^!]+!</.test(r))return{type:"spoiler_inline_paragraph",raw:r,text:r.replace(/\n$/,"")}}}},parseMarkdown:function(t,e){for(var n,r=t.text,o=[],i=/>!([^!]+)!</g,s=/\|\|([^|]+)\|\|/g,a=0,c=[];null!==(n=i.exec(r));)c.push({index:n.index,length:n[0].length,text:n[1],type:"spoiler"});for(;null!==(n=s.exec(r));)c.push({index:n.index,length:n[0].length,text:n[1],type:"spoiler"});c.sort(function(t,e){return t.index-e.index});for(var l=0,u=c;l<u.length;l++){var d=u[l];if(d.index>a){var f=r.slice(a,d.index);f&&o.push({type:"text",text:f})}o.push({type:"text",text:d.text,marks:[{type:"spoilerInline"}]}),a=d.index+d.length}if(a<r.length){var h=r.slice(a);h&&o.push({type:"text",text:h})}return{type:"paragraph",content:o.length>0?o:void 0}}});function ep(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var np=Kc.create({name:"spoilerBlock",group:"block",content:"block+",defining:!0,addOptions:function(){return{HTMLAttributes:{class:"spoiler-block"}}},addAttributes:function(){return{open:{default:!1,parseHTML:function(t){return t.classList.contains("is-open")},renderHTML:function(t){return t.open?{class:"is-open"}:{}}}}},parseHTML:function(){return[{tag:"spoiler"},{tag:"div.spoiler-block"},{tag:"div.spoiler"}]},renderHTML:function(t){var e=t.node,n=t.HTMLAttributes,r=["spoiler-block"];return e.attrs.open&&r.push("is-open"),["div",ga(this.options.HTMLAttributes,n,{class:r.join(" ")}),0]},addCommands:function(){var t=this;return{setSpoilerBlock:function(){return function(e){return e.commands.wrapIn(t.name)}},toggleSpoilerBlock:function(){return function(e){var n=e.commands,r=e.state,o=r.selection,i=o.from;return o.to,r.doc.nodeAt(i),t.editor.isActive(t.name)?n.lift(t.name):n.wrapIn(t.name)}},unsetSpoilerBlock:function(){return function(e){return e.commands.lift(t.name)}}}},markdownTokenName:"spoiler_block",markdownTokenizer:{name:"spoiler_block",level:"block",start:function(t){var e=/^>! /m.exec(t);return e?e.index:-1},tokenize:function(t,e,n){var r=/^(?:>! .*(?:\n|$))+/.exec(t);if(r){var o=r[0],i=o.split("\n").map(function(t){return t.replace(/^>! ?/,"")}).filter(function(t){return t.length>0||o.includes("\n")}),s=i.filter(function(t){return t.trim().length>0}).map(function(t){return{type:"paragraph",raw:t,text:t,tokens:n?n.inlineTokens(t):[{type:"text",raw:t,text:t}]}});return{type:"spoiler_block",raw:o,text:i.join("\n").trim(),tokens:s}}}},parseMarkdown:function(t,e){for(var n,r=[],o=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ep(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ep(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0;return function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(t.tokens||[]);!(n=o()).done;){var i=n.value;if("paragraph"===i.type&&i.tokens){var s=e.parseInline(i.tokens);r.push({type:"paragraph",content:s.length>0?s:void 0})}}return{type:"spoilerBlock",attrs:{open:!1},content:r.length>0?r:[{type:"paragraph",content:[]}]}},renderMarkdown:function(t,e,n){return e.renderChildren(t.content||[]).trim().split("\n").map(function(t){return">! "+t}).join("\n")+"\n\n"},addNodeView:function(){var t=this;return function(e){var n=e.node,r=e.getPos,o=e.editor,i=document.createElement("div");i.className="spoiler-block"+(n.attrs.open?" is-open":"");var s=document.createElement("div");s.className="spoiler-block-header",s.innerHTML='<span class="spoiler-block-icon"></span><span class="spoiler-block-label"></span>',s.addEventListener("click",function(t){"function"==typeof r&&void 0!==r()&&o.chain().focus().updateAttributes("spoilerBlock",{open:!n.attrs.open}).run(),t.preventDefault(),t.stopPropagation()});var a=document.createElement("div");return a.className="spoiler-block-content",i.appendChild(s),i.appendChild(a),{dom:i,contentDOM:a,update:function(e){return e.type.name===t.name&&(i.className="spoiler-block"+(e.attrs.open?" is-open":""),!0)}}}}}),rp=mc.create({name:"subscript",priority:1100,excludes:"superscript",parseHTML:function(){return[{tag:"sub"}]},renderHTML:function(){return["sub",0]},addCommands:function(){var t=this;return{setSubscript:function(){return function(e){return e.commands.setMark(t.name)}},toggleSubscript:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetSubscript:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-,":function(){return t.editor.commands.toggleSubscript()}}},markdownTokenName:"subscript",markdownTokenizer:{name:"subscript",level:"inline",start:function(t){return t.indexOf("~")},tokenize:function(t,e,n){var r=/^~\(([^)]+)\)/.exec(t);if(r)return{type:"subscript",raw:r[0],text:r[1],tokens:n.inlineTokens(r[1])};var o=/^~([^~\s]+)~(?!~)/.exec(t);return o?{type:"subscript",raw:o[0],text:o[1],tokens:n.inlineTokens(o[1])}:void 0}},parseMarkdown:function(t,e){var n=e.parseInline(t.tokens||[]);return e.applyMark("subscript",n)},renderMarkdown:function(t,e){return"~("+e.renderChildren(t.content||[])+")"}}),op=mc.create({name:"superscript",priority:1100,excludes:"subscript",parseHTML:function(){return[{tag:"sup"}]},renderHTML:function(){return["sup",0]},addCommands:function(){var t=this;return{setSuperscript:function(){return function(e){return e.commands.setMark(t.name)}},toggleSuperscript:function(){return function(e){return e.commands.toggleMark(t.name)}},unsetSuperscript:function(){return function(e){return e.commands.unsetMark(t.name)}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-.":function(){return t.editor.commands.toggleSuperscript()}}},markdownTokenName:"superscript",markdownTokenizer:{name:"superscript",level:"inline",start:function(t){return t.indexOf("^")},tokenize:function(t,e,n){var r=/^\^\(([^)]+)\)/.exec(t);if(r)return{type:"superscript",raw:r[0],text:r[1],tokens:n.inlineTokens(r[1])};var o=/^\^([^\^\s]+)\^/.exec(t);return o?{type:"superscript",raw:o[0],text:o[1],tokens:n.inlineTokens(o[1])}:void 0}},parseMarkdown:function(t,e){var n=e.parseInline(t.tokens||[]);return e.applyMark("superscript",n)},renderMarkdown:function(t,e){return"^("+e.renderChildren(t.content||[])+")"}}),ip=Kc.create({name:"blankLine",group:"block",atom:!0,selectable:!0,draggable:!0,parseHTML:function(){return[{tag:"div.lb-blank"},{tag:"span.lb-blank"}]},renderHTML:function(){return["div",{class:"lb-blank"}]},addNodeView:function(){return function(){var t=document.createElement("div");t.className="lb-blank-wrapper";var e=document.createElement("div");e.className="lb-blank";var n=document.createElement("div");return n.className="lb-blank",t.appendChild(e),t.appendChild(n),{dom:t}}},addCommands:function(){return{insertBlankLine:function(){return function(t){var e=t.tr,n=t.dispatch,r=t.state,o=r.schema.nodes.blankLine.create();if(n){var i,s=r.selection;s.node&&"blankLine"===s.node.type.name?(i=s.to,e.insert(i,o)):(i=s.from,e.replaceSelectionWith(o,!1));var a=i+o.nodeSize,c=e.doc.resolve(Math.min(a,e.doc.content.size)),l=Me.near(c,1);e.setSelection(l),n(e)}return!0}}}},addKeyboardShortcuts:function(){var t=this;return{"Mod-Shift-Enter":function(){return t.editor.commands.insertBlankLine()}}},markdownTokenName:"lb_blank",markdownTokenizer:{name:"lb_blank",level:"block",start:function(t){var e=t.indexOf("[lb-blank]");return-1===e?void 0:e},tokenize:function(t,e,n){var r=/^\[lb-blank\](?:[^\[]*)\[\/lb-blank\]/.exec(t);if(r)return{type:"lb_blank",raw:r[0]}}},parseMarkdown:function(t,e){return{type:"blankLine"}},renderMarkdown:function(t,e){return"[lb-blank][/lb-blank]\n[lb-blank][/lb-blank]\n"}}),sp=Kc.create({name:"lbIndent",group:"inline",inline:!0,atom:!0,selectable:!1,parseHTML:function(){return[{tag:"span.lb-i"}]},renderHTML:function(){return["span",{class:"lb-i"}," "]},addCommands:function(){var t=this;return{insertIndent:function(e){return void 0===e&&(e=1),function(n){var r=n.commands,o=Array(e).fill({type:t.name});return r.insertContent(o)}}}},addKeyboardShortcuts:function(){var t=this;return{Tab:function(){return!(0!==t.editor.state.selection.$from.parentOffset)&&t.editor.commands.insertIndent(2)}}},markdownTokenName:"lb_indent",markdownTokenizer:{name:"lb_indent",level:"inline",start:function(t){var e=t.indexOf("[lb-i]");return-1===e?void 0:e},tokenize:function(t,e,n){var r=/^\[lb-i\]/.exec(t);if(r)return{type:"lb_indent",raw:r[0]}}},parseMarkdown:function(t,e){return{type:"lbIndent"}},renderMarkdown:function(t,e){return"[lb-i]"}}),ap=function(){function t(){this.el=void 0,this.editor=null,this.params=null,this.inputListeners=[],this.inputListenerTimeout=null,this.oninputTimeout=null,this.keydownHandler=null,this.taskItemClickHandler=null}var e=t.prototype;return e.build=function(t,e){var n,r=this;this.params=e,this.inputListeners=e.inputListeners||[],this.el=document.createElement("div"),this.el.className=["TiptapEditor","FormControl"].concat(e.classNames).join(" "),t.appendChild(this.el),this.editor=new Ic({element:this.el,extensions:[Ef.configure({heading:{levels:[1,2,3,4,5,6]},link:{openOnClick:!1}}),Mf.configure({placeholder:e.placeholder||""}),jd.configure({HTMLAttributes:{class:"task-list"}}),_d.configure({nested:!0,HTMLAttributes:{class:"task-item"}}),Xh.configure({table:{resizable:!1,HTMLAttributes:{class:"tiptap-table"}},tableRow:{HTMLAttributes:{class:"tiptap-table-row"}},tableCell:{HTMLAttributes:{class:"tiptap-table-cell"}},tableHeader:{HTMLAttributes:{class:"tiptap-table-header"}}}),Yh,tp,np,rp,op,ip,sp,$f.configure({marked:(n=new Nf.Marked,n.setOptions({gfm:!0,breaks:!1}),n)})],content:"",editable:!e.disabled,onUpdate:function(){return r.handleUpdate()},onSelectionUpdate:function(){return r.triggerInputListeners()},onFocus:function(){return r.el.classList.add("focused")},onBlur:function(){return r.el.classList.remove("focused")},editorProps:{transformPastedHTML:function(t){var e=(new DOMParser).parseFromString(t,"text/html"),n=/^data:((?:\w+\/(?:(?!;).)+)?)((?:;[\w\W]*?[^;])*),(.+)$/;return e.querySelectorAll("img").forEach(function(t){n.test(t.src)&&t.remove()}),e.body.innerHTML}}}),e.value&&this.editor.commands.setContent(e.value,{contentType:"markdown",emitUpdate:!1}),this.taskItemClickHandler=function(t){var e,n=t.target,r=null==(e=n.closest(".task-item label"))?void 0:e.querySelector('input[type="checkbox"]');r&&(n===r||n.closest("label"))&&(t.stopImmediatePropagation(),setTimeout(function(){r.checked=!r.checked,r.dispatchEvent(new Event("change",{bubbles:!0}))},0))},this.el.addEventListener("mousedown",this.taskItemClickHandler,!0),this.keydownHandler=function(t){var e,n;(t.ctrlKey||t.metaKey)&&"Enter"===t.key&&(t.preventDefault(),null==(e=r.params)||e.onsubmit()),"Escape"===t.key&&(t.preventDefault(),null==(n=r.params)||null==n.escape||n.escape())},this.el.addEventListener("keydown",this.keydownHandler)},e.handleUpdate=function(){var t=this;this.oninputTimeout&&clearTimeout(this.oninputTimeout),this.oninputTimeout=window.setTimeout(function(){var e;null==(e=t.params)||e.oninput(t.getValue())},50),this.triggerInputListeners()},e.triggerInputListeners=function(){var t=this;this.inputListenerTimeout&&clearTimeout(this.inputListenerTimeout),this.inputListenerTimeout=window.setTimeout(function(){t.inputListeners.forEach(function(t){try{t()}catch(t){}})},50)},e.getValue=function(){return this.editor?this.editor.getMarkdown():""},e.setValue=function(t){this.editor&&this.editor.commands.setContent(t,{contentType:"markdown",emitUpdate:!1})},e.getSelectionRange=function(){if(!this.editor)return[0,0];var t=this.editor.state.selection;return[t.from,t.to]},e.moveCursorTo=function(t){var e;null==(e=this.editor)||e.commands.setTextSelection(t)},e.insertAtCursor=function(t,e){if(void 0===e&&(e=!1),this.editor)if(e){var n=this.editor.state.selection,r=n.from,o=n.to;this.editor.view.dispatch(this.editor.state.tr.insertText(t,r,o))}else this.editor.commands.insertContent(t)},e.insertAt=function(t,e,n){void 0===n&&(n=!1),this.insertBetween(t,t,e,n)},e.insertBetween=function(t,e,n,r){void 0===r&&(r=!1),this.editor&&(r?this.editor.view.dispatch(this.editor.state.tr.insertText(n,t,e)):this.editor.chain().focus().insertContentAt({from:t,to:e},n).run())},e.replaceBeforeCursor=function(t,e,n){void 0===n&&(n=!1);var r=this.getSelectionRange()[0];this.insertBetween(t,r,e,n)},e.getLastNChars=function(t){if(!this.editor)return"";var e=this.editor.state.selection.$from.nodeBefore;return e&&e.text?e.text.slice(Math.max(0,e.text.length-t)):""},e.getCaretCoordinates=function(t){var e;if(null==(e=this.editor)||!e.view)return{top:0,left:0};var n=null!=t?t:this.editor.state.selection.from,r=this.editor.view.coordsAtPos(n),o=this.el.getBoundingClientRect();return{top:r.top-o.top+this.el.scrollTop,left:r.left-o.left+this.el.scrollLeft}},e.focus=function(){var t;null==(t=this.editor)||t.commands.focus()},e.destroy=function(){var t,e;this.inputListenerTimeout&&clearTimeout(this.inputListenerTimeout),this.oninputTimeout&&clearTimeout(this.oninputTimeout),this.keydownHandler&&(this.el.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=null),this.taskItemClickHandler&&(this.el.removeEventListener("mousedown",this.taskItemClickHandler,!0),this.taskItemClickHandler=null),null==(t=this.editor)||t.destroy(),this.editor=null,null==(e=this.el)||null==(e=e.parentNode)||e.removeChild(this.el)},e.disabled=function(t){var e;null==(e=this.editor)||e.setEditable(!t),this.el.classList.toggle("disabled",t)},t}();const cp=flarum.core.compat["common/Component"];var lp=n.n(cp);const up=flarum.core.compat["common/components/Tooltip"];var dp=n.n(up);const fp=flarum.core.compat["common/utils/ItemList"];var hp=n.n(fp);const pp=flarum.core.compat["common/components/Dropdown"];var mp=n.n(pp),vp=[{level:1,label:"H1"},{level:2,label:"H2"},{level:3,label:"H3"},{level:4,label:"H4"},{level:5,label:"H5"},{level:6,label:"H6"}],gp=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).menuState=void 0,e.headingClickHandlers=void 0,e.headingKeydownHandlers=void 0,e.boundClickParagraph=void 0,e.boundKeydownParagraph=void 0,e}f(n,t),n.initAttrs=function(e){t.initAttrs.call(this,e),e.className="TiptapMenu-textType ButtonGroup"};var r=n.prototype;return r.oninit=function(e){var n=this;t.prototype.oninit.call(this,e),this.menuState=this.attrs.menuState,this.boundClickParagraph=function(t){t.preventDefault(),n.menuState.setParagraph()},this.boundKeydownParagraph=function(t){" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),n.menuState.setParagraph())},this.headingClickHandlers=new Map,this.headingKeydownHandlers=new Map,vp.forEach(function(t){var e=t.level;n.headingClickHandlers.set(e,function(t){t.preventDefault(),n.menuState.setHeading(e)}),n.headingKeydownHandlers.set(e,function(t){" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),n.menuState.setHeading(e))})})},r.getButton=function(t){var n=this.getActiveLabel(),r=u()(e().translator.trans("lady-byron-editor.forum.toolbar.text_type"));return m("button",{className:"Dropdown-toggle Button Button--icon Button--link NodeTypeButton Button--menuDropdown","data-toggle":"dropdown",disabled:this.attrs.disabled,title:r},m("span",null,n))},r.getMenu=function(t){return m("ul",{className:"Dropdown-menu dropdown-menu NodeTypeDropdownMenu"},this.getNodeTypeButtons())},r.getActiveLabel=function(){var t,e=this;if(null==(t=this.menuState)||!t.editor)return"P";var n=vp.find(function(t){return e.menuState.isActive("heading",{level:t.level})});return n?n.label:"P"},r.getNodeTypeButtons=function(){var t=this,n=[],r=this.getActiveLabel();return vp.forEach(function(o){var i=o.level,s=o.label;s!==r&&n.push(m("button",{className:"Button Button--icon Button--link NodeTypeButton",onclick:t.headingClickHandlers.get(i),onkeydown:t.headingKeydownHandlers.get(i),title:u()(e().translator.trans("lady-byron-editor.forum.toolbar.heading",{level:i})),key:s},s))}),"P"!==r&&n.push(m("button",{className:"Button Button--icon Button--link NodeTypeButton",onclick:this.boundClickParagraph,onkeydown:this.boundKeydownParagraph,title:u()(e().translator.trans("lady-byron-editor.forum.toolbar.paragraph")),key:"p"},"P")),n},n}(mp());const yp=flarum.core.compat["common/components/Button"];var kp=n.n(yp);const bp=flarum.core.compat["common/utils/Stream"];var wp=n.n(bp),xp=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).menuState=void 0,e.text=void 0,e.href=void 0,e.title=void 0,e.boundOnsubmit=void 0,e.boundRemove=void 0,e.boundOnTextInput=void 0,e.boundOnHrefInput=void 0,e.boundOnTitleInput=void 0,e}f(n,t),n.initAttrs=function(e){t.initAttrs.call(this,e),e.className="TiptapMenu-link ButtonGroup"};var r=n.prototype;return r.oninit=function(e){var n=this;t.prototype.oninit.call(this,e),this.menuState=this.attrs.menuState,this.text=wp()(""),this.href=wp()(""),this.title=wp()(""),this.boundOnsubmit=this.onsubmit.bind(this),this.boundRemove=this.remove.bind(this),this.boundOnTextInput=function(t){return n.text(t.target.value)},this.boundOnHrefInput=function(t){return n.href(t.target.value)},this.boundOnTitleInput=function(t){return n.title(t.target.value)}},r.oncreate=function(e){var n=this;t.prototype.oncreate.call(this,e),this.$().on("shown.bs.dropdown",this.onshow.bind(this)),this.$().on("shown.bs.dropdown",function(){n.$(".Dropdown-menu").find("input").first().focus().select()})},r.onremove=function(e){t.prototype.onremove.call(this,e),this.$().off("shown.bs.dropdown")},r.getButton=function(t){var n,r=(null==(n=this.menuState)?void 0:n.isActive("link"))||!1,o=u()(e().translator.trans("lady-byron-editor.forum.toolbar.link"));return m("button",{className:"Dropdown-toggle Button Button--icon Button--link Button--menuDropdown "+(r?"active":""),"data-toggle":"dropdown",disabled:this.attrs.disabled,title:o},m("span",null,c()("fas fa-link")))},r.getMenu=function(t){return m("ul",{className:"Dropdown-menu dropdown-menu FormDropdown"},m("form",{className:"Form",onsubmit:this.boundOnsubmit},this.fields()))},r.onshow=function(){if(this.menuState.isActive("link")){var t=this.menuState.getLinkAttributes();this.href(t.href),this.title(t.title),this.text("")}else this.href(""),this.title(""),this.text(this.menuState.getSelectedText())},r.fields=function(){var t=this.menuState.isActive("link"),n=this.menuState.selectionEmpty();return m("div",null,n&&!t&&m("div",{className:"Form-group"},m("input",{className:"FormControl",name:"text",placeholder:u()(e().translator.trans("lady-byron-editor.forum.toolbar.link_text_placeholder")),value:this.text(),oninput:this.boundOnTextInput,required:!0})),m("div",{className:"Form-group"},m("input",{className:"FormControl",name:"href",type:"url",placeholder:u()(e().translator.trans("lady-byron-editor.forum.toolbar.link_url_placeholder")),value:this.href(),oninput:this.boundOnHrefInput,required:!0})),m("div",{className:"Form-group"},m("input",{className:"FormControl",name:"title",placeholder:u()(e().translator.trans("lady-byron-editor.forum.toolbar.link_title_placeholder")),value:this.title(),oninput:this.boundOnTitleInput})),m("div",{className:"Form-group"},m(kp(),{type:"submit",className:"Button Button--primary"},e().translator.trans("lady-byron-editor.forum.toolbar.insert_button")),t&&m(kp(),{className:"Button Button--danger",onclick:this.boundRemove},e().translator.trans("lady-byron-editor.forum.toolbar.remove_link_button"))))},r.onsubmit=function(t){t.preventDefault(),this.closeDropdown(),this.insert()},r.insert=function(){var t=this.menuState.isActive("link");this.menuState.selectionEmpty()&&!t&&this.text()?this.menuState.insertLinkWithText(this.text(),this.href(),this.title()):this.menuState.setLink(this.href(),this.title()),this.resetFields(),e().composer.editor.focus()},r.remove=function(t){t.preventDefault(),this.closeDropdown(),this.menuState.setLink(""),this.resetFields(),e().composer.editor.focus()},r.closeDropdown=function(){document.body.click()},r.resetFields=function(){this.text(""),this.href(""),this.title("")},n}(mp()),Sp=[{key:"code",icon:"fas fa-code",tooltipKey:"code",activeCheck:"code"},{key:"ordered_list",icon:"fas fa-list-ol",tooltipKey:"ordered_list",activeCheck:"orderedList"},{key:"task_list",icon:"fas fa-tasks",tooltipKey:"task_list",activeCheck:"taskList"},{key:"strike",icon:"fas fa-strikethrough",tooltipKey:"strikethrough",activeCheck:"strike"},{key:"superscript",icon:"fas fa-superscript",tooltipKey:"superscript",activeCheck:"superscript"},{key:"subscript",icon:"fas fa-subscript",tooltipKey:"subscript",activeCheck:"subscript"},{key:"code_block",icon:"fas fa-terminal",tooltipKey:"code_block",activeCheck:"codeBlock"},{key:"spoiler_block",icon:"fas fa-caret-square-right",tooltipKey:"spoiler_block",activeCheck:"spoilerBlock"},{key:"horizontal_rule",icon:"fas fa-minus",tooltipKey:"horizontal_rule"}],Cp=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).menuState=void 0,e.clickHandlers=void 0,e.keydownHandlers=void 0,e}f(n,t),n.initAttrs=function(e){t.initAttrs.call(this,e),e.className="TiptapMenu-more ButtonGroup"};var r=n.prototype;return r.oninit=function(e){var n=this;t.prototype.oninit.call(this,e),this.menuState=this.attrs.menuState,this.clickHandlers=new Map,this.keydownHandlers=new Map;var r=function(t,e){n.clickHandlers.set(t,function(t){t.preventDefault(),e()}),n.keydownHandlers.set(t,function(t){" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),e())})};r("ordered_list",function(){return n.menuState.toggleOrderedList()}),r("task_list",function(){return n.menuState.toggleTaskList()}),r("code",function(){return n.menuState.toggleCode()}),r("strike",function(){return n.menuState.toggleStrike()}),r("superscript",function(){return n.menuState.toggleSuperscript()}),r("subscript",function(){return n.menuState.toggleSubscript()}),r("code_block",function(){return n.menuState.toggleCodeBlock()}),r("spoiler_block",function(){return n.menuState.toggleSpoilerBlock()}),r("horizontal_rule",function(){return n.menuState.insertHorizontalRule()})},r.getButton=function(t){var n=u()(e().translator.trans("lady-byron-editor.forum.toolbar.more"));return m("button",{className:"Dropdown-toggle Button Button--icon Button--link Button--menuDropdown","data-toggle":"dropdown",disabled:this.attrs.disabled,title:n},m("span",null,c()("fas fa-ellipsis-h")))},r.getMenu=function(t){return m("ul",{className:"Dropdown-menu dropdown-menu HiddenItemsDropdownMenu"},this.buttons())},r.buttons=function(){var t=this,n=this.attrs.disabled;return Sp.map(function(r){var o=!!r.activeCheck&&t.menuState.isActive(r.activeCheck),i=n||!t.menuState.editor;return m("button",{className:"Button Button--icon Button--link "+(o?"active":""),onclick:t.clickHandlers.get(r.key),onkeydown:t.keydownHandlers.get(r.key),disabled:i,title:u()(e().translator.trans("lady-byron-editor.forum.toolbar."+r.tooltipKey)),key:r.key},c()(r.icon))})},n}(mp()),Mp=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).menuState=void 0,e.rows=void 0,e.cols=void 0,e.withHeaderRow=void 0,e.boundOnsubmit=void 0,e.boundOnRowsInput=void 0,e.boundOnColsInput=void 0,e.boundOnHeaderChange=void 0,e}f(n,t),n.initAttrs=function(e){t.initAttrs.call(this,e),e.className="TiptapMenu-table ButtonGroup"};var r=n.prototype;return r.oninit=function(e){var n=this;t.prototype.oninit.call(this,e),this.menuState=this.attrs.menuState,this.rows=wp()(3),this.cols=wp()(3),this.withHeaderRow=wp()(!0),this.boundOnsubmit=this.onsubmit.bind(this),this.boundOnRowsInput=function(t){return n.rows(parseInt(t.target.value)||3)},this.boundOnColsInput=function(t){return n.cols(parseInt(t.target.value)||3)},this.boundOnHeaderChange=function(t){return n.withHeaderRow(t.target.checked)}},r.getButton=function(t){var n,r=(null==(n=this.menuState)?void 0:n.isInTable())||!1,o=u()(e().translator.trans("lady-byron-editor.forum.toolbar.table"));return m("button",{className:"Dropdown-toggle Button Button--icon Button--link Button--menuDropdown "+(r?"active":""),"data-toggle":"dropdown",disabled:this.attrs.disabled,title:o},m("span",null,c()("fas fa-table")))},r.getMenu=function(t){var e;return null!=(e=this.menuState)&&e.isInTable()?this.getEditMenu():this.getCreateMenu()},r.getCreateMenu=function(){return m("ul",{className:"Dropdown-menu dropdown-menu TableDropdown-create"},m("form",{className:"Form",onsubmit:this.boundOnsubmit},m("div",{className:"Form-group"},m("label",null,e().translator.trans("lady-byron-editor.forum.toolbar.table_rows")),m("input",{className:"FormControl",type:"number",min:"1",max:"20",value:this.rows(),oninput:this.boundOnRowsInput})),m("div",{className:"Form-group"},m("label",null,e().translator.trans("lady-byron-editor.forum.toolbar.table_cols")),m("input",{className:"FormControl",type:"number",min:"1",max:"10",value:this.cols(),oninput:this.boundOnColsInput})),m("div",{className:"Form-group"},m("label",{className:"checkbox"},m("input",{type:"checkbox",checked:this.withHeaderRow(),onchange:this.boundOnHeaderChange}),e().translator.trans("lady-byron-editor.forum.toolbar.table_header_row"))),m("div",{className:"Form-group"},m(kp(),{type:"submit",className:"Button Button--primary Button--block"},e().translator.trans("lady-byron-editor.forum.toolbar.insert_table")))))},r.getEditMenu=function(){var t=this,n=function(n,r,o){return m(kp(),{className:"Button Button--link",onclick:function(e){e.preventDefault(),n(),t.closeDropdown()},icon:o},e().translator.trans("lady-byron-editor.forum.toolbar."+r))};return m("ul",{className:"Dropdown-menu dropdown-menu TableDropdown-edit"},m("li",{className:"TableDropdown-section"},m("span",{className:"TableDropdown-sectionTitle"},e().translator.trans("lady-byron-editor.forum.toolbar.table_rows_section")),n(function(){return t.menuState.addRowBefore()},"add_row_before","fas fa-arrow-up"),n(function(){return t.menuState.addRowAfter()},"add_row_after","fas fa-arrow-down"),n(function(){return t.menuState.deleteRow()},"delete_row","fas fa-trash")),m("li",{className:"Dropdown-separator"}),m("li",{className:"TableDropdown-section"},m("span",{className:"TableDropdown-sectionTitle"},e().translator.trans("lady-byron-editor.forum.toolbar.table_cols_section")),n(function(){return t.menuState.addColumnBefore()},"add_col_before","fas fa-arrow-left"),n(function(){return t.menuState.addColumnAfter()},"add_col_after","fas fa-arrow-right"),n(function(){return t.menuState.deleteColumn()},"delete_col","fas fa-trash")),m("li",{className:"Dropdown-separator"}),m("li",{className:"TableDropdown-section"},n(function(){return t.menuState.deleteTable()},"delete_table","fas fa-trash-alt")))},r.onsubmit=function(t){t.preventDefault(),this.menuState.insertTable(this.rows(),this.cols(),this.withHeaderRow()),this.closeDropdown()},r.closeDropdown=function(){document.body.click()},n}(mp()),Tp=function(t){function n(){for(var e,n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))||this).clickHandlers=void 0,e.keydownHandlers=void 0,e}f(n,t);var r=n.prototype;return r.oninit=function(e){var n=this;t.prototype.oninit.call(this,e),this.clickHandlers=new Map,this.keydownHandlers=new Map;var r=function(t,e){n.clickHandlers.set(t,function(t){t.preventDefault(),e()}),n.keydownHandlers.set(t,function(t){" "!==t.key&&"Enter"!==t.key||(t.preventDefault(),e())})};r("bold",function(){var t;return null==(t=n.attrs.menuState)?void 0:t.toggleBold()}),r("italic",function(){var t;return null==(t=n.attrs.menuState)?void 0:t.toggleItalic()}),r("quote",function(){var t;return null==(t=n.attrs.menuState)?void 0:t.toggleBlockquote()}),r("spoiler_inline",function(){var t;return null==(t=n.attrs.menuState)?void 0:t.toggleSpoilerInline()}),r("bullet_list",function(){var t;return null==(t=n.attrs.menuState)?void 0:t.toggleBulletList()})},r.view=function(){var t=this.attrs.menuState;return null!=t&&t.editor?m("div",{className:"TiptapMenu"},this.items().toArray()):null},r.items=function(){var t=new(hp()),e=this.attrs,n=e.menuState,r=e.disabled;return n?(t.add("text_type",m(gp,{menuState:n,disabled:r}),100),t.add("bold",this.createButton("bold","fas fa-bold","bold",n.isActive("bold"),r),90),t.add("italic",this.createButton("italic","fas fa-italic","italic",n.isActive("italic"),r),80),t.add("quote",this.createButton("quote","fas fa-quote-left","quote",n.isActive("blockquote"),r),70),t.add("spoiler_inline",this.createButton("spoiler_inline","fas fa-eye-slash","spoiler_inline",n.isActive("spoilerInline"),r),65),t.add("link",m(xp,{menuState:n,disabled:r}),60),t.add("unordered_list",this.createButton("bullet_list","fas fa-list-ul","bullet_list",n.isActive("bulletList"),r),50),t.add("table",m(Mp,{menuState:n,disabled:r}),40),t.add("additional_items",m(Cp,{menuState:n,disabled:r}),0),t):t},r.createButton=function(t,n,r,o,i){var s,a=u()(e().translator.trans("lady-byron-editor.forum.toolbar."+r));return m(dp(),{text:a},m("button",{className:"Button Button--icon Button--link "+(o?"active":""),onclick:this.clickHandlers.get(t),onkeydown:this.keydownHandlers.get(t),disabled:i||!(null!=(s=this.attrs.menuState)&&s.editor)},c()(n)))},n}(lp()),Ap=function(){function t(){var t=this;this.editor=null,this.boundUpdate=null,this.redrawTimeout=null,this.handleUndoClick=function(e){e.preventDefault(),t.undo()},this.handleRedoClick=function(e){e.preventDefault(),t.redo()}}var e=t.prototype;return e.attachEditor=function(t){var e=this;this.editor=t,this.boundUpdate=function(){e.redrawTimeout&&clearTimeout(e.redrawTimeout),e.redrawTimeout=window.setTimeout(function(){return m.redraw()},16)},t.on("selectionUpdate",this.boundUpdate),t.on("update",this.boundUpdate)},e.destroy=function(){this.redrawTimeout&&(clearTimeout(this.redrawTimeout),this.redrawTimeout=null),this.editor&&this.boundUpdate&&(this.editor.off("selectionUpdate",this.boundUpdate),this.editor.off("update",this.boundUpdate)),this.boundUpdate=null,this.editor=null},e.isActive=function(t,e){var n,r;return null!=(n=null==(r=this.editor)?void 0:r.isActive(t,e))&&n},e.canUndo=function(){var t,e;return null!=(t=null==(e=this.editor)?void 0:e.can().undo())&&t},e.canRedo=function(){var t,e;return null!=(t=null==(e=this.editor)?void 0:e.can().redo())&&t},e.selectionEmpty=function(){if(!this.editor)return!0;var t=this.editor.state.selection;return t.from===t.to},e.getSelectedText=function(){if(!this.editor)return"";var t=this.editor.state.selection,e=t.from,n=t.to;return this.editor.state.doc.textBetween(e,n," ")},e.getLinkAttributes=function(){if(!this.editor)return{href:"",title:""};var t=this.editor.getAttributes("link");return{href:t.href||"",title:t.title||""}},e.toggleBold=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleBold().run()})},e.toggleItalic=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleItalic().run()})},e.toggleStrike=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleStrike().run()})},e.toggleCode=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleCode().run()})},e.toggleCodeBlock=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleCodeBlock().run()})},e.toggleBlockquote=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleBlockquote().run()})},e.toggleBulletList=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleBulletList().run()})},e.toggleOrderedList=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleOrderedList().run()})},e.toggleTaskList=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleTaskList().run()})},e.toggleSpoilerInline=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleSpoilerInline().run()})},e.toggleSpoilerBlock=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleSpoilerBlock().run()})},e.toggleSubscript=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleSubscript().run()})},e.toggleSuperscript=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().toggleSuperscript().run()})},e.setHeading=function(t){var e=this;this.runCommand(function(){var n;return null==(n=e.editor)?void 0:n.chain().focus().toggleHeading({level:t}).run()})},e.setParagraph=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().setParagraph().run()})},e.setLink=function(t,e){var n=this;this.runCommand(function(){if(t){var r,o={href:t};e&&(o.title=e),null==(r=n.editor)||r.chain().focus().setLink(o).run()}else{var i;null==(i=n.editor)||i.chain().focus().unsetLink().run()}})},e.insertLinkWithText=function(t,e,n){var r=this;this.runCommand(function(){if(r.editor){var o={href:e};n&&(o.title=n),r.editor.chain().focus().insertContent({type:"text",text:t,marks:[{type:"link",attrs:o}]}).run()}})},e.insertHorizontalRule=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().setHorizontalRule().run()})},e.insertBlankLine=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().insertBlankLine().run()})},e.insertIndent=function(t){var e=this;void 0===t&&(t=2),this.runCommand(function(){var n;return null==(n=e.editor)?void 0:n.chain().focus().insertIndent(t).run()})},e.isInTable=function(){var t,e;return null!=(t=null==(e=this.editor)?void 0:e.isActive("table"))&&t},e.insertTable=function(t,e,n){var r=this;void 0===t&&(t=3),void 0===e&&(e=3),void 0===n&&(n=!0);var o=Math.max(2,e),i=Math.max(1,t);this.runCommand(function(){var t;return null==(t=r.editor)?void 0:t.chain().focus().insertTable({rows:i,cols:o,withHeaderRow:n}).run()})},e.deleteTable=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().deleteTable().run()})},e.addRowBefore=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().addRowBefore().run()})},e.addRowAfter=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().addRowAfter().run()})},e.deleteRow=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().deleteRow().run()})},e.addColumnBefore=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().addColumnBefore().run()})},e.addColumnAfter=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().addColumnAfter().run()})},e.deleteColumn=function(){var t=this;if(this.editor){var e=this.getTableColumnCount();null!==e&&e<=2||this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().deleteColumn().run()})}},e.getTableColumnCount=function(){if(!this.editor)return null;for(var t=this.editor.state.selection.$from,e=t.depth;e>0;e--){var n=t.node(e);if("table"===n.type.name){var r,o=n.firstChild;if(!o)return null;var i="tableRow"===o.type.name?o:o.firstChild;return null!=(r=null==i?void 0:i.childCount)?r:null}}return null},e.undo=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().undo().run()})},e.redo=function(){var t=this;this.runCommand(function(){var e;return null==(e=t.editor)?void 0:e.chain().focus().redo().run()})},e.runCommand=function(t){this.editor&&(this.editor.isFocused||this.editor.commands.focus(),t())},t}();e().initializers.add("lady-byron/editor",function(){(0,o.extend)(s().prototype,"buildEditorParams",function(t){this.menuState=new Ap,t.classNames.push("Post-body"),t.escape=function(){return e().composer.close()}}),(0,o.override)(s().prototype,"buildEditor",function(t,e){var n=new ap;return n.build(e,this.buildEditorParams()),this.tiptapDriver=n,this.menuState&&n.editor&&this.menuState.attachEditor(n.editor),n}),(0,o.extend)(s().prototype,"toolbarItems",function(t){t.has("markdown")&&t.remove("markdown"),t.add("tiptap-toolbar",m(Tp,{menuState:this.menuState,disabled:this.attrs.disabled}),100);var n=this.menuState;t.add("tiptap-formatting",m("div",{className:"TiptapMenu-formatting ButtonGroup"},[m("button",{className:"Button Button--icon Button--link",title:u()(e().translator.trans("lady-byron-editor.forum.toolbar.blank_paragraph")),disabled:this.attrs.disabled||!(null!=n&&n.editor),onclick:function(t){t.preventDefault(),null==n||n.insertBlankLine()}},c()("fas fa-paragraph")),m("button",{className:"Button Button--icon Button--link",title:u()(e().translator.trans("lady-byron-editor.forum.toolbar.first_line_indent")),disabled:this.attrs.disabled||!(null!=n&&n.editor),onclick:function(t){t.preventDefault(),null==n||n.insertIndent(2)}},c()("fas fa-indent"))]),-50),t.add("tiptap-undo-redo",m("div",{className:"TiptapMenu-undoRedo ButtonGroup"},[m("button",{className:"Button Button--icon Button--link",title:u()(e().translator.trans("lady-byron-editor.forum.toolbar.undo")),disabled:this.attrs.disabled||!(null!=n&&n.canUndo()),onclick:null==n?void 0:n.handleUndoClick},c()("fas fa-undo")),m("button",{className:"Button Button--icon Button--link",title:u()(e().translator.trans("lady-byron-editor.forum.toolbar.redo")),disabled:this.attrs.disabled||!(null!=n&&n.canRedo()),onclick:null==n?void 0:n.handleRedoClick},c()("fas fa-redo"))]),-100)}),(0,o.extend)(s().prototype,"onremove",function(){this.menuState&&(this.menuState.destroy(),this.menuState=null),this.tiptapDriver&&(this.tiptapDriver=null)})})})(),module.exports=r})();
//# sourceMappingURL=forum.js.map